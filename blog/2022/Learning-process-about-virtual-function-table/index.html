<!DOCTYPE html>
<html>

    <head>
<meta charset="utf-8">
<!--dev siwtch-->
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name='apple-mobile-web-app-capable' content='yes'/>
<meta name='full-screen' content='true'/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!--dev switch end-->
<meta name="description" content="本站由哨兵安全实验室支持创办">

    <meta name="baidu-site-verification" content="codeva-Bt0LqEvH6L" />
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TJ5SFQ4KCM"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-TJ5SFQ4KCM');
</script>
<link rel="shortcut icon" href="/assets/img/favicon.png">
<link type="application/atom+xml" rel="alternate" href="/feed.xml" title="© 哨兵" />




<!-- Open Graph metadata -->
<meta property="og:type" content="website" />
<meta property="og:title" content="关于虚函数表的学习过程 | © 哨兵" />
<meta property="og:description" content=" &lt;div class=&quot;container mtb&quot;&gt;
    &lt;div class=&quot;row d-flex &quot;&gt;
        &lt;!-- SINGLE POST --&gt;
        &lt;div class=&quot;col-lg-8 markdown-body-img flex-column&quot;&gt;
            &lt;!-- Blog Post  --&gt;
            &lt;a href=&quot;/blog/2022/Learning-process-about-virtual-function-table/&quot;&gt;&lt;h1 class=&quot;ctitle&quot;&gt;关于虚函数表的学习过程&lt;/h1&gt;&lt;/a&gt;
            &lt;csmall&gt;&lt;div class=&quot;d-flex items-center&quot;&gt;
                &lt;!--article author end--&gt;

&lt;!-- site build time set to the latest time.--&gt;

&lt;!-- post time--&gt;





&lt;div class=&quot;ml-hide&quot;&gt;
    &lt;a class=&quot;f2 d-flex color-fg-default&quot; href=&quot;https://github.com/codecat11&quot; target=&quot;_blank&quot;&gt;
        codecat11

        
            
        post
        

        
        
        
        
        

        
            on Jan 9, 2022
        
    &lt;/a&gt;
&lt;/div&gt;
            &lt;/div&gt;&lt;/csmall&gt;
            &lt;div class=&quot;post-content&quot;&gt; 
            &lt;h3 id=&quot;虚函数表&quot;&gt;虚函数表&lt;/h3&gt;

&lt;h4 id=&quot;简介&quot;&gt;简介&lt;/h4&gt;

&lt;p&gt;C++面向对象的多态性，这里我们就要涉及到虚函数了，接下来我们将用反汇编来学习虚函数的原理。&lt;/p&gt;

&lt;h4 id=&quot;直接调用与简介调用&quot;&gt;直接调用与简介调用&lt;/h4&gt;

&lt;p&gt;这里的直接调用和间接调用时汇编层面上的，我们在看反汇编代码的时候经常会看到 call —- (调用函数的那个call)，那这个呢就是直接调用，而还有一种形式是这样的call [—-]那这个呢就是间接调用。&lt;/p&gt;

&lt;p&gt;直接调用和简介调用反馈到十六进制编码上就是&lt;strong&gt;E8(直接调用)&lt;/strong&gt;和&lt;strong&gt;FF(简介调用)&lt;/strong&gt;&lt;/p&gt;

&lt;h4 id=&quot;虚函数&quot;&gt;虚函数&lt;/h4&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;public:&lt;/span&gt; 
	&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function1----&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function2----&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;现在有这么一个类Base,它有两个成员函数一个不带有virtual的Function1和一个带有virtual的Function2，除此之外两函数之间基本上没啥区别，那现在我们来查看这两个函数调用的时候，它们的反汇编代码，看看它们的反汇编代码有什么区别没。&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Function2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code class=&quot;language-assembly&quot;&gt;00401030 55                   push        ebp
00401031 8B EC                mov         ebp,esp
00401033 83 EC 44             sub         esp,44h
00401036 53                   push        ebx
00401037 56                   push        esi
00401038 57                   push        edi
00401039 8D 7D BC             lea         edi,[ebp-44h]
0040103C B9 11 00 00 00       mov         ecx,11h
00401041 B8 CC CC CC CC       mov         eax,0CCCCCCCCh
00401046 F3 AB                rep stos    dword ptr [edi]
00401048 8D 4D FC             lea         ecx,[ebp-4]   //this指针
0040104B E8 BF FF FF FF       call        @ILT+10(Base::Base) (0040100f)
00401050 8D 4D FC             lea         ecx,[ebp-4]
00401053 E8 B2 FF FF FF       call        @ILT+5(Base::Function1) (0040100a)
00401058 8D 4D FC             lea         ecx,[ebp-4]
0040105B E8 A5 FF FF FF       call        @ILT+0(Base::Function2) (00401005)
00401060 33 C0                xor         eax,eax
00401062 5F                   pop         edi
00401063 5E                   pop         esi
00401064 5B                   pop         ebx
00401065 83 C4 44             add         esp,44h
00401068 3B EC                cmp         ebp,esp
0040106A E8 01 01 00 00       call        __chkesp (00401170)
0040106F 8B E5                mov         esp,ebp
00401071 5D                   pop         ebp
00401072 C3                   ret
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;我们可以看到调用这两个函数的时候使用的是直接调用还是间接调用&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;E8 B2 FF FF FF       call        @ILT+5(Base::Function1) (0040100a)&lt;/code&gt;，&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;E8 A5 FF FF FF       call        @ILT+0(Base::Function2) (00401005)&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;我们可以清楚的看到都是使用的直接调用，从反汇编的层面来看这样加不加virtual没有任何的区别。&lt;/p&gt;

&lt;p&gt;那上面我们是使用对象直接调用的这两个函数，我们就可以总结了，如果我们&lt;strong&gt;使用对象直接调用一个带virtual的函数的话它和调用普通函数是没啥区别的&lt;/strong&gt;。&lt;/p&gt;

&lt;p&gt;那我们换一种方式再来进行试验&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pbase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;pbase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;pbase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Function2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
	

	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;我创建了一个Base型的指针，然后使用指针来调用上面我们定义的这两个函数，查看其反汇编代码看看会有什么不同。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-assembly&quot;&gt;00401030 55                   push        ebp
00401031 8B EC                mov         ebp,esp
00401033 83 EC 48             sub         esp,48h
00401036 53                   push        ebx
00401037 56                   push        esi
00401038 57                   push        edi
00401039 8D 7D B8             lea         edi,[ebp-48h]
0040103C B9 12 00 00 00       mov         ecx,12h
00401041 B8 CC CC CC CC       mov         eax,0CCCCCCCCh
00401046 F3 AB                rep stos    dword ptr [edi]
00401048 8D 4D FC             lea         ecx,[ebp-4]
0040104B E8 BF FF FF FF       call        @ILT+10(Base::Base) (0040100f)
00401050 8D 45 FC             lea         eax,[ebp-4]
00401053 89 45 F8             mov         dword ptr [ebp-8],eax
00401056 8B 4D F8             mov         ecx,dword ptr [ebp-8]
00401059 E8 AC FF FF FF       call        @ILT+5(Base::Function1) (0040100a)
0040105E 8B 4D F8             mov         ecx,dword ptr [ebp-8]
00401061 8B 11                mov         edx,dword ptr [ecx]
00401063 8B F4                mov         esi,esp
00401065 8B 4D F8             mov         ecx,dword ptr [ebp-8]
00401068 FF 12                call        dword ptr [edx]
0040106A 3B F4                cmp         esi,esp
0040106C E8 FF 00 00 00       call        __chkesp (00401170)//检查堆栈平衡的不用管
00401071 33 C0                xor         eax,eax
00401073 5F                   pop         edi
00401074 5E                   pop         esi
00401075 5B                   pop         ebx
00401076 83 C4 48             add         esp,48h
00401079 3B EC                cmp         ebp,esp
0040107B E8 F0 00 00 00       call        __chkesp (00401170)
00401080 8B E5                mov         esp,ebp
00401082 5D                   pop         ebp
00401083 C3                   ret
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;可以看到这次使用指针去调用和上面拿对象进行调用具有明显的不同，调用Function1函数的时候是这样的&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;E8 AC FF FF FF       call        @ILT+5(Base::Function1) (0040100a)&lt;/code&gt;，而调用带有virtual关键字的Function函数的时候是这样的&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FF 12                call        dword ptr [edx]&lt;/code&gt;可以明显的看出来一个是直接调用一个是间接调用。&lt;/p&gt;

&lt;p&gt;由此我们可以总结出，当使用指针来调用带有virtual的函数的时候，生成的是间接调用。&lt;/p&gt;

&lt;p&gt;那除此之外虚函数还有什么特点呢？我们来继续做实验。&lt;/p&gt;

&lt;h5 id=&quot;虚函数的大小&quot;&gt;虚函数的大小&lt;/h5&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Base&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;public:&lt;/span&gt;
	&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function1----&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function2----&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;我把这个Base类改了一下，加上了两个int型的成员变量，那这个类多大呢？我们之前学过成员函数是不占有空间的，那这么看来这个类的大小应该是8字节咯。&lt;/p&gt;

&lt;p&gt;我们来测试一下看看&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%d&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220107203115476.png&quot; alt=&quot;image-20220107203115476&quot; style=&quot;zoom:80%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;可以看到结果为12字节，我们也说了之前学过普通的函数是不占有空间的，那么多出来的4字节只能是带有virtual的函数的大小了，这多出来的4字节真的是带有virtual函数的大小吗？&lt;/p&gt;

&lt;p&gt;我们再来测一下，将上面的代码再改一改&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Base&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;public:&lt;/span&gt;
	&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function1----&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function2----&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以看到我将两个成员函数都改为了带有virtual关键字的虚函数了，那我们再来测一测它的大小。&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%d&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220107203554924.png&quot; alt=&quot;image-20220107203554924&quot; style=&quot;zoom:80%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;可以看到还是12，那说明多出来的那4个字节还不是虚函数的大小，那它是什么呢？&lt;/p&gt;

&lt;h4 id=&quot;虚函数表-1&quot;&gt;虚函数表&lt;/h4&gt;

&lt;p&gt;从刚刚的实验我们知道接下来我们需要研究什么了，现在我再将上面的Base类改一改，重新测试一下，看看我们能不能得出问题的答案。&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;public:&lt;/span&gt; 
	&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以看到我将Base类的成员函数都给去掉了，加上了一个构造函数，我们来看看它的反汇编。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220107204506773.png&quot; alt=&quot;image-20220107204506773&quot; style=&quot;zoom:80%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;可以看到base里存储的数据是01 00 00 00和02 00 00 00也就是1和2，这是我们可以接受的。&lt;/p&gt;

&lt;p&gt;那再将Base改一改&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;public:&lt;/span&gt; 
	&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function1----&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;再来测一测对象base的数据&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108110526539.png&quot; alt=&quot;image-20220108110526539&quot; style=&quot;zoom:80%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;可以看到多出来的4字节的数据，而且这多出来的4字节还是在base对象的首地址。&lt;/p&gt;

&lt;p&gt;多的这4字节存储的是一个地址，我们现在来看看这个地址里存储的是什么。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108110553866.png&quot; alt=&quot;image-20220108110553866&quot; style=&quot;zoom:80%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;emmm，这里面存的值也看不出来是啥，那咱们就来测一测吧。&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pbase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;pbase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;利用指针来调用这个虚函数，仔细看看它是怎么调用的。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-assembly&quot;&gt;00401050 8D 45 F4             lea         eax,[ebp-0Ch]            //把ebp-0xc这块地址赋值给eax，ebp-0xc里是base
00401053 89 45 F0             mov         dword ptr [ebp-10h],eax  //给pbase指针赋值
00401056 8B 4D F0             mov         ecx,dword ptr [ebp-10h]  //将ebp-0x10里的值赋给ecx
00401059 8B 11                mov         edx,dword ptr [ecx]	   //将ecx里存放的值赋给edx
0040105B 8B F4                mov         esi,esp
0040105D 8B 4D F0             mov         ecx,dword ptr [ebp-10h]
00401060 FF 12                call        dword ptr [edx]           //调用edx里存放的值
00401062 3B F4                cmp         esi,esp
00401064 E8 07 01 00 00       call        __chkesp (00401170)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&quot;C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108105908197.png&quot; alt=&quot;image-20220108105908197&quot; style=&quot;zoom:80%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108105959549.png&quot; alt=&quot;image-20220108105959549&quot; style=&quot;zoom:80%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;现在我们就知道了多出来的那4个字节是干啥的了，它是用来存放虚函数实际的地址的。&lt;/p&gt;

&lt;p&gt;我们在多加一个虚函数来进行测试&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;public:&lt;/span&gt; 
	&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function1----&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function2----&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pbase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;pbase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;pbase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Function2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;观察反汇编看看有什么不一样吗？&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-assembly&quot;&gt;0040D716 8B 4D F0             mov         ecx,dword ptr [ebp-10h]
0040D719 8B 11                mov         edx,dword ptr [ecx]
0040D71B 8B F4                mov         esi,esp
0040D71D 8B 4D F0             mov         ecx,dword ptr [ebp-10h]
0040D720 FF 12                call        dword ptr [edx]
0040D722 3B F4                cmp         esi,esp
0040D724 E8 B7 39 FF FF       call        __chkesp (004010e0)
0040D729 8B 45 F0             mov         eax,dword ptr [ebp-10h]
0040D72C 8B 10                mov         edx,dword ptr [eax]
0040D72E 8B F4                mov         esi,esp
0040D730 8B 4D F0             mov         ecx,dword ptr [ebp-10h]
0040D733 FF 52 04             call        dword ptr [edx+4]  //只看这里就可以了
0040D736 3B F4                cmp         esi,esp
0040D738 E8 A3 39 FF FF       call        __chkesp (004010e0)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&quot;C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108111200919.png&quot; alt=&quot;image-20220108111200919&quot; style=&quot;zoom:80%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;可以看到base对象里还是只多出了4字节，这4个字节是用来存放虚函数真实地址的。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108111325918.png&quot; alt=&quot;image-20220108111325918&quot; style=&quot;zoom:80%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;可以看到0x00422fa4这个地址再加上4个字节的地方存放了一个新的地址，这个地址就是虚函数Function2的地址。&lt;/p&gt;

&lt;p&gt;现在我们就搞清楚了多出来的4字节是干嘛的了，它是用来存储虚函数的实际地址的。&lt;/p&gt;

&lt;h4 id=&quot;课后作业&quot;&gt;课后作业&lt;/h4&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include&amp;lt;stdio.h&amp;gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;/// &amp;lt;summary&amp;gt;&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;/// 单继承无函数覆盖(打印Sub对象的虚函数表)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;/// &amp;lt;/summary&amp;gt;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Base&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;public:&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function1----&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function2----&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Function3----&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Sub&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;public:&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sub:Function_4....&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sub:Function_5....&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sub:Function_6....&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Sub&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pFunction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;pFunction&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pFun&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nullptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;地址:%x&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;pFun&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pFunction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;pFun&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include&amp;lt;stdio.h&amp;gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;/// &amp;lt;summary&amp;gt;&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;/// 单继承有覆盖(打印Sub对象的虚函数表)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;/// &amp;lt;/summary&amp;gt;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Base&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;public:&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Base:Function1!-----&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Base:Function2!-----&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Base:Function3!-----&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Sub&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Base&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;public:&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sub:Function1!-----&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sub:Function2!-----&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sub:Function6!-----&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Sub&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pFunction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;pFunction&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pfun&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nullptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;地址:%x&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;pfun&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pFunction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;pfun&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

                &lt;!-- [x] 2022/10/20/10:49:36 fixed: while width &lt; some inch. would be flex column not display like a row.--&gt;
&lt;footer&gt;
	&lt;style&gt;.border-top {
		border-top: 1.5px solid #d0d7de!important;
	}&lt;/style&gt;
	&lt;div class=&quot;border-top&quot;&gt;&lt;/div&gt;
		&lt;section class=&quot;container-xl mt-lg-8 mt-6 px-3 px-md-6 no-print mx-auto&quot;&gt;
			&lt;div class=&quot;col-xs-4-5 pr-4 mb-8 px-md-6 container-xl mx-auto py-6 py-lg-6 clearfix &quot;&gt;
				&lt;h2 class=&quot;lead&quot;&gt;申明&lt;/h2&gt;
				&lt;div&gt;
					&lt;div class=&quot;mb-2&quot;&gt;&lt;a href=&quot;/blog/2022/Learning-process-about-virtual-function-table/&quot; target=&quot;_blank&quot; class=&quot; text-bold&quot;&gt;
						&lt;div class=&quot;fa fa-link&quot;&gt;&lt;/div&gt;
						转载请申明本文档链接&lt;/a&gt;&lt;/div&gt;
					&lt;div&gt;&lt;a href=&quot;https://github.com/codecat11&quot; target=&quot;_blank&quot;  class=&quot;text-bold&quot;&gt;
						&lt;div class=&quot;fa fa-user&quot;&gt;&lt;/div&gt;
						Post by codecat11.&lt;/a&gt;
					&lt;/div&gt;
				&lt;/div&gt;
			&lt;/div&gt;
			&lt;div class=&quot;col-xs-4-5 pr-4 mb-8 px-md-6 container-xl mx-auto py-6 py-lg-6 clearfix&quot;&gt;
				&lt;h2 class=&quot;lead&quot;&gt;贡献开源文档&lt;/h2&gt;
				&lt;div&gt;
					&lt;a href=&quot;https://github.com/Bin4xin/bin4xin.github.io/tree/main/_posts/blog/2022-01-09-Learning-process-about-virtual-function-table.md&quot; target=&quot;_blank&quot; class=&quot;no-underline btn mr-1 color-border-accent-emphasis&quot;&gt;
						&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; role=&quot;img&quot; class=&quot;octicon mr-1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot; height=&quot;16&quot; fill=&quot;currentColor&quot; style=&quot;display: inline-block; user-select: none; vertical-align: text-bottom; overflow: visible;&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;
						贡献当前开源文档
					&lt;/a&gt;
					&lt;p class=&quot;f0_8-l mt-2 text-bold&quot;&gt;此之前，学习开源贡献&lt;a target=&quot;_blank&quot; href=&quot;https://github.com/Bin4xin/bin4xin.github.io/wiki/Git操作-Git如何贡献仓库代码&quot;&gt;CN&amp;nbsp;|&lt;/a&gt;
						&lt;a target=&quot;_blank&quot; href=&quot;https://github.com/github/docs/blob/main/CONTRIBUTING.md&quot;&gt;EN&lt;/a&gt;&lt;/p&gt;
				&lt;/div&gt;
			&lt;/div&gt;
			&lt;div class=&quot;col-xs-4-5 pr-4 mb-8 px-md-6 container-xl mx-auto py-6 py-lg-6 clearfix&quot;&gt;
				&lt;h2 class=&quot;lead&quot;&gt;此文档对您有帮助吗&lt;/h2&gt;
				&lt;a href=&quot;https://github.com/Bin4xin/bin4xin.github.io/&quot; target=&quot;_blank&quot; class=&quot;no-underline&quot;&gt;
				&lt;span class=&quot;btn mr-1 color-border-accent-emphasis&quot; title=&quot;给文档仓库点个赞!&quot;&gt;
					&lt;div class=&quot;fa fa-thumbs-o-up&quot;&gt;&lt;/div&gt;
				&lt;/span&gt;
				&lt;/a&gt;
				&lt;a href=&quot;https://github.com/Bin4xin/bin4xin.github.io/issues/new?labels=Service+Issue,research&amp;template=2-bug_report.yaml&amp;title=_posts/blog/2022-01-09-Learning-process-about-virtual-function-table.md&amp;nbsp; 关于虚函数表的学习过程 | © 哨兵 | SENTINEL SECURITY, LAB&quot; target=&quot;_blank&quot;&gt;
				&lt;span class=&quot;btn mr-1 color-border-accent-emphasis&quot; title=&quot;本文档有问题?&quot;&gt;
				&lt;div class=&quot;fa fa-thumbs-o-down&quot;&gt;&lt;/div&gt;
				&lt;/span&gt;
				&lt;/a&gt;
			&lt;/div&gt;
		&lt;/section&gt;
&lt;/footer&gt;
            &lt;/div&gt;
            &lt;div class=&quot;spacing&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;&lt;!--/col-lg-8 --&gt;
        
&lt;div class=&quot;col-md-4 ml-hide table-of-contents__left-border&quot; style=&quot;max-height: 100%&quot;&gt;
    &lt;div class=&quot;nav nav-stacked tableOfContents_35-E thin-scrollbar position-sticky top-0&quot;&gt;
        &lt;li class=&quot; table-of-contents&quot;&gt;
            &lt;code-index-css&gt;
                &lt;ul&gt;&lt;li class=&quot;no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column&quot;&gt;&lt;a&gt;文章目录&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;
                &lt;ul id=&quot;toc&quot; class=&quot;section-nav&quot;&gt;
&lt;li class=&quot;no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h3&quot;&gt;&lt;a href=&quot;#虚函数表&quot;&gt;虚函数表&lt;/a&gt;
&lt;ul&gt;
&lt;li class=&quot;no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h4&quot;&gt;&lt;a href=&quot;#简介&quot;&gt;简介&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h4&quot;&gt;&lt;a href=&quot;#直接调用与简介调用&quot;&gt;直接调用与简介调用&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h4&quot;&gt;&lt;a href=&quot;#虚函数&quot;&gt;虚函数&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h4&quot;&gt;&lt;a href=&quot;#虚函数表-1&quot;&gt;虚函数表&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h4&quot;&gt;&lt;a href=&quot;#课后作业&quot;&gt;课后作业&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
            &lt;/code-index-css&gt;
        &lt;/li&gt;
    &lt;/div&gt;
&lt;/div&gt;

    &lt;/div&gt;&lt;!--/row --&gt;
&lt;/div&gt;&lt;!--/container --&gt;哨兵安全实验室 SENTINEL SECURITY, LAB" />
<meta property="og:image" content="https://bin4xin.sentrylab.cn/assets/img/logo-share.png" /> <!-- WeChat requires that thumbnail image is larger than 300x300 -->
<meta property="og:url" content="https://bin4xin.sentrylab.cn/blog/2022/Learning-process-about-virtual-function-table/" />
<title> 关于虚函数表的学习过程 | © 哨兵 | SENTINEL SECURITY, LAB</title>

<link rel="stylesheet" type="text/css" href="/assets/css/pace-minimal.css">
<link rel="stylesheet" type="text/css" href="/assets/css/footer.css">
<script src="/assets/js/pace.min.js"></script>
<!-- Bootstrap core CSS -->
<link href="/assets/css/bootstrap.css" rel="stylesheet">
<link href="/assets/css/bilibili_icon.css" rel="stylesheet">

    <!-- Custom styles for this template -->
<link href="/assets/css/style.css" rel="stylesheet">
<link href="/assets/css/font-awesome.min.css" rel="stylesheet">
<link href="/assets/css/font-awesome-v4-shims.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/assets/css/card.css">

<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>
<script src="/assets/js/jquery.sticky/1.0.4/jquery.sticky.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>

<!--mathjax-config scripts.-->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        inlineMath: [['$$','$$']]
      }
    });
</script>
<script src="/assets/js/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<!--mathjax-config scripts stop.-->



</head>


    <body>

                <!--
#####################################################################################################################
|  1.Fixed navbar issues #3 visit https://github.com/Bin4xin/bin4xin.github.io/issues/3                             |
|    change `position: fixed` to `position: sticky`                                                                 |
|                                                                                                                   |
|  2.Fixed navbar padding-top equals to 70px                                                                        |
|    `./assets/css/style.scss` @import struture in `./assets/css/_struture.scss` del `padding-top=70px` in body.    |
#####################################################################################################################-->
<style>
.nav>li>a {
    padding: 10px 15px;
}
</style>
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <div class="flex-justify-center-l flex-justify-between">
                <!-- 代码引用申明/code reference declaration:
                @ [click this icon -> scroll to top of page;] code from anquanke. visit any posts in https://www.anquanke.com/
                <del>also this icon func are under-construction</del>
                DONE.
                -->
                <div>
                    <picture>
  
  
  <source srcset="/assets/img/logo-small-dark.png 1x, /assets/img/logo-small-dark@2x.png 2x, /assets/img/logo-small-dark@3x.png 3x, /assets/img/logo-small-dark@4x.png 4x" media="(prefers-color-scheme: dark)" />
  
  
  
  <img src="/assets/img/logo-small.jpg" srcset="/assets/img/logo-small.png 1x, /assets/img/logo-small@2x.png 2x, /assets/img/logo-small@3x.png 3x, /assets/img/logo-small@4x.png 4x" />
  
</picture>
                    
                </div>
                <div>
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button></div>
            </div>
        </div>
        <div class="navbar-collapse collapse navbar-right">
            <ul class="nav navbar-nav">
                
                <li ><a href="/"><div class="fa fa-search"></div></a></li>
                <li class="active"><a href="/blog/">BLOG</a></li>
                <li ><a href="/categories/">CATEGORIES</a></li>
                <li ><a href="/daily/">DAILY</a></li>
                <li ><a href="/newest">NEWEST</a></li>
                <li ><a href="/about/">RESEARCH</a></li>
                <li ><a href="/feed.xml">RSS</a></li>
                
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</div>
                <div class="container mtb">
    <div class="row d-flex ">
        <!-- SINGLE POST -->
        <div class="col-lg-8 markdown-body-img flex-column">
            <!-- Blog Post  -->
            <a href="/blog/2022/Learning-process-about-virtual-function-table/"><h1 class="ctitle">关于虚函数表的学习过程</h1></a>
            <csmall><div class="d-flex items-center">
                <!--article author end-->

<!-- site build time set to the latest time.-->

<!-- post time-->





<div class="ml-hide">
    <a class="f2 d-flex color-fg-default" href="https://github.com/codecat11" target="_blank">
        codecat11

        
            
        post
        

        
        
        
        
        

        
            on Jan 9, 2022
        
    </a>
</div>
            </div></csmall>
            <div class="post-content"> 
            <h3 id="虚函数表">虚函数表</h3>

<h4 id="简介">简介</h4>

<p>C++面向对象的多态性，这里我们就要涉及到虚函数了，接下来我们将用反汇编来学习虚函数的原理。</p>

<h4 id="直接调用与简介调用">直接调用与简介调用</h4>

<p>这里的直接调用和间接调用时汇编层面上的，我们在看反汇编代码的时候经常会看到 call —- (调用函数的那个call)，那这个呢就是直接调用，而还有一种形式是这样的call [—-]那这个呢就是间接调用。</p>

<p>直接调用和简介调用反馈到十六进制编码上就是<strong>E8(直接调用)</strong>和<strong>FF(简介调用)</strong></p>

<h4 id="虚函数">虚函数</h4>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Base</span><span class="p">{</span>
<span class="nl">public:</span> 
	<span class="kt">void</span> <span class="n">Function1</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function1----"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function2</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function2----"</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>现在有这么一个类Base,它有两个成员函数一个不带有virtual的Function1和一个带有virtual的Function2，除此之外两函数之间基本上没啥区别，那现在我们来查看这两个函数调用的时候，它们的反汇编代码，看看它们的反汇编代码有什么区别没。</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>

	<span class="n">Base</span> <span class="n">base</span><span class="p">;</span>
	<span class="n">base</span><span class="p">.</span><span class="n">Function1</span><span class="p">();</span>
	<span class="n">base</span><span class="p">.</span><span class="n">Function2</span><span class="p">();</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div></div>

<pre><code class="language-assembly">00401030 55                   push        ebp
00401031 8B EC                mov         ebp,esp
00401033 83 EC 44             sub         esp,44h
00401036 53                   push        ebx
00401037 56                   push        esi
00401038 57                   push        edi
00401039 8D 7D BC             lea         edi,[ebp-44h]
0040103C B9 11 00 00 00       mov         ecx,11h
00401041 B8 CC CC CC CC       mov         eax,0CCCCCCCCh
00401046 F3 AB                rep stos    dword ptr [edi]
00401048 8D 4D FC             lea         ecx,[ebp-4]   //this指针
0040104B E8 BF FF FF FF       call        @ILT+10(Base::Base) (0040100f)
00401050 8D 4D FC             lea         ecx,[ebp-4]
00401053 E8 B2 FF FF FF       call        @ILT+5(Base::Function1) (0040100a)
00401058 8D 4D FC             lea         ecx,[ebp-4]
0040105B E8 A5 FF FF FF       call        @ILT+0(Base::Function2) (00401005)
00401060 33 C0                xor         eax,eax
00401062 5F                   pop         edi
00401063 5E                   pop         esi
00401064 5B                   pop         ebx
00401065 83 C4 44             add         esp,44h
00401068 3B EC                cmp         ebp,esp
0040106A E8 01 01 00 00       call        __chkesp (00401170)
0040106F 8B E5                mov         esp,ebp
00401071 5D                   pop         ebp
00401072 C3                   ret
</code></pre>

<p>我们可以看到调用这两个函数的时候使用的是直接调用还是间接调用<code class="language-plaintext highlighter-rouge">E8 B2 FF FF FF       call        @ILT+5(Base::Function1) (0040100a)</code>，<code class="language-plaintext highlighter-rouge">E8 A5 FF FF FF       call        @ILT+0(Base::Function2) (00401005)</code></p>

<p>我们可以清楚的看到都是使用的直接调用，从反汇编的层面来看这样加不加virtual没有任何的区别。</p>

<p>那上面我们是使用对象直接调用的这两个函数，我们就可以总结了，如果我们<strong>使用对象直接调用一个带virtual的函数的话它和调用普通函数是没啥区别的</strong>。</p>

<p>那我们换一种方式再来进行试验</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">Base</span> <span class="n">base</span><span class="p">;</span>
	<span class="n">Base</span><span class="o">*</span> <span class="n">pbase</span><span class="o">=&amp;</span><span class="n">base</span><span class="p">;</span>
	<span class="n">pbase</span><span class="o">-&gt;</span><span class="n">Function1</span><span class="p">();</span>
	<span class="n">pbase</span><span class="o">-&gt;</span><span class="n">Function2</span><span class="p">();</span>
	

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div></div>

<p>我创建了一个Base型的指针，然后使用指针来调用上面我们定义的这两个函数，查看其反汇编代码看看会有什么不同。</p>

<pre><code class="language-assembly">00401030 55                   push        ebp
00401031 8B EC                mov         ebp,esp
00401033 83 EC 48             sub         esp,48h
00401036 53                   push        ebx
00401037 56                   push        esi
00401038 57                   push        edi
00401039 8D 7D B8             lea         edi,[ebp-48h]
0040103C B9 12 00 00 00       mov         ecx,12h
00401041 B8 CC CC CC CC       mov         eax,0CCCCCCCCh
00401046 F3 AB                rep stos    dword ptr [edi]
00401048 8D 4D FC             lea         ecx,[ebp-4]
0040104B E8 BF FF FF FF       call        @ILT+10(Base::Base) (0040100f)
00401050 8D 45 FC             lea         eax,[ebp-4]
00401053 89 45 F8             mov         dword ptr [ebp-8],eax
00401056 8B 4D F8             mov         ecx,dword ptr [ebp-8]
00401059 E8 AC FF FF FF       call        @ILT+5(Base::Function1) (0040100a)
0040105E 8B 4D F8             mov         ecx,dword ptr [ebp-8]
00401061 8B 11                mov         edx,dword ptr [ecx]
00401063 8B F4                mov         esi,esp
00401065 8B 4D F8             mov         ecx,dword ptr [ebp-8]
00401068 FF 12                call        dword ptr [edx]
0040106A 3B F4                cmp         esi,esp
0040106C E8 FF 00 00 00       call        __chkesp (00401170)//检查堆栈平衡的不用管
00401071 33 C0                xor         eax,eax
00401073 5F                   pop         edi
00401074 5E                   pop         esi
00401075 5B                   pop         ebx
00401076 83 C4 48             add         esp,48h
00401079 3B EC                cmp         ebp,esp
0040107B E8 F0 00 00 00       call        __chkesp (00401170)
00401080 8B E5                mov         esp,ebp
00401082 5D                   pop         ebp
00401083 C3                   ret
</code></pre>

<p>可以看到这次使用指针去调用和上面拿对象进行调用具有明显的不同，调用Function1函数的时候是这样的<code class="language-plaintext highlighter-rouge">E8 AC FF FF FF       call        @ILT+5(Base::Function1) (0040100a)</code>，而调用带有virtual关键字的Function函数的时候是这样的<code class="language-plaintext highlighter-rouge">FF 12                call        dword ptr [edx]</code>可以明显的看出来一个是直接调用一个是间接调用。</p>

<p>由此我们可以总结出，当使用指针来调用带有virtual的函数的时候，生成的是间接调用。</p>

<p>那除此之外虚函数还有什么特点呢？我们来继续做实验。</p>

<h5 id="虚函数的大小">虚函数的大小</h5>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Base</span> <span class="p">{</span>
<span class="nl">public:</span>
	<span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">Function1</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function1----</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function2</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function2----</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>我把这个Base类改了一下，加上了两个int型的成员变量，那这个类多大呢？我们之前学过成员函数是不占有空间的，那这么看来这个类的大小应该是8字节咯。</p>

<p>我们来测试一下看看</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Base</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220107203115476.png" alt="image-20220107203115476" style="zoom:80%;" /></p>

<p>可以看到结果为12字节，我们也说了之前学过普通的函数是不占有空间的，那么多出来的4字节只能是带有virtual的函数的大小了，这多出来的4字节真的是带有virtual函数的大小吗？</p>

<p>我们再来测一下，将上面的代码再改一改</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Base</span> <span class="p">{</span>
<span class="nl">public:</span>
	<span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function1</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function1----</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function2</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function2----</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>可以看到我将两个成员函数都改为了带有virtual关键字的虚函数了，那我们再来测一测它的大小。</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Base</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220107203554924.png" alt="image-20220107203554924" style="zoom:80%;" /></p>

<p>可以看到还是12，那说明多出来的那4个字节还不是虚函数的大小，那它是什么呢？</p>

<h4 id="虚函数表-1">虚函数表</h4>

<p>从刚刚的实验我们知道接下来我们需要研究什么了，现在我再将上面的Base类改一改，重新测试一下，看看我们能不能得出问题的答案。</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Base</span><span class="p">{</span>
<span class="nl">public:</span> 
	<span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">b</span><span class="p">;</span>
	<span class="n">Base</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>可以看到我将Base类的成员函数都给去掉了，加上了一个构造函数，我们来看看它的反汇编。</p>

<p><img src="C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220107204506773.png" alt="image-20220107204506773" style="zoom:80%;" /></p>

<p>可以看到base里存储的数据是01 00 00 00和02 00 00 00也就是1和2，这是我们可以接受的。</p>

<p>那再将Base改一改</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Base</span><span class="p">{</span>
<span class="nl">public:</span> 
	<span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">b</span><span class="p">;</span>
	<span class="n">Base</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function1</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function1----"</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>再来测一测对象base的数据</p>

<p><img src="C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108110526539.png" alt="image-20220108110526539" style="zoom:80%;" /></p>

<p>可以看到多出来的4字节的数据，而且这多出来的4字节还是在base对象的首地址。</p>

<p>多的这4字节存储的是一个地址，我们现在来看看这个地址里存储的是什么。</p>

<p><img src="C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108110553866.png" alt="image-20220108110553866" style="zoom:80%;" /></p>

<p>emmm，这里面存的值也看不出来是啥，那咱们就来测一测吧。</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">Base</span> <span class="n">base</span><span class="p">;</span>
	<span class="n">Base</span><span class="o">*</span> <span class="n">pbase</span><span class="o">=&amp;</span><span class="n">base</span><span class="p">;</span>
	<span class="n">pbase</span><span class="o">-&gt;</span><span class="n">Function1</span><span class="p">();</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>利用指针来调用这个虚函数，仔细看看它是怎么调用的。</p>

<pre><code class="language-assembly">00401050 8D 45 F4             lea         eax,[ebp-0Ch]            //把ebp-0xc这块地址赋值给eax，ebp-0xc里是base
00401053 89 45 F0             mov         dword ptr [ebp-10h],eax  //给pbase指针赋值
00401056 8B 4D F0             mov         ecx,dword ptr [ebp-10h]  //将ebp-0x10里的值赋给ecx
00401059 8B 11                mov         edx,dword ptr [ecx]	   //将ecx里存放的值赋给edx
0040105B 8B F4                mov         esi,esp
0040105D 8B 4D F0             mov         ecx,dword ptr [ebp-10h]
00401060 FF 12                call        dword ptr [edx]           //调用edx里存放的值
00401062 3B F4                cmp         esi,esp
00401064 E8 07 01 00 00       call        __chkesp (00401170)
</code></pre>

<p><img src="C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108105908197.png" alt="image-20220108105908197" style="zoom:80%;" /></p>

<p><img src="C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108105959549.png" alt="image-20220108105959549" style="zoom:80%;" /></p>

<p>现在我们就知道了多出来的那4个字节是干啥的了，它是用来存放虚函数实际的地址的。</p>

<p>我们在多加一个虚函数来进行测试</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Base</span><span class="p">{</span>
<span class="nl">public:</span> 
	<span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">b</span><span class="p">;</span>
	<span class="n">Base</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function1</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function1----"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function2</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function2----</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">Base</span> <span class="n">base</span><span class="p">;</span>
	<span class="n">Base</span><span class="o">*</span> <span class="n">pbase</span><span class="o">=&amp;</span><span class="n">base</span><span class="p">;</span>
	<span class="n">pbase</span><span class="o">-&gt;</span><span class="n">Function1</span><span class="p">();</span>
	<span class="n">pbase</span><span class="o">-&gt;</span><span class="n">Function2</span><span class="p">();</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>观察反汇编看看有什么不一样吗？</p>

<pre><code class="language-assembly">0040D716 8B 4D F0             mov         ecx,dword ptr [ebp-10h]
0040D719 8B 11                mov         edx,dword ptr [ecx]
0040D71B 8B F4                mov         esi,esp
0040D71D 8B 4D F0             mov         ecx,dword ptr [ebp-10h]
0040D720 FF 12                call        dword ptr [edx]
0040D722 3B F4                cmp         esi,esp
0040D724 E8 B7 39 FF FF       call        __chkesp (004010e0)
0040D729 8B 45 F0             mov         eax,dword ptr [ebp-10h]
0040D72C 8B 10                mov         edx,dword ptr [eax]
0040D72E 8B F4                mov         esi,esp
0040D730 8B 4D F0             mov         ecx,dword ptr [ebp-10h]
0040D733 FF 52 04             call        dword ptr [edx+4]  //只看这里就可以了
0040D736 3B F4                cmp         esi,esp
0040D738 E8 A3 39 FF FF       call        __chkesp (004010e0)
</code></pre>

<p><img src="C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108111200919.png" alt="image-20220108111200919" style="zoom:80%;" /></p>

<p>可以看到base对象里还是只多出了4字节，这4个字节是用来存放虚函数真实地址的。</p>

<p><img src="C:\Users\86173\AppData\Roaming\Typora\typora-user-images\image-20220108111325918.png" alt="image-20220108111325918" style="zoom:80%;" /></p>

<p>可以看到0x00422fa4这个地址再加上4个字节的地方存放了一个新的地址，这个地址就是虚函数Function2的地址。</p>

<p>现在我们就搞清楚了多出来的4字节是干嘛的了，它是用来存储虚函数的实际地址的。</p>

<h4 id="课后作业">课后作业</h4>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include&lt;stdio.h&gt;
</span><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// 单继承无函数覆盖(打印Sub对象的虚函数表)</span>
<span class="c1">/// &lt;/summary&gt;</span>

<span class="k">class</span> <span class="nc">Base</span> <span class="p">{</span>
<span class="nl">public:</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function1</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function1----</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function2</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function2----</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function3</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Function3----</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>

<span class="p">};</span>

<span class="k">class</span> <span class="nc">Sub</span><span class="o">:</span><span class="n">Base</span>
<span class="p">{</span>
<span class="nl">public:</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function4</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Sub:Function_4....</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function5</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Sub:Function_5....</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function6</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Sub:Function_6....</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>

<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">Sub</span> <span class="n">s</span><span class="p">;</span>
	<span class="k">typedef</span> <span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">pFunction</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="n">pFunction</span> <span class="n">pFun</span><span class="o">=</span><span class="nb">nullptr</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"地址:%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="o">*</span><span class="p">(((</span><span class="kt">int</span><span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="p">((</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">s</span><span class="p">)))</span><span class="o">+</span><span class="n">i</span><span class="p">));</span>
		<span class="n">pFun</span> <span class="o">=</span> <span class="p">(</span><span class="n">pFunction</span><span class="p">)(</span><span class="o">*</span><span class="p">(((</span><span class="kt">int</span><span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="p">((</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">s</span><span class="p">)))</span> <span class="o">+</span> <span class="n">i</span><span class="p">));</span>
		<span class="n">pFun</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include&lt;stdio.h&gt;
</span><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// 单继承有覆盖(打印Sub对象的虚函数表)</span>
<span class="c1">/// &lt;/summary&gt;</span>

<span class="k">class</span> <span class="nc">Base</span> <span class="p">{</span>
<span class="nl">public:</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function1</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Base:Function1!-----"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function2</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Base:Function2!-----"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function3</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Base:Function3!-----"</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Sub</span> <span class="o">:</span><span class="n">Base</span> <span class="p">{</span>
<span class="nl">public:</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function1</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Sub:Function1!-----"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function2</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Sub:Function2!-----"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Function6</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Sub:Function6!-----"</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">Sub</span> <span class="n">s</span><span class="p">;</span>
	<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">pFunction</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="n">pFunction</span> <span class="n">pfun</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"地址:%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="o">*</span><span class="p">(((</span><span class="kt">int</span><span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">s</span><span class="p">))</span><span class="o">+</span><span class="n">i</span><span class="p">));</span>
		<span class="n">pfun</span> <span class="o">=</span> <span class="p">(</span><span class="n">pFunction</span><span class="p">)(</span><span class="o">*</span><span class="p">(((</span><span class="kt">int</span><span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">s</span><span class="p">))</span> <span class="o">+</span> <span class="n">i</span><span class="p">));</span>
		<span class="n">pfun</span><span class="p">();</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

                <!-- [x] 2022/10/20/10:49:36 fixed: while width < some inch. would be flex column not display like a row.-->
<footer>
	<style>.border-top {
		border-top: 1.5px solid #d0d7de!important;
	}</style>
	<div class="border-top"></div>
		<section class="container-xl mt-lg-8 mt-6 px-3 px-md-6 no-print mx-auto">
			<div class="col-xs-4-5 pr-4 mb-8 px-md-6 container-xl mx-auto py-6 py-lg-6 clearfix ">
				<h2 class="lead">申明</h2>
				<div>
					<div class="mb-2"><a href="/blog/2022/Learning-process-about-virtual-function-table/" target="_blank" class=" text-bold">
						<div class="fa fa-link"></div>
						转载请申明本文档链接</a></div>
					<div><a href="https://github.com/codecat11" target="_blank"  class="text-bold">
						<div class="fa fa-user"></div>
						Post by codecat11.</a>
					</div>
				</div>
			</div>
			<div class="col-xs-4-5 pr-4 mb-8 px-md-6 container-xl mx-auto py-6 py-lg-6 clearfix">
				<h2 class="lead">贡献开源文档</h2>
				<div>
					<a href="https://github.com/Bin4xin/bin4xin.github.io/tree/main/_posts/blog/2022-01-09-Learning-process-about-virtual-function-table.md" target="_blank" class="no-underline btn mr-1 color-border-accent-emphasis">
						<svg aria-hidden="true" focusable="false" role="img" class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display: inline-block; user-select: none; vertical-align: text-bottom; overflow: visible;"><path fill-rule="evenodd" d="M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z"></path></svg>
						贡献当前开源文档
					</a>
					<p class="f0_8-l mt-2 text-bold">此之前，学习开源贡献<a target="_blank" href="https://github.com/Bin4xin/bin4xin.github.io/wiki/Git操作-Git如何贡献仓库代码">CN&nbsp;|</a>
						<a target="_blank" href="https://github.com/github/docs/blob/main/CONTRIBUTING.md">EN</a></p>
				</div>
			</div>
			<div class="col-xs-4-5 pr-4 mb-8 px-md-6 container-xl mx-auto py-6 py-lg-6 clearfix">
				<h2 class="lead">此文档对您有帮助吗</h2>
				<a href="https://github.com/Bin4xin/bin4xin.github.io/" target="_blank" class="no-underline">
				<span class="btn mr-1 color-border-accent-emphasis" title="给文档仓库点个赞!">
					<div class="fa fa-thumbs-o-up"></div>
				</span>
				</a>
				<a href="https://github.com/Bin4xin/bin4xin.github.io/issues/new?labels=Service+Issue,research&template=2-bug_report.yaml&title=_posts/blog/2022-01-09-Learning-process-about-virtual-function-table.md&nbsp; 关于虚函数表的学习过程 | © 哨兵 | SENTINEL SECURITY, LAB" target="_blank">
				<span class="btn mr-1 color-border-accent-emphasis" title="本文档有问题?">
				<div class="fa fa-thumbs-o-down"></div>
				</span>
				</a>
			</div>
		</section>
</footer>
            </div>
            <div class="spacing"></div>
        </div><!--/col-lg-8 -->
        
<div class="col-md-4 ml-hide table-of-contents__left-border" style="max-height: 100%">
    <div class="nav nav-stacked tableOfContents_35-E thin-scrollbar position-sticky top-0">
        <li class=" table-of-contents">
            <code-index-css>
                <ul><li class="no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column"><a>文章目录</a></li></ul>
                <ul id="toc" class="section-nav">
<li class="no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h3"><a href="#虚函数表">虚函数表</a>
<ul>
<li class="no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h4"><a href="#简介">简介</a></li>
<li class="no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h4"><a href="#直接调用与简介调用">直接调用与简介调用</a></li>
<li class="no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h4"><a href="#虚函数">虚函数</a></li>
<li class="no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h4"><a href="#虚函数表-1">虚函数表</a></li>
<li class="no-underline table-of-contents Item__StyledItem-sc-yeql7o-2 edSFyN flex-column toc-h4"><a href="#课后作业">课后作业</a></li>
</ul>
</li>
</ul>
            </code-index-css>
        </li>
    </div>
</div>

    </div><!--/row -->
</div><!--/container -->
                <!-- 代码引用申明/code reference declaration:
#############################################################################
## code from cloudflare. visit footer in https://www.cloudflare.com/zh-cn/ ##
#############################################################################
-->

<div id="footerwrap" class="hidden-print">
    <div class="footer-container">
        <div class="pt3 pt3-ns pt3-m pt7-l pb0 pb0-ns pb0-m pb5-l">
            <div class="footer-row">
                
<div class="footer-col-lg-2">
    <details class="bb bb-ns bb-m bn-l b--white pv2 pv2-ns pv2-m pv0-l" open>
        <summary class="fw6 mt0 flex justify-between mb0 mb0-ns mb0-m mb1-l lh-copy f2 f2-ns f2-m f3-l ">
            <span class="footer-abstract point"><strong>入门</strong></span>
        </summary>
        <ul class="db db-ns db-m db-l ma0 pa0 mt2 mt2-ns mt2-m mt0-l list">
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="/usage/" target="_blank">快速开始</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="/blog/2019/jekyll/in/linux/" target="_blank">博客搭建</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="/blog/2019/nginx/with/jekyll-site/" target="_blank">公网部署</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://github.com/tuna/mirror-web/" target="_blank">Jekyll Tuna源码</a></li>
            
            
        </ul>
    </details>
</div>

<div class="footer-col-lg-2">
    <details class="bb bb-ns bb-m bn-l b--white pv2 pv2-ns pv2-m pv0-l" open>
        <summary class="fw6 mt0 flex justify-between mb0 mb0-ns mb0-m mb1-l lh-copy f2 f2-ns f2-m f3-l ">
            <span class="footer-abstract point"><strong>社区</strong></span>
        </summary>
        <ul class="db db-ns db-m db-l ma0 pa0 mt2 mt2-ns mt2-m mt0-l list">
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://github.com/Bin4xin/bigger-than-bigger/" target="_blank">Bigger than Bigger</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://github.com/Bin4xin/bigger-than-bigger/tree/master/CoVV" target="_blank">Collection Of Verified Vulnerabilities</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://github.com/Bin4xin/sweet-ysoserial" target="_blank">sweet-ysoserial</a></li>
            
            
        </ul>
    </details>
</div>

<div class="footer-col-lg-2">
    <details class="bb bb-ns bb-m bn-l b--white pv2 pv2-ns pv2-m pv0-l" open>
        <summary class="fw6 mt0 flex justify-between mb0 mb0-ns mb0-m mb1-l lh-copy f2 f2-ns f2-m f3-l ">
            <span class="footer-abstract point"><strong>技术栈</strong></span>
        </summary>
        <ul class="db db-ns db-m db-l ma0 pa0 mt2 mt2-ns mt2-m mt0-l list">
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://jekyllrb.com/docs/" target="_blank">Jekyll</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://www.markdownguide.org/" target="_blank">MarkDown</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://www.cloudflare.com/waf/" target="_blank">CloudFlare WAF</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://dash.cloudflare.com/dns/" target="_blank">CloudFlare CDN</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://github.com/features/actions" target="_blank">Github Action</a></li>
            
            
        </ul>
    </details>
</div>

<div class="footer-col-lg-2">
    <details class="bb bb-ns bb-m bn-l b--white pv2 pv2-ns pv2-m pv0-l" open>
        <summary class="fw6 mt0 flex justify-between mb0 mb0-ns mb0-m mb1-l lh-copy f2 f2-ns f2-m f3-l ">
            <span class="footer-abstract point"><strong>关于</strong></span>
        </summary>
        <ul class="db db-ns db-m db-l ma0 pa0 mt2 mt2-ns mt2-m mt0-l list">
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="/about/" target="_blank">近期研究</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="/blog/" target="_blank">博客</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://github.com/Bin4xin/bin4xin.github.io/wiki" target="_blank">WIKI</a></li>
            
            
        </ul>
    </details>
</div>

<div class="footer-col-lg-2">
    <details class="bb bb-ns bb-m bn-l b--white pv2 pv2-ns pv2-m pv0-l" open>
        <summary class="fw6 mt0 flex justify-between mb0 mb0-ns mb0-m mb1-l lh-copy f2 f2-ns f2-m f3-l ">
            <span class="footer-abstract point"><strong>贡献者</strong></span>
        </summary>
        <ul class="db db-ns db-m db-l ma0 pa0 mt2 mt2-ns mt2-m mt0-l list">
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://github.com/bin4xin" target="_blank">本阿信</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://github.com/dnf-2008" target="_blank">夏天の风</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="https://github.com/Yang2635" target="_blank">Yang2635</a></li>
            
            
        </ul>
    </details>
</div>

<div class="footer-col-lg-2">
    <details class="bb bb-ns bb-m bn-l b--white pv2 pv2-ns pv2-m pv0-l" open>
        <summary class="fw6 mt0 flex justify-between mb0 mb0-ns mb0-m mb1-l lh-copy f2 f2-ns f2-m f3-l ">
            <span class="footer-abstract point"><strong>其他</strong></span>
        </summary>
        <ul class="db db-ns db-m db-l ma0 pa0 mt2 mt2-ns mt2-m mt0-l list">
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="/usage/" target="_blank">帮助</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="/privacy/" target="_blank">隐私</a></li>
            
            <li class="mt1 lh-6 "><a class="dotted-underline no-underline f2 fw4 footer-abstract" href="/privacy/#cookie" target="_blank">Cookie偏好</a></li>
            
            
        </ul>
    </details>
</div>

            </div><!-- "/row"-->
            <!--TODO mark-->
            <span class="btn mr-1 color-border-accent-emphasis" title="Under construction">
					<div class="fa fa-bug">
                        <div class="fa fa-hand-point-down"></div>
                        <a href="https://github.com/Bin4xin/bin4xin.github.io/blob/main/.github/workflows/deploy.yml#L46" target="_blank">
                        Clock counter Bug need to FIX.</a>
                    </div>
            </span>

            <div class="pv2-ns">
                <div class="bb bb-ns bb-m bn-l b--white pv2 pv2-ns pv2-m pv0-l flex footer-bottom-row-margin">
                    <!--
   - FlipClock design
   -    @link { https://github.com/objectivehtml/FlipClock }
-->
<link rel="stylesheet" href="/assets/flipclock/flipclock.css">
<script src="/assets/flipclock/flipclock.js"></script>

<div class="clock" style="margin-bottom:2em;margin-top:2em;"></div>
<div class="flex items-center mb3 mb3-ns mb3-m mb0-l lh-1 mt0 mt3-ns" >
    
    
    
    <div id="SentinelLAB"><a class="lh-1 dib mr2" title="SentinelLAB" target="_blank" rel="noopener" href="https://www.vulbox.com/team/ERRORS"></a></div>
    
    
    
    <div id="YouTuBe"><a class="lh-1 dib mr2" title="YouTuBe" target="_blank" rel="noopener" href="https://www.youtube.com/@bin4xin"></a></div>
    
    
    
    <div id="Twitter"><a class="lh-1 dib mr2" title="Twitter" target="_blank" rel="noopener" href="https://twitter.com/bin4xin"></a></div>
    
    
    
    <div id="Linkedin"><a class="lh-1 dib mr2" title="Linkedin" target="_blank" rel="noopener" href="https://www.linkedin.com/#"></a></div>
    
    
    
    <div id="Facebook"><a class="lh-1 dib mr2" title="Facebook" target="_blank" rel="noopener" href="https://www.facebook.com/#"></a></div>
    
    
    
    <div id="Bilibili"><a class="lh-1 dib mr2" title="Bilibili" target="_blank" rel="noopener" href="https://space.bilibili.com/67373868"></a></div>
    
</div>
<!--
  - Ajax @para counts
  - Jquery-return-value-undefined @link { https://stackoverflow.com/questions/13848123/jquery-return-value-undefined }
  -->
<script>
    function getGAJson() {
        let counts = null
        $.ajax({
            url: 'https://bin4xin.sentrylab.cn/assets/ga.json',
            dataType: 'json', // for cross-origin access
            timeout: 1000 * 10, // 10 secs
            async: false,
            success: function(data) { counts = displayPageviews(data.rows); },
            error: function() { console.log('Failed to load Pageviews!'); }
        });
        return counts;
    }
    function displayPageviews(rows) {
        if (rows === undefined) { return; }
        var curPath = window.location.pathname;
        var curFile = curPath.slice(curPath.lastIndexOf('/') + 1); // Sometimes posts will be moved.
        var len = rows.length;
        var cnt = 0;

        for (var i = 0; i < len; ++i) {
            var gaPath = rows[i][0];
            var gaFile = gaPath.slice(gaPath.lastIndexOf('/') + 1);

            if (gaPath === curPath || gaFile === curFile) {
                cnt += parseInt(rows[i][1]);
            }
        }
        return setInitialCount(cnt);
        // ref @link
        //      - { https://cotes.page/posts/fetch-pageviews-from-google-analytics/#web-%E7%AB%AF%E5%A4%84%E7%90%86-ga-%E6%95%B0%E6%8D%AE }
        //      - { https://taoalpha.github.io/blog/2015/06/07/tech-add-google-analytics-pageviews-to-jekyll-blog/ }
    }
    // <!-- @link { https://profile-counter.glitch.me/bin4xin.github.io/count.svg } -->
    function setInitialCount(num) {
        var init_SiteOffset = 66749;
        _value_site_pv = parseInt(num)
        all_counts = init_SiteOffset + _value_site_pv
        return all_counts
    }
    var clock;
    let All_Counts = getGAJson()
    $(document).ready(function() {
            // Instantiate a counter
            clock = new FlipClock($('.clock'), All_Counts , {
            clockFace: 'Counter'
        });
        // Attach a click event to a button an increment the clock
        $('.increment').click(function() {
            //clock.setValue(10); Or you could decrease the clock // clock.decrement();
            clock.increment();
            // Or set it to a specific value
            // clock.setValue(x);
        });
        // Attach a click event to a button a decrement the clock
        $('.decrement').click(function() {
            clock.decrement();
        });
        $('.reset').click(function() {
            clock.reset();
        });
    });
</script>
                </div>
            </div><!-- "/pv5" -->
        </div>
    </div>
    <div class="tertiary d-flex">
        <div class="wrapper">
            <div class="col justify-center flex-wrap-l d-flex justify-content-center">
                <ul class="pa1 table-of-contents flex-xl-justify-between flex-xl-column">
                    <li class="outstanding"><a>© 2019-2025 SENTRYLAB.CN</a></li>
                    <li class="outstanding"><a>SENTINEL SECURITY, LAB</a></li>
                    <li class="outstanding"><a>Jekyll Ver 3.9.3.</a></li>
                </ul>
            </div>
        </div>
    </div>
</div><!--/footerwrap -->

    </body>

    <script src="/assets/js/copy.js"></script>
<!--TODONE.
**FireFox display BUG**
position-fixed in FireFox display position -> none
- Reference:
    - { @link https://developer.mozilla.org/zh-CN/docs/Web/CSS/position#browser_compatibility }
    - { @link https://blog.csdn.net/DDD4V/article/details/123354124 }
    - { @link https://juejin.cn/post/6844904100576886797 }
        - { @link Demo https://codepen.io/li377242494/pen/VwLGGaR }
Fiex In `[assets/css/style.scss](https://github.com/Bin4xin/bin4xin.github.io/blob/main/assets/css/style.scss)`
    - tooltipped css postion.
-->

<!--<link rel="preload" href="https://bobbyhadz.com/_next/static/css/b9669d7c5a48325f.css" as="style"/>-->
<!--<link rel="stylesheet" href="https://bobbyhadz.com/_next/static/css/b9669d7c5a48325f.css" data-n-g=""/>-->

<divs role="tooltip" class="position-fixed bottom-0 mb-4 right-5 mr-4 z-1 transition-200 opacity-0" onclick="$(&quot;html,body&quot;).animate({scrollTop:0}, 1000);">
    <button class="tooltipped tooltipped-n tooltipped-no-delay color-bg-accent-emphasis color-fg-on-emphasis circle border-0" style="width:45px;height:45px"
            aria-label="滚动到顶部">
        <svg aria-hidden="true" role="img" class="octicon octicon-chevron-up" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path fill-rule="evenodd" d="M3.22 9.78a.75.75 0 010-1.06l4.25-4.25a.75.75 0 011.06 0l4.25 4.25a.75.75 0 01-1.06 1.06L8 6.06 4.28 9.78a.75.75 0 01-1.06 0z">
            </path>
        </svg>
    </button>
</divs>


</html>